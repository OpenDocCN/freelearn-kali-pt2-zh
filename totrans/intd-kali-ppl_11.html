<html><head></head><body>
<div id="sbo-rt-content"><div id="_idContainer154">
<h1 class="chapter-number" id="_idParaDest-131"><a id="_idTextAnchor134"/>8</h1>
<h1 id="_idParaDest-132"><a id="_idTextAnchor135"/>Security Incident and Response</h1>
<p>So far, within the realm of cybersecurity defense, we’ve covered a lot of ground surrounding the setup and acquisition of data from various sources and studied how to transport it, organize it, store it, and evaluate it through various methods of analysis. Have you wondered while covering all of these topics what you might do if the data you are analyzing suggests that an actual cyber-attack is occurring or has occurred? After all, it doesn’t do much good going through all of this work to grab, study, and try to decipher the data if we have no plan of action when the data tells us something bad <span class="No-Break">is happening!</span></p>
<p>When our defensive analysis suggests malicious activity is happening, we transform into a new realm of cybersecurity. We go from triaging alerts to a formal action<a id="_idIndexMarker661"/> known as <strong class="bold">incident response</strong>. Oftentimes, organizations will have dedicated workers who specialize in responding to incidents that are usually a career step up from <span class="No-Break">entry-level triage.</span></p>
<p>Kali Purple provides several tools that are designed to assist us in responding to threats, and even take it a step further by actively searching through data for hints of potential future threats or deeply hidden threats. That is known <a id="_idIndexMarker662"/>as <strong class="bold">threat hunting</strong> from a career perspective. Aiding in these <a id="_idIndexMarker663"/>activities, we will examine a <strong class="bold">Security Orchestration and Automation Response</strong> (<strong class="bold">SOAR</strong>) product, which is a more automated, pseudo-<strong class="bold">Artificial Intelligence</strong> (<strong class="bold">AI</strong>) style of<a id="_idIndexMarker664"/> SIEM from a company called StrangeBee – Cortex. StrangeBee also produces an incident response platform <a id="_idIndexMarker665"/>called <strong class="bold">TheHive</strong>, which we will spend a fair amount of time <span class="No-Break">setting up.</span></p>
<p>These two products are capable of integrating with a vast array of threat-hunting and intelligence feeds. In a departure from what we’ve done so far, there is a small challenge section at the end of this chapter so you can go out and find the feeds and integrations that best suit your interests. Not all of the tools you will find are part of the default Kali Purple ecosystem, but you will be surprised at how many of them are compatible and able to be integrated. Some of these tools <a id="_idIndexMarker666"/>might<a id="_idIndexMarker667"/> include <a id="_idIndexMarker668"/>the <strong class="bold">Malware Information Sharing Platform</strong> (<strong class="bold">MISP</strong>), <strong class="bold">Structured Threat Information eXpression</strong> (<strong class="bold">STIX</strong>), and <strong class="bold">Trusted Automated Exchange of Indicator </strong><span class="No-Break"><strong class="bold">Information</strong></span><span class="No-Break"> (</span><span class="No-Break"><strong class="bold">TAXII</strong></span><span class="No-Break">).</span></p>
<p>By the end of this chapter, you will know how to install a Docker container and create a <strong class="source-inline">Docker-compose</strong> YAML file that includes many of the applications we’re discussing here. Expect to cover the <span class="No-Break">following sections:</span></p>
<ul>
<li><span class="No-Break">Incident response</span></li>
<li><span class="No-Break">Docker</span></li>
<li><span class="No-Break">Cortex</span></li>
<li><span class="No-Break">TheHive</span></li>
<li><span class="No-Break">Cha<a id="_idTextAnchor136"/>llenge!</span></li>
</ul>
<h1 id="_idParaDest-133"><a id="_idTextAnchor137"/>Technical requirements</h1>
<p>The technical requirements for this chapter are <span class="No-Break">as follows:</span></p>
<ul>
<li><strong class="bold">Minimum</strong>: A computing device with either <em class="italic">amd64 (x86_64/64-bit)</em> or <em class="italic">i386 (x86/32-bit)</em> architectures. It should contain at least <em class="italic">8 GB</em> <span class="No-Break">of RAM.</span></li>
<li><strong class="bold">Recommended</strong>: Based on feedback from cybersecurity field practitioners, aim for <em class="italic">amd64 (x86_64/64-bit)</em> architecture with <em class="italic">16 GB</em> of RAM – more is better – and up to <em class="italic">64 GB</em> of additional <span class="No-Break">disk space.</span></li>
</ul>
<h1 id="_idParaDest-134"><a id="_idTextAnchor138"/>Incident response</h1>
<p>Sometimes, despite deploying the <a id="_idIndexMarker669"/>best technology and exerting our best efforts, the bad guys still manage to penetrate our security defenses and cause damage in some form or fashion to our information resources. It’s not something any of us want to happen on our watch but the fact of the matter is the day will come when it will. When it does, those of us who are most passionate about the field of cybersecurity tend to take it personally while others might become engaged in a finger-pointing contest. The truth is neither of those mindsets is helpful and, more likely than not, the actual root cause or success of the breach will have nothing to do with any specific analyst. When a security breach, or other unauthorized activity, occurs, we refer to it as an incident. To keep our heads screwed on straight and operate smoothly with an organized and proper reaction, there is a subset of cybersecurity that<a id="_idIndexMarker670"/> has evolved, known as <strong class="bold">security incident </strong><span class="No-Break"><strong class="bold">response</strong></span><span class="No-Break"> (</span><span class="No-Break"><strong class="bold">SIR</strong></span><span class="No-Break">).</span></p>
<p>SIR is usually handled by a team of professionals<a id="_idIndexMarker671"/> sometimes referred to<a id="_idIndexMarker672"/> as a <strong class="bold">cyber security incident response team</strong> (<strong class="bold">CSIRT</strong>) or <strong class="bold">security incident response team</strong> (<strong class="bold">SIRT</strong>). You’ll see references to both out in the wild. For simplicity’s sake, we will simply use the term <strong class="bold">incident response</strong> – or <strong class="bold">IR</strong> – in this chapter. IR is an organized method of reacting to security incidents. It’s a way of putting our personal emotions aside so we can focus on addressing and managing the aftermath of a security breach, cyberattack, or other security incident that has already occurred. IR involves detecting, analyzing, and responding to security threats in the most accurate and efficient manner possible to help limit or otherwise mitigate any damage. It’s a pathway to help recover from an attack as well as to<a id="_idIndexMarker673"/> create educational opportunities to prevent future security incidents of <span class="No-Break">the like.</span></p>
<p>A good IR framework might include <span class="No-Break">the following:</span></p>
<ul>
<li><span class="No-Break">Preparation</span></li>
<li><span class="No-Break">Detection</span></li>
<li><span class="No-Break">Containment</span></li>
<li><span class="No-Break">Eradication</span></li>
<li><span class="No-Break">Recovery</span></li>
<li>Post-incident analysis – aka <strong class="bold">After Action Review</strong> (<strong class="bold">AAR</strong>) or <span class="No-Break">lessons</span><span class="No-Break"><a id="_idIndexMarker674"/></span><span class="No-Break"> learned</span></li>
</ul>
<p>Of course, stopping security incidents altogether would be the most ideal situation, but we all know that’s neither realistic nor likely. Anything that can be made can also be unmade. Anything that can be engineered can also be reverse-engineered. As long as technology exists, so will the exploits of those with ill intentions. Therefore, the ultimate practical goal of IR is to minimize the impact of security incidents, along with improving and maintaining the security and integrity of the affected systems <span class="No-Break">and data.</span></p>
<p>Now that you’ve gained a general idea of what <a id="_idIndexMarker675"/>IR is from a business definition, let’s begin to set up our IR environment first, by creating a fresh virtual machine so we can avoid software conflicts with previous work we’ve done. If you need a refresher on this, go back to <a href="B21223_03.xhtml#_idTextAnchor052"><span class="No-Break"><em class="italic">Chapter 3</em></span></a>. You’ll be surprised at how much you remember. In the next section, we are going to begin in our new VM by acquiring and <span class="No-Break">installing Docker.</span></p>
<p class="callout-heading">Note</p>
<p class="callout">Because our packaged Docker container is <a id="_idIndexMarker676"/>going to include <strong class="bold">Elasticsearch</strong>, which you might already have installed, along with other applications that could conflict with what you have – depending on how experimental you have been, we highly recommend that you create a new virtual machine for <span class="No-Break">this chapter.</span></p>
<p class="callout">The reasons are the suite of software we are bundling in this chapter can function as a standalone SOC and an alternative to the ELK Stack setup you’ve already tried, and also, if you don’t containerize the content in this chapter, you’re quite likely to experience software compatibility and <span class="No-Break">communication conflicts.</span></p>
<p class="callout">Be prepared to experience bonus challenges if you do not heed this advice! (It’s quite okay if you don’t, by the way, since that’s how <span class="No-Break">folks learn.)</span></p>
<h1 id="_idParaDest-135"><a id="_idTextAnchor139"/>Docker</h1>
<p><strong class="bold">Docker</strong> can be <a id="_idIndexMarker677"/>thought of as a cyber-container. Have you ever gone out on a picnic lunch? How did you prepare, store, and distribute/carry your food? You packed it inside a container, right? Perhaps you had a peanut butter and jelly sandwich or two, fruit such as an apple or banana, maybe some celery or carrot sticks, and a juice box or small bottle of water. Then, you placed all of those items inside a single unit. Maybe you called it a lunch box, a picnic basket, or something else. The point is you placed them all inside a container. Though related, they were still each unique with a unique purpose, working together to resolve a unified need – your nutritional need; your hunger. However, the container didn’t just include those items, did it? It also included things you depended on to smoothly enjoy those food items. It included eating utensils, napkins or wet wipes, and perhaps a spice packet or two. It included dependencies. It included everything you needed to fulfill your mission without having to walk around and fetch things from your kitchen or fill your pockets from the open condiments section of your favorite fast food restaurant. No, the container had everything you needed to keep the hunger monster inside <span class="No-Break">you satisfied.</span></p>
<p>Docker <a id="_idIndexMarker678"/>is exactly that. It is a lunchbox – or picnic basket – full of cyber items and their needed dependencies. The suite of software applications we’re building in this chapter will be inside a Docker container. When complete, it will have yet another base for a mini-SOC independent of the ELK Stack as a standalone SOC. However, this suite of tools does have a dependency on Elasticsearch. Furthermore, we are going to <a id="_idIndexMarker679"/>include <strong class="bold">Apache Cassandra</strong> and <strong class="bold">Minio</strong> in <span class="No-Break">the </span><span class="No-Break"><a id="_idIndexMarker680"/></span><span class="No-Break">package.</span></p>
<p>Whenever there’s a large group of software with such interdependencies as you will encounter here, you will deal with regular independent software upgrades, which means regular issues with compatibility. We are going to help you avoid those headaches by deploying the entire suite within the Docker container we just <span class="No-Break">learned about.</span></p>
<p>Before we install Docker, let’s make sure its own core dependencies are in place. Within your fresh Kali Purple VM, type <span class="No-Break">the following:</span></p>
<pre class="console">
sudo apt install apt-transport-https ca-certificates curl gnupg lsb-release</pre> <p>These items will now also ensure that you can install Docker using the standard package manager instead of some of the archaic ways we’ve taught you to find software in this book thus far. One thing is for sure, when you complete this textual journey with us, you will be well-rounded and experienced in many future package-mapping and installation experiences. You might be annoyed at us making you do some things the hard way now, but you’ll thank us for it eventually. In the meantime, imagine actor Dwayne Johnson singing the peppy, melodic song called <em class="italic">You’re Welcome!</em> If you haven’t heard it, search for it on YouTube. That’s exactly what your humble author is like, except with <span class="No-Break">bigger muscles.</span></p>
<p>According to <a href="http://kali.org">kali.org</a>, there <em class="italic">may</em> already be a package named <strong class="source-inline">docker</strong> in your default installation that is not a containerized version. Since we don’t know which version of Kali Purple you’re running by the time you read this, we will need to make a subtle adjustment to our installation plans. We will first try to install something called docker.io, and if you get an error, then you can try the default <strong class="source-inline">docker install</strong>. It’s much simpler than it sounds. First, type <strong class="source-inline">sudo apt update &amp;&amp; sudo apt install -y docker.io</strong> at the command line, and only if you get a warning or error, either now or after the next step, you can type <strong class="source-inline">sudo apt install -y docker</strong> (no need to update again since you just did that). If you continue to get an error, you should type <strong class="source-inline">sudo systemctl daemon-reload</strong> and then reboot before attempting the following command again, and if you still receive an error, you can type it a third time but append <strong class="source-inline">–-now</strong> to the end <span class="No-Break">of it.</span></p>
<p>When you’ve finished installing <a id="_idIndexMarker681"/>Docker, you’ll want to bind it to autostart when you launch or reboot your VM. Type <strong class="source-inline">sudo systemctl </strong><span class="No-Break"><strong class="source-inline">enable docker</strong></span><span class="No-Break">.</span></p>
<p>Now, let’s start it up and make sure all is working as intended. By now, you’re surely familiar with this process. Type <strong class="source-inline">sudo systemctl start docker</strong> to start the service. Now, type <strong class="source-inline">sudo systemctl status docker</strong> and it should show as active (running), as seen in <span class="No-Break"><em class="italic">Figure 8</em></span><em class="italic">.1</em>. You can press <em class="italic">Ctrl</em> + <em class="italic">Z</em> to break out of the <span class="No-Break">status screen:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer123">
<img alt="Figure 8.1 – Docker status screen" height="704" src="image/B21223_08_1.jpg" width="1250"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.1 – Docker status screen</p>
<p>Once you’ve confirmed Docker is up and running properly, you’ll want to do yourself a favor and set a command that will allow you to use it without typing <strong class="source-inline">sudo</strong> before every command by adding yourself to the Docker group. Type <strong class="source-inline">sudo usermod -aG </strong><span class="No-Break"><strong class="source-inline">docker $USER</strong></span><span class="No-Break">.</span></p>
<p>We’re not done yet but, at this point, we recommend rebooting your system. Give it a chance to fully load and then try checking the status again by typing <strong class="source-inline">sudo systemctl status docker</strong> to make sure <a id="_idIndexMarker682"/>Docker <span class="No-Break">automatically started.</span></p>
<p>Now, it’s time to create the YAML file that will pull and configure the resources we want to have inside our container. First, let’s make the directory where that file will reside. Type <strong class="source-inline">mkdir security-stack</strong> and for the sake of keeping things simple, let’s go into that directory by typing <strong class="source-inline">cd security-stack</strong>. Now, we’re going to do something rather neat in the world of containers. Think of the lunchbox container we described a few moments ago. Now, imagine such a lunchbox that has multiple sections inside of it – one for the cold and/or wet items and one for the dry items. It’s like having multiple containers inside of a <span class="No-Break">larger container.</span></p>
<p>Docker has created a tool for us to do the same<a id="_idIndexMarker683"/> thing, called <strong class="bold">Docker Compose</strong>. We can define the items in Docker Compose by creating our own YAML file. Those are the files with the <strong class="source-inline">.yml</strong> file extensions that you’ve been editing throughout this book to configure the applications that you’ve been using. Let’s create our file now by typing <strong class="source-inline">nano docker-compose.yml</strong>. While still in your Kali Purple instance (unless you configured it to allow cut and paste to be shared between your host and VM), open a web browser and go to the following <span class="No-Break">URL: </span><a href="https://docs.strangebee.com/thehive/installation/docker/#quick-start"><span class="No-Break">https://docs.strangebee.com/thehive/installation/docker/#quick-start</span></a><span class="No-Break">.</span></p>
<p>The only way to ensure we have the most up-to-date compatibility between applications is to grab the suggested Docker Compose YAML file directly from <strong class="bold">StrangeBee</strong>. This way, no <a id="_idIndexMarker684"/>matter how long after this is published you read it, you’ll still be able to successfully run Docker Compose. On the web page, under <strong class="bold">quick start</strong>, copy the data from the proposed <strong class="source-inline">docker compose</strong> file and paste it inside the open <strong class="source-inline">docker-compose.yml</strong> file you recently created. The data should resemble what you see in <span class="No-Break"><em class="italic">Figure 8</em></span><em class="italic">.2</em> but may have <span class="No-Break">subtle differences</span><span class="No-Break">:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer124">
<img alt="Figure 8.2 – Beginning of StrangeBee’s docker-compose.yml" height="642" src="image/B21223_08_2.jpg" width="717"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.2 – Beginning of StrangeBee’s docker-compose.yml</p>
<p>Once you are finished pasting the data into the YAML file, you can press <em class="italic">Ctrl</em> + <em class="italic">X</em> to exit the file and select <em class="italic">Y</em> to save <span class="No-Break">when prompted.</span></p>
<p>After you return to the command prompt, we recommend typing <strong class="source-inline">cat docker-compose.yml</strong>, which displays a non-editable – read-only – display of the file’s contents. Double-check it against the information on the web page and then we highly recommend rebooting your system one <span class="No-Break">more time.</span></p>
<p>Upon returning from the reboot, again confirm that Docker<a id="_idIndexMarker685"/> is up and running by typing <strong class="source-inline">systemctl status docker</strong> and then move into the directory where your <strong class="source-inline">docker-compose.yml</strong> file resides by typing <strong class="source-inline">cd security-stack</strong>. Now, it’s time to fire it up! Type <strong class="source-inline">docker-compose up -d</strong> and enjoy watching the various containers load in front of your eyes unless you’re prompted to install the <strong class="source-inline">docker-compose</strong> command, in which case you should dramatically roll your eyes, grunt in annoyance, and then press <strong class="source-inline">y</strong> to install the command before again attempting to type <strong class="source-inline">docker-compose up -d</strong>. If you continue to have problems, make absolutely certain that you’re in the directory where your <strong class="source-inline">docker-compose.yml</strong> file is, and that you’ve rebooted your system. Sometimes, it takes a few minutes for all of these technologies you’re working with to start working fully together. We’ve found jumping up and down and pumping your fists in anger to be very helpful in scenarios like that. That’s primarily because it usually distracts you long enough to allow the technologies to start up and begin to communicate <span class="No-Break">as desired:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer125">
<img alt="Figure 8.3 – Docker Compose containers loading" height="708" src="image/B21223_08_3.jpg" width="800"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.3 – Docker Compose containers loading</p>
<p>After the containers load, there are two more commands you will want to know. They are <strong class="source-inline">docker ps</strong> and <strong class="source-inline">docker-compose ps</strong>. Both serve the same function of showing you the status of all <a id="_idIndexMarker686"/>Docker containers simultaneously. However, they each have their own benefit. The <strong class="source-inline">docker ps</strong> command will provide container IDs at the beginning of each line so that you can execute container-specific commands. Such commands might be to start, stop, pause, unpause, or view logs specific to that container. Those commands, however, are executed within Docker Compose. Remember, you must be inside the security-stack directory in order to execute Docker <span class="No-Break">Compose commands:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer126">
<img alt="Figure 8.4 – docker ps shows the state of the containers with container IDs" height="139" src="image/B21223_08_4.jpg" width="557"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.4 – docker ps shows the state of the containers with container IDs</p>
<p>And here is the <span class="No-Break">other one:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer127">
<img alt="Figure 8.5 – Docker-compose ps shows the state of the containers in summary" height="220" src="image/B21223_08_5.jpg" width="717"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.5 – Docker-compose ps shows the state of the containers in summary</p>
<p>You likely will need to run the <strong class="source-inline">docker-compose up -d</strong> command after a reboot to get all of the containers up and running again. That said, let’s start examining this group of applications as they relate to the overall IR environment we are creating in this chapter. First up <a id="_idIndexMarker687"/>is <strong class="bold">Cortex</strong>, which is the centerpiece of our <span class="No-Break">IR solution.</span></p>
<h1 id="_idParaDest-136"><a id="_idTextAnchor140"/>Cortex</h1>
<p>Cortex is a<a id="_idIndexMarker688"/> security product that<a id="_idIndexMarker689"/> helps to facilitate <strong class="bold">security orchestration automation and response</strong> (<strong class="bold">SOAR</strong>) activities. Many consider Cortex the most crucial component of incident response because it serves as a sort of IR operating system. This is because it integrates with – <em class="italic">marries</em>, if you will – other IR tools with automation to create a streamlined process of working IR. In doing so, Cortex is able to more directly address some of the more common challenges that are faced by today’s SOCs and CSIRTs, as well as professional security researchers, during the threat intelligence and digital forensics portions of the <span class="No-Break">IR process.</span></p>
<p>Before installing it, let’s take a look at a few things that make <span class="No-Break">Cortex special:</span></p>
<ul>
<li><strong class="bold">Analyzer and responder integration</strong>: Cortex <a id="_idIndexMarker690"/>provides a very robust framework to be used for integrating and executing analyzers and responders. Analyzers are software utilities that are used to perform security analysis tasks, such as enriching observable data – we talked about data enrichment in the first four chapters, conducting malware analysis, or executing queries/searches from differing sources of data. Responders help to enable automated response actions such as isolating endpoints, blocking potentially malicious IP addresses, dealing with file hashes and artifacts, or sending notifications. Cortex has an architecture that allows custom analyzers and responders to be integrated, which enables organizations using the product to tailor Cortex to fit their unique business <span class="No-Break">security needs.</span></li>
<li><strong class="bold">Pluggable architecture</strong>: The pluggable architecture is the part of Cortex that is designed to accept customized analyzers and responders. It is what makes the integrations <span class="No-Break">mechanically possible.</span></li>
<li><strong class="bold">RESTful API</strong>: Cortex provides a RESTful API that is also often referred to as a <strong class="bold">REST API</strong> to <a id="_idIndexMarker691"/>support seamless integration with external systems, applications, and security tools. What does that mean? Those of you who’ve worked, or presently work, in software development likely have a thorough understanding of this concept already. For everyone else, let’s break it down just a <span class="No-Break">little bit.</span><p class="list-inset">We’ve talked about what an API is in broad terms but what does it really do? The <strong class="bold">Application Programming Interface</strong> (<strong class="bold">API</strong>) is <a id="_idIndexMarker692"/>something that defines the rules for how two different software systems will communicate with each other. Developers create these sets of rules in the form of an API to explain to any external applications how they should interact with their own applications from a <span class="No-Break">programming perspective.</span></p><p class="list-inset">The <strong class="bold">REST</strong> acronym stands<a id="_idIndexMarker693"/> for <strong class="bold">Representational State Transfer</strong>, which is a software architecture that provides guidelines on how APIs should work. It’s somewhat of a case of who’s watching the watchdog, with<a id="_idIndexMarker694"/> the <em class="italic">watchdog</em> being the API setting the rules and<a id="_idIndexMarker695"/> the <em class="italic">who</em> being REST. It was created with the idea that it would help manage inter-application communications within the most complex internet networks. It’s known for contributing to high performance, which translates into faster application loading and data retrieval for us mere mortals. REST provides a high level of visibility into cross-platform portability communications, implementations, and modifications. It is stateless, which means all necessary data must be contained within the communications between the client and server because the server will not store or record the client’s connection status. There is an abundance of resources if you wish to learn more about the RESTful API. We’ll toss a couple of links in the <em class="italic">Further reading</em> section at the end of <span class="No-Break">this chapter.</span></p></li>
<li><strong class="bold">Multi-tenancy</strong>: Making Cortex especially useful is the implementation of multi-tenancy support. Some of you might hear that term and think that it means a single instance of Cortex can handle multiple organizations or customers. Yes, that is true, but it’s more than that. Multi-tenancy can also refer to a more precise segmentation based on organizational units, teams, or specific use cases. This can help larger organizations manage multiple unrelated scenarios while employing separation of duties with their personnel. Separation of duties is used to make sure no single person has all of the security and access permissions of any environment, reducing potential damage from insider threats. Keep in mind that insider threats do not always occur with malicious intent. A super awesome and honest high-performing employee who makes a simple mistake, maybe even due to no fault of their own, is considered an insider threat in terms of cybersecurity. The key takeaway here is that Cortex allows segmentation within <span class="No-Break">its deployment.</span></li>
<li><strong class="bold">Scalability and performance</strong>: We’ve<a id="_idIndexMarker696"/> already talked about how scalability, when applied to technology, means having the ability to increase the size and scope of the technology seamlessly, and possibly even suddenly, without adversely affecting the availability of organizational resources. This is yet another example of a software developer considering the <em class="italic">A</em> from<a id="_idIndexMarker697"/> the <strong class="bold">CIA Triad</strong> we talked about in <a href="B21223_01.xhtml#_idTextAnchor013"><span class="No-Break"><em class="italic">Chapter 1</em></span></a>. Cortex is built to efficiently handle very large volumes of information while maintaining high performance and reliability in support of <span class="No-Break">security operations.</span></li>
<li><strong class="bold">Integration with TheHive</strong>: Cortex is very tightly integrated with TheHive, which we will discuss in the next section. In fact, it was created by the same folks who created<a id="_idIndexMarker698"/> TheHive. In a nutshell, TheHive submits observable security information to Cortex, where it can be handled through automation and then returned to TheHive for<a id="_idIndexMarker699"/> a more streamlined and efficient analysis, and, if applicable, investigation <span class="No-Break">and response.</span></li>
</ul>
<p>Now that we’ve covered a basic overview of what Cortex is, what its key features are, and what it can do, we should go play in the dirt. It’s much more fun than staring at it, wouldn’t you say? Unlike previous chapters, we don’t need to go through step-by-step procedures to install any of the packages in this and the next chapter because they have all already been installed, along with their dependencies, via Docker Compose. So, now, all we do is make sure everything is still up and running – in case you took a break since reading that section. Review the end of the section with the screenshots showing <strong class="source-inline">docker-compose ps</strong> and <strong class="source-inline">docker ps</strong>. Either restart any down processes or just try to restart the entire group by typing <strong class="source-inline">docker-compose up -d</strong>. It is mission-critical that you are very patient with this process. When you try to load Cortex in your browser in the next step, you might get an error if Cortex is still loading in the background. Just wait a minute or two and <span class="No-Break">try again.</span></p>
<p>You can access Cortex<a id="_idIndexMarker700"/> using your web browser. Depending on your individual setup, you will want to make sure you have port forwarding enabled within your Kali Purple VM instance, assigning port <strong class="source-inline">9001</strong> to your Cortex access. You can review <a href="B21223_05.xhtml#_idTextAnchor085"><span class="No-Break"><em class="italic">Chapter 5</em></span></a> if you want a refresher<a id="_idIndexMarker701"/> on <strong class="bold">port forwarding</strong>. While we’re at it, let’s just get all of the port forwards put in place right now. Then, we won’t have to keep going back. Forward ports <strong class="source-inline">80</strong>, <strong class="source-inline">443</strong>, <strong class="source-inline">9000</strong>, <strong class="source-inline">9001</strong>, <strong class="source-inline">9042</strong>, <strong class="source-inline">9090</strong>, <strong class="source-inline">9200</strong>, and <strong class="source-inline">9300</strong> as you see in <span class="No-Break"><em class="italic">Figure 8</em></span><span class="No-Break"><em class="italic">.6</em></span><span class="No-Break">:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer128">
<img alt="Figure 8.6 – Port forwards needed for this VM instance" height="575" src="image/B21223_08_6.jpg" width="1416"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.6 – Port forwards needed for this VM instance</p>
<p>When your port forwarding is set up, open up the appropriate browser (host or guest OS) based on your preferences and point the URL to <a href="http://127.0.0.1:9001">http://127.0.0.1:9001</a>, where you might be prompted to have <a id="_idIndexMarker702"/>Cortex update its database, as seen in <span class="No-Break"><em class="italic">Figure 8</em></span><span class="No-Break"><em class="italic">.7</em></span><span class="No-Break">:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer129">
<img alt="Figure 8.7 – Cortex initial access requests a database update" height="172" src="image/B21223_08_7.jpg" width="451"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.7 – Cortex initial access requests a database update</p>
<p>Select the <strong class="bold">Update Database</strong> button and you will be prompted to create an administrator account as seen in <span class="No-Break"><em class="italic">Figure 8</em></span><em class="italic">.8</em>. To be clear, the value you enter in the <strong class="bold">Login</strong> field will become the username. The value you enter in the <strong class="bold">Name</strong> field is simply an identity of the type of account. As you can see, we called our super admin <strong class="source-inline">Packt Super Admin</strong>. Fill in your desired values and select the <strong class="bold">Create</strong> button <span class="No-Break">to continue:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer130">
<img alt="Figure 8.8 – Cortex initial admin account creation" height="435" src="image/B21223_08_8.jpg" width="783"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.8 – Cortex initial admin account creation</p>
<p>You’ll be redirected to the <a id="_idIndexMarker703"/>regular login page, which is the page you will see moving forward whenever you go to access Cortex. You can now log in with the credentials that you <span class="No-Break">just created:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer131">
<img alt="Figure 8.9 – Default Cortex login screen after initial admin account creation" height="479" src="image/B21223_08_9.jpg" width="564"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.9 – Default Cortex login screen after initial admin account creation</p>
<p>You may recall that we discussed a little earlier how Cortex supports multi-tenancy. That is, it supports a fragmented setup where groups of users can be isolated from other groups if their assignments are not related or with the same company or team. The page that loads immediately after logging in is where we begin to manage this multi-tenancy. Do not be misled by the <strong class="bold">Organizations</strong> label. It could just as easily have been labeled <strong class="bold">Segments</strong>, <strong class="bold">Teams</strong>, <strong class="bold">Pods</strong>, or pretty much anything that describes a deliberate isolation from the other groups. It is here you will create your organizations, as shown in <span class="No-Break"><em class="italic">Figure 8</em></span><span class="No-Break"><em class="italic">.10</em></span><span class="No-Break">:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer132">
<img alt="Figure 8.10 – Cortex Organizations and Users tabs for multi-tenancy management" height="663" src="image/B21223_08_10.jpg" width="717"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.10 – Cortex Organizations and Users tabs for multi-tenancy management</p>
<p>In the preceding<a id="_idIndexMarker704"/> screenshot, you can also see a <strong class="bold">Users</strong> option if you look across the top-right navigation, next to the logged-in username. There, you can create and manage additional users, including assigning roles <span class="No-Break">and permissions.</span></p>
<p>Select the <strong class="bold">Organizations</strong> tab. There, you can create new organizations and manage the ones you already have. Go ahead and select the <strong class="bold">+ Add organization</strong> button at the top left to create a new organization. It’s pretty self-explanatory at this point. Enter a name for your organization in the <strong class="bold">Name</strong> field and a description of your organization in the <strong class="bold">Description</strong> field. <span class="No-Break"><em class="italic">Figure 8</em></span><em class="italic">.11</em> shows an example. Select <strong class="bold">Save</strong> when <span class="No-Break">you’ve finished:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer133">
<img alt="Figure 8.11 – Creating an organization in Cortex" height="382" src="image/B21223_08_11.jpg" width="1349"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.11 – Creating an organization in Cortex</p>
<p>Now, let’s create a<a id="_idIndexMarker705"/> user to add to that organization. Select the <strong class="bold">Users</strong> tab. There, you will notice that we also have the option to create API keys for authentication or lock the accounts completely. It is through this feature that you will get TheHive to integrate with Cortex. First, create <span class="No-Break">the user.</span></p>
<p>Select the <strong class="bold">Add user</strong> button at the top left of the page to create a <span class="No-Break">new user:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer134">
<img alt="Figure 8.12 – Cortex Add user button" height="523" src="image/B21223_08_12.jpg" width="422"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.12 – Cortex Add user button</p>
<p>You will create a user named <strong class="bold">TheHive</strong> and it may be a good practice – depending on your organization’s setup<a id="_idIndexMarker706"/> and <strong class="bold">Service-Level Agreements</strong> (<strong class="bold">SLAs</strong>) that you might have established with these customer organizations – to give that original user general administrative roles as well as reading and analyzing since the admin of the organization is likely to be the first account you’re creating for it. It is certainly possible that you have it arranged for organizations to not have dedicated admin – if you’re providing that service yourself or your organization is, as <a id="_idIndexMarker707"/>opposed to the customer managing their own organization within <span class="No-Break">your environment:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer135">
<img alt="Figure 8.13 – Cortex Add user window" height="522" src="image/B21223_08_13.jpg" width="859"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.13 – Cortex Add user window</p>
<p>You might have noticed there is no option to set the password. That option is provided after you click <strong class="bold">Save user</strong> and return to the default <strong class="bold">Users</strong> screen, which you can see in <span class="No-Break"><em class="italic">Figure 8</em></span><em class="italic">.13</em>. You will notice the first row offers an opportunity to edit the password. That’s what will show when a password <span class="No-Break">already exists.</span></p>
<p>When a password needs to be created from scratch, it will instead provide you the option to create a <a id="_idIndexMarker708"/>new password, as you see in the second row. To do that, go ahead and click <strong class="bold">New password</strong> and a field will appear in place of the button. Type your password into that field and press the <em class="italic">Enter</em> key on your keyboard. You’ll then need to refresh your page for the button display to switch to <span class="No-Break"><strong class="bold">Edit password</strong></span><span class="No-Break">.</span></p>
<p>You’ll also notice at the very end of the second row that you have an option to lock the user. That will be the case for everyone you create except the default super user. That should be pretty self-explanatory; it locks the user and prevents them from having access <span class="No-Break">to Cortex:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer136">
<img alt="Figure 8.14 – Edit password, New password, Create API Key, and Lock" height="287" src="image/B21223_08_14.jpg" width="689"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.14 – Edit password, New password, Create API Key, and Lock</p>
<p>Lastly, let’s create an <a id="_idIndexMarker709"/>API key for our users. For the user you just created, select the <strong class="bold">Create API Key</strong> button and it will create the API key, transforming the display into three button options – <strong class="bold">Renew</strong>, <strong class="bold">Revoke</strong>, and <strong class="bold">Reveal</strong>, as you see in the first row of <span class="No-Break"><em class="italic">Figure 8</em></span><em class="italic">.14</em>. To see the API that Cortex created for you, select the <strong class="bold">Reveal</strong> button and a value box will appear showing the key, as you see in the second row of <span class="No-Break"><em class="italic">Figure 8</em></span><span class="No-Break"><em class="italic">.15</em></span><span class="No-Break">:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer137">
<img alt="Figure 8.15 – Create, Renew, Revoke, and copy the API key" height="355" src="image/B21223_08_15.jpg" width="1010"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.15 – Create, Renew, Revoke, and copy the API key</p>
<p>To save space, the API is truncated, and you’ll only see the beginning of it. That’s okay, because as those of you who are astute observers will have already noticed, the international symbol for copy contents is in a small box to the right of the truncated API key field. Select the image with two pieces of paper to automatically copy the contents of your API key to your clipboard. Record that value somewhere safe and reference it any time you’d like to integrate another tool with Cortex using this specific user. Remember to pay attention to this user’s purpose. They don’t have to be a unique human; they could be a service account. Some of the more complex setups may have multiple service accounts for integrating with <span class="No-Break">other tools.</span></p>
<p>This feature is the bread and butter of this entire section. After you finish the next section, you should start to be able to visualize how the IR tool known as TheHive integrates with a SOAR product, which itself integrates with the Elasticsearch database we learned about near the beginning of <span class="No-Break">this book.</span></p>
<p>In this section, you learned that a SOAR is used to manage and automate security tasks as they relate to the total incident response process and that Cortex is such a product. You also gained insight into how the various products in <em class="italic">Introduction to Kali Purple</em> are designed to work together as a full unit, giving anyone who takes the time to fully implement and integrate them the makings of a home-built SOC. You now have Cortex installed and configured, along with some elements of TheHive, which we will dive into a little deeper in the next section. That said, let’s move on to TheHive, which is the application that will utilize the features of Cortex and fill in a few gaps we’ve yet <span class="No-Break">to cover.</span></p>
<h1 id="_idParaDest-137"><a id="_idTextAnchor141"/>TheHive</h1>
<p>Kali Purple offers <a id="_idIndexMarker710"/>TheHive as an open source <strong class="bold">Security Incident Response Platform</strong> (<strong class="bold">SIRP</strong>). TheHive now falls under the umbrella of a company called StrangeBee. StrangeBee <a id="_idIndexMarker711"/>was co-founded by Jerome Leonard, Nabil Adouani, and Thomas Franco, who are also TheHive’s creators. Also falling under StrangeBee is a product called Cortex, which should be quite familiar to you since we just discussed it in the previous section. TheHive is a SIRP that was built to integrate with Cortex and also with the extremely well-known MISP. If you presently work in a cybersecurity profession, odds are you’ve already worked with MISP. We will cover that in the <span class="No-Break">next section.</span></p>
<p>TheHive was built to streamline the process of managing security incidents. The creators realized the best way to achieve streamlining was to ensure everybody had access to the same threat data, hence the integration with the MISP, which was built specifically for that purpose. TheHive is equipped with a comprehensive set of IR features and enhancements. Let’s take a bird’s-eye view of these features <span class="No-Break">and enhancements:</span></p>
<ul>
<li><strong class="bold">Case management</strong>: TheHive<a id="_idIndexMarker712"/> provides a centralized location for organizing and managing security incident cases. Cybersecurity analysts can create, update, and track the progress of individual cases, providing a structured and organized approach to incident handling. In fact, you can either enter a case ID for quick access or create a brand new case from the top ribbon of TheHive’s GUI, as seen in <span class="No-Break"><em class="italic">Figure 8</em></span><span class="No-Break"><em class="italic">.16</em></span><span class="No-Break">:</span></li>
</ul>
<div>
<div class="IMG---Figure" id="_idContainer138">
<img alt="Figure 8.16 – TheHive case creation" height="321" src="image/B21223_08_16.jpg" width="1300"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.16 – TheHive case creation</p>
<ul>
<li><strong class="bold">Task management</strong>: The product allows users to manage tasks by giving them permission to assign and track the precise tasks that might be associated with any specific incident response scenario. Having this feature provides a level of accountability among the analysts, not to mention it further facilitates collaboration <span class="No-Break">and coordination.</span></li>
<li><strong class="bold">Observables management</strong>: Observables are items that analysts can physically see that might be worth categorizing and tracking independently and by themselves. This is because they could affect numerous incident response cases in one form or another. To further explain: Think of an IP address that turns out to have a poor OSINT reputation and is generally considered to be malicious in nature. By tracking this IP address by itself, analysts would be able to correlate malicious activity across many different incident response scenarios if there was a broad malicious campaign coming from the address, such as a phishing campaign. Such an event would likely affect many different organizations and involve many different incident response scenarios. IP addresses are something analysts can physically see. Therefore, they’re observable. Other observables may include domain names, URLs, and hashes. In TheHive, analysts can categorize and track any of these observables for more effective <span class="No-Break">incident response.</span></li>
<li><strong class="bold">Reporting and analysis</strong>: Knowing <a id="_idIndexMarker713"/>where our own potential weaknesses are is critical for a mature SOC. This security solution includes reporting and analysis tools that allow users to generate fully comprehensive reports on security incidents. They can also use the software to report on security trends and performance metrics. This feature empowers organizations to gain insights from within their own security posture overall, as well as their individual incident <span class="No-Break">response capabilities.</span></li>
<li><strong class="bold">Collaboration</strong>: We’ve talked about it several times now and it cannot be overstated. This security solution offers collaboration as a key feature because it’s one of the core values of TheHive’s manner of operations. This collaboration is accomplished by providing a shared workspace for incident responders so they can work together to resolve the security incidents they are facing. This is set up so that the collaboration can occur in real time, providing IR folks with a manner of sharing insights, knowledge, and best practices as they <span class="No-Break">are needed.</span></li>
<li><strong class="bold">Playbook automation</strong>: Cybersecurity analysts can create and execute automated playbooks in TheHive. <strong class="bold">Playbooks</strong> are <a id="_idIndexMarker714"/>predefined workflows for common incident response scenarios. If you think of a flow chart that you might have studied or created when you were in school, a workflow is pretty much the same thing. It’s a visual flow of the step-by-step corrective actions needed to respond to a particular security event. Playbooks are these same workflows set up in advance for the sake of universal response and are often automated for the sake of creating a streamlined approach to any repetitive tasks, thereby ensuring a consistent and effective response to security incidents. It can also save considerable time on human interaction while avoiding <span class="No-Break">human error.</span></li>
<li><strong class="bold">Integrations</strong>: TheHive offers integrations with a very wide range of security tools and platforms, creating seamless data sharing and orchestration of incident response activities. Some of these integrations include Cortex, MISP <span class="No-Break">Active Directory:</span><ul><li><strong class="bold">Lightweight Directory Access Protocol</strong> (<strong class="bold">LDAP</strong>), <strong class="bold">Active Directory Federation Services</strong> (<strong class="bold">ADFS</strong>), email services, other<a id="_idIndexMarker715"/> reporting, and metrics platforms, SIEM <a id="_idIndexMarker716"/>and SOAR platforms, threat intelligence feeds, and other collaboration and communication <a id="_idIndexMarker717"/>tools. The integrations promote the enhanced interoperability of TheHive with other <span class="No-Break">security solutions.</span></li></ul></li>
<li><strong class="bold">Customization</strong>: TheHive users have the ability to customize their experience by creating personalized templates, playbooks, and dashboards tailored to their organization’s specific <span class="No-Break">IR needs.</span></li>
<li><strong class="bold">Scalability</strong>: As you likely already know, scalability refers to the capability of a system, network, or process to handle a growing amount of work, sometimes quickly and unexpectedly, or at least have the potential to be quickly enlarged to handle such organizational growth. It is typically only used when talking within the context of software and technology. The word scalability itself is often used in reference to a rapid need to adapt to increased demands on resources without compromising the performance, reliability, or functionality of the product. Scalability is considered a capability <span class="No-Break">of TheHive.</span></li>
<li><strong class="bold">Historical data retention</strong>: A necessary feature for any security-oriented application is to preserve the history of what happened. We could spend all day talking about why this is to include lessons learned, trend analysis, clueing in future analysts to potential resolutions, forensic investigations, government regulations, having proof if needed in a legal court case, or simply having knowledge available for continuous process improvement. TheHive preserves historical incident data and provides a repository of past security incidents along with <span class="No-Break">their </span><span class="No-Break"><a id="_idIndexMarker718"/></span><span class="No-Break">resolutions.</span></li>
</ul>
<p>When you’re ready to access TheHive, open up another browser tab and point the URL to <a href="http://127.0.0.1:9000">http://127.0.0.1:9000</a>, where you will be presented with the login screen. Luckily for you, a default administrator account is already created with TheHive, as seen in <span class="No-Break"><em class="italic">Figure 8</em></span><em class="italic">.17</em>. Your initial login will be to that account. Type <strong class="source-inline">admin</strong> for your username and <strong class="source-inline">secret</strong> for the password. Then<a id="_idIndexMarker719"/> click the <strong class="bold">Let me in</strong> button to formally <span class="No-Break">gain access:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer139">
<img alt="Figure 8.17 – TheHive default login screen" height="595" src="image/B21223_08_17.jpg" width="1200"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.17 – TheHive default login screen</p>
<p>After you log in for the first time, you might notice the absence of case management and the ability to create cases that we previously mentioned. That’s because admin roles are to manage the organizations and users, not the cases themselves. Users will manage the cases. So, the first thing you’ll want to do is to create a user with the analyst role assigned to them so that you can create and manage cases with that user! However, in order to create a user with the analyst role, we first need to have an organization that has that role available. The default admin organization will not be adequate for creating any users who are <span class="No-Break">not admin.</span></p>
<p>Since we are setting up TheHive for the very first time, there will not already be an organization in place with the correct options. So, let’s create one. In fact, let’s create the exact same organization we created in Cortex! Select the <strong class="bold">Organisations</strong> field from the left column of the default view, as highlighted in <span class="No-Break"><em class="italic">Figure 8</em></span><em class="italic">.18</em>, and then select the plus icon on the far left of the <span class="No-Break">top ribbon:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer140">
<img alt="Figure 8.18 – TheHive – create an organization" height="644" src="image/B21223_08_18.jpg" width="857"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.18 – TheHive – create an organization</p>
<p>The main<a id="_idIndexMarker720"/> screen will be grayed out and you will get a popup on the right for you to fill out the details of the organization you wish <span class="No-Break">to create:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer141">
<img alt="Figure 8.19 – TheHive main screen grays out when we create an organization" height="93" src="image/B21223_08_19.jpg" width="267"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.19 – TheHive main screen grays out when we create an organization</p>
<p>Go ahead<a id="_idIndexMarker721"/> and fill in all of the same details from the organization we created in Cortex for TheHive organization creation. For now, leave <strong class="bold">Tasks sharing rule</strong> and <strong class="bold">Observables sharing rule</strong> set to <strong class="bold">manual</strong>. Setting the autoshare for tasks is meant for teams who are working together on a project. We’re just going to create one user for this organization. However, if we were to assign an entire team to this organization, we might consider setting <strong class="bold">Tasks sharing rule</strong> to <strong class="bold">autoshare</strong> so that all members of the team could be equally informed and involved in the resolution of the task. <strong class="bold">Observables sharing rule</strong> is for sharing observable data such as <strong class="bold">Indicators of Compromise</strong> (<strong class="bold">IoCs</strong>) or <a id="_idIndexMarker722"/>information gleaned from threat intelligence feeds. Setting this to <strong class="bold">autoshare</strong> helps to produce timely dissemination of critical information to the appropriate stakeholders. Select the <strong class="bold">Confirm</strong> button at the bottom right of your screen to finalize the creation of <span class="No-Break">the organization:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer142">
<img alt="Figure 8.20 – TheHive – create an organization screen" height="464" src="image/B21223_08_20.jpg" width="653"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.20 – TheHive – create an organization screen</p>
<p>The pop-up <a id="_idIndexMarker723"/>window will go away. However, since it was a pop-up window instead of another page, it’s possible you may need to refresh the page for your new organization to show up in the default listing. We recommend waiting 10 to 20 seconds first. Give the application time to do its <span class="No-Break">background work:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer143">
<img alt="Figure 8.21 – TheHive default organization screen with our newly added organization" height="384" src="image/B21223_08_21.jpg" width="1218"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.21 – TheHive default organization screen with our newly added organization</p>
<p>To create your first <a id="_idIndexMarker724"/>user, which will be a non-administrative user, you have two options. First, you can select the name of the new organization you just created and then select <strong class="bold">Add User</strong> from the main windowpane, as you see in <span class="No-Break"><em class="italic">Figure 8</em></span><em class="italic">.22</em>, and then proceed to the third step in the <span class="No-Break">instructions ahead:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer144">
<img alt="Figure 8.22 – TheHive organization details screen with the option to add a new user" height="598" src="image/B21223_08_22.jpg" width="1456"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.22 – TheHive organization details screen with the option to add a new user</p>
<p>Alternatively, you can proceed with the following steps, which will only be effective if the organization has been <span class="No-Break">created first:</span></p>
<ol>
<li>Select and click the icon showing three human silhouettes in the left column of the default page after logging in. We will call that the <strong class="bold">users</strong> icon. It’s highlighted in <span class="No-Break"><em class="italic">Figure 8</em></span><em class="italic">.23</em> if you need help identifying <span class="No-Break">the icon.</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer145">
<img alt="Figure 8.23 – TheHive selecting the Users icon in the left column" height="626" src="image/B21223_08_23.jpg" width="657"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.23 – TheHive selecting the Users icon in the left column</p>
<ol>
<li value="2">Then, after you<a id="_idIndexMarker725"/> click the human silhouettes, select, and click the large plus symbol near the top left of the <strong class="bold">Users</strong> page. This is also reflected in <span class="No-Break"><em class="italic">Figure 8</em></span><em class="italic">.24</em>. It’s very important that you do this after you first select the <strong class="bold">users</strong> icon. Otherwise, the plus will not add a new user but instead a <span class="No-Break">new organization!:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer146">
<img alt="Figure 8.24 – TheHive selecting the plus on the Users screen to create a new user" height="148" src="image/B21223_08_24.jpg" width="527"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.24 – TheHive selecting the plus on the Users screen to create a new user</p>
<ol>
<li value="3">Once you do this, the page will be grayed out and a pop-up window will appear on the right portion of the page asking you to input details for the <span class="No-Break">new user:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer147">
<img alt="Figure 8.25 – TheHive Adding a User popup with grayed-out main window" height="246" src="image/B21223_08_25.jpg" width="705"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.25 – TheHive Adding a User popup with grayed-out main window</p>
<ol>
<li value="4">Under <strong class="bold">Type</strong>, the value <a id="_idIndexMarker726"/>should default to <strong class="bold">Normal</strong> and you should leave it that way. That field is for setting up service accounts, which we discussed briefly in <a href="B21223_04.xhtml#_idTextAnchor076"><span class="No-Break"><em class="italic">Chapter 4</em></span></a>. Refer back to that chapter if you’d like a refresher on <span class="No-Break">service accounts:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer148">
<img alt="Figure 8.26 – TheHive setting new user type to Normal" height="633" src="image/B21223_08_26.jpg" width="850"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.26 – TheHive setting new user type to Normal</p>
<ol>
<li value="5">Under <strong class="bold">Login</strong>, you will not enter a username but instead a classification of login. This allows admin users to create groups of logins where they can pre-assign roles. For simplicity’s sake, we recommend typing <strong class="source-inline">thehive@thehive.local</strong>, but you can make the first part whatever you want, such as <strong class="source-inline">test@thehive.local</strong>, so long as whatever you begin with, you append <strong class="source-inline">@thehive.local</strong> to the end of it. During login, you will only type the name you created without the <strong class="source-inline">@thehive.local</strong>. Then, under the <strong class="bold">Name</strong> field is where you will <a id="_idIndexMarker727"/>enter the desired username for <span class="No-Break">the value:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer149">
<img alt="Figure 8.27 – TheHive setting new user Login and Name values" height="514" src="image/B21223_08_27.jpg" width="900"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.27 – TheHive setting new user Login and Name values</p>
<ol>
<li value="6">Under the <strong class="bold">Organizations</strong> field, you will determine the level of this new user you are creating. We already know that we don’t want the user to be an admin. So, select the drop-down area under <strong class="bold">Organizations</strong> or <strong class="bold">Profile</strong> (it will be one or the other depending on which of the two ways you accessed this feature) and choose <strong class="bold">analyst</strong>. If you arrived here by adding the user from the profile of the organization you created, then all of the analyst roles will populate on the screen for you. If every field has been addressed, then a <strong class="bold">Confirm</strong> button will appear at the bottom of the page. Select that button and you will have your new <span class="No-Break">admin user:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer150">
<img alt="Figure 8.28 – TheHive completed new user form" height="866" src="image/B21223_08_28.jpg" width="894"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.28 – TheHive completed new user form</p>
<ol>
<li value="7">The grayed-out <a id="_idIndexMarker728"/>area will go away and your new user will appear on the list. You still have one more very important step before you log in as this user. Similar to setting up Cortex users, you need to edit the user you just created in order to establish a password, which was not available at the time you created the user. However, the manner of doing so is a little bit different than Cortex. From the default user screen, you need to hover your mouse over the name of the user you just created. When you do, a <strong class="bold">Preview</strong> field will appear near the middle of the row, next to the value under the <strong class="bold">Organizations</strong> column. Select that <strong class="bold">Preview</strong> field as highlighted in <span class="No-Break"><em class="italic">Figure 8</em></span><span class="No-Break"><em class="italic">.29</em></span><span class="No-Break">:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer151">
<img alt="Figure 8.29 – TheHive new user Preview button used to set a password" height="204" src="image/B21223_08_29.jpg" width="228"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.29 – TheHive new user Preview button used to set a password</p>
<ol>
<li value="8">Scroll down until <a id="_idIndexMarker729"/>you see the <strong class="bold">Password</strong> section. You’ll have <strong class="bold">Reset the password</strong> and <strong class="bold">Edit password</strong> options. You can play with all of this stuff later, but for now, select <strong class="bold">Reset the password</strong> or <strong class="bold">Set a new password</strong> if you’re a brand new user, and then type the desired password in for the user you are creating. When you’ve finished, click the little blue <strong class="bold">Confirm</strong> button that appears at the lower right of <span class="No-Break">your screen:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer152">
<img alt="Figure 8.30 – TheHive Set a new password and Reset the password" height="1055" src="image/B21223_08_30.jpg" width="950"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.30 – TheHive Set a new password and Reset the password</p>
<ol>
<li value="9">Once you’ve finished, you’ll <a id="_idIndexMarker730"/>see the same <strong class="bold">Confirm</strong> button appear at the bottom as you saw when you first created the user. Click that button and you should <span class="No-Break">be set:</span></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer153">
<img alt="Figure 8.31 – Confirm button" height="404" src="image/B21223_08_31.jpg" width="1000"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.31 – Confirm button</p>
<ol>
<li value="10">You may have a circle<a id="_idIndexMarker731"/> appear in the far-left column, allowing you to quickly switch between the admin account and the analyst account you just created. If not, select the down arrow at the top right followed by <strong class="bold">Logout</strong> from the dropdown, and then enter the credentials for the new account you <span class="No-Break">just created.</span></li>
<li>Select <strong class="bold">Let me in</strong> to log back in as the mortal user. Now the top ribbon should have a field to search by case ID, as well as an option to create a <span class="No-Break">new case.</span></li>
</ol>
<p>Congratulations! Installing and setting up Cortex and TheHive can be a tedious and confusing set of tasks. If you made it this far, give yourself a pat on the back. We recommend taking as much time as you like to play around with these utilities, read the developer documentation if you like, and explore as much as possible. If you break something, that’s fantastic! That’s how we learn. That’s how we all <span class="No-Break">get better.</span></p>
<p>With Cortex and TheHive being the core of incident response as far as the Kali Purple suite of tools is concerned, you have a very basic framework to build upon. Let’s take some real estate to make you aware of some of the threat intelligence applications that you can use to support the mini IR SOC you’ve begun <span class="No-Break">to assemble.</span></p>
<h1 id="_idParaDest-138"><a id="_idTextAnchor142"/>Challenge!</h1>
<p>There are countless information-sharing platforms out there. You’ve already been briefed a few times in this book about <a id="_idIndexMarker732"/>the <strong class="bold">MISP</strong>, or the <strong class="bold">Malware Information Sharing Platform</strong>. That one is an open source project that was selflessly created for the purpose of helping all of us to work together in stopping the malicious activities of bad actors. Something that sets the MISP apart from many other information-sharing feeds is <strong class="bold">threat information exchange formats</strong>. The MISP<a id="_idIndexMarker733"/> platform supports standardized threat information exchange formats, including two of the most well known, which <a id="_idIndexMarker734"/>are <strong class="bold">Structured Threat Information eXpression</strong> (<strong class="bold">STIX</strong>) and <strong class="bold">Trusted Automated eXchange of Indicator Information</strong> (<strong class="bold">TAXII</strong>). That <a id="_idIndexMarker735"/>gives MISP a high level of interoperability and compatibility with any other security platform or tool that chooses to adopt these <span class="No-Break">well-known standards.</span></p>
<p>Other key features of the<a id="_idIndexMarker736"/> MISP include <span class="No-Break">the following:</span></p>
<ul>
<li>Threat <span class="No-Break">intelligence sharing</span></li>
<li><span class="No-Break">IOC management</span></li>
<li>Threat <span class="No-Break">intelligence feeds</span></li>
<li>Automated <span class="No-Break">indicator correlation</span></li>
<li><span class="No-Break">Collaborative analysis</span></li>
<li>Visualization <span class="No-Break">and reporting</span></li>
<li><span class="No-Break">Integration framework</span></li>
</ul>
<p>Your challenge is to go out into the wild and find as many different applicable platform feeds as you can, so long as they’re applicable to cybersecurity, study them, and select at least one – but feel free to choose as many as you like – to integrate with the mini IR SOC that you’ve started in this chapter. Thoroughly document your journey with an abundance of words and screenshots, and then find an online venue – perhaps social media, perhaps not – and present your work in a manner that showcases your skills and will also help others learn <span class="No-Break">and grow.</span></p>
<h1 id="_idParaDest-139"><a id="_idTextAnchor143"/>Summary</h1>
<p>In this chapter, you have taken the lessons from previous chapters and learned how they apply when data you’ve previously learned how to collect, analyze, and store reveals there may be a possible true positive incident occurring. That is to say, you’ve begun to gain a feel for the part of cybersecurity defense known as <span class="No-Break">incident response.</span></p>
<p>In the course of responding to incidents, it helps to have tools at your disposal, especially when automation is included, and with that, you were introduced to a security orchestration automation and response platform known as Cortex. You learned about an incident response case management platform known as TheHive, which feeds its data into Cortex for processing and gets it returned with many potential automation activities performed on <span class="No-Break">the data.</span></p>
<p>You also got a glimpse of the MISP. This open source project was selflessly created for the purpose of helping all of us to work together to stop the malicious activities of <span class="No-Break">bad actors.</span></p>
<p>In the next chapter, we'll do a little bit of a deeper dig into malware analysis than we have thus far, and even learn a little bit about <span class="No-Break">exploit development!</span></p>
<h1 id="_idParaDest-140"><a id="_idTextAnchor144"/>Questions</h1>
<ol>
<li>Cortex and TheHive were created by the same company, which <span class="No-Break">is called…</span><ol><li class="Alphabets"><span class="No-Break">BumbleBee</span></li><li class="Alphabets"><span class="No-Break">SweatBee</span></li><li class="Alphabets"><span class="No-Break">StrangeBee</span></li><li class="Alphabets"><span class="No-Break">LeaveMeBee</span></li></ol></li>
<li>A pre-defined series of steps for orchestrated patterns of activity that are often repeatable <span class="No-Break">is what?</span><ol><li class="Alphabets"><span class="No-Break">IR circuit</span></li><li class="Alphabets"><span class="No-Break">Workflow</span></li><li class="Alphabets"><span class="No-Break">Container</span></li><li class="Alphabets">Code library or <strong class="source-inline">.</strong><span class="No-Break"><strong class="source-inline">dll</strong></span><span class="No-Break"> file</span></li></ol></li>
<li>Something that defines the rules for how two different software systems will communicate with each other is known <span class="No-Break">as what?</span><ol><li class="Alphabets"><strong class="bold">Application Programming </strong><span class="No-Break"><strong class="bold">Interface</strong></span><span class="No-Break"> (</span><span class="No-Break"><strong class="bold">API</strong></span><span class="No-Break">)</span></li><li class="Alphabets"><strong class="bold">International Cybersecurity Communication </strong><span class="No-Break"><strong class="bold">Law</strong></span><span class="No-Break"> (</span><span class="No-Break"><strong class="bold">ICCL</strong></span><span class="No-Break">)</span></li><li class="Alphabets">A <span class="No-Break">constitutional monarchy</span></li><li class="Alphabets"><strong class="bold">International Standards of Technological Security </strong><span class="No-Break"><strong class="bold">Controls</strong></span><span class="No-Break"> (</span><span class="No-Break"><strong class="bold">ISTSC</strong></span><span class="No-Break">)</span></li></ol></li>
<li>What <span class="No-Break">is multi-tenancy?</span><ol><li class="Alphabets">When two or more people work on the <span class="No-Break">same computer</span></li><li class="Alphabets">An application that can distinguish between and manage more than one customer <span class="No-Break">or organization</span></li><li class="Alphabets">Similar to multi-tasking except performed <span class="No-Break">in secret</span></li><li class="Alphabets">An octopus or other member of the animal kingdom with more than 2 arms <span class="No-Break">or legs</span></li></ol></li>
<li>The MISP facilitates the sharing of information about what type <span class="No-Break">of technology?</span><ol><li class="Alphabets">All <span class="No-Break">known threats</span></li><li class="Alphabets"><span class="No-Break">Database</span></li><li class="Alphabets"><span class="No-Break">Digital</span></li><li class="Alphabets"><span class="No-Break">Malware</span></li></ol></li>
</ol>
<h1 id="_idParaDest-141"><a id="_idTextAnchor145"/>Further reading</h1>
<ul>
<li><strong class="bold">Cortex </strong><span class="No-Break"><strong class="bold">Documentation</strong></span><span class="No-Break">: </span><a href="https://docs.strangebee.com/cortex/"><span class="No-Break">https://docs.strangebee.com/cortex/</span></a></li>
<li><strong class="bold">REST API resource number </strong><span class="No-Break"><strong class="bold">1</strong></span><span class="No-Break">: </span><a href="http://restapitutorial.com"><span class="No-Break">restapitutorial.com</span></a></li>
<li><strong class="bold">REST API resource number </strong><span class="No-Break"><strong class="bold">2</strong></span><span class="No-Break">: </span><a href="http://restcookbook.com"><span class="No-Break">restcookbook.com</span></a></li>
<li><strong class="bold">MISP project </strong><span class="No-Break"><strong class="bold">website</strong></span><span class="No-Break">: </span><a href="https://www.misp-project.org/"><span class="No-Break">https://www.misp-project.org/</span></a></li>
<li><strong class="bold">Learning Linux CHMOD </strong><span class="No-Break"><strong class="bold">commands</strong></span><span class="No-Break">: </span><a href="https://linuxhandbook.com/chmod-command/"><span class="No-Break">https://linuxhandbook.com/chmod-command/</span></a></li>
<li><strong class="bold">Free Azure Synapse Analytics video </strong><span class="No-Break"><strong class="bold">course</strong></span><span class="No-Break">: </span><a href="https://www.youtube.com/watch?v=lLrjaVdBuM0"><span class="No-Break">https://www.youtube.com/watch?v=lLrjaVdBuM0</span></a></li>
<li><strong class="bold">Synapse Analytics with TheHive GitHub </strong><span class="No-Break"><strong class="bold">page</strong></span><span class="No-Break">: </span><a href="https://github.com/TheHive-Project/Synapse"><span class="No-Break">https://github.com/TheHive-Project/Synapse</span></a></li>
<li><strong class="bold">Microsoft Synapse free </strong><span class="No-Break"><strong class="bold">trial</strong></span><span class="No-Break">: </span><a href="https://azure.microsoft.com/en-us/free/synapse-analytics/"><span class="No-Break">https://azure.microsoft.com/en-us/free/synapse-analytics/</span></a></li>
</ul>
</div>
</div></body></html>