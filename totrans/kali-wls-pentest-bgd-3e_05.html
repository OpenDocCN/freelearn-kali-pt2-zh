<html><head></head><body><div class="chapter" title="Chapter&#xA0;5.&#xA0;Attacks on the WLAN Infrastructure"><div class="titlepage"><div><div><h1 class="title"><a id="ch05"/>Chapter 5. Attacks on the WLAN Infrastructure</h1></div></div></div><div class="blockquote"><table border="0" cellpadding="0" cellspacing="0" class="blockquote" summary="Block quote" width="100%"><tr><td valign="top"> </td><td valign="top"><p><span class="emphasis"><em>"Thus, what is of supreme importance in war is to attack the enemy's strategy"</em></span></p></td><td valign="top"> </td></tr><tr><td valign="top"> </td><td align="right" colspan="2" style="text-align: center" valign="top">--<span class="attribution"><span class="emphasis"><em>Sun Tzu, Art of War</em></span></span></td></tr></table></div><p>
<span class="emphasis"><em>In this chapter, we will attack the WLAN infrastructure's core! We will focus on how we can penetrate into the authorized network using various new attack vectors and lure authorized clients to connect to us, as an attacker.</em></span>
</p><p>The WLAN infrastructure is what provides wireless services to all the WLAN clients in a system. In this chapter, we will take a look at the various attacks that can be conducted against the infrastructure:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Default accounts and credentials on the access point</li><li class="listitem" style="list-style-type: disc">Denial of service attacks</li><li class="listitem" style="list-style-type: disc">Evil twin and access point MAC spoofing</li><li class="listitem" style="list-style-type: disc">Rogue access points</li></ul></div><div class="section" title="Default accounts and credentials on the access point"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec52"/>Default accounts and credentials on the access point</h1></div></div></div><p>WLAN access points are the<a class="indexterm" id="id157"/> core building blocks of a wireless infrastructure. Even though they play such an important role, they are sometimes the most neglected in<a class="indexterm" id="id158"/> terms of security. In this exercise, we will check <a class="indexterm" id="id159"/>whether the default passwords have been changed on the access point or not. Then, we will go on to verify that, even if the passwords have been changed, they are still easy to guess and crack using a dictionary-based attack.</p><p>It is important to note that, as we move on to more advanced chapters, it will be assumed that you have gone through the previous chapters and are now familiar with the use of all the tools discussed there. This will allow us to build on that knowledge and try more complicated attacks!</p></div></div>
<div class="section" title="Time for action &#x2013; cracking default accounts on the access points"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec53"/>Time for action – cracking default accounts on the access points</h1></div></div></div><p>Follow these instructions<a class="indexterm" id="id160"/> to get started:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Let's first connect to our Wireless Lab access point and attempt to navigate to the HTTP management interface. We see that the access point model is <span class="strong"><strong>TP-LINK Wireless N Router WR841N</strong></span>, as shown in the following screenshot:<div class="mediaobject"><img alt="Time for action – cracking default accounts on the access points" src="graphics/B09903_05_01.jpg"/></div></li><li class="listitem">From the manufacturer's website, we find the default password for <code class="literal">admin</code> is <code class="literal">admin</code>. We try this on the login page and we succeed in logging in. This shows how easy it is to break into accounts with default credentials. We highly encourage you to obtain the router's user manual online. This will allow you to understand what you are dealing with during the penetration test and gives you an insight into other configuration flaws you could check for.</li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec47"/>
<span class="emphasis"><em>What just happened?</em></span>
</h2></div></div></div><p>We verified that the default credentials were never changed on this access point, and this could lead to a full network<a class="indexterm" id="id161"/> compromise. Also, even if the default credentials are changed, the result should not be something that is easy to guess or run a simple dictionary-based attack on.</p></div><div class="section" title="Have a go hero – cracking accounts using brute-force attacks"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec48"/>Have a go hero – cracking accounts using brute-force attacks</h2></div></div></div><p>In the previous exercise, change the password to something that is hard to guess or find in a dictionary and see whether<a class="indexterm" id="id162"/> you can crack it using a brute-force approach. Limit the length and characters in the password so that you can <a class="indexterm" id="id163"/>succeed at some point. One of the most common tools used to crack HTTP authentication is called <span class="strong"><strong>Hydra</strong></span> and is available on Kali.</p></div></div>
<div class="section" title="Denial of service attacks"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec54"/>Denial of service attacks</h1></div></div></div><p>WLANs are prone<a class="indexterm" id="id164"/> to <span class="strong"><strong>Denial of Service</strong></span> (<span class="strong"><strong>DoS</strong></span>) attacks using various techniques, including but not limited to:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Deauthentication attacks</li><li class="listitem" style="list-style-type: disc">Disassociation attacks</li><li class="listitem" style="list-style-type: disc">CTS-RTS attacks</li><li class="listitem" style="list-style-type: disc">Signal interference or spectrum jamming attacks</li></ul></div><p>In the scope of this book, we will discuss deauthentication attacks on the WLAN infrastructure using the following experiment.</p></div>
<div class="section" title="Time for action &#x2013; deauthentication DoS attack"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec55"/>Time for action – deauthentication DoS attack</h1></div></div></div><p>Follow these instructions to<a class="indexterm" id="id165"/> get started:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Let's configure the Wireless Lab network to use Open Authentication and no encryption. This will allow us to see the packets using Wireshark easily:<div class="mediaobject"><img alt="Time for action – deauthentication DoS attack" src="graphics/B09903_05_02.jpg"/></div></li><li class="listitem">Let's connect a Windows client to the access point. We will see the connection in the <code class="literal">airodump-ng</code> screen:<div class="mediaobject"><img alt="Time for action – deauthentication DoS attack" src="graphics/B09903_05_03.jpg"/></div></li><li class="listitem">Now, on the<a class="indexterm" id="id166"/> attacker machine, let's run a directed deauthentication attack against this:<div class="mediaobject"><img alt="Time for action – deauthentication DoS attack" src="graphics/B09903_05_04.jpg"/></div></li><li class="listitem">Note how the <a class="indexterm" id="id167"/>client gets disconnected from the access point completely. We can verify this on the <code class="literal">airodump-ng</code> screen as well:<div class="mediaobject"><img alt="Time for action – deauthentication DoS attack" src="graphics/B09903_05_05.jpg"/></div></li><li class="listitem">If we use <a class="indexterm" id="id168"/>Wireshark to see the traffic, you will notice a lot of deauthentication packets that we just sent over the air:<div class="mediaobject"><img alt="Time for action – deauthentication DoS attack" src="graphics/B09903_05_06.jpg"/></div></li><li class="listitem">We can do <a class="indexterm" id="id169"/>the same attack by sending a Broadcast deauthentication packet on behalf of the access point to the entire wireless network. This will have the effect of disconnecting all connected clients:<div class="mediaobject"><img alt="Time for action – deauthentication DoS attack" src="graphics/B09903_05_07.jpg"/></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec49"/>
<span class="emphasis"><em>What just happened?</em></span>
</h2></div></div></div><p>We successfully<a class="indexterm" id="id170"/> sent deauthentication frames to both the access point and the client. This resulted in them getting disconnected and a full loss of communication between them.</p><p>We also sent out Broadcast deauthentication packets, which will ensure that no client in the vicinity can successfully connect to our access point.</p><p>It is important to note that, as soon as the client is disconnected, it will try to connect back once again to the access point, and thus the deauthentication attack has to be carried out in a sustainable way to have a full DoS effect.</p><p>This is one of the easiest attacks to orchestrate but has the most devastating effect. This can easily be used in the real world to bring a wireless network down on its knees.</p></div><div class="section" title="Have a go hero – disassociation attacks"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec50"/>Have a go hero – disassociation attacks</h2></div></div></div><p>Try to check how you<a class="indexterm" id="id171"/> can conduct disassociation attacks against the infrastructure using tools available in Kali. Can you do a broadcast disassociation attack?</p></div></div>
<div class="section" title="Evil twin and access point MAC spoofing"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec56"/>Evil twin and access point MAC spoofing</h1></div></div></div><p>One of the most potent attacks on WLAN infrastructures is the <span class="strong"><strong>evil twin</strong></span>. The idea is to basically introduce an attacker-controlled access point in the vicinity of the WLAN network. This access<a class="indexterm" id="id172"/> point will advertise the exact same SSID as the authorized WLAN network.</p><p>Many wireless users <a class="indexterm" id="id173"/>may accidentally connect to this malicious access point, thinking it is part of the authorized network. Once a connection is established, the attacker can orchestrate a man-in-the-middle attack and transparently relay traffic while eavesdropping on the entire communication. We will take a look at how a man-in-the-middle attack is done in a later chapter. In the real world, an attacker would ideally use this attack close to the authorized network so that the user gets confused and accidentally connects to the attacker's network.</p><p>An evil twin having the same MAC address as an authorized access point is even more difficult to detect and deter. This is where access point MAC spoofing comes in! In the next experiment, we will take a look at how to create an evil twin, coupled with access point MAC spoofing.</p></div>
<div class="section" title="Time for action &#x2013; evil twin with MAC spoofing"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec57"/>Time for action – evil twin with MAC spoofing</h1></div></div></div><p>Follow these<a class="indexterm" id="id174"/> instructions to get started:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Use <code class="literal">airodump-ng</code> to locate the access point's BSSID and ESSID, which we would like to emulate in the evil twin:<div class="mediaobject"><img alt="Time for action – evil twin with MAC spoofing" src="graphics/B09903_05_08.jpg"/></div></li><li class="listitem">Using this<a class="indexterm" id="id175"/> information, we create a new access point with the following <code class="literal">airbase-ng</code> command: <code class="literal">airbase-ng –essid &lt;your chosen ssid&gt; -c &lt;channel&gt; &lt;interface&gt;</code>. Minor errors may occur with newer releases:<div class="mediaobject"><img alt="Time for action – evil twin with MAC spoofing" src="graphics/B09903_05_09.jpg"/></div></li><li class="listitem">This new access point also shows up in the <code class="literal">airodump-ng</code> screen. It is important to note that you will need to run <code class="literal">airodump-ng</code> in a new window with the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>airodump-ng -c &lt;channel&gt; wlan0mon</strong></span>
</pre></div><p>Let's see this new access point:</p><div class="mediaobject"><img alt="Time for action – evil twin with MAC spoofing" src="graphics/B09903_05_10.jpg"/></div></li><li class="listitem">What we will<a class="indexterm" id="id176"/> do now is spoof the ESSID and MAC address of the access point using the following command:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>airbase-ng –a &lt;router mac&gt; --essid "Wireless Lab" –c 11 wlan0mon</strong></span>
</pre></div></li><li class="listitem">Now if we look at through <code class="literal">airodump-ng</code>, it is almost impossible to differentiate between both visually:<div class="mediaobject"><img alt="Time for action – evil twin with MAC spoofing" src="graphics/B09903_05_11.jpg"/></div></li><li class="listitem">Even <code class="literal">airodump-ng</code> is unable to discern that there are actually two different physical access points on the same channel. This is the most potent form of the evil twin.<div class="mediaobject"><img alt="Time for action – evil twin with MAC spoofing" src="graphics/B09903_05_12.jpg"/></div></li><li class="listitem">Now we send<a class="indexterm" id="id177"/> a deauthentication frame to the client, so it disconnects and immediately tries to reconnect:<div class="mediaobject"><img alt="Time for action – evil twin with MAC spoofing" src="graphics/B09903_05_13.jpg"/></div></li><li class="listitem">As we are closer<a class="indexterm" id="id178"/> to this client, our signal strength is higher, and it connects to our evil twin access point. As shown by the following airbase-ng output:<div class="mediaobject"><img alt="Time for action – evil twin with MAC spoofing" src="graphics/B09903_05_14.jpg"/></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec51"/>
<span class="emphasis"><em>What just happened?</em></span>
</h2></div></div></div><p>We created an evil twin for the authorized network and used a deauthentication attack to have the legitimate client connect back to us, instead of the authorized network access point.</p><p>It is important to note that, in the case of the authorized access point using encryption such as WEP/WPA, it is more difficult to conduct an attack in which traffic eavesdropping is possible. We will take a look at how to break the WEP key with just a client using the Caffe Latte attack in a later chapter.</p></div><div class="section" title="Have a go hero – evil twin and channel hopping"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec52"/>Have a go hero – evil twin and channel hopping</h2></div></div></div><p>In the previous exercise, run the<a class="indexterm" id="id179"/> evil twin on different channels and observe how the client, once disconnected, hops channels to connect to the access point. What is the deciding factor based on which the client decides which access point to connect to? Is it signal strength? Experiment and validate.</p></div></div>
<div class="section" title="A rogue access point"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec58"/>A rogue access point</h1></div></div></div><p>A <span class="strong"><strong>rogue access point</strong></span> is an unauthorized access point connected to the authorized network. Typically, this<a class="indexterm" id="id180"/> access point can be used as a backdoor entry by an attacker, thus enabling him to bypass all security controls on the network. This would mean that the firewalls, intrusion prevention systems, and so on, which guard the border of a network, would be able to do little to stop him from accessing the network.</p><p>In the most common case, a rogue access point is set to Open Authentication and no encryption. The rogue <a class="indexterm" id="id181"/>access point can be created in the following two ways:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Installing an actual physical device on the authorized network as a rogue access point. (This is something I leave as an exercise to you.) Also, more than wireless security, this has to do with breaching the physical security of the authorized network.</li><li class="listitem" style="list-style-type: disc">Creating a rogue access point in software and bridging it with the local authorized Ethernet network. This will allow practically any laptop running on the authorized network to function as a rogue access point. We will look at this in the next experiment.</li></ul></div></div>
<div class="section" title="Time for action &#x2013; Setting up a rogue access point"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec59"/>Time for action – Setting up a rogue access point</h1></div></div></div><p>Follow these instructions to get started:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Let's first bring up our rogue access point using <code class="literal">airbase-ng</code> and give it the ESSID <code class="literal">Rogue</code>:<div class="mediaobject"><img alt="Time for action – Setting up a rogue access point" src="graphics/B09903_05_15.jpg"/></div></li><li class="listitem">We now<a class="indexterm" id="id182"/> want to create a bridge between the Ethernet interface, which is part of the authorized network, and our rogue access point interface. To do this, we will first install <code class="literal">bridge-utils</code> files, create a bridge interface, and name it <code class="literal">Wifi-Bridge</code>:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>apt-get install bridge-utils</strong></span>
<span class="strong"><strong>brctl addbr Wifi-Bridge</strong></span>
</pre></div><p>The following screenshot shows the required commands in action:</p><div class="mediaobject"><img alt="Time for action – Setting up a rogue access point" src="graphics/B09903_05_16.jpg"/></div></li><li class="listitem">We will then add both the Ethernet and the <code class="literal">at0</code> virtual interface created by <code class="literal">airbase-ng</code> to this bridge:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>brctl addif Wifi-Bridge eth0</strong></span>
<span class="strong"><strong>brctl addif Wifi-Bridge at0</strong></span>
</pre></div><p>The screenshot of the command is as follows:</p><div class="mediaobject"><img alt="Time for action – Setting up a rogue access point" src="graphics/B09903_05_17.jpg"/></div></li><li class="listitem">We will then <a class="indexterm" id="id183"/>bring up this interfaces to enable the bridge with the following commands:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>ifconfig eth0 0.0.0.0 up</strong></span>
<span class="strong"><strong>ifconfig at0 0.0.0.0 up</strong></span>
</pre></div><p>The screenshot of the command is as follows:</p><div class="mediaobject"><img alt="Time for action – Setting up a rogue access point" src="graphics/B09903_05_18.jpg"/></div></li><li class="listitem">We will then enable IP forwarding in the kernel to ensure that packets are forwarded:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>echo 1 &gt; /proc/sys/net/ipv4/ip_forward</strong></span>
</pre></div><p>The screenshot of the command is as follows:</p><div class="mediaobject"><img alt="Time for action – Setting up a rogue access point" src="graphics/B09903_05_19.jpg"/></div></li><li class="listitem">Brilliant! We<a class="indexterm" id="id184"/> are done. Now, any wireless client connecting to our rogue access point will have full access to the authorized network using the wireless-to-wired <code class="literal">Wifi-Bridge</code> we just built. We can verify this by connecting a client to the rogue access point.</li><li class="listitem">Then bring the bridge up with:<div class="informalexample"><pre class="programlisting">
<span class="strong"><strong>ifconfig Wifi-Bridge up</strong></span>
</pre></div></li><li class="listitem">Notice that it receives an IP address from the DHCP daemon running on the authorized LAN.</li><li class="listitem">We can now access any host on the wired network from this wireless client using this rogue access point.</li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec53"/>
<span class="emphasis"><em>What just happened?</em></span>
</h2></div></div></div><p>We created a rogue access point and used it to bridge all the authorized network LAN traffic over the wireless network. As you can see, this is a really serious security threat as anyone can break into the wired network using this bridge.</p></div><div class="section" title="Have a go hero – rogue access point challenge"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec54"/>Have a go hero – rogue access point challenge</h2></div></div></div><p>Check whether you<a class="indexterm" id="id185"/> can create a rogue access point that uses WPA/WPA2-based encryption to look more legitimate on the wireless network.</p></div><div class="section" title="Pop quiz – attacks on the WLAN infrastructure"><div class="titlepage"><div><div><h2 class="title"><a id="ch05lvl2sec55"/>Pop quiz – attacks on the WLAN infrastructure</h2></div></div></div><p>Q1. What encryption does a rogue access point use in most cases?</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">None</li><li class="listitem">WEP</li><li class="listitem">WPA</li><li class="listitem">WPA2</li></ol></div><p>Q2. What is the advantage of having the same MAC address as the authorized access point in an evil twin?</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">It makes detecting the evil twin more difficult</li><li class="listitem">It forces the client to connect to it</li><li class="listitem">It increases the signal strength of the network</li><li class="listitem">None of the above</li></ol></div><p>Q3. What do DoS attacks do?</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">They bring down the overall throughput of the network</li><li class="listitem">They do not target the clients</li><li class="listitem">They can only be done if we know the network WEP/WPA/WPA2 credentials</li><li class="listitem">All of the above</li></ol></div><p>Q4. What do rogue access points do and how can they be created?</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">They allow backdoor entry into the authorized network</li><li class="listitem">They use WPA2 encryption only</li><li class="listitem">They can be created as software-based access points or can be actual devices</li><li class="listitem">Both 1 and 3</li></ol></div></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch05lvl1sec60"/>Summary</h1></div></div></div><p>In this chapter, we explored different ways to compromise the security of the Wireless LAN infrastructure:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Compromising default accounts and credentials on access points</li><li class="listitem" style="list-style-type: disc">Denial of service attacks</li><li class="listitem" style="list-style-type: disc">Evil twins and MAC spoofing</li><li class="listitem" style="list-style-type: disc">Rogue access points in the enterprise network</li></ul></div><p>In the next chapter, we will take a look at different attacks on the Wireless LAN client. Interestingly, most administrators feel that the client has no security problems to worry about. We will see how nothing could be further from the truth.</p></div></body></html>