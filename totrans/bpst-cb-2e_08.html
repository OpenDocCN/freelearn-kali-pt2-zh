<html><head></head><body>
		<div id="_idContainer458">
			<h1 id="_idParaDest-174" class="chapter-number"><a id="_idTextAnchor441"/>8</h1>
			<h1 id="_idParaDest-175"><a id="_idTextAnchor442"/>Evaluating Input Validation Checks</h1>
			<p><a id="_idTextAnchor443"/>Failure to validate any input received from the client before using it in the application code is one of the most common security vulnerabilities found in web applications. This flaw is the source <a id="_idIndexMarker495"/>of major security issues, such as SQL injection and <strong class="bold">Cross-Site Scripting</strong> (<strong class="bold">XSS</strong>). Web penetration testers must evaluate and determine whether any input is reflected back or executed upon by the application. We’ll learn how to use Burp Suite to perform <span class="No-Break">such tests.</span><a id="_idTextAnchor444"/></p>
			<p>In this chapter, we will cover the <span class="No-Break">following recipes:</span></p>
			<ul>
				<li>Testing for reflected <span class="No-Break">cross-site scripting</span></li>
				<li>Testing for stored <span class="No-Break">cross-site scripting</span></li>
				<li>Testing for HTTP <span class="No-Break">verb tampering</span></li>
				<li>Testing for HTTP <span class="No-Break">parameter pollution</span></li>
				<li>Testing for <span class="No-Break">SQL injection</span></li>
				<li>Testing for <span class="No-Break">command injection</span><a id="_idTextAnchor445"/></li>
			</ul>
			<h1 id="_idParaDest-176"><a id="_idTextAnchor446"/>Technical requirements</h1>
			<p>To complete the recipes in this chapter, you will need <span class="No-Break">the following:</span></p>
			<ul>
				<li>OWASP Broken Web <span class="No-Break">Applications (VM)</span></li>
				<li>OWASP <span class="No-Break">Mutillidae link</span></li>
				<li>Burp Suite Proxy Community or <span class="No-Break">Professional (</span><a href="https://portswigger.net/burp/"><span class="No-Break">https://portswigger.net/burp/<span id="_idTextAnchor447"/></span></a><span class="No-Break">)</span><a id="_idTextAnchor448"/></li>
			</ul>
			<h1 id="_idParaDest-177"><a id="_idTextAnchor449"/>Testing for reflected cross-site scripting</h1>
			<p>Reflected cross-site <a id="_idIndexMarker496"/>scripting occurs when malicious JavaScript is injected into an input field, parameter, or header and, after returning from the web server, is executed within the browser. Reflected XSS occurs when the execution of JavaScript reflects in the browser only and is not a permanent part of the web page. Penetration testers need to test all client values sent to the web server to determine whether XSS <span class="No-Break">is possibl<a id="_idTextAnchor450"/>e<a id="_idTextAnchor451"/>.</span></p>
			<h2 id="_idParaDest-178"><a id="_idTextAnchor452"/>Getting ready</h2>
			<p>Using OWASP <a id="_idIndexMarker497"/>Mutillidae II, let’s determine whether the application protects against <span class="No-Break">reflected X<a id="_idTextAnchor453"/>S<a id="_idTextAnchor454"/>S.</span></p>
			<h2 id="_idParaDest-179"><a id="_idTextAnchor455"/>How to do it...</h2>
			<ol>
				<li>From the OWASP Mutillidae II menu, select <strong class="bold">Login</strong> by navigating to <strong class="bold">OWASP 2013</strong> | <strong class="bold">A3 - Cross Site Scripting (XSS)</strong> | <strong class="bold">Reflected (First Order)</strong> | <strong class="bold">Pen Test </strong><span class="No-Break"><strong class="bold">Tool Lookup</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer423" class="IMG---Figure">
					<img src="image/B21173_08_001.jpg" alt="Figure 8.1 – Multillidae landing page"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.1 – Multillidae landing page</p>
			<ol>
				<li value="2">Select a tool from the drop-down listing and click the <strong class="bold">Lookup Tool</strong> button. Any value from the drop-down list will work for <span class="No-Break">this recipe:</span></li>
			</ol>
			<div>
				<div id="_idContainer424" class="IMG---Figure">
					<img src="image/B21173_08_002.jpg" alt="Figure 8.2 – Pentest tool vote"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.2 – Pentest tool vote</p>
			<ol>
				<li value="3">Switch to Burp Suite <strong class="bold">Proxy</strong> | <strong class="bold">HTTP history</strong> and find the HTTP message you just created <a id="_idIndexMarker498"/>by selecting the lookup tool. Note that in the request is a parameter called <strong class="source-inline">ToolID</strong>. In the following example, the value <span class="No-Break">is </span><span class="No-Break"><strong class="source-inline">3</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer425" class="IMG---Figure">
					<img src="image/B21173_08_003.jpg" alt="Figure 8.3 – Proxy HTTP history view"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.3 – Proxy HTTP history view</p>
			<ol>
				<li value="4">Flip over <a id="_idIndexMarker499"/>to the <strong class="bold">Response</strong> tab and note the JSON returned from the request. You can find the JavaScript function in the response more easily by typing <strong class="source-inline">PenTest</strong> in the search box at the bottom. Note that <strong class="source-inline">tool_id</strong> is reflected in a response parameter called <strong class="source-inline">toolIDRequested</strong>. This may be an attack vector <span class="No-Break">for XSS:</span></li>
			</ol>
			<div>
				<div id="_idContainer426" class="IMG---Figure">
					<img src="image/B21173_08_004.jpg" alt="Figure 8.4 – toolIDRequested and tool_id"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.4 – toolIDRequested and tool_id</p>
			<ol>
				<li value="5">Send the <a id="_idIndexMarker500"/>request over to <strong class="bold">Repeater</strong>. Add an XSS payload within the <strong class="source-inline">ToolID</strong> parameter immediately following the equals sign. Use a simple payload such <span class="No-Break">as </span><span class="No-Break"><strong class="source-inline">&lt;script&gt;alert(1);&lt;/script&gt;</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer427" class="IMG---Figure">
					<img src="image/B21173_08_005.jpg" alt="Figure 8.5 – XSS payload in the ToolID parameter"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.5 – XSS payload in the ToolID parameter</p>
			<ol>
				<li value="6">Click <strong class="bold">Send</strong> and examine <a id="_idIndexMarker501"/>the returned JSON response, searching for <strong class="source-inline">PenTest</strong>. Notice our payload is returned exactly as input. It looks like the developer is not sanitizing any of the input data before using it. Let’s exploit <span class="No-Break">the flaw:</span></li>
			</ol>
			<div>
				<div id="_idContainer428" class="IMG---Figure">
					<img src="image/B21173_08_006.jpg" alt="Figure 8.6 – Payload reflected in response"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.6 – Payload reflected in response</p>
			<ol>
				<li value="7">Since we are working with JSON instead of HTML, we will need to adjust the payload to <a id="_idIndexMarker502"/>match the structure of the JSON returned. We will fool the JSON into thinking the payload is legitimate. We will modify the original <strong class="source-inline">&lt;script&gt;alert(1);&lt;/script&gt;</strong> payload to <strong class="source-inline">"}} )%</strong><span class="No-Break"><strong class="source-inline">3balert(1)%3b//</strong></span><span class="No-Break"> instead.</span></li>
				<li>Switch to the Burp Suite <strong class="bold">Proxy</strong> | <strong class="bold">Intercept</strong> tab. Turn <strong class="bold">Interceptor</strong> on with the <strong class="bold">Intercept is </strong><span class="No-Break"><strong class="bold">on</strong></span><span class="No-Break"> button.</span></li>
				<li>Return to Firefox, select another tool from the drop-down list, and click the <strong class="bold">Lookup </strong><span class="No-Break"><strong class="bold">Tool</strong></span><span class="No-Break"> button.</span></li>
				<li>While <strong class="bold">Proxy</strong> | <strong class="bold">Interceptor</strong> has the request paused, insert the new payload of <strong class="source-inline">"}} )%3balert(1)%3b//</strong> immediately after the <span class="No-Break"><strong class="source-inline">ToolID</strong></span><span class="No-Break"> number:</span></li>
			</ol>
			<div>
				<div id="_idContainer429" class="IMG---Figure">
					<img src="image/B21173_08_007.jpg" alt="Figure 8.7 – Modified XSS payload for JSON"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.7 – Modified XSS payload for JSON</p>
			<ol>
				<li value="11">Click <a id="_idIndexMarker503"/>the <strong class="bold">Forward</strong> button. Turn <strong class="bold">Interceptor</strong> off by toggling to <strong class="bold">Intercept </strong><span class="No-Break"><strong class="bold">is off</strong></span><span class="No-Break">.</span></li>
				<li>Return to the Firefox browser and see the pop-up alert box displayed. You’ve successfully <a id="_idIndexMarker504"/>shown a <strong class="bold">proof of concept</strong> (<strong class="bold">PoC</strong>) for the reflected <span class="No-Break">XSS vulnerability:</span></li>
			</ol>
			<div>
				<div id="_idContainer430" class="IMG---Figure">
					<img src="image/B21173_08_008.jpg" alt="Figure 8.8 – Evidence of XSS vulnerabili﻿t﻿y"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.8 – Evidence of XSS vulnerabili<a id="_idTextAnchor456"/>t<a id="_idTextAnchor457"/>y</p>
			<h2 id="_idParaDest-180"><a id="_idTextAnchor458"/>How it works...</h2>
			<p>Due to inadequate <a id="_idIndexMarker505"/>input cleansing prior to using data received from the client, in this case, the penetration testing tool’s identifier is reflected in the response as it is received from the client, allowing an attack vector for an <span class="No-Break">XSS atta<a id="_idTextAnchor459"/>c<a id="_idTextAnchor460"/>k.</span></p>
			<h1 id="_idParaDest-181"><a id="_idTextAnchor461"/>Testing for stored cross-site scripting</h1>
			<p>Stored cross-site scripting occurs when malicious JavaScript is injected into an input field, parameter, or header and, after returning from the web server, is executed within the browser <a id="_idIndexMarker506"/>and becomes a permanent part of the page. Stored XSS occurs when the malicious JavaScript is stored in the database and is used later to populate the display of a web page. Penetration testers need to test all client values sent to the web server to determine whether XSS <span class="No-Break">is possi<a id="_idTextAnchor462"/>b<a id="_idTextAnchor463"/>le.</span></p>
			<h2 id="_idParaDest-182"><a id="_idTextAnchor464"/>Getting ready</h2>
			<p>Using OWASP Mutillidae II, let’s determine whether the application protects against stored <span class="No-Break">cross-site script<a id="_idTextAnchor465"/>i<a id="_idTextAnchor466"/>ng.</span></p>
			<h2 id="_idParaDest-183"><a id="_idTextAnchor467"/>How to do it...</h2>
			<ol>
				<li>From the <a id="_idIndexMarker507"/>OWASP Mutillidae II menu, select <strong class="bold">Login</strong> by navigating to <strong class="bold">OWASP 2013</strong> | <strong class="bold">A3 - Cross Site Scripting (XSS)</strong> | <strong class="bold">Persistent (First Order)</strong> | <strong class="bold">Add to </strong><span class="No-Break"><strong class="bold">your blog</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer431" class="IMG---Figure">
					<img src="image/B21173_08_009.jpg" alt="Figure 8.9 – Navigation to the stored XSS lesson"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.9 – Navigation to the stored XSS lesson</p>
			<ol>
				<li value="2">Place some verbiage into the text area. Before clicking the <strong class="bold">Save Blog Entry</strong> button, let’s try a payload with <span class="No-Break">the entry:</span></li>
			</ol>
			<div>
				<div id="_idContainer432" class="IMG---Figure">
					<img src="image/B21173_08_010..jpg" alt="Figure 8.10 – Save your blog entry"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.10 – Save your blog entry</p>
			<ol>
				<li value="3">After <a id="_idIndexMarker508"/>clicking the <strong class="bold">Save Blog Entry</strong> button, you should immediately see the popup of the JavaScript stored on <span class="No-Break">the page.</span></li>
			</ol>
			<div>
				<div id="_idContainer433" class="IMG---Figure">
					<img src="image/B21173_08_011..jpg" alt="Figure 8.11 – Evidence of stored XSS vulnerability"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.11 – Evidence of stored XSS vulnerability</p>
			<ol>
				<li value="4">Click the <strong class="bold">OK</strong> button to close the popups. Reload the page and you will see the alert popup again. This is because your malicious script has become a permanent <a id="_idIndexMarker509"/>part of the page. You’ve successfully shown a PoC for the stored <span class="No-Break">XSS vulnerabil<a id="_idTextAnchor468"/>i<a id="_idTextAnchor469"/>ty!</span></li>
			</ol>
			<h2 id="_idParaDest-184"><a id="_idTextAnchor470"/>How it works...</h2>
			<p>Stored or persistent XSS occurs because the application not only neglects to sanitize the input but also stores the input within the database. Therefore, when a page is reloaded and populated with database data, the malicious script is executed along with <span class="No-Break">that d<a id="_idTextAnchor471"/>a<a id="_idTextAnchor472"/>ta.</span></p>
			<h1 id="_idParaDest-185"><a id="_idTextAnchor473"/>Testing for HTTP verb tampering</h1>
			<p>HTTP requests <a id="_idIndexMarker510"/>can include methods beyond <strong class="source-inline">GET</strong> and <strong class="source-inline">POST</strong>. As a penetration tester, it is important to determine which other HTTP verbs (that is, methods) the web server allows. Support for other verbs may disclose sensitive information (for example, <strong class="source-inline">TRACE</strong>) or allow for a dangerous invocation of application code (for example, <strong class="source-inline">DELETE</strong>). Let’s see how Burp Suite can help test for HTTP <span class="No-Break">verb tampe<a id="_idTextAnchor474"/>r<a id="_idTextAnchor475"/>ing.</span></p>
			<h2 id="_idParaDest-186"><a id="_idTextAnchor476"/>Getting ready</h2>
			<p>Using Altoro Mutual (<a href="https://demo.testfire.net">https://demo.testfire.net</a>), let’s determine whether the application has a <strong class="source-inline">POST</strong> request we can manipulate into using a <strong class="source-inline">GET</strong> instead. If possible, the <strong class="source-inline">GET</strong> request <a id="_idIndexMarker511"/>will expose sensitive data within the query s<a id="_idTextAnchor477"/>tring. We will login first, then map the application to look for something interesting like a money <span class="No-Break">movement transac<a id="_idTextAnchor478"/>tion.</span></p>
			<h2 id="_idParaDest-187"><a id="_idTextAnchor479"/>How to do it...</h2>
			<ol>
				<li>Navigate to <a href="https://demo.testfire.net">https://demo.testfire.net</a>. Click the <strong class="bold">Sign </strong><span class="No-Break"><strong class="bold">In</strong></span><span class="No-Break"> button.</span></li>
			</ol>
			<div>
				<div id="_idContainer434" class="IMG---Figure">
					<img src="image/B21173_08_012..jpg" alt="Figure 8.12 – Altoro Mutual landing page"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.12 – Altoro Mutual landing page</p>
			<p>You are brought to the <span class="No-Break">login form.</span></p>
			<div>
				<div id="_idContainer435" class="IMG---Figure">
					<img src="image/B21173_08_013..jpg" alt="Figure 8.13 – Altoro Mutual login page"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.13 – Altoro Mutual login page</p>
			<ol>
				<li value="2">After login, navigate <a id="_idIndexMarker512"/>to <strong class="bold">Transfer Funds</strong> using the <span class="No-Break">left menu.</span></li>
			</ol>
			<div>
				<div id="_idContainer436" class="IMG---Figure">
					<img src="image/B21173_08_014..jpg" alt="Figure 8.14 – Navigate to the Transfer Funds page"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.14 – Navigate to the Transfer Funds page</p>
			<ol>
				<li value="3">On the <strong class="bold">Transfer Funds</strong> page, select the <strong class="bold">Checking</strong> account and type an amount of <a id="_idIndexMarker513"/>money in the <strong class="bold">Amount to Transfer</strong> field. Do not transfer the <span class="No-Break">money yet.</span></li>
			</ol>
			<div>
				<div id="_idContainer437" class="IMG---Figure">
					<img src="image/B21173_08_015..jpg" alt="Figure 8.15 – Select the account to transfer to and type the amount"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.15 – Select the account to transfer to and type the amount</p>
			<ol>
				<li value="4">Go to <strong class="bold">Proxy</strong> | <strong class="bold">Intercept</strong> and toggle <strong class="bold">Intercept </strong><span class="No-Break"><strong class="bold">is on</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer438" class="IMG---Figure">
					<img src="image/B21173_08_016..jpg" alt="Figure 8.16 – Turn proxy intercept on"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.16 – Turn proxy intercept on</p>
			<ol>
				<li value="5">Return to <a id="_idIndexMarker514"/>the browser and click the <strong class="bold">Transfer </strong><span class="No-Break"><strong class="bold">Money</strong></span><span class="No-Break"> button.</span></li>
			</ol>
			<div>
				<div id="_idContainer439" class="IMG---Figure">
					<img src="image/B21173_08_017..jpg" alt="Figure 8.17 – Click the Transfer Money button"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.17 – Click the Transfer Money button</p>
			<ol>
				<li value="6">Inside <strong class="bold">Proxy</strong> | <strong class="bold">Intercept</strong>, you can easily change the verb from <strong class="source-inline">POST</strong> to <strong class="source-inline">GET</strong> by right-clicking and selecting <strong class="bold">Change </strong><span class="No-Break"><strong class="bold">request method</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer440" class="IMG---Figure">
					<img src="image/B21173_08_018..jpg" alt="Figure 8.18 – Change POST to GET"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.18 – Change POST to GET</p>
			<ol>
				<li value="7">Note how <a id="_idIndexMarker515"/>the request is now a <strong class="source-inline">GET</strong> request and the account numbers are now exposed in the <span class="No-Break">query string.</span></li>
			</ol>
			<div>
				<div id="_idContainer441" class="IMG---Figure">
					<img src="image/B21173_08_019..jpg" alt="Figure 8.19 – See sensitive data in the GET query string"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.19 – See sensitive data in the GET query string</p>
			<ol>
				<li value="8">Click <a id="_idIndexMarker516"/>the <strong class="bold">Forward</strong> button and toggle <strong class="bold">Proxy</strong> | <strong class="bold">Intercept </strong><span class="No-Break"><strong class="bold">is off</strong></span><span class="No-Break">.</span></li>
				<li>Notice the transfer was still successful as a <span class="No-Break"><strong class="source-inline">GET</strong></span><span class="No-Break"> request:</span><a id="_idTextAnchor480"/></li>
			</ol>
			<div>
				<div id="_idContainer442" class="IMG---Figure">
					<img src="image/B21173_08_020..jpg" alt="Figure 8.20 – Transfer was successfu﻿l"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.20 – Transfer was successfu<a id="_idTextAnchor481"/>l</p>
			<h2 id="_idParaDest-188"><a id="_idTextAnchor482"/>How it works...</h2>
			<p>Testing for HTTP verb tampering includes sending requests against the application using different HTTP <a id="_idIndexMarker517"/>methods and analyzing the response received. In this recipe, the web developers allowed both a <strong class="source-inline">POST</strong> and a <strong class="source-inline">GET</strong> verb to be used in a transfer of funds between two accounts. Why is this a finding? Because the original <strong class="source-inline">POST</strong> request held sensitive data in the body of the request, whereas a <strong class="source-inline">GET</strong> request exposes the data in a query string, which is captured easily in web logs of servers and sniffed on the network wire. As a tester, you need to perform this type of test against login sequences and other areas of the application where you see <span class="No-Break">sensitive da<a id="_idTextAnchor483"/>t<a id="_idTextAnchor484"/>a.</span></p>
			<h1 id="_idParaDest-189"><a id="_idTextAnchor485"/>Testing for HTTP parameter pollution</h1>
			<p><strong class="bold">HTTP parameter pollution</strong> (<strong class="bold">HPP</strong>) is <a id="_idIndexMarker518"/>an attack in which multiple HTTP parameters are sent to the web server with the same name. The <a id="_idIndexMarker519"/>intention is to determine whether the application responds in an unanticipated manner, allowing exploitation. For example, in a <strong class="source-inline">GET</strong> request, additional parameters can be added to the query string—in this fashion: <strong class="source-inline">"&amp;name=value"</strong>—where <strong class="source-inline">name</strong> is a duplicate parameter name already known by the application code. Likewise, HPP attacks can be performed on <strong class="source-inline">POST</strong> requests by duplicating a parameter name in the <strong class="source-inline">POST</strong> <span class="No-Break">body <a id="_idTextAnchor486"/>d<a id="_idTextAnchor487"/>ata.</span></p>
			<h2 id="_idParaDest-190"><a id="_idTextAnchor488"/>Getting ready</h2>
			<p>Using OWASP Mutillidae II, let’s determine whether the application allows <span class="No-Break">HPP atta<a id="_idTextAnchor489"/>c<a id="_idTextAnchor490"/>ks.</span></p>
			<h2 id="_idParaDest-191"><a id="_idTextAnchor491"/>How to do it...</h2>
			<ol>
				<li>From the <a id="_idIndexMarker520"/>OWASP Mutillidae II menu, select <strong class="bold">Login</strong> by navigating to <strong class="bold">OWASP 2013</strong> | <strong class="bold">A1 - Injection (Other)</strong> | <strong class="bold">HTTP Parameter Pollution</strong> | <span class="No-Break"><strong class="bold">Poll Question</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer443" class="IMG---Figure">
					<img src="image/B21173_08_021..jpg" alt="Figure 8.21 – Navigate to the HTTP Parameter Pollution lesson"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.21 – Navigate to the HTTP Parameter Pollution lesson</p>
			<ol>
				<li value="2">Select a tool from one of the radio buttons, add your initials, and click the <strong class="bold">Submit </strong><span class="No-Break"><strong class="bold">Vote</strong></span><span class="No-Break"> button:</span></li>
			</ol>
			<div>
				<div id="_idContainer444" class="IMG---Figure">
					<img src="image/B21173_08_022..jpg" alt="Figure 8.22 – Vote for a tool"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.22 – Vote for a tool</p>
			<ol>
				<li value="3">Switch to <a id="_idIndexMarker521"/>the Burp Suite <strong class="bold">Proxy</strong> | <strong class="bold">HTTP history</strong> tab and find the request you just performed from the <strong class="bold">User Poll</strong> page. Note the parameter named <strong class="source-inline">choice</strong>. The value of this parameter is <strong class="source-inline">nmap</strong>. Right-click and send this request <span class="No-Break">to </span><span class="No-Break"><strong class="bold">Repeater</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer445" class="IMG---Figure">
					<img src="image/B21173_08_023..jpg" alt="Figure 8.23 – Send to Repeater"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.23 – Send to Repeater</p>
			<ol>
				<li value="4">Switch to Burp Suite <strong class="bold">Repeater</strong> and add another parameter with the same name to <a id="_idIndexMarker522"/>the query string. Let’s pick another tool from the <strong class="bold">User Poll</strong> list and append it to the query string, for example, <strong class="source-inline">&amp;choice=tcpdump</strong>. This will add two choices, <strong class="source-inline">&amp;choice=nmap</strong> (original) and <strong class="source-inline">&amp;choice=tcpdump</strong>. Click <strong class="bold">Send</strong> to send <span class="No-Break">the request.</span></li>
				<li>Examine the response. Which choice did the application code accept? This is easy to find by searching for the <strong class="source-inline">Your choice was</strong> string. Clearly, the duplicate choice parameter value is the one the application code accepted to count in the <strong class="bold">User </strong><span class="No-Break"><strong class="bold">Poll</strong></span><span class="No-Break"> vote:</span></li>
			</ol>
			<div>
				<div id="_idContainer446" class="IMG---Figure">
					<img src="image/B21173_08_024..jpg" alt="Figure 8.24 – Validate your change was accepted by the se﻿r﻿ver"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.24 – Validate your change was accepted by the se<a id="_idTextAnchor492"/>r<a id="_idTextAnchor493"/>ver</p>
			<h2 id="_idParaDest-192"><a id="_idTextAnchor494"/>How it works...</h2>
			<p>The application <a id="_idIndexMarker523"/>code fails to check against multiple parameters with the same name when passed into a function. The result is that the application usually acts upon the last parameter match provided. This can result in odd behavior and <span class="No-Break">unexpected res<a id="_idTextAnchor495"/>u<a id="_idTextAnchor496"/>lts.</span></p>
			<h1 id="_idParaDest-193"><a id="_idTextAnchor497"/>Testing for SQL injection</h1>
			<p>A SQL injection <a id="_idIndexMarker524"/>attack involves an attacker providing input to the database, which is received and used without any validation or sanitization. The result is divulging sensitive data, modifying data, or even bypassing <span class="No-Break">authentication mecha<a id="_idTextAnchor498"/>n<a id="_idTextAnchor499"/>isms.</span></p>
			<h2 id="_idParaDest-194"><a id="_idTextAnchor500"/>Getting ready</h2>
			<p>Using the <a id="_idIndexMarker525"/>OWASP Mutillidae II <strong class="bold">Login</strong> page, let’s determine whether the application is vulnerable to <strong class="bold">SQL injection</strong> (<span class="No-Break"><strong class="bold">SQLi</strong></span><span class="No-Break">) a<a id="_idTextAnchor501"/>t<a id="_idTextAnchor502"/>tacks.</span></p>
			<h2 id="_idParaDest-195"><a id="_idTextAnchor503"/>How to do it...</h2>
			<ol>
				<li>From the OWASP Mutillidae II menu, select <strong class="bold">Login</strong> by navigating to <strong class="bold">OWASP 2013</strong> | <strong class="bold">A1-Injection (SQL)</strong> | <strong class="bold">SQLi – Bypass Authentication</strong> | <span class="No-Break"><strong class="bold">Login</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer447" class="IMG---Figure">
					<img src="image/B21173_08_025..jpg" alt="Figure 8.25 – Navigate to the SQL injection authentication bypass lesson"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.25 – Navigate to the SQL injection authentication bypass lesson</p>
			<ol>
				<li value="2">On the <strong class="bold">Login</strong> screen, place invalid credentials in the <strong class="bold">Username</strong> and <strong class="bold">Password</strong> textboxes. For example, the username is <strong class="source-inline">' or 1=1--</strong> with no password. Click the <span class="No-Break"><strong class="bold">Login</strong></span><span class="No-Break"> button.</span></li>
			</ol>
			<div>
				<div id="_idContainer448" class="IMG---Figure">
					<img src="image/B21173_08_026..jpg" alt="Figure 8.26 – Login using SQLi payload"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.26 – Login using SQLi payload</p>
			<ol>
				<li value="3">Switch to <a id="_idIndexMarker526"/>the Burp Suite <strong class="bold">Proxy</strong> | <strong class="bold">HTTP history</strong> tab. Find the request with the payload of <strong class="source-inline">' or 1=1--&lt;space&gt;</strong> within the <strong class="source-inline">username</strong> parameter and click the <strong class="bold">Login</strong> button. Use <strong class="bold">Inspector</strong> to see the contents of the SQL injection payload <span class="No-Break">more easily.</span></li>
			</ol>
			<div>
				<div id="_idContainer449" class="IMG---Figure">
					<img src="image/B21173_08_027..jpg" alt="Figure 8.27 – Use Inspector to see your URL-encoded payload"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.27 – Use Inspector to see your URL-encoded payload</p>
			<ol>
				<li value="4">Return to <a id="_idIndexMarker527"/>the Firefox browser and note you are now logged in <span class="No-Break">as ad<a id="_idTextAnchor504"/>min!</span></li>
			</ol>
			<div>
				<div id="_idContainer450" class="IMG---Figure">
					<img src="image/B21173_08_028..jpg" alt="Figure 8.28 – Verify SQLi payload wo﻿rked"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.28 – Verify SQLi payload wo<a id="_idTextAnchor505"/>rked</p>
			<h2 id="_idParaDest-196"><a id="_idTextAnchor506"/>How it works...</h2>
			<p>Without knowing any credentials, you can use a SQL injection payload, such as <strong class="source-inline">' or 1=1--&lt;space&gt;</strong>, to bypass the authentication mechanism. The application contains a SQL injection vulnerability because the SQL code used in the backend application is constructed using the values of the textbox as is, without any sanitization of user input. The admin account is the first account created in the database, so the database defaulted to that account when the SQL injection <span class="No-Break">payload exec<a id="_idTextAnchor507"/>u<a id="_idTextAnchor508"/>ted.</span></p>
			<h2 id="_idParaDest-197"><a id="_idTextAnchor509"/>There’s more...</h2>
			<p>We can re-do <a id="_idIndexMarker528"/>this recipe and use a SQL injection wordlist from <strong class="source-inline">wfuzz</strong> within Burp Suite<strong class="bold"> Intruder</strong> to test many different payloads in the <strong class="bold">Username</strong> field. Examine the response for each attack in the results table to determine whether the payload successfully performed a SQL injection and you are logged in to <span class="No-Break">the application.</span></p>
			<p>The construction of SQL injection payloads requires some knowledge of the backend database and <a id="_idIndexMarker529"/>the syntax required. A great resource to assist in the construction of SQL injection payloads <span class="No-Break">is </span><a href="https://pentestmonkey.net/category/cheat-sheet/sql-injection"><span class="No-Break">https://pentestmonkey.net/category/cheat-sheet/sql-inje<span id="_idTextAnchor510"/>c<span id="_idTextAnchor511"/>tion</span></a><span class="No-Break">.</span></p>
			<h1 id="_idParaDest-198"><a id="_idTextAnchor512"/>Testing for command injection</h1>
			<p>Command injection involves an attacker attempting to invoke a system command, normally <a id="_idIndexMarker530"/>performed in a terminal session, within an HTTP request instead. Many web applications allow system commands through the UI for troubleshooting purposes. A web penetration tester must test whether the web page allows further commands on the system that should normally <span class="No-Break">be res<a id="_idTextAnchor513"/>t<a id="_idTextAnchor514"/>ricted.</span></p>
			<h2 id="_idParaDest-199"><a id="_idTextAnchor515"/>Getting ready</h2>
			<p>For this recipe, you will <a id="_idIndexMarker531"/>need the SecLists payload for Unix commands on a Unix- or Linux-based <span class="No-Break">operating system:</span></p>
			<p><a href="https://github.com/danielmiessler/SecLists/blob/master/Fuzzing/UnixAttacks.fuzzdb.txt"><span class="No-Break">https://github.com/danielmiessler/SecLists/blob/master/Fuzzing/UnixAttacks.fuzzdb.txt</span></a></p>
			<p>Download the SecLists payload <span class="No-Break">from GitHub:</span></p>
			<p><a href="https://github.com/danielmiessler/SecLists"><span class="No-Break">https://github.com/danielmiessler/SecLists</span></a></p>
			<p>Using the OWASP Mutillidae II <strong class="bold">DNS Lookup</strong> page, let’s determine whether the application is vulnerable to command <span class="No-Break">injection<a id="_idTextAnchor516"/> <a id="_idTextAnchor517"/>attacks.</span></p>
			<h2 id="_idParaDest-200"><a id="_idTextAnchor518"/>How to do it...</h2>
			<ol>
				<li>From the OWASP Mutillidae II menu, select <strong class="bold">DNS Lookup</strong> by navigating to <strong class="bold">OWASP 2013</strong> | <strong class="bold">A1-Injection (Other)</strong> | <strong class="bold">Command Injection</strong> | <span class="No-Break"><strong class="bold">DNS Lookup</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer451" class="IMG---Figure">
					<img src="image/B21173_08_029..jpg" alt="Figure 8.29 – Navigate to the Command Injection lesson"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.29 – Navigate to the Command Injection lesson</p>
			<ol>
				<li value="2">On the <strong class="bold">DNS Lookup</strong> page, type <a id="_idIndexMarker532"/>the IP address <strong class="source-inline">127.0.0.1</strong> in the textbox and click the <strong class="bold">Lookup </strong><span class="No-Break"><strong class="bold">DNS</strong></span><span class="No-Break"> button:</span></li>
			</ol>
			<div>
				<div id="_idContainer452" class="IMG---Figure">
					<img src="image/B21173_08_030..jpg" alt="Figure 8.30 – Type in an IP address"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.30 – Type in an IP address</p>
			<ol>
				<li value="3">Switch to the Burp Suite <strong class="bold">Proxy</strong> | <strong class="bold">HTTP history</strong> tab and look for the request you just performed. Right-click on <strong class="bold">Send </strong><span class="No-Break"><strong class="bold">to Intruder</strong></span><span class="No-Break">.</span></li>
				<li>In the <strong class="bold">Intruder</strong> | <strong class="bold">Positions</strong> tab, clear all suggested payload markers with the <strong class="bold">Clear $</strong> button. In the <strong class="source-inline">target_host</strong> parameter, place a pipe symbol (<strong class="source-inline">|</strong>) immediately <a id="_idIndexMarker533"/>following the <strong class="source-inline">127.0.0.1</strong> IP address. After the pipe symbol, place an <strong class="source-inline">X</strong>. Highlight the <strong class="source-inline">X</strong> and click the <strong class="bold">Add $</strong> button to wrap the <strong class="source-inline">X</strong> with <span class="No-Break">payload markers:</span></li>
			</ol>
			<div>
				<div id="_idContainer453" class="IMG---Figure">
					<img src="image/B21173_08_031..jpg" alt="Figure 8.31 – Add a substitution marker at the end of the parameter along with a pipe"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.31 – Add a substitution marker at the end of the parameter along with a pipe</p>
			<ol>
				<li value="5">In the <strong class="bold">Intruder</strong> | <strong class="bold">Payloads</strong> tab, click the <strong class="bold">Load</strong> button. Browse to the location where you downloaded the <strong class="bold">SecLists-master</strong> wordlists from GitHub. Navigate to the location of the <strong class="source-inline">UnixAttacks.fuzzdb.txt</strong> wordlist and use the following to populate the <strong class="bold">Payload  settings [Simple list]</strong> <span class="No-Break">box: </span><span class="No-Break"><strong class="source-inline">SecLists-master/Fuzzing/UnixAttacks.fuzzdb.txt</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer454" class="IMG---Figure">
					<img src="image/B21173_08_032..jpg" alt="Figure 8.32 – Load wordlist"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.32 – Load wordlist</p>
			<ol>
				<li value="6">Uncheck <a id="_idIndexMarker534"/>the <strong class="bold">Payload encoding</strong> box at the bottom of the <strong class="bold">Payloads</strong> tab page and then click the <strong class="bold">Start </strong><span class="No-Break"><strong class="bold">Attack</strong></span><span class="No-Break"> button.</span></li>
				<li>Allow the attack to continue until you reach payload <strong class="source-inline">50</strong>. Notice the responses through the <strong class="bold">Render</strong> tab are around payload <strong class="source-inline">45</strong> or so. We can perform commands, such as <strong class="source-inline">id</strong> on the operating system, which displays the results of the commands on the <span class="No-Break">web page:</span></li>
			</ol>
			<div>
				<div id="_idContainer455" class="IMG---Figure">
					<img src="image/B21173_08_033..jpg" alt="Figure 8.33 – Evidence of command injection e﻿xploit"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.33 – Evidence of command injection e<a id="_idTextAnchor519"/>xploit</p>
			<ol>
				<li value="8">We can also <a id="_idIndexMarker535"/>right-click this request from the results table and send to <strong class="bold">Repeater</strong> to perform the <span class="No-Break">attack again.</span></li>
			</ol>
			<div>
				<div id="_idContainer456" class="IMG---Figure">
					<img src="image/B21173_08_034..jpg" alt="Figure 8.34 – Send to Repeater"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.34 – Send to Repeater</p>
			<ol>
				<li value="9">In <strong class="bold">Repeater</strong>, click <strong class="bold">Send</strong>, and on the response, click the <strong class="bold">Render</strong> tab to view the results <a id="_idIndexMarker536"/>of the <span class="No-Break">command injection.</span></li>
			</ol>
			<div>
				<div id="_idContainer457" class="IMG---Figure">
					<img src="image/B21173_08_035..jpg" alt="Figure 8.35 – Repeat exploit to see ev﻿idence"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 8.35 – Repeat exploit to see ev<a id="_idTextAnchor520"/>idence</p>
			<h2 id="_idParaDest-201"><a id="_idTextAnchor521"/>How it works...</h2>
			<p>Failure to define and validate user input against an acceptable list of system commands can lead to command injection vulnerabilities. In this case, the application code does not confine system commands available through the UI, allowing visibility and execution of commands on the operating system that should <span class="No-Break">be restricted.</span></p>
		</div>
	</body></html>