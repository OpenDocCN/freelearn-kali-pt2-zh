<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xml:lang="en" lang="en">
<head>
<title>The Ultimate Kali Linux Book - Third Edition</title>
<link rel="stylesheet" type="text/css" href="../styles/stylesheet1.css"/>
<link rel="stylesheet" type="text/css" href="../styles/stylesheet2.css"/>
</head>
<body>
<div id="book-content">
<div id="sbo-rt-content"><section id="active-reconnaissance" class="level1 pkt" data-number="7">
<h1 data-number="7">6 Active Reconnaissance</h1>
<section id="join-our-book-community-on-discord-5" class="level2" data-number="7.1">
<h2 data-number="7.1">Join our book community on Discord</h2>
<p><a href="https://packt.link/SecNet">https://packt.link/SecNet</a><img src="../media/file211.png" alt="Qr code Description automatically generated" width="150" height="150"/>The more information collected about a target helps ethical hackers and penetration testers to improve exploit development during the weaponization phase of the Cyber Kill Chain and identify the best method to deliver the malicious payload to the target. Active reconnaissance helps you to collect information that’s not public available, such as which services are running and how many ports exists on a targeted system. For instance, if you’re targeting a web server, it’s important to identify the web application and its version. In addition, it would be useful to also identify the operating system that’s hosting the web application.During this chapter, you will understand the need for active reconnaissance techniques during ethical hacking and penetration testing assessments on a target system, network and organization. You will explore active scanning techniques which are commonly used to identify live systems, their open port and running services. Furthermore, you will explore various techniques used by seasoned penetration testers to profile systems and identify their attack surface, which can help improve their plan of attack. Lastly, you will learn how to perform enumeration on common network services and identify whether an organization is leaking data on their cloud platform.In this chapter, we will cover the following topics:</p>
<ul>
<li>Understanding active information</li>
<li>Profiling websites using EyeWitness</li>
<li>Exploring active scanning techniques</li>
<li>Enumerating common network services</li>
<li>Discovering data leaks in the cloud</li>
</ul>
<p>Let’s dive in!</p>
</section>
<section id="technical-requirements-4" class="level2" data-number="7.2">
<h2 data-number="7.2">Technical Requirements</h2>
<p>To follow along with the exercises in this chapter, please ensure that you have met the following hardware and software requirements:</p>
<ul>
<li>Kali Linux - <a href="https://www.kali.org/get-kali/">https://www.kali.org/get-kali/</a></li>
<li>EyeWitness - <a href="https://github.com/RedSiege/EyeWitness">https://github.com/RedSiege/EyeWitness</a></li>
<li>S3Scanner - <a href="https://github.com/sa7mon/S3Scanner">https://github.com/sa7mon/S3Scanner</a></li>
</ul>
</section>
<section id="understanding-active-information" class="level2" data-number="7.3">
<h2 data-number="7.3">Understanding active information</h2>
<p>Using active reconnaissance techniques enables ethical hackers and penetration tester to use a more direct approach when engaging the target. For instance, many active reconnaissance techniques involves establishing a logical network connection between your attacker machine, such as Kali Linux and the targeted system(s) over the network. With active reconnaissance, you can send specially crafted probes to collect specific details such as the following:</p>
<ul>
<li>Determine how live hosts are on the network.</li>
<li>Determine whether the targeted system is online.</li>
<li>Identify open port numbers and running services.</li>
<li>Profile the operating system on the targeted machine.</li>
<li>Identify whether the targeted system has any network shares.</li>
</ul>
<p>Therefore, before launching any type of network-based attack, it's important to determine whether there are live systems on the network and the target is online. Imagine launching an attack towards a specific system, only to realize the target is offline and the attack has failed. Hence, it doesn't make sense to target an offline device as it would be unresponsive and increase the risk of detection by the organization’s security team.</p>
<blockquote>
<p>Unlike passive reconnaissance which leverages <strong>Open Source Intelligence</strong> (<strong>OSINT</strong>) from public data sources, using active reconnaissance techniques does increase the risk of being detected by the target’s security systems and triggering alerts. Therefore, it’s important to consider the threat level for each type of attack during your planning phase.</p>
</blockquote>
<p>As compared to adversaries, ethical hackers and penetration testers uses similar techniques to simulate a real-world cyber-attack to identify how a real attacker would collect and leverage information to identify security vulnerabilities and compromise their targets.In the next section, you will learn how to automate the process of taking screenshots of targeted domains and systems on a network.</p>
</section>
<section id="profiling-websites-using-eyewitness" class="level2" data-number="7.4">
<h2 data-number="7.4">Profiling websites using EyeWitness</h2>
<p>What do you do after discovering additional sub-domains of a targeted organization on the internet? A common and obvious practice would be to visit each sub-domain to determine whether it leads to a vulnerable web application or system which can be exploited to gain a foothold into the targeted organization’s network. However, manually visiting each sub-domain can be quite time consuming if you need to visit 100+ sub-domains for a targeted organization. As an aspiring ethical hacker and penetration tester, using a tool such as <strong>EyeWitness</strong> enables you to automate the process of checking and capturing a screenshot of each sub-domain. To get started using EyeWitness, please use the following instructions:</p>
<ol>
<li>Power-on the <strong>Kali Linux</strong> virtual machine, open the <strong>Terminal</strong> and use the following commands to clone the EyeWitness repository:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ git clone https://github.com/RedSiege/EyeWitness</code></pre>
</div>
<ol>
<li>Next, execute the <code>setup.py</code> script to install EyeWitness by using the following commands:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ cd EyeWitness/Python/setup 
kali@kali:~/EyeWitness/Python/setup$ sudo ./setup.sh</code></pre>
</div>
<ol>
<li>Next, use the <code>cd ..</code> command to move up one directory , as shown below:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~/EyeWitness/Python/setup$ cd ..</code></pre>
</div>
<ol>
<li>Next, use the following commands to create a new text file within the <code>/home/kali/</code> directory, then write a targeted sub-domain into it:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~/EyeWitness/Python$ touch /home/kali/eyewitness_targets.txt
kali@kali:~/EyeWitness/Python$ echo https://example.com/ &gt; /home/kali/eyewitness_targets.txt</code></pre>
</div>
<blockquote>
<p>The <code>touch &lt;filename&gt;</code> command enables you to create a new file within Linux. The <code>echo</code> command allows you to write contents within a file.</p>
</blockquote>
<ol>
<li>Next, use the following command to enable EyeWitness to capture screenshots of each sub-domain found within the <code>eyewitness_targets.txt</code> file:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~/EyeWitness/Python$ ./EyeWitness.py --web -f /home/kali/eyewitness_targets.txt -d /home/kali/EyeWitness_Screenshots --prepend-https</code></pre>
</div>
<p>The following is a breakdown of each syntax used in the preceding command:</p>
<ul>
<li><code>--web</code>: Specifies to take HTTP screenshots.</li>
<li><code>-f</code>: Specifies the source file with the list of targeted domains and sub-domains.</li>
<li><code>-d</code>: Specifies the output directory to save the results and report.</li>
<li><code>--prepend-https</code>: Specifies to prepend <code>http://</code> and <code>https://</code> to the list of domains and sub-domains.</li>
</ul>
<p>The following screenshot shows the process of capturing the screenshot(s):</p>
<img src="../media/file212.png" width="1256" height="390"/>
<p>If you type <code>Y</code> and hit Enter, the EyeWitness report will automatically load and open within the web browser, as shown below:</p>
<img src="../media/file213.png" width="1194" height="625"/>
<p>As you have seen, using a tool such as EyeWitness can save you a lot of time as compared to checking each sub-domain manually. You can quickly browse each image within the generated report to identify any login portals and sensitive directories on a targeted domain.</p>
<blockquote>
<p>To learn more about EyeWitness, please see: <a href="https://github.com/RedSiege/EyeWitness">https://github.com/RedSiege/EyeWitness</a> and use the <code>./EyeWitness.py –h</code> command to view the help menu.</p>
</blockquote>
<p>Having completed this section, you have learned how to automate the process of capturing screenshots of many websites using EyeWitness. In the next section, you will explore various scanning and fingerprinting techniques.</p>
</section>
<section id="exploring-active-scanning-techniques" class="level2" data-number="7.5">
<h2 data-number="7.5">Exploring active scanning techniques</h2>
<p>As an aspiring ethical hacker and penetration tester, it’s essential to develop a solid foundation on understanding how to leverage scanning techniques to efficiently discover and profile targeted systems on an organization’s network. Many organizations focus on securing their perimeter network and sometimes do not apply equal focus on securing their internal network. Quite often, you will discover that over 90% of a cyberattack or threat usually originates from the inside network. Due to this, many organizations think the attacker will launch their attack from the internet, which will then be blocked by their network-based firewall.The following diagram shows a simplified overview of a typical deployment of a firewall:</p>
<img src="../media/file214.png" width="612" height="346"/>
<p>As shown in the preceding diagram, the network-based firewall is implemented as the edge device between the organization’s internal network and the internet. One of its role is to filter traffic between networks and prevent malicious traffic from passing through to the other side, whether it’s malicious traffic originating from the internet with a destination to the internal systems on the organization’s network and vice versa. However, threat actors are continuously learning how organizations implement their infrastructure and security solutions, as well as the decisions that both the leadership team and IT professionals make when securing their assets.While many organizations are investing into their cyber defenses to ensure their assets and people are protected from adversaries and cyber-attacks, there are still so many organizations around the world without firewalls, misconfigured network devices and security appliances, and unpatched operating systems. Metaphorically speaking, it’s only a matter of time for an adversary to discover this gold mine and starts <em>living of the land</em>. During the reconnaissance phase of the Cyber Kill Chain and common penetration testing methodology, ethical hackers and penetration testers will eventually need to directly engage with the target to collect information that’s not available from <strong>Open Source Intelligence</strong> (<strong>OSINT</strong>) and use active reconnaissance techniques such as scanning and enumeration.Scanning is a technique that's used by threat actors to discover live systems on a network, identify the open service ports on a system, and discover vulnerabilities on host machines and even their operating system architecture. The information that's gathered from scanning helps the penetration tester gain a clearer view of their targets compared to passive information gathering.</p>
<blockquote>
<p>Do not perform any type of scanning on systems and networks that you do not own or have legal permission to do so. Scanning is considered illegal in many countries.</p>
</blockquote>
<p>Penetration testers always need to improve their critical thinking mindset to think like a real threat actor, especially if they want to perform a successful penetration test on a targeted organization. In this section, you will learn about various techniques and methodologies for performing scanning on a targeted network and how to profile systems.</p>
<section id="changing-your-mac-address" class="level3" data-number="7.5.1">
<h3 data-number="7.5.1">Changing your MAC address</h3>
<p>The <strong>Network Interface Card</strong> (<strong>NIC</strong>) is a network adapter which enables a system to communicate over a wired or wireless network. For instance, before your devices sends data on a network, the NIC converts the message into a signal that’s supported over the media for transmission, such as electrical signals for copper cables, light signals for fiber optics and radio frequency for wireless communication. In addition, the NIC on each device contains a globally unique <strong>Media Access Control</strong> (<strong>MAC</strong>) address, sometimes referred to as a <em>burned-in address</em> that’s theoretically not changeable. Before a device transmits data over a network, the sender device automatically inserts the source and destination MAC address onto the frame header of the message. The source MAC address helps the recipient identify the sender of the message, and the destination MAC address helps the network switches forward the message to the intended destination. The MAC address is a 48-bit address written in hexadecimal. The first 24-bits of the address is known as the <strong>Organizational Unique Identifier</strong> (<strong>OUI</strong>) which helps IT professionals to determine the vendor of a device. While the last 24-bits is uniquely assigned by the vendor. Therefore, when your NIC sends traffic out on a network, your real MAC address is also inserted within the frame header, and this information can be used to identify your machine on a network. As an aspiring penetration tester, you can change the MAC address on both your Ethernet and wireless network adapters by using a pre-installed tool known as <strong>MAC Changer</strong>.Changing your MAC address allows you to trick other devices on the network into thinking your system is a common device that belong within the organization’s network infrastructure, such as a network device, a printer, or a vendor-specific device. This technique is commonly used to protect the identity of your attacker machine, bypass MAC filtering rules on network devices and evade network restrictions while on your target’s network.To learn how to change your MAC address using <strong>MAC Changer</strong>, please use the following instructions:</p>
<ol>
<li>Power-on the <strong>Kali Linux</strong> virtual machine and use the <code>ifconfig</code> command to determine the original MAC address on your network adapters, as shown below:</li>
</ol>
<img src="../media/file215.png" width="1142" height="539"/>
<p>As shown in the preceding screenshot, the <code>ifconfig</code> command was used to display all connected network adapters on the Kali Linux virtual machine. In addition, this command enables us to view the original MAC address on each network adapter, within the <strong>ether</strong> field.</p>
<ol>
<li>Next, logically turn down the <strong>eth0</strong> interface with the following commands:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ sudo ifconfig eth0 down</code></pre>
</div>
<ol>
<li>Next, use the <code>macchanger --help</code> command to view a list of available options, as shown below:</li>
</ol>
<img src="../media/file216.png" width="1139" height="546"/>
<ol>
<li>Next, set a randomized MAC address on the <strong>eth0</strong> network adapter by using the following commands:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ sudo macchanger -A eth0</code></pre>
</div>
<p>The following screenshot shows the current, permanent and the newly generated MAC address for the <strong>eth0</strong> network adapter:</p>
<img src="../media/file217.png" width="1266" height="176"/>
<ol>
<li>Next, re-enable the <strong>eth0</strong> interface by using the following commands:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ sudo ifconfig eth0 up</code></pre>
</div>
<ol>
<li>Next, use the <code>ifconfig</code> command once more to verify the <strong>eth0</strong> has a spoofed MAC address, as shown below:</li>
</ol>
<img src="../media/file218.png" width="1146" height="296"/>
<ol>
<li>Lastly, to further verify the vendor of the spoofed MAC address, go to <a href="https://macvendors.com/">https://macvendors.com/</a> and enter the MAC address, as shown below:</li>
</ol>
<img src="../media/file219.png" width="720" height="309"/>
<p>Having completed this exercise, you have learnt how spoof your MAC address on Kali Linux. However, it’s important to consider using a MAC address that’s associated to a common vendor of networking devices or system to reduce the risk of detection by the organization’s security team. Next, you will learn how perform host discovery to identify live systems on an internal network.</p>
</section>
<section id="performing-host-discovery" class="level3" data-number="7.5.2">
<h3 data-number="7.5.2">Performing host discovery</h3>
<p>Discovering live hosts on a targeted network is an essential stage when performing a penetration test. Let's imagine you're an ethical hacker or a penetration tester; your targeted organization permits you to directly connect your attacker machine with Kali Linux on their network to perform security testing on their internal network. You're eager to start discovering security vulnerabilities and hacking systems, but you're not sure whether the targeted hosts are online.In this section, you will learn about the skills you will need to perform various types of active reconnaissance on an organization's networks using various tools and techniques. However, to ensure you can perform these exercises in a safe space, please use the following guidelines:</p>
<ul>
<li>Ensure you do not scan systems that you do not own or have been granted legal permission.</li>
<li>Ensure the network adapter of Kali Linux is assigned to the <strong>PentestNet</strong> network within Oracle VM VirtualBox Manager.</li>
<li>The PentestNet network will be our simulated organization network.</li>
</ul>
<p>To get started with this exercise, please use the following instructions:</p>
<ol>
<li>Power-on the <strong>Kali Linux</strong>, <strong>Metasploitable 2</strong> and <strong>Metasploitable 3</strong> (<strong>Windows version</strong>) virtual machines.</li>
<li>On <strong>Kali Linux</strong>, open the <strong>Terminal</strong> the use the <code>ifconfig</code> or <code>ip address</code> command to determine if your attacker machine (Kali Linux) is connected to the targeted network (<code>172.30.1.0/24</code>), as shown below:</li>
</ol>
<img src="../media/file220.png" width="1518" height="553"/>
<p>As an aspiring ethical hacker and penetration tester, it’s important to verify whether your attacker machine has a valid IP address and subnet mask on the targeted network during the internal network penetration test. As shown in the preceding screenshot, <code>eth1</code> is connected to the <em>PentestNet</em> environment which is our targeted network.</p>
<blockquote>
<p>Keep in mind, wired network adapters are identified with <strong>eth</strong> and wireless adapters are identified with <strong>wlan</strong>.</p>
</blockquote>
<p>Additionally, the <strong>inet</strong> field contains the IP address that’s assigned on the interface of the Kali Linux virtual machine. However, the IP address shown in the preceding screenshot may be different from the address shown on your machine, that's okay once it's on the <code>172.30.1.0/24</code> network. Furthermore, identifying the IP address on the network adapter will enable us to exclude scanning our own machine in the next steps.</p>
<blockquote>
<p>Ethical hackers and penetration testers often needs to determine the Network ID and range of IP addresses within a network before performing host discovery on an internal network. While its recommended to build a solid foundation on networking prior to learning cybersecurity and penetration testing, the following website is an online subnet calculator that will help you determine the IP ranges and much more: <a href="https://www.calculator.net/ip-subnet-calculator.html">https://www.calculator.net/ip-subnet-calculator.html</a>.</p>
</blockquote>
<ol>
<li>Next, let’s use <strong>Netdiscover</strong> to passively scan for live systems on the <em>PentestNet</em> environment (<code>172.30.1.0/24</code>), using the following commands:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ sudo netdiscover -p -i eth1</code></pre>
</div>
<p>The <code>-i</code> syntax is commonly used to specify the listening interface and using the <code>-p</code> syntax performs a passive scan by enabling Netdiscover the capture and analyze <strong>Address Resolution Protocol</strong> (<strong>ARP</strong>) messages on a network, by analyzing the source and destination IP and MAC addresses helps us to identify live hosts on a network, as shown below:</p>
<img src="../media/file221.png" width="1243" height="346"/>
<p>As shown in the preceding screenshot, Netdiscover provided the IP addresses, MAC addresses, vendors, and hostnames of the live systems on the targeted network. Where, <code>172.30.1.48</code> is assigned to Metasploitable 3 – Windows and <code>172.30.1.49</code> is assigned to the Metasploitable 2 virtual machines. Furthermore, leveraging the MAC vendor information helps us determine the type of devices are on the network and can be useful when researching security vulnerabilities for a specific system</p>
<ol>
<li>Next, to perform an active host discovery scan using Netdiscover, use the following commands:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ sudo netdiscover -r 172.30.1.0/24 -i eth1</code></pre>
</div>
<p>Since the active scan does not wait for ARP message, Netdiscover sends its own probes to all usable IP addresses within the <code>172.30.1.0/24</code> network. Only live systems will respond, enabling Netdiscover to analyze each response messages to identify the IP and MAC addresses of live hosts on the network, as shown below:</p>
<img src="../media/file222.png" width="1170" height="328"/>
<ol>
<li>Next, let’s use <strong>Network Mapper</strong> (<strong>Nmap</strong>) to perform a <em>ping sweep</em> over the entire targeted network and exclude our attacker machine during the scanning process, use the following commands:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ nmap -sn 172.30.1.0/24 --exclude 172.30.1.50</code></pre>
</div>
<p>A <strong>ping sweep</strong> is a basic scanning technique that’s used by IT professionals to determine which systems are online within a network. It’s the automated process of pinging each usable IP address within a network and observing which devices are responding. However, the <code>ping</code> utility within an operating system sends <strong>Internet Control Message Protocol</strong> (<strong>ICMP</strong>) <strong>ECHO Request</strong> message to the destination and a live system will respond with an <strong>ICMP ECHO Reply</strong> message. It’s a common security practice for cybersecurity professionals to disable ICMP responses on critical systems within their organization, this reduces the likelihood that a novice hacker is to discover a live host. Therefore, if an attacker sends <strong>ICMP ECHO Request</strong> messages to a system that’s configured to not respond, the novice attacker will think the target is offline. On the other hand, seasoned threat actors and penetration testers who understands the security vulnerabilities that exists within the <strong>Transmission Control Protocol/Internet Protocol</strong> (<strong>TCP/IP</strong>) networking model can bypass this minor security mechanism and instead send <strong>Transmission Control Protocol</strong> (<strong>TCP</strong>) messages to specific ports on the targeted system. This technique leverages the design of TCP and tricks the targeted system to respond, indicating it’s live on the network.The following screenshot shows there are 2 live hosts, <code>172.30.1.48</code> and <code>172.30.1.49</code> on the network:</p>
<img src="../media/file223.png" width="1012" height="272"/>
<p>The <code>-sn</code> syntax on Nmap is used to specify a ping scan but Nmap does not send ICMP messages to the target. Instead, Nmap sends TCP messages to specific ports on the targeted system as shown in the Wireshark packet capture below:</p>
<img src="../media/file224.png" width="1220" height="434"/>
<p>Nmap sends specially crafted TCP <strong>Synchronization</strong> (<strong>SYN</strong>) packets to the targeted host, with the intention of triggering a TCP <strong>Reset</strong> (<strong>RST</strong>) or TCP <strong>Acknowledgement</strong> (<strong>ACK</strong>) as a response from a live/online host.</p>
<blockquote>
<p>To learn more on how TCP establishes a connection with a destination host using the TCP 3-way handshake, please see: <a href="https://hub.packtpub.com/understanding-network-port-numbers-tcp-udp-and-icmp-on-an-operating-system/">https://hub.packtpub.com/understanding-network-port-numbers-tcp-udp-and-icmp-on-an-operating-system/</a>.</p>
</blockquote>
<p>Identifying live hosts on a network helps ethical hackers and penetration testers to create a network topology and identify whether their targets are online before proceeding to profile the targets. Next, you will learn how identify open ports, running services and determine the operating system of a target.</p>
</section>
<section id="identifying-open-ports-services-and-operating-systems" class="level3" data-number="7.5.3">
<h3 data-number="7.5.3">Identifying open ports, services and operating systems</h3>
<p>After performing host discovery, the next step is to identify any open ports on the targeted system and determine which services are mapped to those open ports. There are various techniques that a penetration tester can use to identify the open ports on a targeted system. Some techniques are manual, while others can simply be automated using the Nmap tool.To gets started fingerprinting using Nmap, please use the following instructions:</p>
<ol>
<li>Firstly, ensure the <strong>Kali Linux</strong>, <strong>Metasploitable 2</strong>, and <strong>Metasloitable 3</strong> (<strong>Windows version</strong>) virtual machines are powered-on.</li>
<li>On <strong>Kali Linux</strong>, open the <strong>Terminal</strong> and use the following commands to perform a basic Nmap scan to determine whether any of the top 1000 ports are open on the Metasploitable 3 (Windows version) virtual machine:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ nmap 172.30.1.48</code></pre>
</div>
<p>As shown in the following screenshot, Nmap indicates there are 20 TCP open ports and provided the name of their associated services:</p>
<img src="../media/file225.png" width="981" height="652"/>
<p>Using the information from this scan enables you to start fingerprinting your targeted systems. As a penetration tester, you can determine which ports are open and discover how they can be used as a point-of-entry into the target, and look for security vulnerabilities on the running services.</p>
<blockquote>
<p>As an aspiring ethical hacker and penetration, it’s okay if you don’t initially understand the role and function of service ports on a system. However, its recommended to perform research on anything you’re not familiar with to gain a better understanding of the technology or topic. For instance, there are many service ports and each if associated with a specific application-layer service, such as TCP port 443 is associated to the <strong>Hypertext Transfer Protocol Secure</strong> (<strong>HTTPS</strong>) protocol that’s used for secure web communication.</p>
</blockquote>
<ol>
<li>Next, let’s perform an advanced scan to identify the targeted system’s operating system, service versions and retrieve <strong>Server Message Block</strong> (<strong>SMB</strong>) details, using the following the commands:</li>
</ol>
<div class="C1-CodePACKT">
<pre><code>kali@kali:~$ nmap -A -T4 -p- 172.30.1.48</code></pre>
</div>
<p>Let's take a look at each syntax that were used in the preceding command:</p>
<ul>
<li><code>-A</code>: This enables Nmap to profile the target to identify its operating system, service versions, and script scanning, as well as perform a traceroute.</li>
<li><code>-T</code>: This syntax specifies the timing options for the scan, which ranges from 0 – 5, where 0 is very slow and 5 is the fastest. This command is useful for preventing too many probes from being sent to the targeted system too quickly which may trigger alerts.</li>
<li><code>-p</code>: Using the <code>-p</code> syntax allows you to specify targeted port(s) to identify as opened or closed on a system. You can specify <code>-p80</code> to scan for port 80 only on the target and <code>-p-</code> to scan for all 65,535 open ports.</li>
</ul>
<blockquote>
<p>By default, Nmap scans TCP ports only. Therefore, if a target is running a service on a <strong>User Datagram Protocol</strong> (<strong>UDP</strong>) server port, there's a possibility you will miss it. To perform a UDP scan on a port or range of ports, use the <code>-p U:53</code> command, where 53 is the targeted port number.</p>
</blockquote>
<p>The following screenshots the upper-portion of the scan results:</p>
<img src="../media/file226.png" width="1130" height="716"/>
<p>As shown in the preceding screenshot, Nmap was able to retrieve a lot more in-depth information about our target, such as the service versions of each service that is associated with an open port. It was also able to perform banner grabbing and determine whether there's an authentication system/login mechanism for each service. The following screenshot is the lower-portion of the same scan results:</p>
<img src="../media/file227.png" width="1490" height="361"/>
<p>As shown in the preceding screenshot, Nmap was able to identify the host operating system on the target as a Windows Server 2008 R2 machine with service pack 1. In addition, Nmap was able to determine the hostname of the system and whether it’s connected to a domain or not based on the Workgroup name. Whenever a Windows-based system is not connected to a <strong>Domain Controller</strong> (<strong>DC</strong>), the default Workgroup is called <code>Workgroup</code>. Furthermore, the Nmap scan was able to perform a basic SMB scan to identify the operation system, this also indication the targeted system may have file and printer shares available.The following are additional syntax which can be used during the scanning process with Nmap:</p>
<ul>
<li><code>-Pn</code> – This syntax enables Nmap to perform a scan on the targeted system(s) without firstly performing host discovery, and simply considers the target to be online.</li>
<li><code>-sU</code> – This syntax enables Nmap to perform UDP port scanning on the targeted system(s). This command will be useful with identifying whether there are any running services on UDP ports as compared to TCP port numbers.</li>
<li><code>-p</code> – This command allows you to specify either a range of targeted ports or specific ports are open on a system. Using <code>nmap -p 50-60</code>, <code>nmap -p 80,443</code> or <code>nmap -p 22</code> allows you to scan a range, a group or specific ports numbers. However, using <code>nmap -p-</code> specifies to scan all 65,535 port numbers, keep in mind Nmap scans TCP ports by default.</li>
<li><code>-sV</code> – This syntax enables you to perform service version identification of running services on a targeted system. For instance, an Nmap basic scan may indicate port 23 is open and it’s associated to the <strong>Telnet</strong>, as an ethical hacker is important to determine the service version of this running service. Therefore, using <code>nmap -sV &lt;targeted system&gt;</code> command will identify the service version which can be useful when researching security vulnerabilities on a target.</li>
<li><code>-6</code> – Using this syntax enables Nmap to perform scans on a targeted IPv6 network or a host with an IPv6 address.</li>
</ul>
<p>Additionally, ethical hackers and penetration testers can use the <strong>Ping</strong> utility to profile the operating system of a target by analyzing the <strong>Time To Live</strong> (<strong>TTL</strong>) value found within the ICMP response messages from the target. For instance, Windows-based operating systems reply with a default TTL value of <code>128</code>, while Linux-based systems reply with a default TTL value of <code>64</code>.To better understand how ICMP helps us identify the operating system of a targeted machine, please use the following instuctions:</p>
<ol>
<li>On <strong>Kali Linux</strong>, use the following commands to send 4 ICMP ECHO Request messages to the Metasploitable 3 (Windows version) virtual machine:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ ping 172.30.1.48 -c 4</code></pre>
</div>
<p>As shown in the following screenshot, all ICMP responses contained a TTL of <code>128</code>, which indicates the targeted system is running a version of the Windows operating system:</p>
<img src="../media/file228.png" width="974" height="352"/>
<ol>
<li>Next, use the following commands to send 4 ICMP ECHO Request messages to the Metasploitable 2 virtual machine:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ ping 172.30.1.49 -c 4</code></pre>
</div>
<p>As shown in the following screenshot, the ICMP responses has a TTL value of <code>64</code>, which indicates the targeted system is running a version of Linux:</p>
<img src="../media/file229.png" width="978" height="347"/>
<p>As an aspiring ethical hacker and penetration tester, identifying the operating system, open ports and running services helps you to better profile the target and identify its security vulnerabilities. By identifying the security vulnerabilities, you can improve on your exploit development phase and plan of attack. Simply put, an exploit or payload for a Windows-based operating system will most likely not work on a Linux-based system or vice versa.Thus far, you have learned how to discover open ports, service versions, operating system, and SMB versions. Next, you will learn how to evade detection while performing active scanning on a network and systems using Nmap.</p>
</section>
<section id="using-scanning-evasion-techniques" class="level3" data-number="7.5.4">
<h3 data-number="7.5.4">Using scanning evasion techniques</h3>
<p>Whenever a packet is sent from one device to another, the source IP address is included within the header of the packet. This is the default behavior of the TCP/IP networking model; all addressing information must be included within all packets before they are placed on the network. When performing a scan as an ethical hacker and a penetration tester, we try to remain undetected to determine whether the security team of the targeted organization has the capabilities of detecting the simulated cyber-attack.During a real cyber-attack, if an organization is unable to detect suspicious activities and security incidents on their network and systems, the threat actor can simply achieve their objectives without obstructions. However, if an organization can detect suspicious activities as soon as they occur, the security team can take action quickly to contain and stop the threat while safeguarding their organization’s assets. During a penetration test, it's important to simulate real-world cyber-attack to test the threat detection and mitigation systems within the targeted organization.</p>
<section id="avoiding-detection-with-decoys" class="level4" data-number="7.5.4.1">
<h4 data-number="7.5.4.1">Avoiding detection with decoys</h4>
<p>Nmap is usually considered to be the king of network scanners within the cybersecurity industry due to its advanced scanning capabilities. Nmap enables penetration testers to use decoys when scanning a targeted system. This scanning technique tricks the targeted system into thinking the source of the scan is originating from multiple sources, rather than a single source IP address that belongs to the attacker machine.To get started with this exercise, please use the following instructions:</p>
<ol>
<li>Power-on <strong>Kali Linux</strong>, <strong>Metasploitable 2</strong> and <strong>Metasploitable 3</strong> (Windows version) virtual machines. Kali Linux will be the attacker machine, Metasploitable 2 will be the targeted system and Metasploitable 3 – Windows virtual machine will be the decoy, as shown in the following diagram:</li>
</ol>
<img src="../media/file230.png" width="688" height="322"/>
<p>Ensure you identify the IP addresses of each of these systems as they may be different from the preceding diagram. Using the scanning techniques from the previous section will help you identify the IP addresses easily.</p>
<ol>
<li>Next, to perform an Nmap scan using decoys, use the following commands:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ sudo nmap 172.30.1.49 -D 172.30.1.48</code></pre>
</div>
<p>Using the <code>-D</code> syntax enables you to specify one or more decoys. Before Nmap uses the decoy addresses, it will first check whether each decoy system is a live host on the network, if an address is not reachable, it won’t include the offline address during the scan. The following screenshot shows the expected results of the scan:</p>
<img src="../media/file231.png" width="988" height="430"/>
<p>If the security team of the targeted organization is closely monitoring the packets over their internal network and identifies a port scan is in progress, there’s a chance they will determine the scan is originating from your IP address. However, the decoy feature will include the decoy addresses within various packets from your attacker machine, as shown below:</p>
<img src="../media/file232.png" width="1530" height="336"/>
<p>Therefore, using more decoy addresses during the Nmap scan will decrease the risk a security analyst may trace the source of the scan back to your IP address. However, security analysts are well-trained professionals and usually has the required tools and skilled to identify threats quickly on their network infrastructure.</p>
</section>
<section id="using-mac-and-ip-spoofing-techniques" class="level4" data-number="7.5.4.2">
<h4 data-number="7.5.4.2">Using MAC and IP spoofing techniques</h4>
<p>Nmap is like the Swiss army knife of scanners, filled with lots of scanning features to evade detection. Nmap allows a penetration tester to spoof both the MAC and IP addresses of their Kali Linux machine.The following are common MAC and IP spoofing techniques with Nmap:</p>
<ol>
<li>To perform an Nmap scan using a randomized MAC address, use the <code>--spoof-mac 0</code> command as shown below:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ sudo nmap --spoof-mac 0 172.30.1.49</code></pre>
</div>
<p>The following screenshot shows Nmap generated a random MAC address before performing the scan on targeted system:</p>
<img src="../media/file233.png" width="994" height="431"/>
<p>In addition, the following screenshot shows the packets that were captured using Wireshark to further verify Nmap used a randomized address as the source MAC address:</p>
<img src="../media/file234.png" width="1416" height="226"/>
<ol>
<li>To perform an Nmap scan on a targeted system with a spoof MAC address of a specific vendor, it’s simply as including the vendor’s name, with the following commands:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ sudo nmap -sT -Pn --spoof-mac hp 172.30.1.49</code></pre>
</div>
<p>The following screenshot Nmap using an HP MAC address as the source address:</p>
<img src="../media/file235.png" width="1032" height="490"/>
<blockquote>
<p>To learn more about the various functionality of Nmap, use the <code>nmap -h</code> and <code>man nmap</code> commands to view the help menu and manual page.</p>
</blockquote>
<p>Having completed this section, you have learned how to evade detection on a network while performing scanning using Nmap. Next, you will learn how to perform a stealth scan using Nmap.</p>
</section>
<section id="stealth-scanning-techniques" class="level4" data-number="7.5.4.3">
<h4 data-number="7.5.4.3">Stealth scanning techniques</h4>
<p>By default, Nmap establishes a TCP 3-way handshake on any open TCP ports found on the targeted systems. Once the handshake has been established between the attacker machine and the targeted system, data packets are exchanged between each host. The following diagram shows the TCP 3-way handshake, where Host A is initializing communication with Host B:</p>
<img src="../media/file236.png" width="578" height="224"/>
<p>During a penetration test, it's important to be as stealthy as possible on the network. This creates the effect of a real adversary attempting to compromise the targeted systems on the network, without being caught by the organization's security solutions. However, by establishing a TCP 3-way handshake with the targeted devices, we are making ourselves known to the target.By using Nmap, we can perform a stealth scan (half-open) between the target and our attacker system. A stealth scan does not setup a full TCP 3-way handshake but resets the connection before it’s fully established.The following diagram shows the exchange of TCP packets during an Nmap stealth scan:</p>
<img src="../media/file237.png" width="578" height="224"/>
<p>As shown in the preceding diagram:</p>
<ol>
<li>The attacker machine tricks the target by sending a <strong>TCP SYN</strong> packet to a specific port on the targeted system to determine if the port is open.</li>
<li>Then, the target system will respond with a <strong>TCP SYN/ACK</strong> packet if the port is open.</li>
<li>Lastly, the attacker will send a <strong>TCP RST</strong> packet to the target to reset and terminate the connection.</li>
</ol>
<p>To get started with learning stealth scanning techniques, please use the following instuctions:</p>
<ol>
<li>Power-on the <strong>Kali Linux</strong> and <strong>Metasploitable 2</strong> virtual machines.</li>
<li>On <strong>Kali Linux</strong>, open the <strong>Terminal</strong> and use the following commands to perform a stealth scan on the Metasploitable 2 to identify whether port 80 is open:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ sudo nmap -sS -p 80 172.30.1.48</code></pre>
</div>
<p>Using the <code>-sS</code> syntax to indicate a stealth scan, and the <code>-p</code> operator allow us to specify a targeted port.The following screenshot shows the Nmap identified port 80 as opened on the targeted system:</p>
<img src="../media/file238.png" width="986" height="348"/>
<p>The following screenshot shows the exchange of packets between the Kali Linux (<code>172.30.1.50</code>) and the targeted system (<code>172.30.1.48</code>) during the stealth scan:</p>
<img src="../media/file239.png" width="1376" height="140"/>
<p>As shown in the preceding snippet, Nmap sent a <strong>TCP SYN</strong> packet with a destination port 80 to identify whether there are any running services on port 80 of the targeted system. The target responded with a <strong>TCP SYN/ACK</strong> packet as expected, however, the attacker machine sent a <strong>TCP RST</strong> packet to reset and terminate the connection. Therefore, no network connections were made between the attacker machine (Kali Linux) and the targeted system during the stealth scan.However, keep in mind that seasoned cybersecurity professionals who are actively monitoring their network traffic for any security incidents can easily identify whether a threat actor is performing a stealth scan on their network.Having completed this section, you have learnt how to perform various types of scanning techniques to identify live hosts on a network, profile their running services and operating systems. In the next section, you will learn how to enumerate common services and network shares from vulnerable systems.</p>
</section>
</section>
</section>
<section id="enumerating-network-services" class="level2" data-number="7.6">
<h2 data-number="7.6">Enumerating network services</h2>
<p>While scanning, you will notice there are common network services running on the targeted systems. Collecting more information on these network services can help you further identify shared network resources such shared directories, printers, and file shares on system. Sometimes, these network services are misconfigured and enables a threat actor to gain unauthorized access to sensitive data stored on servers and other systems within an organization.Over the next few sub-section, you will learn how to enumerate common network services such as <strong>Server Message Block</strong> (<strong>SMB</strong>), <strong>Simple Mail Transfer Protocol</strong> (<strong>SMTP</strong>) and <strong>Simple Network Management Protocol</strong> (<strong>SNMP</strong>).</p>
<section id="enumerating-smb-services" class="level3" data-number="7.6.1">
<h3 data-number="7.6.1">Enumerating SMB services</h3>
<p><strong>Server Message Block</strong> (<strong>SMB</strong>) is a common network service that allows hosts to share resources such as files to other devices on a network. As an aspiring ethical hacker and penetration tester, it's always recommended to enumerate file shares once it's within your scope for the penetration test.To get started enumerating SMB services on a targeted system, please use the following instructions:</p>
<ol>
<li>Power-on both the <strong>Kali Linux</strong> and <strong>Metasploitable 2</strong> virtual machines.</li>
<li>On <strong>Kali Linux</strong>, open the <strong>Terminal</strong> and use the following command to launch the Metasploit Framework:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ msfconsole</code></pre>
</div>
<ol>
<li>After the Metasploit framework loads, use the <code>search</code> command along with the <code>smb_version</code> search term to quickly locate modules:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>msf6 &gt; search smb_version</code></pre>
</div>
<p>As shown in the following screenshot, the search result shows only one module available which can be used to identify whether SMB is running on the targeted system and its version:</p>
<img src="../media/file240.png" width="1445" height="311"/>
<ol>
<li>Next, use the following commands to load the module and display its options:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>msf6 &gt; use auxiliary/scanner/smb/smb_version
msf6 auxiliary(scanner/smb/smb_version) &gt; options</code></pre>
</div>
<p>Using the <code>options</code> or <code>show options</code> command displays the current settings within the loaded module and helps you determine whether there are additional configurations needed before executing the module, as shown below:</p>
<img src="../media/file241.png" width="1391" height="367"/>
<p>As shown in the preceding screenshot, there are two required settings. One is <code>RHOSTS</code> or the target settings, while the other is the number of threads to apply to the process. Notice that the <code>RHOSTS</code> setting is blank.</p>
<ol>
<li>Next, use the following commands to set the targeted system (Metasploitable 2) as the <code>RHOSTS</code> and execute the module:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>msf6 auxiliary(scanner/smb/smb_version) &gt; set RHOSTS 172.30.1.49
msf6 auxiliary(scanner/smb/smb_version) &gt; run</code></pre>
</div>
<blockquote>
<p>The <code>run</code> command is commonly used to execute auxiliary modules within the Metasploit framework, while the <code>exploit</code> command is used to execute exploit modules.</p>
</blockquote>
<p>The following screenshot shows Metasploit was able to detect SMB is running and it’s version from the targeted system:</p>
<img src="../media/file242.png" width="1476" height="265"/>
<blockquote>
<p>Use the <code>exit</code> command to quit Metasploit framework and return to the BASH shell on the Terminal.</p>
</blockquote>
<p>Using more than one tool to enumerate running services on your target is always recommended because there's the possibility one tool may not identify something important. Sometimes, penetration testers may prefer to work with Metasploit as it contains a lot of <em>auxiliary</em> modules to scan and enumerate services, while others prefer Nmap. However, I recommend that you become familiar with both tools as they are excellent and will be very handy in various situations.Since SMB has been discovered on the targeted system, we can use <strong>SMBmap</strong> to enumerate the files and shared drives within the target. To get started using SMBMap, please use the following instructions:</p>
<ol>
<li>Ensure <strong>Kali Linux</strong> and <strong>Metasploitable 2</strong> virtual machines are power-on.</li>
<li>On <strong>Kali Linux</strong>, use the following commands on the <strong>Terminal</strong> to identify whether the targeted system (Metasploitable 2) is running the SMB service:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ nmap -p 139,445 172.30.1.49</code></pre>
</div>
<ol>
<li>The following screenshot shows Nmap was able to identify ports 139 and 445 is open on the targeted system:</li>
</ol>
<img src="../media/file243.png" width="1004" height="365"/>
<ol>
<li>Next, use SMBmap to identify whether the targeted system has any network shares:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ smbmap -H 172.30.1.49</code></pre>
</div>
<p>As shown in the following screenshot, the targeted system (Metasploitable 2) has a few shared drive, most are not accessible over the network except for the <strong>tmp</strong> resource:</p>
<img src="../media/file244.png" width="1429" height="281"/>
<p>As shown in the preceding screenshot, the SMBmap tool was able to provide the permissions and comments for each network share on a targeted system. This information is useful in helping ethical hackers and penetration testers to identify sensitive directories and collect data found within unsecure network shares.</p>
<ol>
<li>Next, use the following commands to display the contents of the <strong>tmp</strong> directory on the targeted system:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ smbmap -H 172.30.1.49 -r tmp</code></pre>
</div>
<p>As shown in the following screenshot, SMBmap was able to access the <strong>tmp</strong> directory because there were no authentication mechanism that’s configured to restrict unauthenticated access:</p>
<img src="../media/file245.png" width="1088" height="346"/>
<ol>
<li>Next, to download all the contents of the <strong>tmp</strong> directory onto your Kali Linux machine, use the following commands to create a new directory (folder) within Kali Linux and download the files:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ mkdir smb_files 
kali@kali:~$ cd smb_files 
kali@kali:~/smb_files$ smbmap -H 172.30.1.49 --download .\tmp\*</code></pre>
</div>
<p>The following screenshot shows the execution of the preceding commands:</p>
<img src="../media/file246.png" width="835" height="183"/>
<p>Having completed this section, you have learned how to perform SMB enumeration using both Metasploit and SMBMap. In the next section, you will learn how to perform SMTP enumeration.</p>
</section>
<section id="enumerating-smtp-services" class="level3" data-number="7.6.2">
<h3 data-number="7.6.2">Enumerating SMTP services</h3>
<p>Enumerating SMTP services enables ethical hackers and penetration testers to collect information about the email services and identify any valid user accounts on the targeted system. To get started with this exercise, please use the following instructions:</p>
<ol>
<li>Power-on both <strong>Kali Linux</strong> and <strong>Metasploitable 2</strong> virtual machines.</li>
<li>On <strong>Kali Linux</strong>, open the <strong>Terminal</strong> and use <strong>Netcat</strong> to check whether port 25 is open on the targeted system (Metasploitable 2) and identify the running service:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ nc -nv 172.30.1.49 25</code></pre>
</div>
<ol>
<li>Next, use the <code>VRFY root</code> command to determine whether <code>root</code> is a valid user.</li>
<li>Next use the <code>VRFY toor</code> to check whether the user <code>toor</code> is a valid user, as shown below:</li>
</ol>
<img src="../media/file247.png" width="679" height="221"/>
<p>As shown in the preceding screenshot, Netcat was able to successfully establish a connection to the targeted system on port 25 which further identified SMTP is running. When the <code>VRFY root</code> command was executed, the email service responses indicate the user exist. However, the email service provided an error message when a non-valid user is checked.</p>
<ol>
<li>Manually checking each possible username on a targeted system can be very time-consuming. To help automate the process of SMTP enumeration, we can create a simply BASH script which intakes a pre-defined list of possible usernames and query it on the target system. Use the following commands to create a new script using Nano:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ nano smtp_user_enum.sh</code></pre>
</div>
<p>Once the Nano command-line text editor opens, enter the following code exactly as is:</p>
<div class="C1-CodePACKT">
<pre><code>#!/bin/bash
if [ $# -ne 2 ]; then
    echo "Usage: $0 &lt;target_ip&gt; &lt;email_list&gt;"
    exit 1
fi
target_ip="$1"
email_list="$2"
echo "Starting SMTP user enumeration..."
while IFS= read -r email; do
    # Construct the SMTP communication
    ( sleep 1; echo "HELO example.com"; sleep 1; echo "VRFY $email"; sleep 1; echo "QUIT" ) | nc -nv $target_ip 25 | grep -q "252 2.0.0"
    if [ $? -eq 0 ]; then
        echo "User found: $email"
    fi
done &lt; "$email_list"
echo "SMTP user enumeration finished."</code></pre>
</div>
<p>Once you’ve finished entering the preceding code, save the script by pressing <code>CTRL + X</code>, then <code>Y</code> and <code>Enter</code> on your keyboard.</p>
<ol>
<li>Next, use the following commands to make the newly saved script executable on Kali Linux:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ chmod +x smtp_user_enum.sh</code></pre>
</div>
<ol>
<li>To use the script, the <code>./smtp_user_enum.sh &lt;target&gt; &lt;wordlist&gt;</code> syntax enables you to start the SMTP enumeration on a targeted system, as with the following commands:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ ./smtp_user_enum.sh 172.30.1.49 /usr/share/wordlists/seclists/SecLists-master/Usernames/top-usernames-shortlist.txt</code></pre>
</div>
<p>The following screenshot shows valid user names were identified while the script is running:</p>
<img src="../media/file248.png" width="966" height="567"/>
<p>Identifying and leveraging valid usernames and accounts helps penetration testers in gaining unauthorized access on targeted systems. Having completed this exercise, you have gained the hands-on skills on SMTP enumeration. Next, you will learn how to enumerate SNMP services on a targeted host.</p>
</section>
<section id="enumerating-snmp-services" class="level3" data-number="7.6.3">
<h3 data-number="7.6.3">Enumerating SNMP services</h3>
<p>SNMP is a common network protocol which enables network professionals to monitor, manage and troubleshoot common networking devices. In addition, IT professionals uses SNMP to retrieve sensitive information from their devices such as the following:</p>
<ul>
<li>System uptime</li>
<li>Device hostname</li>
<li>CPU and memory utilization</li>
<li>Interface status and statistics</li>
<li>Operating system</li>
<li>Open ports and running services</li>
</ul>
<p>SNMP leverages the Management Information Base (MIB) which is a common database that contains specific information about an SNMP managed device. The MIB is like a tree-structure that’s divided into multiple branches and each branch is used to manage a specific area of the device. On each branch of the MIB tree, there are leaves which represent specific values that enables a network professional to access the leaves to retrieve specific information about the device on the network.</p>
<blockquote>
<p>To learn more about SNMP, please see: <a href="https://www.techtarget.com/searchnetworking/definition/SNMP">https://www.techtarget.com/searchnetworking/definition/SNMP</a>.</p>
</blockquote>
<p>To get started with SNMP enumeration, please use the following instructions:</p>
<ol>
<li>Power-on the <strong>Kali Linux</strong> and <strong>Metasploitable 3</strong> (Windows version) virtual machines.</li>
<li>On <strong>Kali Linux</strong>, open the <strong>Terminal</strong> and use the followings to determine whether SNMP is running the targeted system (Metasploitable 2):</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ sudo nmap -sU -p 161 172.30.1.48</code></pre>
</div>
<p>The following screenshot shows SNMP is running on the targeted system on UDP port 161:</p>
<img src="../media/file249.png" width="1002" height="361"/>
<ol>
<li>Next, perform SNMP enumeration using the <strong>SNMP-Check</strong> tool, use the following commands:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ snmp-check -p 161 -c public -v 1 172.30.1.48</code></pre>
</div>
<p>The following is a description for each syntax used in the preceding commands:</p>
<ul>
<li><code>-p</code>: Allows you to specify the targeted port, by default its set to port 161.</li>
<li><code>-c</code>: Allows you to specify the community string to login to the targeted system, the default community string is <code>public</code>.</li>
<li><code>-v</code>: Allows you to specify the SNMP version to use, by default its set to version 1.</li>
</ul>
<p>As shown in the following screenshot, we are able to identify a lot of sensitive information which can be used to improve future cyber-attacks on the target:</p>
<img src="../media/file250.png" width="1188" height="839"/>
<p>The SNMP-Check tool was able to enumerate the following information from the target:</p>
<ul>
<li>System information</li>
<li>User accounts</li>
<li>Network information</li>
<li>Routing information</li>
<li>Network services</li>
<li>Running processes</li>
<li>Software components</li>
</ul>
<blockquote>
<p>To learn more about SNMP-Check, use the <code>snmp-check -h</code> command to display its menu and additional options.</p>
</blockquote>
<p>As you have learnt, enumerating systems helps ethical hackers and penetration testers to improve their profile on targeted system and determine what’s running on them. Such information helps penetration testers to identify vulnerabilities which can be exploited to compromise the target.In the next section, you will learn how to discover data leaks in cloud storage.</p>
</section>
</section>
<section id="discovering-data-leaks-in-the-cloud" class="level2" data-number="7.7">
<h2 data-number="7.7">Discovering data leaks in the cloud</h2>
<p>Over the past decade, cloud computing has become one of the fastest-growing trends in the IT industry. Cloud computing allows companies to migrate and utilize computing resources within a cloud provider's data center. Cloud computing providers have a pay-as-you-go model, which means that you only pay for the resources you use. Some cloud providers allow pay-per-minute models, while others use a pay-per-hour structure.The following are popular cloud computing service providers:</p>
<ul>
<li>Amazon Web Services (AWS)</li>
<li>Microsoft Azure</li>
<li>Google Cloud Platform</li>
</ul>
<p>Many cloud service providers offer their customers a storage service. The AWS storage facility is known as <strong>Simple Storage Service</strong> (<strong>S3</strong>). Whenever a customer enables the S3 service, a bucket is created. A bucket is a storage unit within the AWS platform where the customer can add or remove files. In Microsoft Azure, the file storage facility is known as Azure Files. Additionally, on Google Cloud, the storage facility is known as Google Cloud Storage.In the field of cybersecurity, we need to remember when a company is using a cloud platform, the data on the cloud platform must be secured, just like it should be when stored on-premises (that is, when stored locally). Sometimes, administrators forget to enable security configurations or lack knowledge regarding the security of a cloud solution. This could lead to, say, an attacker discovering a target organization's AWS S3 buckets and downloading their content.For this exercise, we are going to use some free online learning resources from http://flaws.cloud. This is a learning environment that's been created by an AWS security professional who is helping the community learn about security vulnerabilities that can exist within AWS S3 misconfigurations.To get started with identifying data leakage with AWS S3 Buckets, please use the following instructions:</p>
<ol>
<li>Power-on the <strong>Kali Linux</strong> virtual machine, open the <strong>Terminal</strong> and use the following commands to install the <strong>S3Scanner</strong> tool:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ sudo apt update
kali@kali:~$ sudo pip3 install s3scanner</code></pre>
</div>
<ol>
<li>Next, install the AWS command-line package using the following commands:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ sudo apt install awscli</code></pre>
</div>
<ol>
<li>Next, configure the AWS command-line features on Kali Linux by using the following commands:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ aws configure</code></pre>
</div>
<p>Simply hit Enter to use the default options as shown in the following screenshot:</p>
<img src="../media/file251.png" width="493" height="197"/>
<ol>
<li>Next, to view all the supported features and options of the S3Scanner tool, use the <code>s3scanner –h</code> command as shown in the following screenshot:</li>
</ol>
<img src="../media/file252.png" width="1791" height="727"/>
<ol>
<li>Next, let’s use the <strong>NSlookup</strong> within Kali Linux to retrieve the IP address of the targeted server:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ nslookup flaws.cloud</code></pre>
</div>
<ol>
<li>The following screenshot shows NSlookup was able to retrieve multiple public IP addresses for the hosting server:</li>
</ol>
<img src="../media/file253.png" width="564" height="379"/>
<ol>
<li>Next, let’s use NSlookup again to retrieve the hostname of the AWS S3 Bucket server:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ nslookup 52.92.148.75</code></pre>
</div>
<p>The following screenshot the hostname of the server, including the name of the AWS S3 Bucket:</p>
<img src="../media/file254.png" width="1152" height="136"/>
<p>An AWS S3 bucket's URL format is usually in the form of <code>https://&lt;bucketname&gt; &lt;region&gt;.amazonaws.com</code>. Therefore, by using the information from the URL, the following can be determined:</p>
<ul>
<li>S3 Bucket name: s3-website</li>
<li>Hosting region: us-west-2</li>
</ul>
<p>AWS S3 buckets are not only used to store data such as files. They are also used to host websites. Therefore, we can use <code>flaws.cloud</code> as a prefix to the AWS S3 bucket URL to get the following URL:<a href="http://flaws.cloud.s3-website-us-west-2.amazonaws.com">http://flaws.cloud.s3-website-us-west-2.amazonaws.com</a> The following screenshots the contents of the preceding URL:</p>
<img src="../media/file255.png" width="1076" height="310"/>
<ol>
<li>Next, let's use S3Scanner to verify that a bucket exists and the available permissions:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ s3scanner scan --bucket http://flaws.cloud</code></pre>
</div>
<p>As shown in the following screenshot, an AWS S3 Bucket exist:</p>
<img src="../media/file256.png" width="933" height="149"/>
<ol>
<li>Next, let’s attempt to view the contents of the AWS S3 bucket, use the following commands:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ aws s3 ls s3://flaws.cloud --region us-west-2 --no-sign-request</code></pre>
</div>
<p>As shown in the following screenshot, there are some files within the S3 bucket;</p>
<img src="../media/file257.png" width="1180" height="308"/>
<ol>
<li>Next, let's attempt to download the files onto our Kali Linux machine. Use the following commands to create a folder and download the files into the newly created folder:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ mkdir s3_bucket_files
kali@kali:~$ cd s3_bucket_files 
kali@kali:~/s3_bucket_files$ aws s3 cp s3://flaws.cloud/secret-dd02c7c.html --region us-west-2 --no-sign-request secret-dd02c7c.html</code></pre>
</div>
<p>The <code>cp</code> syntax specifies the file to download, <code>--region</code> allows us to specify the location of the AWS S3 Bucket and <code>--no-sign-request</code> specifies to do not use any user credentials.</p>
<ol>
<li>Lastly, you can use the <code>cat</code> or <code>open</code> command to view the contents of the downloaded file, as shown below:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~/s3_bucket_files$ cat secret-dd02c7c.html
kali@kali:~/s3_bucket_files$ open secret-dd02c7c.html</code></pre>
</div>
<p>You can continue this exercise on <a href="http://flaws.cloud/">http://flaws.cloud/</a> to learn more about various security vulnerabilities and discover the impact of misconfigurations on cloud services such as AWS S3 buckets. However, do not perform such actions on systems, networks, and organizations that you do not have legal permission to do so.As you have seen, data leaks can happen on any platform and to any organization. As an aspiring ethical hacker and penetration tester, you must know how to find them before a real adversary do and exploits them. Companies can store sensitive data on cloud platforms, or even leave data completely unprotected on a cloud service provider network. This can lead to data and accounts being retrieved. In this section, you learned how to perform enumeration of AWS S3 buckets using various tools and techniques.</p>
</section>
<section id="summary-5" class="level2" data-number="7.8">
<h2 data-number="7.8">Summary</h2>
<p>During this chapter, you have gained the hands-on skills as an aspiring ethical hacker and penetration tester to perform active scanning techniques to identify open ports, running services and operating system on targeted systems. In addition, you have learnt how to use common evasion techniques during scanning to reduce your threat level. Furthermore, you have discovered how to enumerate common network services and leverage the information on improve a cyber-attack.I trust that the knowledge presented in this chapter has provided you with valuable insights, supporting your path towards becoming an ethical hacker and penetration tester in the dynamic field of cybersecurity. May this newfound understanding empower you in your journey, allowing you to navigate the industry with confidence and make a significant impact. In the next chapter, <em>Performing Vulnerability Assessments</em>, you will learn how to setup and work with popular vulnerability management tools.</p>
</section>
<section id="further-reading-5" class="level2" data-number="7.9">
<h2 data-number="7.9">Further Reading</h2>
<ul>
<li>Nmap reference guide - <a href="https://nmap.org/book/man.html">https://nmap.org/book/man.html</a></li>
<li>Information gathering using Metasploit - <a href="https://www.offensive-security.com/metasploit-unleashed/information-gathering/">https://www.offensive-security.com/metasploit-unleashed/information-gathering/</a></li>
</ul>
</section>
</section>
</div>
</div>
</body>
</html>