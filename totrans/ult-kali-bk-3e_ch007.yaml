- en: 6 Active Reconnaissance
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Join our book community on Discord
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[https://packt.link/SecNet](https://packt.link/SecNet)![Qr code Description
    automatically generated](../media/file211.png)The more information collected about
    a target helps ethical hackers and penetration testers to improve exploit development
    during the weaponization phase of the Cyber Kill Chain and identify the best method
    to deliver the malicious payload to the target. Active reconnaissance helps you
    to collect information that’s not public available, such as which services are
    running and how many ports exists on a targeted system. For instance, if you’re
    targeting a web server, it’s important to identify the web application and its
    version. In addition, it would be useful to also identify the operating system
    that’s hosting the web application.During this chapter, you will understand the
    need for active reconnaissance techniques during ethical hacking and penetration
    testing assessments on a target system, network and organization. You will explore
    active scanning techniques which are commonly used to identify live systems, their
    open port and running services. Furthermore, you will explore various techniques
    used by seasoned penetration testers to profile systems and identify their attack
    surface, which can help improve their plan of attack. Lastly, you will learn how
    to perform enumeration on common network services and identify whether an organization
    is leaking data on their cloud platform.In this chapter, we will cover the following
    topics:'
  prefs: []
  type: TYPE_NORMAL
- en: Understanding active information
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Profiling websites using EyeWitness
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Exploring active scanning techniques
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Enumerating common network services
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Discovering data leaks in the cloud
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Let’s dive in!
  prefs: []
  type: TYPE_NORMAL
- en: Technical Requirements
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'To follow along with the exercises in this chapter, please ensure that you
    have met the following hardware and software requirements:'
  prefs: []
  type: TYPE_NORMAL
- en: Kali Linux - [https://www.kali.org/get-kali/](https://www.kali.org/get-kali/)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: EyeWitness - [https://github.com/RedSiege/EyeWitness](https://github.com/RedSiege/EyeWitness)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: S3Scanner - [https://github.com/sa7mon/S3Scanner](https://github.com/sa7mon/S3Scanner)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Understanding active information
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Using active reconnaissance techniques enables ethical hackers and penetration
    tester to use a more direct approach when engaging the target. For instance, many
    active reconnaissance techniques involves establishing a logical network connection
    between your attacker machine, such as Kali Linux and the targeted system(s) over
    the network. With active reconnaissance, you can send specially crafted probes
    to collect specific details such as the following:'
  prefs: []
  type: TYPE_NORMAL
- en: Determine how live hosts are on the network.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Determine whether the targeted system is online.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Identify open port numbers and running services.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Profile the operating system on the targeted machine.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Identify whether the targeted system has any network shares.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Therefore, before launching any type of network-based attack, it's important
    to determine whether there are live systems on the network and the target is online.
    Imagine launching an attack towards a specific system, only to realize the target
    is offline and the attack has failed. Hence, it doesn't make sense to target an
    offline device as it would be unresponsive and increase the risk of detection
    by the organization’s security team.
  prefs: []
  type: TYPE_NORMAL
- en: Unlike passive reconnaissance which leverages **Open Source Intelligence** (**OSINT**)
    from public data sources, using active reconnaissance techniques does increase
    the risk of being detected by the target’s security systems and triggering alerts.
    Therefore, it’s important to consider the threat level for each type of attack
    during your planning phase.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: As compared to adversaries, ethical hackers and penetration testers uses similar
    techniques to simulate a real-world cyber-attack to identify how a real attacker
    would collect and leverage information to identify security vulnerabilities and
    compromise their targets.In the next section, you will learn how to automate the
    process of taking screenshots of targeted domains and systems on a network.
  prefs: []
  type: TYPE_NORMAL
- en: Profiling websites using EyeWitness
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'What do you do after discovering additional sub-domains of a targeted organization
    on the internet? A common and obvious practice would be to visit each sub-domain
    to determine whether it leads to a vulnerable web application or system which
    can be exploited to gain a foothold into the targeted organization’s network.
    However, manually visiting each sub-domain can be quite time consuming if you
    need to visit 100+ sub-domains for a targeted organization. As an aspiring ethical
    hacker and penetration tester, using a tool such as **EyeWitness** enables you
    to automate the process of checking and capturing a screenshot of each sub-domain.
    To get started using EyeWitness, please use the following instructions:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Power-on the **Kali Linux** virtual machine, open the **Terminal** and use
    the following commands to clone the EyeWitness repository:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: 'Next, execute the `setup.py` script to install EyeWitness by using the following
    commands:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: 'Next, use the `cd ..` command to move up one directory , as shown below:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: 'Next, use the following commands to create a new text file within the `/home/kali/`
    directory, then write a targeted sub-domain into it:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: The `touch <filename>` command enables you to create a new file within Linux.
    The `echo` command allows you to write contents within a file.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Next, use the following command to enable EyeWitness to capture screenshots
    of each sub-domain found within the `eyewitness_targets.txt` file:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: 'The following is a breakdown of each syntax used in the preceding command:'
  prefs: []
  type: TYPE_NORMAL
- en: '`--web`: Specifies to take HTTP screenshots.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`-f`: Specifies the source file with the list of targeted domains and sub-domains.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`-d`: Specifies the output directory to save the results and report.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`--prepend-https`: Specifies to prepend `http://` and `https://` to the list
    of domains and sub-domains.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The following screenshot shows the process of capturing the screenshot(s):'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file212.png)'
  prefs: []
  type: TYPE_IMG
- en: 'If you type `Y` and hit Enter, the EyeWitness report will automatically load
    and open within the web browser, as shown below:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file213.png)'
  prefs: []
  type: TYPE_IMG
- en: As you have seen, using a tool such as EyeWitness can save you a lot of time
    as compared to checking each sub-domain manually. You can quickly browse each
    image within the generated report to identify any login portals and sensitive
    directories on a targeted domain.
  prefs: []
  type: TYPE_NORMAL
- en: 'To learn more about EyeWitness, please see: [https://github.com/RedSiege/EyeWitness](https://github.com/RedSiege/EyeWitness)
    and use the `./EyeWitness.py –h` command to view the help menu.'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Having completed this section, you have learned how to automate the process
    of capturing screenshots of many websites using EyeWitness. In the next section,
    you will explore various scanning and fingerprinting techniques.
  prefs: []
  type: TYPE_NORMAL
- en: Exploring active scanning techniques
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'As an aspiring ethical hacker and penetration tester, it’s essential to develop
    a solid foundation on understanding how to leverage scanning techniques to efficiently
    discover and profile targeted systems on an organization’s network. Many organizations
    focus on securing their perimeter network and sometimes do not apply equal focus
    on securing their internal network. Quite often, you will discover that over 90%
    of a cyberattack or threat usually originates from the inside network. Due to
    this, many organizations think the attacker will launch their attack from the
    internet, which will then be blocked by their network-based firewall.The following
    diagram shows a simplified overview of a typical deployment of a firewall:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file214.png)'
  prefs: []
  type: TYPE_IMG
- en: As shown in the preceding diagram, the network-based firewall is implemented
    as the edge device between the organization’s internal network and the internet.
    One of its role is to filter traffic between networks and prevent malicious traffic
    from passing through to the other side, whether it’s malicious traffic originating
    from the internet with a destination to the internal systems on the organization’s
    network and vice versa. However, threat actors are continuously learning how organizations
    implement their infrastructure and security solutions, as well as the decisions
    that both the leadership team and IT professionals make when securing their assets.While
    many organizations are investing into their cyber defenses to ensure their assets
    and people are protected from adversaries and cyber-attacks, there are still so
    many organizations around the world without firewalls, misconfigured network devices
    and security appliances, and unpatched operating systems. Metaphorically speaking,
    it’s only a matter of time for an adversary to discover this gold mine and starts
    *living of the land*. During the reconnaissance phase of the Cyber Kill Chain
    and common penetration testing methodology, ethical hackers and penetration testers
    will eventually need to directly engage with the target to collect information
    that’s not available from **Open Source Intelligence** (**OSINT**) and use active
    reconnaissance techniques such as scanning and enumeration.Scanning is a technique
    that's used by threat actors to discover live systems on a network, identify the
    open service ports on a system, and discover vulnerabilities on host machines
    and even their operating system architecture. The information that's gathered
    from scanning helps the penetration tester gain a clearer view of their targets
    compared to passive information gathering.
  prefs: []
  type: TYPE_NORMAL
- en: Do not perform any type of scanning on systems and networks that you do not
    own or have legal permission to do so. Scanning is considered illegal in many
    countries.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Penetration testers always need to improve their critical thinking mindset to
    think like a real threat actor, especially if they want to perform a successful
    penetration test on a targeted organization. In this section, you will learn about
    various techniques and methodologies for performing scanning on a targeted network
    and how to profile systems.
  prefs: []
  type: TYPE_NORMAL
- en: Changing your MAC address
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'The **Network Interface Card** (**NIC**) is a network adapter which enables
    a system to communicate over a wired or wireless network. For instance, before
    your devices sends data on a network, the NIC converts the message into a signal
    that’s supported over the media for transmission, such as electrical signals for
    copper cables, light signals for fiber optics and radio frequency for wireless
    communication. In addition, the NIC on each device contains a globally unique
    **Media Access Control** (**MAC**) address, sometimes referred to as a *burned-in
    address* that’s theoretically not changeable. Before a device transmits data over
    a network, the sender device automatically inserts the source and destination
    MAC address onto the frame header of the message. The source MAC address helps
    the recipient identify the sender of the message, and the destination MAC address
    helps the network switches forward the message to the intended destination. The
    MAC address is a 48-bit address written in hexadecimal. The first 24-bits of the
    address is known as the **Organizational Unique Identifier** (**OUI**) which helps
    IT professionals to determine the vendor of a device. While the last 24-bits is
    uniquely assigned by the vendor. Therefore, when your NIC sends traffic out on
    a network, your real MAC address is also inserted within the frame header, and
    this information can be used to identify your machine on a network. As an aspiring
    penetration tester, you can change the MAC address on both your Ethernet and wireless
    network adapters by using a pre-installed tool known as **MAC Changer**.Changing
    your MAC address allows you to trick other devices on the network into thinking
    your system is a common device that belong within the organization’s network infrastructure,
    such as a network device, a printer, or a vendor-specific device. This technique
    is commonly used to protect the identity of your attacker machine, bypass MAC
    filtering rules on network devices and evade network restrictions while on your
    target’s network.To learn how to change your MAC address using **MAC Changer**,
    please use the following instructions:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Power-on the **Kali Linux** virtual machine and use the `ifconfig` command
    to determine the original MAC address on your network adapters, as shown below:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](../media/file215.png)'
  prefs: []
  type: TYPE_IMG
- en: As shown in the preceding screenshot, the `ifconfig` command was used to display
    all connected network adapters on the Kali Linux virtual machine. In addition,
    this command enables us to view the original MAC address on each network adapter,
    within the **ether** field.
  prefs: []
  type: TYPE_NORMAL
- en: 'Next, logically turn down the **eth0** interface with the following commands:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: 'Next, use the `macchanger --help` command to view a list of available options,
    as shown below:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](../media/file216.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Next, set a randomized MAC address on the **eth0** network adapter by using
    the following commands:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: 'The following screenshot shows the current, permanent and the newly generated
    MAC address for the **eth0** network adapter:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file217.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Next, re-enable the **eth0** interface by using the following commands:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: 'Next, use the `ifconfig` command once more to verify the **eth0** has a spoofed
    MAC address, as shown below:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](../media/file218.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Lastly, to further verify the vendor of the spoofed MAC address, go to [https://macvendors.com/](https://macvendors.com/)
    and enter the MAC address, as shown below:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](../media/file219.png)'
  prefs: []
  type: TYPE_IMG
- en: Having completed this exercise, you have learnt how spoof your MAC address on
    Kali Linux. However, it’s important to consider using a MAC address that’s associated
    to a common vendor of networking devices or system to reduce the risk of detection
    by the organization’s security team. Next, you will learn how perform host discovery
    to identify live systems on an internal network.
  prefs: []
  type: TYPE_NORMAL
- en: Performing host discovery
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Discovering live hosts on a targeted network is an essential stage when performing
    a penetration test. Let''s imagine you''re an ethical hacker or a penetration
    tester; your targeted organization permits you to directly connect your attacker
    machine with Kali Linux on their network to perform security testing on their
    internal network. You''re eager to start discovering security vulnerabilities
    and hacking systems, but you''re not sure whether the targeted hosts are online.In
    this section, you will learn about the skills you will need to perform various
    types of active reconnaissance on an organization''s networks using various tools
    and techniques. However, to ensure you can perform these exercises in a safe space,
    please use the following guidelines:'
  prefs: []
  type: TYPE_NORMAL
- en: Ensure you do not scan systems that you do not own or have been granted legal
    permission.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Ensure the network adapter of Kali Linux is assigned to the **PentestNet** network
    within Oracle VM VirtualBox Manager.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The PentestNet network will be our simulated organization network.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'To get started with this exercise, please use the following instructions:'
  prefs: []
  type: TYPE_NORMAL
- en: Power-on the **Kali Linux**, **Metasploitable 2** and **Metasploitable 3** (**Windows
    version**) virtual machines.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'On **Kali Linux**, open the **Terminal** the use the `ifconfig` or `ip address`
    command to determine if your attacker machine (Kali Linux) is connected to the
    targeted network (`172.30.1.0/24`), as shown below:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](../media/file220.png)'
  prefs: []
  type: TYPE_IMG
- en: As an aspiring ethical hacker and penetration tester, it’s important to verify
    whether your attacker machine has a valid IP address and subnet mask on the targeted
    network during the internal network penetration test. As shown in the preceding
    screenshot, `eth1` is connected to the *PentestNet* environment which is our targeted
    network.
  prefs: []
  type: TYPE_NORMAL
- en: Keep in mind, wired network adapters are identified with **eth** and wireless
    adapters are identified with **wlan**.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Additionally, the **inet** field contains the IP address that’s assigned on
    the interface of the Kali Linux virtual machine. However, the IP address shown
    in the preceding screenshot may be different from the address shown on your machine,
    that's okay once it's on the `172.30.1.0/24` network. Furthermore, identifying
    the IP address on the network adapter will enable us to exclude scanning our own
    machine in the next steps.
  prefs: []
  type: TYPE_NORMAL
- en: 'Ethical hackers and penetration testers often needs to determine the Network
    ID and range of IP addresses within a network before performing host discovery
    on an internal network. While its recommended to build a solid foundation on networking
    prior to learning cybersecurity and penetration testing, the following website
    is an online subnet calculator that will help you determine the IP ranges and
    much more: [https://www.calculator.net/ip-subnet-calculator.html](https://www.calculator.net/ip-subnet-calculator.html).'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Next, let’s use **Netdiscover** to passively scan for live systems on the *PentestNet*
    environment (`172.30.1.0/24`), using the following commands:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: 'The `-i` syntax is commonly used to specify the listening interface and using
    the `-p` syntax performs a passive scan by enabling Netdiscover the capture and
    analyze **Address Resolution Protocol** (**ARP**) messages on a network, by analyzing
    the source and destination IP and MAC addresses helps us to identify live hosts
    on a network, as shown below:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file221.png)'
  prefs: []
  type: TYPE_IMG
- en: As shown in the preceding screenshot, Netdiscover provided the IP addresses,
    MAC addresses, vendors, and hostnames of the live systems on the targeted network.
    Where, `172.30.1.48` is assigned to Metasploitable 3 – Windows and `172.30.1.49`
    is assigned to the Metasploitable 2 virtual machines. Furthermore, leveraging
    the MAC vendor information helps us determine the type of devices are on the network
    and can be useful when researching security vulnerabilities for a specific system
  prefs: []
  type: TYPE_NORMAL
- en: 'Next, to perform an active host discovery scan using Netdiscover, use the following
    commands:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: 'Since the active scan does not wait for ARP message, Netdiscover sends its
    own probes to all usable IP addresses within the `172.30.1.0/24` network. Only
    live systems will respond, enabling Netdiscover to analyze each response messages
    to identify the IP and MAC addresses of live hosts on the network, as shown below:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file222.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Next, let’s use **Network Mapper** (**Nmap**) to perform a *ping sweep* over
    the entire targeted network and exclude our attacker machine during the scanning
    process, use the following commands:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: 'A **ping sweep** is a basic scanning technique that’s used by IT professionals
    to determine which systems are online within a network. It’s the automated process
    of pinging each usable IP address within a network and observing which devices
    are responding. However, the `ping` utility within an operating system sends **Internet
    Control Message Protocol** (**ICMP**) **ECHO Request** message to the destination
    and a live system will respond with an **ICMP ECHO Reply** message. It’s a common
    security practice for cybersecurity professionals to disable ICMP responses on
    critical systems within their organization, this reduces the likelihood that a
    novice hacker is to discover a live host. Therefore, if an attacker sends **ICMP
    ECHO Request** messages to a system that’s configured to not respond, the novice
    attacker will think the target is offline. On the other hand, seasoned threat
    actors and penetration testers who understands the security vulnerabilities that
    exists within the **Transmission Control Protocol/Internet Protocol** (**TCP/IP**)
    networking model can bypass this minor security mechanism and instead send **Transmission
    Control Protocol** (**TCP**) messages to specific ports on the targeted system.
    This technique leverages the design of TCP and tricks the targeted system to respond,
    indicating it’s live on the network.The following screenshot shows there are 2
    live hosts, `172.30.1.48` and `172.30.1.49` on the network:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file223.png)'
  prefs: []
  type: TYPE_IMG
- en: 'The `-sn` syntax on Nmap is used to specify a ping scan but Nmap does not send
    ICMP messages to the target. Instead, Nmap sends TCP messages to specific ports
    on the targeted system as shown in the Wireshark packet capture below:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file224.png)'
  prefs: []
  type: TYPE_IMG
- en: Nmap sends specially crafted TCP **Synchronization** (**SYN**) packets to the
    targeted host, with the intention of triggering a TCP **Reset** (**RST**) or TCP
    **Acknowledgement** (**ACK**) as a response from a live/online host.
  prefs: []
  type: TYPE_NORMAL
- en: 'To learn more on how TCP establishes a connection with a destination host using
    the TCP 3-way handshake, please see: [https://hub.packtpub.com/understanding-network-port-numbers-tcp-udp-and-icmp-on-an-operating-system/](https://hub.packtpub.com/understanding-network-port-numbers-tcp-udp-and-icmp-on-an-operating-system/).'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Identifying live hosts on a network helps ethical hackers and penetration testers
    to create a network topology and identify whether their targets are online before
    proceeding to profile the targets. Next, you will learn how identify open ports,
    running services and determine the operating system of a target.
  prefs: []
  type: TYPE_NORMAL
- en: Identifying open ports, services and operating systems
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'After performing host discovery, the next step is to identify any open ports
    on the targeted system and determine which services are mapped to those open ports.
    There are various techniques that a penetration tester can use to identify the
    open ports on a targeted system. Some techniques are manual, while others can
    simply be automated using the Nmap tool.To gets started fingerprinting using Nmap,
    please use the following instructions:'
  prefs: []
  type: TYPE_NORMAL
- en: Firstly, ensure the **Kali Linux**, **Metasploitable 2**, and **Metasloitable
    3** (**Windows version**) virtual machines are powered-on.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'On **Kali Linux**, open the **Terminal** and use the following commands to
    perform a basic Nmap scan to determine whether any of the top 1000 ports are open
    on the Metasploitable 3 (Windows version) virtual machine:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: 'As shown in the following screenshot, Nmap indicates there are 20 TCP open
    ports and provided the name of their associated services:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file225.png)'
  prefs: []
  type: TYPE_IMG
- en: Using the information from this scan enables you to start fingerprinting your
    targeted systems. As a penetration tester, you can determine which ports are open
    and discover how they can be used as a point-of-entry into the target, and look
    for security vulnerabilities on the running services.
  prefs: []
  type: TYPE_NORMAL
- en: As an aspiring ethical hacker and penetration, it’s okay if you don’t initially
    understand the role and function of service ports on a system. However, its recommended
    to perform research on anything you’re not familiar with to gain a better understanding
    of the technology or topic. For instance, there are many service ports and each
    if associated with a specific application-layer service, such as TCP port 443
    is associated to the **Hypertext Transfer Protocol Secure** (**HTTPS**) protocol
    that’s used for secure web communication.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Next, let’s perform an advanced scan to identify the targeted system’s operating
    system, service versions and retrieve **Server Message Block** (**SMB**) details,
    using the following the commands:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE12]'
  prefs: []
  type: TYPE_PRE
- en: 'Let''s take a look at each syntax that were used in the preceding command:'
  prefs: []
  type: TYPE_NORMAL
- en: '`-A`: This enables Nmap to profile the target to identify its operating system,
    service versions, and script scanning, as well as perform a traceroute.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`-T`: This syntax specifies the timing options for the scan, which ranges from
    0 – 5, where 0 is very slow and 5 is the fastest. This command is useful for preventing
    too many probes from being sent to the targeted system too quickly which may trigger
    alerts.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`-p`: Using the `-p` syntax allows you to specify targeted port(s) to identify
    as opened or closed on a system. You can specify `-p80` to scan for port 80 only
    on the target and `-p-` to scan for all 65,535 open ports.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: By default, Nmap scans TCP ports only. Therefore, if a target is running a service
    on a **User Datagram Protocol** (**UDP**) server port, there's a possibility you
    will miss it. To perform a UDP scan on a port or range of ports, use the `-p U:53`
    command, where 53 is the targeted port number.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'The following screenshots the upper-portion of the scan results:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file226.png)'
  prefs: []
  type: TYPE_IMG
- en: 'As shown in the preceding screenshot, Nmap was able to retrieve a lot more
    in-depth information about our target, such as the service versions of each service
    that is associated with an open port. It was also able to perform banner grabbing
    and determine whether there''s an authentication system/login mechanism for each
    service. The following screenshot is the lower-portion of the same scan results:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file227.png)'
  prefs: []
  type: TYPE_IMG
- en: 'As shown in the preceding screenshot, Nmap was able to identify the host operating
    system on the target as a Windows Server 2008 R2 machine with service pack 1\.
    In addition, Nmap was able to determine the hostname of the system and whether
    it’s connected to a domain or not based on the Workgroup name. Whenever a Windows-based
    system is not connected to a **Domain Controller** (**DC**), the default Workgroup
    is called `Workgroup`. Furthermore, the Nmap scan was able to perform a basic
    SMB scan to identify the operation system, this also indication the targeted system
    may have file and printer shares available.The following are additional syntax
    which can be used during the scanning process with Nmap:'
  prefs: []
  type: TYPE_NORMAL
- en: '`-Pn` – This syntax enables Nmap to perform a scan on the targeted system(s)
    without firstly performing host discovery, and simply considers the target to
    be online.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`-sU` – This syntax enables Nmap to perform UDP port scanning on the targeted
    system(s). This command will be useful with identifying whether there are any
    running services on UDP ports as compared to TCP port numbers.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`-p` – This command allows you to specify either a range of targeted ports
    or specific ports are open on a system. Using `nmap -p 50-60`, `nmap -p 80,443`
    or `nmap -p 22` allows you to scan a range, a group or specific ports numbers.
    However, using `nmap -p-` specifies to scan all 65,535 port numbers, keep in mind
    Nmap scans TCP ports by default.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`-sV` – This syntax enables you to perform service version identification of
    running services on a targeted system. For instance, an Nmap basic scan may indicate
    port 23 is open and it’s associated to the **Telnet**, as an ethical hacker is
    important to determine the service version of this running service. Therefore,
    using `nmap -sV <targeted system>` command will identify the service version which
    can be useful when researching security vulnerabilities on a target.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`-6` – Using this syntax enables Nmap to perform scans on a targeted IPv6 network
    or a host with an IPv6 address.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Additionally, ethical hackers and penetration testers can use the **Ping**
    utility to profile the operating system of a target by analyzing the **Time To
    Live** (**TTL**) value found within the ICMP response messages from the target.
    For instance, Windows-based operating systems reply with a default TTL value of
    `128`, while Linux-based systems reply with a default TTL value of `64`.To better
    understand how ICMP helps us identify the operating system of a targeted machine,
    please use the following instuctions:'
  prefs: []
  type: TYPE_NORMAL
- en: 'On **Kali Linux**, use the following commands to send 4 ICMP ECHO Request messages
    to the Metasploitable 3 (Windows version) virtual machine:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE13]'
  prefs: []
  type: TYPE_PRE
- en: 'As shown in the following screenshot, all ICMP responses contained a TTL of
    `128`, which indicates the targeted system is running a version of the Windows
    operating system:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file228.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Next, use the following commands to send 4 ICMP ECHO Request messages to the
    Metasploitable 2 virtual machine:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE14]'
  prefs: []
  type: TYPE_PRE
- en: 'As shown in the following screenshot, the ICMP responses has a TTL value of
    `64`, which indicates the targeted system is running a version of Linux:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file229.png)'
  prefs: []
  type: TYPE_IMG
- en: As an aspiring ethical hacker and penetration tester, identifying the operating
    system, open ports and running services helps you to better profile the target
    and identify its security vulnerabilities. By identifying the security vulnerabilities,
    you can improve on your exploit development phase and plan of attack. Simply put,
    an exploit or payload for a Windows-based operating system will most likely not
    work on a Linux-based system or vice versa.Thus far, you have learned how to discover
    open ports, service versions, operating system, and SMB versions. Next, you will
    learn how to evade detection while performing active scanning on a network and
    systems using Nmap.
  prefs: []
  type: TYPE_NORMAL
- en: Using scanning evasion techniques
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Whenever a packet is sent from one device to another, the source IP address
    is included within the header of the packet. This is the default behavior of the
    TCP/IP networking model; all addressing information must be included within all
    packets before they are placed on the network. When performing a scan as an ethical
    hacker and a penetration tester, we try to remain undetected to determine whether
    the security team of the targeted organization has the capabilities of detecting
    the simulated cyber-attack.During a real cyber-attack, if an organization is unable
    to detect suspicious activities and security incidents on their network and systems,
    the threat actor can simply achieve their objectives without obstructions. However,
    if an organization can detect suspicious activities as soon as they occur, the
    security team can take action quickly to contain and stop the threat while safeguarding
    their organization’s assets. During a penetration test, it's important to simulate
    real-world cyber-attack to test the threat detection and mitigation systems within
    the targeted organization.
  prefs: []
  type: TYPE_NORMAL
- en: Avoiding detection with decoys
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'Nmap is usually considered to be the king of network scanners within the cybersecurity
    industry due to its advanced scanning capabilities. Nmap enables penetration testers
    to use decoys when scanning a targeted system. This scanning technique tricks
    the targeted system into thinking the source of the scan is originating from multiple
    sources, rather than a single source IP address that belongs to the attacker machine.To
    get started with this exercise, please use the following instructions:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Power-on **Kali Linux**, **Metasploitable 2** and **Metasploitable 3** (Windows
    version) virtual machines. Kali Linux will be the attacker machine, Metasploitable
    2 will be the targeted system and Metasploitable 3 – Windows virtual machine will
    be the decoy, as shown in the following diagram:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](../media/file230.png)'
  prefs: []
  type: TYPE_IMG
- en: Ensure you identify the IP addresses of each of these systems as they may be
    different from the preceding diagram. Using the scanning techniques from the previous
    section will help you identify the IP addresses easily.
  prefs: []
  type: TYPE_NORMAL
- en: 'Next, to perform an Nmap scan using decoys, use the following commands:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE15]'
  prefs: []
  type: TYPE_PRE
- en: 'Using the `-D` syntax enables you to specify one or more decoys. Before Nmap
    uses the decoy addresses, it will first check whether each decoy system is a live
    host on the network, if an address is not reachable, it won’t include the offline
    address during the scan. The following screenshot shows the expected results of
    the scan:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file231.png)'
  prefs: []
  type: TYPE_IMG
- en: 'If the security team of the targeted organization is closely monitoring the
    packets over their internal network and identifies a port scan is in progress,
    there’s a chance they will determine the scan is originating from your IP address.
    However, the decoy feature will include the decoy addresses within various packets
    from your attacker machine, as shown below:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file232.png)'
  prefs: []
  type: TYPE_IMG
- en: Therefore, using more decoy addresses during the Nmap scan will decrease the
    risk a security analyst may trace the source of the scan back to your IP address.
    However, security analysts are well-trained professionals and usually has the
    required tools and skilled to identify threats quickly on their network infrastructure.
  prefs: []
  type: TYPE_NORMAL
- en: Using MAC and IP spoofing techniques
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'Nmap is like the Swiss army knife of scanners, filled with lots of scanning
    features to evade detection. Nmap allows a penetration tester to spoof both the
    MAC and IP addresses of their Kali Linux machine.The following are common MAC
    and IP spoofing techniques with Nmap:'
  prefs: []
  type: TYPE_NORMAL
- en: 'To perform an Nmap scan using a randomized MAC address, use the `--spoof-mac
    0` command as shown below:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE16]'
  prefs: []
  type: TYPE_PRE
- en: 'The following screenshot shows Nmap generated a random MAC address before performing
    the scan on targeted system:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file233.png)'
  prefs: []
  type: TYPE_IMG
- en: 'In addition, the following screenshot shows the packets that were captured
    using Wireshark to further verify Nmap used a randomized address as the source
    MAC address:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file234.png)'
  prefs: []
  type: TYPE_IMG
- en: 'To perform an Nmap scan on a targeted system with a spoof MAC address of a
    specific vendor, it’s simply as including the vendor’s name, with the following
    commands:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE17]'
  prefs: []
  type: TYPE_PRE
- en: 'The following screenshot Nmap using an HP MAC address as the source address:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file235.png)'
  prefs: []
  type: TYPE_IMG
- en: To learn more about the various functionality of Nmap, use the `nmap -h` and
    `man nmap` commands to view the help menu and manual page.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Having completed this section, you have learned how to evade detection on a
    network while performing scanning using Nmap. Next, you will learn how to perform
    a stealth scan using Nmap.
  prefs: []
  type: TYPE_NORMAL
- en: Stealth scanning techniques
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: 'By default, Nmap establishes a TCP 3-way handshake on any open TCP ports found
    on the targeted systems. Once the handshake has been established between the attacker
    machine and the targeted system, data packets are exchanged between each host.
    The following diagram shows the TCP 3-way handshake, where Host A is initializing
    communication with Host B:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file236.png)'
  prefs: []
  type: TYPE_IMG
- en: 'During a penetration test, it''s important to be as stealthy as possible on
    the network. This creates the effect of a real adversary attempting to compromise
    the targeted systems on the network, without being caught by the organization''s
    security solutions. However, by establishing a TCP 3-way handshake with the targeted
    devices, we are making ourselves known to the target.By using Nmap, we can perform
    a stealth scan (half-open) between the target and our attacker system. A stealth
    scan does not setup a full TCP 3-way handshake but resets the connection before
    it’s fully established.The following diagram shows the exchange of TCP packets
    during an Nmap stealth scan:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file237.png)'
  prefs: []
  type: TYPE_IMG
- en: 'As shown in the preceding diagram:'
  prefs: []
  type: TYPE_NORMAL
- en: The attacker machine tricks the target by sending a **TCP SYN** packet to a
    specific port on the targeted system to determine if the port is open.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Then, the target system will respond with a **TCP SYN/ACK** packet if the port
    is open.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Lastly, the attacker will send a **TCP RST** packet to the target to reset and
    terminate the connection.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'To get started with learning stealth scanning techniques, please use the following
    instuctions:'
  prefs: []
  type: TYPE_NORMAL
- en: Power-on the **Kali Linux** and **Metasploitable 2** virtual machines.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'On **Kali Linux**, open the **Terminal** and use the following commands to
    perform a stealth scan on the Metasploitable 2 to identify whether port 80 is
    open:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE18]'
  prefs: []
  type: TYPE_PRE
- en: 'Using the `-sS` syntax to indicate a stealth scan, and the `-p` operator allow
    us to specify a targeted port.The following screenshot shows the Nmap identified
    port 80 as opened on the targeted system:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file238.png)'
  prefs: []
  type: TYPE_IMG
- en: 'The following screenshot shows the exchange of packets between the Kali Linux
    (`172.30.1.50`) and the targeted system (`172.30.1.48`) during the stealth scan:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file239.png)'
  prefs: []
  type: TYPE_IMG
- en: As shown in the preceding snippet, Nmap sent a **TCP SYN** packet with a destination
    port 80 to identify whether there are any running services on port 80 of the targeted
    system. The target responded with a **TCP SYN/ACK** packet as expected, however,
    the attacker machine sent a **TCP RST** packet to reset and terminate the connection.
    Therefore, no network connections were made between the attacker machine (Kali
    Linux) and the targeted system during the stealth scan.However, keep in mind that
    seasoned cybersecurity professionals who are actively monitoring their network
    traffic for any security incidents can easily identify whether a threat actor
    is performing a stealth scan on their network.Having completed this section, you
    have learnt how to perform various types of scanning techniques to identify live
    hosts on a network, profile their running services and operating systems. In the
    next section, you will learn how to enumerate common services and network shares
    from vulnerable systems.
  prefs: []
  type: TYPE_NORMAL
- en: Enumerating network services
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: While scanning, you will notice there are common network services running on
    the targeted systems. Collecting more information on these network services can
    help you further identify shared network resources such shared directories, printers,
    and file shares on system. Sometimes, these network services are misconfigured
    and enables a threat actor to gain unauthorized access to sensitive data stored
    on servers and other systems within an organization.Over the next few sub-section,
    you will learn how to enumerate common network services such as **Server Message
    Block** (**SMB**), **Simple Mail Transfer Protocol** (**SMTP**) and **Simple Network
    Management Protocol** (**SNMP**).
  prefs: []
  type: TYPE_NORMAL
- en: Enumerating SMB services
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**Server Message Block** (**SMB**) is a common network service that allows
    hosts to share resources such as files to other devices on a network. As an aspiring
    ethical hacker and penetration tester, it''s always recommended to enumerate file
    shares once it''s within your scope for the penetration test.To get started enumerating
    SMB services on a targeted system, please use the following instructions:'
  prefs: []
  type: TYPE_NORMAL
- en: Power-on both the **Kali Linux** and **Metasploitable 2** virtual machines.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'On **Kali Linux**, open the **Terminal** and use the following command to launch
    the Metasploit Framework:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE19]'
  prefs: []
  type: TYPE_PRE
- en: 'After the Metasploit framework loads, use the `search` command along with the
    `smb_version` search term to quickly locate modules:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE20]'
  prefs: []
  type: TYPE_PRE
- en: 'As shown in the following screenshot, the search result shows only one module
    available which can be used to identify whether SMB is running on the targeted
    system and its version:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file240.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Next, use the following commands to load the module and display its options:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE21]'
  prefs: []
  type: TYPE_PRE
- en: 'Using the `options` or `show options` command displays the current settings
    within the loaded module and helps you determine whether there are additional
    configurations needed before executing the module, as shown below:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file241.png)'
  prefs: []
  type: TYPE_IMG
- en: As shown in the preceding screenshot, there are two required settings. One is
    `RHOSTS` or the target settings, while the other is the number of threads to apply
    to the process. Notice that the `RHOSTS` setting is blank.
  prefs: []
  type: TYPE_NORMAL
- en: 'Next, use the following commands to set the targeted system (Metasploitable
    2) as the `RHOSTS` and execute the module:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE22]'
  prefs: []
  type: TYPE_PRE
- en: The `run` command is commonly used to execute auxiliary modules within the Metasploit
    framework, while the `exploit` command is used to execute exploit modules.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'The following screenshot shows Metasploit was able to detect SMB is running
    and it’s version from the targeted system:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file242.png)'
  prefs: []
  type: TYPE_IMG
- en: Use the `exit` command to quit Metasploit framework and return to the BASH shell
    on the Terminal.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Using more than one tool to enumerate running services on your target is always
    recommended because there''s the possibility one tool may not identify something
    important. Sometimes, penetration testers may prefer to work with Metasploit as
    it contains a lot of *auxiliary* modules to scan and enumerate services, while
    others prefer Nmap. However, I recommend that you become familiar with both tools
    as they are excellent and will be very handy in various situations.Since SMB has
    been discovered on the targeted system, we can use **SMBmap** to enumerate the
    files and shared drives within the target. To get started using SMBMap, please
    use the following instructions:'
  prefs: []
  type: TYPE_NORMAL
- en: Ensure **Kali Linux** and **Metasploitable 2** virtual machines are power-on.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'On **Kali Linux**, use the following commands on the **Terminal** to identify
    whether the targeted system (Metasploitable 2) is running the SMB service:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE23]'
  prefs: []
  type: TYPE_PRE
- en: 'The following screenshot shows Nmap was able to identify ports 139 and 445
    is open on the targeted system:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](../media/file243.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Next, use SMBmap to identify whether the targeted system has any network shares:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE24]'
  prefs: []
  type: TYPE_PRE
- en: 'As shown in the following screenshot, the targeted system (Metasploitable 2)
    has a few shared drive, most are not accessible over the network except for the
    **tmp** resource:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file244.png)'
  prefs: []
  type: TYPE_IMG
- en: As shown in the preceding screenshot, the SMBmap tool was able to provide the
    permissions and comments for each network share on a targeted system. This information
    is useful in helping ethical hackers and penetration testers to identify sensitive
    directories and collect data found within unsecure network shares.
  prefs: []
  type: TYPE_NORMAL
- en: 'Next, use the following commands to display the contents of the **tmp** directory
    on the targeted system:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE25]'
  prefs: []
  type: TYPE_PRE
- en: 'As shown in the following screenshot, SMBmap was able to access the **tmp**
    directory because there were no authentication mechanism that’s configured to
    restrict unauthenticated access:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file245.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Next, to download all the contents of the **tmp** directory onto your Kali
    Linux machine, use the following commands to create a new directory (folder) within
    Kali Linux and download the files:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE26]'
  prefs: []
  type: TYPE_PRE
- en: 'The following screenshot shows the execution of the preceding commands:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file246.png)'
  prefs: []
  type: TYPE_IMG
- en: Having completed this section, you have learned how to perform SMB enumeration
    using both Metasploit and SMBMap. In the next section, you will learn how to perform
    SMTP enumeration.
  prefs: []
  type: TYPE_NORMAL
- en: Enumerating SMTP services
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Enumerating SMTP services enables ethical hackers and penetration testers to
    collect information about the email services and identify any valid user accounts
    on the targeted system. To get started with this exercise, please use the following
    instructions:'
  prefs: []
  type: TYPE_NORMAL
- en: Power-on both **Kali Linux** and **Metasploitable 2** virtual machines.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'On **Kali Linux**, open the **Terminal** and use **Netcat** to check whether
    port 25 is open on the targeted system (Metasploitable 2) and identify the running
    service:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE27]'
  prefs: []
  type: TYPE_PRE
- en: Next, use the `VRFY root` command to determine whether `root` is a valid user.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Next use the `VRFY toor` to check whether the user `toor` is a valid user,
    as shown below:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](../media/file247.png)'
  prefs: []
  type: TYPE_IMG
- en: As shown in the preceding screenshot, Netcat was able to successfully establish
    a connection to the targeted system on port 25 which further identified SMTP is
    running. When the `VRFY root` command was executed, the email service responses
    indicate the user exist. However, the email service provided an error message
    when a non-valid user is checked.
  prefs: []
  type: TYPE_NORMAL
- en: 'Manually checking each possible username on a targeted system can be very time-consuming.
    To help automate the process of SMTP enumeration, we can create a simply BASH
    script which intakes a pre-defined list of possible usernames and query it on
    the target system. Use the following commands to create a new script using Nano:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE28]'
  prefs: []
  type: TYPE_PRE
- en: 'Once the Nano command-line text editor opens, enter the following code exactly
    as is:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE29]'
  prefs: []
  type: TYPE_PRE
- en: Once you’ve finished entering the preceding code, save the script by pressing
    `CTRL + X`, then `Y` and `Enter` on your keyboard.
  prefs: []
  type: TYPE_NORMAL
- en: 'Next, use the following commands to make the newly saved script executable
    on Kali Linux:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE30]'
  prefs: []
  type: TYPE_PRE
- en: 'To use the script, the `./smtp_user_enum.sh <target> <wordlist>` syntax enables
    you to start the SMTP enumeration on a targeted system, as with the following
    commands:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE31]'
  prefs: []
  type: TYPE_PRE
- en: 'The following screenshot shows valid user names were identified while the script
    is running:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file248.png)'
  prefs: []
  type: TYPE_IMG
- en: Identifying and leveraging valid usernames and accounts helps penetration testers
    in gaining unauthorized access on targeted systems. Having completed this exercise,
    you have gained the hands-on skills on SMTP enumeration. Next, you will learn
    how to enumerate SNMP services on a targeted host.
  prefs: []
  type: TYPE_NORMAL
- en: Enumerating SNMP services
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'SNMP is a common network protocol which enables network professionals to monitor,
    manage and troubleshoot common networking devices. In addition, IT professionals
    uses SNMP to retrieve sensitive information from their devices such as the following:'
  prefs: []
  type: TYPE_NORMAL
- en: System uptime
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Device hostname
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: CPU and memory utilization
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Interface status and statistics
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Operating system
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Open ports and running services
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: SNMP leverages the Management Information Base (MIB) which is a common database
    that contains specific information about an SNMP managed device. The MIB is like
    a tree-structure that’s divided into multiple branches and each branch is used
    to manage a specific area of the device. On each branch of the MIB tree, there
    are leaves which represent specific values that enables a network professional
    to access the leaves to retrieve specific information about the device on the
    network.
  prefs: []
  type: TYPE_NORMAL
- en: 'To learn more about SNMP, please see: [https://www.techtarget.com/searchnetworking/definition/SNMP](https://www.techtarget.com/searchnetworking/definition/SNMP).'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'To get started with SNMP enumeration, please use the following instructions:'
  prefs: []
  type: TYPE_NORMAL
- en: Power-on the **Kali Linux** and **Metasploitable 3** (Windows version) virtual
    machines.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'On **Kali Linux**, open the **Terminal** and use the followings to determine
    whether SNMP is running the targeted system (Metasploitable 2):'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE32]'
  prefs: []
  type: TYPE_PRE
- en: 'The following screenshot shows SNMP is running on the targeted system on UDP
    port 161:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file249.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Next, perform SNMP enumeration using the **SNMP-Check** tool, use the following
    commands:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE33]'
  prefs: []
  type: TYPE_PRE
- en: 'The following is a description for each syntax used in the preceding commands:'
  prefs: []
  type: TYPE_NORMAL
- en: '`-p`: Allows you to specify the targeted port, by default its set to port 161.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`-c`: Allows you to specify the community string to login to the targeted system,
    the default community string is `public`.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`-v`: Allows you to specify the SNMP version to use, by default its set to
    version 1.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'As shown in the following screenshot, we are able to identify a lot of sensitive
    information which can be used to improve future cyber-attacks on the target:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file250.png)'
  prefs: []
  type: TYPE_IMG
- en: 'The SNMP-Check tool was able to enumerate the following information from the
    target:'
  prefs: []
  type: TYPE_NORMAL
- en: System information
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: User accounts
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Network information
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Routing information
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Network services
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Running processes
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Software components
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: To learn more about SNMP-Check, use the `snmp-check -h` command to display its
    menu and additional options.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: As you have learnt, enumerating systems helps ethical hackers and penetration
    testers to improve their profile on targeted system and determine what’s running
    on them. Such information helps penetration testers to identify vulnerabilities
    which can be exploited to compromise the target.In the next section, you will
    learn how to discover data leaks in cloud storage.
  prefs: []
  type: TYPE_NORMAL
- en: Discovering data leaks in the cloud
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Over the past decade, cloud computing has become one of the fastest-growing
    trends in the IT industry. Cloud computing allows companies to migrate and utilize
    computing resources within a cloud provider''s data center. Cloud computing providers
    have a pay-as-you-go model, which means that you only pay for the resources you
    use. Some cloud providers allow pay-per-minute models, while others use a pay-per-hour
    structure.The following are popular cloud computing service providers:'
  prefs: []
  type: TYPE_NORMAL
- en: Amazon Web Services (AWS)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Microsoft Azure
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Google Cloud Platform
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Many cloud service providers offer their customers a storage service. The AWS
    storage facility is known as **Simple Storage Service** (**S3**). Whenever a customer
    enables the S3 service, a bucket is created. A bucket is a storage unit within
    the AWS platform where the customer can add or remove files. In Microsoft Azure,
    the file storage facility is known as Azure Files. Additionally, on Google Cloud,
    the storage facility is known as Google Cloud Storage.In the field of cybersecurity,
    we need to remember when a company is using a cloud platform, the data on the
    cloud platform must be secured, just like it should be when stored on-premises
    (that is, when stored locally). Sometimes, administrators forget to enable security
    configurations or lack knowledge regarding the security of a cloud solution. This
    could lead to, say, an attacker discovering a target organization''s AWS S3 buckets
    and downloading their content.For this exercise, we are going to use some free
    online learning resources from http://flaws.cloud. This is a learning environment
    that''s been created by an AWS security professional who is helping the community
    learn about security vulnerabilities that can exist within AWS S3 misconfigurations.To
    get started with identifying data leakage with AWS S3 Buckets, please use the
    following instructions:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Power-on the **Kali Linux** virtual machine, open the **Terminal** and use
    the following commands to install the **S3Scanner** tool:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE34]'
  prefs: []
  type: TYPE_PRE
- en: 'Next, install the AWS command-line package using the following commands:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE35]'
  prefs: []
  type: TYPE_PRE
- en: 'Next, configure the AWS command-line features on Kali Linux by using the following
    commands:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE36]'
  prefs: []
  type: TYPE_PRE
- en: 'Simply hit Enter to use the default options as shown in the following screenshot:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file251.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Next, to view all the supported features and options of the S3Scanner tool,
    use the `s3scanner –h` command as shown in the following screenshot:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](../media/file252.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Next, let’s use the **NSlookup** within Kali Linux to retrieve the IP address
    of the targeted server:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE37]'
  prefs: []
  type: TYPE_PRE
- en: 'The following screenshot shows NSlookup was able to retrieve multiple public
    IP addresses for the hosting server:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '![](../media/file253.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Next, let’s use NSlookup again to retrieve the hostname of the AWS S3 Bucket
    server:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE38]'
  prefs: []
  type: TYPE_PRE
- en: 'The following screenshot the hostname of the server, including the name of
    the AWS S3 Bucket:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file254.png)'
  prefs: []
  type: TYPE_IMG
- en: 'An AWS S3 bucket''s URL format is usually in the form of `https://<bucketname>
    <region>.amazonaws.com`. Therefore, by using the information from the URL, the
    following can be determined:'
  prefs: []
  type: TYPE_NORMAL
- en: 'S3 Bucket name: s3-website'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Hosting region: us-west-2'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'AWS S3 buckets are not only used to store data such as files. They are also
    used to host websites. Therefore, we can use `flaws.cloud` as a prefix to the
    AWS S3 bucket URL to get the following URL:[http://flaws.cloud.s3-website-us-west-2.amazonaws.com](http://flaws.cloud.s3-website-us-west-2.amazonaws.com)
    The following screenshots the contents of the preceding URL:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file255.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Next, let''s use S3Scanner to verify that a bucket exists and the available
    permissions:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE39]'
  prefs: []
  type: TYPE_PRE
- en: 'As shown in the following screenshot, an AWS S3 Bucket exist:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file256.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Next, let’s attempt to view the contents of the AWS S3 bucket, use the following
    commands:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE40]'
  prefs: []
  type: TYPE_PRE
- en: As shown in the following screenshot, there are some files within the S3 bucket;
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file257.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Next, let''s attempt to download the files onto our Kali Linux machine. Use
    the following commands to create a folder and download the files into the newly
    created folder:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE41]'
  prefs: []
  type: TYPE_PRE
- en: The `cp` syntax specifies the file to download, `--region` allows us to specify
    the location of the AWS S3 Bucket and `--no-sign-request` specifies to do not
    use any user credentials.
  prefs: []
  type: TYPE_NORMAL
- en: 'Lastly, you can use the `cat` or `open` command to view the contents of the
    downloaded file, as shown below:'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE42]'
  prefs: []
  type: TYPE_PRE
- en: You can continue this exercise on [http://flaws.cloud/](http://flaws.cloud/)
    to learn more about various security vulnerabilities and discover the impact of
    misconfigurations on cloud services such as AWS S3 buckets. However, do not perform
    such actions on systems, networks, and organizations that you do not have legal
    permission to do so.As you have seen, data leaks can happen on any platform and
    to any organization. As an aspiring ethical hacker and penetration tester, you
    must know how to find them before a real adversary do and exploits them. Companies
    can store sensitive data on cloud platforms, or even leave data completely unprotected
    on a cloud service provider network. This can lead to data and accounts being
    retrieved. In this section, you learned how to perform enumeration of AWS S3 buckets
    using various tools and techniques.
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: During this chapter, you have gained the hands-on skills as an aspiring ethical
    hacker and penetration tester to perform active scanning techniques to identify
    open ports, running services and operating system on targeted systems. In addition,
    you have learnt how to use common evasion techniques during scanning to reduce
    your threat level. Furthermore, you have discovered how to enumerate common network
    services and leverage the information on improve a cyber-attack.I trust that the
    knowledge presented in this chapter has provided you with valuable insights, supporting
    your path towards becoming an ethical hacker and penetration tester in the dynamic
    field of cybersecurity. May this newfound understanding empower you in your journey,
    allowing you to navigate the industry with confidence and make a significant impact.
    In the next chapter, *Performing Vulnerability Assessments*, you will learn how
    to setup and work with popular vulnerability management tools.
  prefs: []
  type: TYPE_NORMAL
- en: Further Reading
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Nmap reference guide - [https://nmap.org/book/man.html](https://nmap.org/book/man.html)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Information gathering using Metasploit - [https://www.offensive-security.com/metasploit-unleashed/information-gathering/](https://www.offensive-security.com/metasploit-unleashed/information-gathering/)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
