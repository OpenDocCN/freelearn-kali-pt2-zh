<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Reconnaissance and Scanning</h1>
                </header>
            
            <article>
                
<p>In this chapter, we will cover the following topics:</p>
<ul>
<li><span>Using KeepNote to organize our data</span></li>
<li>Getting up and running with Maltego CE</li>
<li>Gathering domain information</li>
<li>Gathering public IP information</li>
<li>Gathering external routing information</li>
<li>Gathering internal routing information</li>
<li>Gathering cloud service information</li>
<li>Identifying network hosts</li>
<li>Profiling hosts</li>
<li>Identifying whether there is a web application firewall</li>
<li>Using SNMP to gather more information</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Introduction</h1>
                </header>
            
            <article>
                
<p>In this chapter, you will learn the skills necessary to gather information about your target environment. We will spend time trying to identify as much information as possible. The more information we can gather will provide us with more potential vectors for possible penetration in the environment as well as make those penetration attempts more successful. We will gather domain names, IP subnets, hosts, routing information, as well as other useful information. You will also learn how to keep track of this data, so we can refer to it in the future as we progress through our penetration testing environment. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using KeepNote to organize our data</h1>
                </header>
            
            <article>
                
<p>We will explore the application KeepNote and how you can use it to capture the information we discover during our testing.</p>
<p>It will be very important for you to record all the information in detail, as this information will be useful in later chapters, as well as for the reports that you need to create for your customer. Kali actually provides some useful purpose-built tools for recording your information. Don't reinvent the wheel; if you have already used a note taking tool like Microsoft OneNote or EverNote, just stick to it. However, if you don't do this, Kali does provide a cross-platform, note-taking application called KeepNote that you can use if you don't have a preference. But always remember that, as a penetration tester, you are gathering information that can be used to do great harm to a customer, so remember security and privacy when you decide on the tools you use to record the data you gather.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Let's ensure the following prerequisites:</p>
<ul>
<li>Kali Linux is running, and you are logged in as root</li>
<li>Validate the internet connectivity</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>In this recipe we will learn how to use KeepNote in order to collect and organize the data we collect:</p>
<ol>
<li>Click on <span class="packt_screen">Applications</span>. Slide your mouse down and highlight <span class="packt_screen">12 - Reporting Tools</span>, and click on<strong> </strong>the KeepNote icon:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="41" width="43" class="alignnone size-full wp-image-414" src="assets/fa9a1eb3-5e44-493d-9b57-5baecf4a27c5.png"/></div>
<ol start="2">
<li>From the main KeepNote screen, select <span class="packt_screen">File</span> | <span class="packt_screen">New Notebook</span>. We will be provided with a file navigation screen. So, select <kbd>/root/Documents</kbd> and type in your customer name (for example we will use <kbd>customer_1</kbd>), and click on <span class="packt_screen">New</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="490" width="577" class="alignnone size-full wp-image-616 image-border" src="assets/e778f879-036d-4adf-bdf5-9ce040425921.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">KeepNote - New Notebook screen</div>
<ol start="3">
<li>One of the first pieces of information we want to capture is basic company details. Click on <span class="packt_screen">File</span><strong> </strong>| <span class="packt_screen">New Page,</span> name it <kbd>Company Info</kbd>, and press <em>Enter</em>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="471" width="569" class="alignnone size-full wp-image-617 image-border" src="assets/39039f9a-2f15-4521-8bbb-8959af19cd0c.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">KeepNote - New Page screen</div>
<ol start="4">
<li>Populate it with whatever information you can find about your target. Use Google searches, go through its website and if it's a public company gather their financial and SEC filing information:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="476" width="575" class="alignnone size-full wp-image-620 image-border" src="assets/09b3c610-9331-428f-8f2c-b12008b5fd54.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">KeepNote - Add information screen</div>
<ol start="5">
<li>Click on <span class="packt_screen">File</span> | <span class="packt_screen">New Child Page</span>, and call it <kbd>e-mail addresses</kbd>. Add any email address you can find:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="473" width="572" class="alignnone size-full wp-image-621 image-border" src="assets/87fb8d43-2536-4825-a569-dd10d3292448.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">KeepNote - New Child page</div>
<ol start="6">
<li>To save the notebook, click on <span class="packt_screen">File</span> | <span class="packt_screen">Save Notebook</span>.</li>
<li>To quit, click on <span class="packt_screen">File</span> | <span class="packt_screen">Quit</span> but make sure you always save it first.</li>
</ol>
<div class="mce-root packt_tip">You're never going to be done recording information. Every little piece of information you find, log it and keep it organized. You can add output information from the commands you run, from images, and from screenshots. <span>After you do a few of these, you will find that you may be able to start with a basic template of information. You can create a generic template that has pages and child pages already set up. Just copy it over for your new notebook whenever you start a new engagement. You can continue modify and adjust these template as you find new categories of information you want to capture.</span></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>Explore the <a href="http://keepnote.org/">http://keepnote.org/</a> <span>website </span>to get more information on the KeepNote application and its capabilities.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting up and running with Maltego CE</h1>
                </header>
            
            <article>
                
<p><span>We will be using the <strong>maltego community edition</strong> (<strong>Maltego CE</strong>) for several more recipes. This chapter will take us through the initial setup of Maltego. Maltego is a tool designed for data mining and discovery. It will place the information in a knowledge graph that you can continue to build and pivot from to help discover and gather information. This information can then be leveraged to expand our attack surface.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Let's ensure the following pre-requisites:</p>
<ul>
<li>Kali Linux is running and you are logged in as root</li>
<li>Validate network connectivity to the internet</li>
<li>Sign up for a Maltego community edition account through <a href="https://www.paterva.com/web7/community/community.php">https://www.paterva.com/web7/community/community.php</a></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>In this recipe we will get Matego - Community Edition registered and setup:</p>
<ol>
<li>Launch Maltego CE by going to <span class="packt_screen">Applications</span> | <span class="packt_screen">01 -</span> <span class="packt_screen">Information Gathering.</span> Click on <span class="packt_screen">maltegoce</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="418" width="324" class="alignnone size-full wp-image-622 image-border" src="assets/bbcf726f-42eb-4d0c-a614-fd9bf94a68f3.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Kali application menu screen</div>
<ol start="2">
<li>You will be brought to a welcome Screen. Click on <span class="packt_screen">Next</span> to Continue.</li>
<li>You will now be brought to <span class="packt_screen">Install Transforms From: <span>Screen</span></span><span>. Ensure that there is a check mark in the</span> <span class="packt_screen">Maltego public servers</span>,<strong> </strong><span>and click</span> on <span class="packt_screen">Next</span>.</li>
<li>At the <span class="packt_screen">Ready...Set...Go!</span> <span>screen, select</span> <span class="packt_screen">Go away</span>, <span class="packt_screen">I have done this before!</span>, <span>and click</span> on <span class="packt_screen">Finish</span>.</li>
</ol>
<ol start="5">
<li>Click on the Maltego CE icon in the top left-hand corner of the screen, and select <span class="packt_screen">Log in to Community Server</span> <span>at the bottom:</span></li>
</ol>
<div class="packt_figref CDPAlignCenter CDPAlign"><img height="50" width="49" class="alignnone size-full wp-image-623" src="assets/a690f51f-6120-4e37-b9c5-2df41af4788c.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Maltego icon</div>
<ol start="6">
<li>Log in with the credentials you created in the preceding <em>Getting ready</em> section, and click on <span class="packt_screen">Next</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="367" width="498" class="alignnone size-full wp-image-624 image-border" src="assets/806547f7-6d00-4f10-9bf0-0f14b783faec.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Maltego logon screen</div>
<ol start="7">
<li>You will be presented with a screen providing the personal details that you used when registering; click on <span class="packt_screen">Finish</span>.</li>
</ol>
<div class="packt_infobox">The API key Maltego provided through your login is good for three days. Every three days, you will have to log back in to obtain a new API key.</div>
<ol start="8">
<li>Now that we are all done, we should be brought to <span class="packt_screen">Transform Hub</span>. To start, let's click on <span class="packt_screen">Refresh Transform Hub</span> to ensure we have the latest list of transforms available.</li>
<li>Once <span class="packt_screen">Transform Hub</span> is refreshed, you can start by installing all the transforms listed.</li>
<li>You can easily install a transform by clicking on it and selecting <span class="packt_screen">I</span><span class="packt_screen">nstall</span>.</li>
<li>After you install your transforms, you can go through and, by clicking on them, check whether there are any settings that you may need to, or want to, modify. In particular, you may need to set up credentials for other transforms as needed, in order to use them.</li>
</ol>
<div class="packt_infobox">A transform is an operation that will take a bit of data and analyze it against a predefined set of characteristics and add that information to the graph. Later, we will review machines that our groups of transforms put together in a macro. Here, we can carry out successive data operations by linking multiple transforms together in a series. Please note that the community edition of Maltego is limited to 12 entries returned per transform, which may require you to run certain transforms multiple times, or with less granular information, to receive all the information.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>You can read more information on Maltego at <a href="https://docs.paterva.com/en/user-guide/">https://docs.paterva.com/en/user-guide/</a>. There are many other transforms available for Maltego that you can search for online. Here are a few links to get you started:</p>
<ul>
<li><a href="https://maltego.shodan.io/">https://maltego.shodan.io/</a></li>
<li><a href="http://packetninjas.net/tools/socialnet.html">http://packetninjas.net/tools/socialnet.html</a></li>
<li><a href="https://code.google.com/p/recordedfuture/downloads/detail?name=RF_Maltego_Package_1.0.tgz">https://code.google.com/p/recordedfuture/downloads/detail?name=RF_Maltego_Package_1.0.tgz</a></li>
<li><a href="https://github.com/allfro/sploitego">https://github.com/allfro/sploitego</a> <a href="https://github.com/allfro/sploitego"/></li>
<li><a href="https://github.com/catalyst256/Watcher">https://github.com/catalyst256/Watcher</a></li>
<li><a href="https://github.com/digital4rensics/Malformity">https://github.com/digital4rensics/Malformity</a></li>
<li><a href="https://www.threatminer.org/maltego.php">https://www.threatminer.org/maltego.php</a></li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Gathering domain information</h1>
                </header>
            
            <article>
                
<p>In this recipe we will use Maltego CE to gather Internet Domain information. If we are mainly working an external, internet based, penetration test. This information will provide of plenty of valuable information regarding the public aspects of there network. This tool will start with a domain name and pivot out to several different aspects of publicly available domain information.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Let's ensure the following prerequisites:</p>
<ul>
<li>Kali Linux is running and you are logged in as root</li>
<li>Validate network connectivity to the internet</li>
<li>Maltego is running</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>In this recipe we will use Maltego CE to gather information about a target's domain name:</p>
<ol>
<li>In the upper left-hand corner, click on the new graph button:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="37" width="32" class="alignnone size-full wp-image-625" src="assets/3fbc9fd7-e514-4927-9c5f-26efed9de93f.png"/></div>
<ol start="2">
<li>On the left, select <span class="packt_screen">Entity</span> palette. Scroll down to <span class="packt_screen">Infrastructure</span>, and click on <span class="packt_screen">Domain.</span> Drag it onto the graph.</li>
</ol>
<ol start="3">
<li>Rename <kbd>paterva.com</kbd> to <kbd>example.com</kbd>; <kbd>example.com</kbd> will suffice as the target domain for this round of testing:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="506" width="641" class="alignnone size-full wp-image-626 image-border" src="assets/9ac481bf-f7b6-45ff-af14-756f1dc2978e.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Maltego - New Graph page</div>
<div class="packt_infobox">We will use <kbd>example.com</kbd> for some of our initial testings. The <kbd>example.com</kbd> is a reserved site dedicated to documentation. It has some infrastructure behind it. The infrastructure is minimal, so some results will not be complete. You can use <kbd>example.com</kbd> for your testing or a domain you are authorized to access. </div>
<ol start="4">
<li>Right-click on the <kbd>example.com</kbd> domain icon, which will show you a variety of transform options. Let's start by getting the whois information. Navigate to <span class="packt_screen">Threat Miner</span> | <span class="packt_screen">[Threat Miner] Domain to Whois Details</span>. This will reach out and pull all the publicly available information on the domain. If you now double-click on the domain icon, and select <span class="packt_screen">Properties (14)</span> from the top. Then, you will see that all the information is populated:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="437" width="559" class="alignnone size-full wp-image-627 image-border" src="assets/ddc50273-0d6b-4e50-bc5e-44b08c4958f0.png"/></div>
<div class="packt_tip">Spend a minute getting used to how the transform interface works. Right-click on <kbd>example.com</kbd> to open the <span class="packt_screen">Run Tansform(s)</span> dialog. Along the left edge, you may notice a return arrow, which can bring you back in the transform menu. Depending on where you are, you may need to click back a couple times to get back to the root transform screen; go into a couple of the populated choices as needed.</div>
<ol start="5">
<li>Continue building the graph and have it populate the name servers. Right-click on <kbd>example.com</kbd>, and select <span class="packt_screen">Paterva CTS</span> | <span class="packt_screen">DNS from Domain</span> | <span class="packt_screen">To DNS name</span> - <span class="packt_screen">NS (name server)</span>. You will now see our name servers populating:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="390" width="543" class="alignnone size-full wp-image-628 image-border" src="assets/937e4ce9-e86f-4bc3-b40e-b4cb59642b03.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Maltego - example.com graph with name servers</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>There is a tremendous amount of additional information that you can use Maltego to gather. Spend some time trying to obtain more domain-related information. Test some different transforms, even if one transform fails to gather a particular type of data, another transform may succeed in gathering it. Also you can use Maltego to discover other domains that may be related to the company. Perhaps, they have <kbd>example.com</kbd> and <kbd>example.org</kbd> that have different mappings, so take the time to explore and gather all the information you can. </p>
<div class="packt_infobox">We will continue to use Maltego for further examples, so, either save your graph at this point so that you can come back to it, or continue with other operations.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Gathering public IP information</h1>
                </header>
            
            <article>
                
<p>We will now use Maltego to obtain the external host, the IP address, and some netblock information.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>We want to continue from where we left off with the last section, so, if you are coming back to the book after a while, open your saved Maltego graph from <span>the Gathering domain information recipe</span>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>In this recipe we will use Maltego CE to gather a company's public IP information:</p>
<ol>
<li>Starting from the graph screen, right-click on the <kbd>example.com</kbd> domain icon and select <span class="packt_screen">Paterva CTAS</span> | <span class="packt_screen">DNS from Domain</span> | <span class="packt_screen">To Website [Quick lookup]</span>. You will now discover <kbd>www.example.com</kbd>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="442" width="613" class="alignnone size-full wp-image-629 image-border" src="assets/6ddba475-11ec-417a-b0ac-bcd8670b92da.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Maltego - Graph screen with www.example.com</div>
<div class="packt_tip">Against a real domain, try the following transforms to further propagate a list of hosts. Some of the transforms you may want to try are; <span class="packt_screen">Paterva CTAS</span> | <span class="packt_screen">DNS from Domain</span> |<span> </span><span class="packt_screen">To DNS Name [Using DB]</span> and<strong> </strong><span class="packt_screen">Paterva CTAS</span> | <span class="packt_screen">DNS from Domain</span> | <span class="packt_screen">To DNS Name [Find common DNS names]</span>.</div>
<ol start="2">
<li>Now let's resolve the host names of all objects to their corresponding IP addresses. Start by highlighting multiple objects by clicking and dragging across the ones you want to select. Once those items are highlighted right-click and Select <span class="packt_screen">Paterva CTAS</span> | <span class="packt_screen">Resolve to IP</span><span> |</span> <span class="packt_screen">To IP Address [DNS]</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="435" width="600" class="alignnone size-full wp-image-630 image-border" src="assets/ed180e92-c778-4edc-b0a7-ebaa1effa2fb.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Maltego - Graph screen with www.example.com</div>
<ol start="3">
<li>Let's obtain netblock information for <kbd>www.example.com</kbd> now that we have its IP address. Right-click on the IP address in the question, and select <span class="packt_screen">All Transforms</span> | <span class="packt_screen">To Netblock [Using routing info]</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="372" width="518" class="alignnone size-full wp-image-631 image-border" src="assets/7b6474dc-2363-424e-9874-cd351244d425.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign"><span>Maltego - Graph screen with www.example.com</span></div>
<div class="packt_infobox"><span>We will be continuing to use Maltego for further examples, so, either save your graph at this point so that you can come back to it, or continue on with other operations.</span></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Gathering external routing information</h1>
                </header>
            
            <article>
                
<p>We will now use Maltego to obtain external routing information. External routing information can provide us with valuable information such as who their internet service providers are and how their traffic flows.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>We want to continue from where we left off with the last section, so, if you are coming back to the book after a while, open your saved Maltego graph from the <em>Gathering public IP information recipe</em>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>We will use Maltego CE to gather BGP autonomous system information:</p>
<ol>
<li>By right-clicking on the IP netblock, we can now obtain the BGP AS number assigned to this netblock by selecting <span class="packt_screen">Paterva CTAS</span><strong> |</strong> <span class="packt_screen">To AS number</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="431" width="594" class="alignnone size-full wp-image-632 image-border" src="assets/3065791b-06a6-49eb-8c79-bfd7613b63d2.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign"><span>Maltego - Graph screen with www.example.com</span></div>
<ol start="2">
<li>Next, we want to find the owner of the AS number in question. Right-click on the AS number and select <span class="packt_screen">All Transforms</span> | <span class="packt_screen">To Company [Owner]</span>.</li>
</ol>
<div class="packt_infobox"><span>We will be continuing to use Maltego for further examples, so, either save your graph at this point so that you can come back to it, or continue on with other operations.</span></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Gathering internal routing information</h1>
                </header>
            
            <article>
                
<p>We will use zenmap to provide a graphical representation of our network. Zenmap is a graphical front end to nmap. Zenmap does have some advantages over nmap, especially when it comes to providing certain graphical outputs. We are going to use it to provide a visual look at our target network. By obtaining information about how the internal network is layed out we can use this information to spread attacks beyond just the local subnet. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Let's ensure the following prerequisites:</p>
<ul>
<li>Kali Linux is running and you are logged in as root</li>
<li>Validate network connectivity to the internet</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>We will use zenmap to graphically map our network out to a predefined point:</p>
<ol>
<li>Open zenmap by selecting <span class="packt_screen">Application</span> | <span class="packt_screen">Information Gathering</span> - <span class="packt_screen">zenmap</span>. Spend a minute and examine the interface. You have some profile scans, and you can create your own to perform repetitive tasks. You will also see several output tabs. The one we will concentrate on a bit will be the <span class="packt_screen">Topology</span> section:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="391" width="516" class="alignnone size-full wp-image-633 image-border" src="assets/39f82cea-4362-462e-96a9-3267fd13c645.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Zenmap - Main start screen</div>
<ol start="2">
<li>Start by using an nmap traceroute scan using ICMP to map the path that we have to <kbd>scanme.nmap.org</kbd>. In the target screen, type <kbd>scanme.nmap.org</kbd>, and we will use the following options: <kbd>-sn</kbd> for a simple ping scan, <kbd>-PE</kbd> to specify protocol ICMP, and <kbd>-traceroute</kbd> to indicate that we want traceroute information to the destination. Once done, click on <span class="packt_screen">Topology</span> to see a graphical view of our network. This information can be used to see other areas we may want to scan:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="426" width="546" class="alignnone size-full wp-image-634 image-border" src="assets/27ed1e65-82be-458d-ba70-8dae62be8918.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Zenmap - External topology scan</div>
<ol start="3">
<li>If we have internal access to the network, we can try scanning it against the RFC1918 address block. For speed, we specifically just did the <kbd>192.168.0.0/16</kbd> address block. As you see, we have found other address blocks that are worth exploring:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="423" width="511" class="alignnone size-full wp-image-635 image-border" src="assets/c89f0989-2aba-48fe-950b-9ad67feb4519.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Zenmap - internal topology scan</div>
<div class="packt_tip">This will be a fairly noisy scan, so, in a typical penetration testing scenario, we would be more tactical with our scans. We would do this by tracerouting to some specific things that we would know of: internal DNS servers, domain controllers, and so on. We will use this information to be more specific and narrower with our scans.</div>
<ol start="4">
<li>You can click on <span class="packt_screen">Save Graphic</span>, and save the topology as a PDF or PNG file, and insert it into KeepNote. You can also save the entire scan by going to <span class="packt_screen">Scan</span> | S<span class="packt_screen">ave Scan</span> for later reference, or to continue to grow your knowledge of the network host and the host discovery.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>Remember zenmap provides all the nmap capabilities and functionalities. Try some additional scans including traceroute, and try to use it to a build a map of your internal home network or a network you are authorized to use.</p>
<p>Also, for additional information, take a look at <a href="https://nmap.org/book/zenmap.html">https://nmap.org/book/zenmap.html.</a></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title"> Gathering cloud service information</h1>
                </header>
            
            <article>
                
<p>We next want to discover whether the target is using any cloud-based services. Based on the IP addresses we have found we can see if there are multiple different domain and host information associated with an individual IP Address which would indicate some form of cloud based service.</p>
<p>Cloud services come in several different forms and offerings. Cloud services originally started the as a service trend with <strong>Software as a Service</strong> (<span><strong>SaaS</strong>), </span>such as Office 365 and Exchange 365 and a <strong>Platform as a Service</strong> (<span><strong>PaaS</strong>)</span> like AWS and Azure. Today, many organizations rely on cloud-based systems. Sometimes, these systems are controlled, managed, and monitored as part of the data center infrastructure. At other times, this use is regarded as Shadow IT. Shadow IT refers to the services that are brought up outside the corporate IT environment and control. They are often used for development purposes or to actually get around restricts or delays based on standard corporate IT policies. These environments can be rich with information; in fact, some of the more recent breaches of <strong>Personally Identifiable Information</strong> (<span><strong>PII</strong>) </span>have been from either unsecured or badly secured test applications, where they used real data in the databases. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>We want to continue from where we left off with the last section, so, if you are coming back to the book after a while, open your saved Maltego graph from <span>the Gathering public IP information recipe</span>.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>We will now use Maltego CE to obtain information about network blocks and hosts:</p>
<ol>
<li>We can get some more information about the netblock by right-clicking on it and selecting <span class="packt_screen">All Transforms</span> | <span class="packt_screen">To Entities (NER)</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="447" width="620" class="alignnone size-full wp-image-636 image-border" src="assets/3ee934be-98ba-4029-adc9-a17b5d666ac3.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign"><span>Maltego - Graph screen with www.example.com</span></div>
<ol start="2">
<li>Analyze the information to see if there are any signs of it being a cloud service provider; there are no chances in this case, but let's try something else.</li>
</ol>
<ol start="3">
<li>The following is the output from another domain. In this case, we see that this website (not disclosed) is being hosted by Weebly, a popular web hosting company:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="405" width="563" class="alignnone size-full wp-image-637 image-border" src="assets/6363f9d6-b9c2-48f3-bb53-8c0f0b9eaa63.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Maltego - Graph screen with reference to weebly</div>
<div class="packt_tip">Run this function against all the IP addresses you can find through the various items of domain information that we have worked on in the past, to see if any of them register back to a known service provider.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Identifying network hosts</h1>
                </header>
            
            <article>
                
<p>There are various methods we can use to scan for hosts on internal or external networks. We will explore some of these in detail. We will use nmap for several examples in this section. TCP port scans are default within nmap as most of our well-known servers running using TCP. However, from a penetration standpoint, there are some very useful UDP ports that might be open that could provide us with attack vectors such as SNMP.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Let's ensure the following prerequisites:</p>
<ul>
<li>Kali Linux is running and you are logged in as root</li>
<li>Bring up your other test machines (Metasploitable and Windows)</li>
<li>Validate network connectivity to the network you plan on scanning</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it... </h1>
                </header>
            
            <article>
                
<p>We will use nmap and various command line options to perform a variety of different scans:</p>
<ol>
<li>Open the terminal screen by clicking on the terminal icon:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="41" width="41" class="alignnone size-full wp-image-638" src="assets/b7d4089f-0c93-4dc4-97c0-155b56bcb62a.png"/></div>
<ol start="2">
<li>From the main terminal screen, you should be at a Command Prompt of <kbd>root@kali:~#</kbd><span class="packt_screen">.</span></li>
<li>Type <kbd>nmap</kbd> <span>and press</span> <em>Enter</em>. A list of options should fill the screen; briefly, review the list of options.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">A simple subnet scan</h1>
                </header>
            
            <article>
                
<p>We will perform simple scan of a subnet:</p>
<p>Perform a simple subnet scan of your lab network, <kbd>192.168.56.0/24</kbd>. Substitute the subnet you created for your lab network in the section installing Kali on VirtualBox :</p>
<pre><strong>nmap 192.168.56.0/24</strong> </pre>
<p>This command will scan 1000 popular ports of all targets in a specific subnet range. Examine the output. In the case of our Metasploitable machine (<kbd>192.168.56.102</kbd>), we will see the following output. From this output, we can identify the IP address as well as the number of open ports:</p>
<div class="CDPAlignCenter CDPAlign"><img height="294" width="363" class="alignnone size-full wp-image-639 image-border" src="assets/d49db9e3-186c-436c-abea-c0e02839984e.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Scan all the TCP ports of a host</h1>
                </header>
            
            <article>
                
<p>To perform a full TCP scan of our Metasploitable machine, <kbd>192.168.56.102</kbd>, we add the command line option <kbd>-p-</kbd>. Substitute the IP address for your Metasploitable virtual machine:</p>
<pre><strong>nmap -p- 192.168.56.102</strong></pre>
<p>This command will scan all the TCP ports of the target device. The following is the output of our scan. You will notice that we have discovered some new open ports:</p>
<div class="CDPAlignCenter CDPAlign"><img height="390" width="399" class="alignnone size-full wp-image-640 image-border" src="assets/fac93ba1-1628-46e1-acdb-159e6b46d9a4.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Performing a TCP SYN scan</h1>
                </header>
            
            <article>
                
<p>TCP SYN scans, otherwise known as half open scans, are very useful because of their specific scanning nature; they are often not logged by the target device. This allows you to scan a host without leaving traces of the scan:</p>
<pre><strong>nmap -sS -p- 192.168.56.102</strong> </pre>
<p>Upon scanning the host, you will notice that we have discovered the same open ports.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Performing a UDP port scan</h1>
                </header>
            
            <article>
                
<p>Performing UDP scans against targets provides us with additional vectors of attacks. We are also going to add a couple of extra CLI options. We have also added to other command line options <kbd>-r</kbd> for randomize, which will help avoid detection by security devices such as IDS and IPS servers and the <kbd>-v</kbd> for verbose, allowing us to see action more quickly. This scan will take several minutes to run, so it's nice to know what it's doing while we wait:</p>
<pre><strong>nmap -sU -r -v 192.168.56.102</strong> </pre>
<p>You will see from the output that we did find a few UDP ports open that we can explore later:</p>
<div class="CDPAlignCenter CDPAlign"><img height="298" width="520" class="alignnone size-full wp-image-641 image-border" src="assets/c5c1043d-acdc-48d9-b054-438ac41daddd.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">The nmap output formats</h1>
                </header>
            
            <article>
                
<p>There are several types of output that you can use for simple logging of the data, logging in an XML format for potential input into another program, or outputting for grep:</p>
<table>
<tbody>
<tr>
<td>
<p><kbd>nmap -oN filename.txt</kbd></p>
</td>
<td>
<p><kbd>N</kbd> is a standard default text output format</p>
</td>
</tr>
<tr>
<td>
<p><kbd>nmap -oG filename.txt</kbd></p>
</td>
<td>
<p><kbd>G</kbd> is a format so you can better run grep against the file</p>
</td>
</tr>
<tr>
<td>
<p><kbd>nmap -oX filename.xml</kbd></p>
</td>
<td>
<p><kbd>X</kbd> is for an XML format</p>
</td>
</tr>
</tbody>
</table>
<p>Let's take a simple scan and output it to a file for grep:</p>
<pre><strong>nmap -p- -oG 192_168_56_102.txt 192.168.56.102</strong></pre>
<p>You will see the output on the screen, and it will also output to a TXT file in your home directory, which you can use as a target for grep:</p>
<div class="CDPAlignCenter CDPAlign"><img height="337" width="508" class="alignnone size-full wp-image-642 image-border" src="assets/e46aeb5a-74a6-4997-8cf2-104b77744e6c.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Profiling hosts</h1>
                </header>
            
            <article>
                
<p>We will continue to use some advanced functions of nmap to provide us with additional information about a particular host.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Let's ensure the following prerequisites:</p>
<ul>
<li>Kali Linux is running and you are logged in as root</li>
<li>Bring up your other test machines (Metasploitable and Windows)</li>
<li>Validate network connectivity to the network you plan on scanning</li>
<li>Internet connectivity</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>We will now provide more targeted nmap scans against particular hosts to obtain further information about the ports and protocols that are open:</p>
<ol start="1">
<li>Open the terminal screen by clicking on the terminal icon on the top-left corner:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"> <img height="41" width="41" class="alignnone size-full wp-image-643" src="assets/ffe86dd8-f6fb-46d5-9507-c4db028bc4f9.png"/></div>
<ol start="2">
<li>From the main terminal screen, you should be at a Command Prompt of <kbd>root@kali:~#</kbd>.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Operating systems and service detection</h1>
                </header>
            
            <article>
                
<p>The following command will run an operating system and service discovery of our Metasploitable host:</p>
<pre><strong>nmap -A 192.168.56.102</strong></pre>
<p>You will notice a considerable amount of information provided in the output. Starting from the bottom you will see that it correctly identified the machine as well as other useful information:</p>
<div class="CDPAlignCenter CDPAlign"><img height="167" width="652" class="alignnone size-full wp-image-644 image-border" src="assets/c4fae0d3-dc53-49a3-8b7f-77e28a94fcd8.png"/></div>
<p>As we scroll through the output we see a considerable amount of information about running services. It gives us detailed information about the specific service being run on the port, version information, and other relevant information. The following is an example of the VNC port:</p>
<div class="CDPAlignCenter CDPAlign"><img height="64" width="325" class="alignnone size-full wp-image-645 image-border" src="assets/430cae6d-d0ca-461f-9afd-972c336a7b07.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Aggressive service detection</h1>
                </header>
            
            <article>
                
<p>To perform an aggressive service scan against a host, we will use the following command:</p>
<pre><strong>nmap -sV --version-intensity 5 192.168.56.102</strong></pre>
<p>You will see we get a nice consolidated output of open ports, service, and the version information:</p>
<div class="CDPAlignCenter CDPAlign"><img height="306" width="388" class="alignnone size-full wp-image-646 image-border" src="assets/8d960d3a-1e3e-486c-8a50-beb3f8a7580c.png"/></div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>If you are interested in learning more about nmap please take a look at <a href="https://nmap.org/nmap_doc.html">https://nmap.org/nmap_doc.html</a>. Also, for all those who would rather use a graphical interface to nmap, there is zenmap. Why don't you open it and try a few scans with it? Lastly, if you want to try a target on the internet for some testing of nmap or zenmap, try it against <a href="http://scanme.nmap.org/">scanme.nmap.org</a>. This site is available as a training aid for you to do scanning as long as you don't get too aggressive with your testing.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Identifying whether there is a web application firewall</h1>
                </header>
            
            <article>
                
<p>We will use <kbd>wafw00f</kbd> to identify whether there is a web application firewall between us and our target website.</p>
<p>Many organizations will use a <strong>Web Application Firewall</strong> (<strong>WAF</strong>) to protect websites from web-specific attack. Understanding that a security device sits between you and your target is extremely important. You will need to obfuscate and avoid detection. You will have to be more targeted and use special techniques to penetrate the website even with the WAF in place.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Let's ensure the following prerequisites:</p>
<ul>
<li>Kali Linux is running and you are logged in as root</li>
<li>Validate the internet connectivity</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>In this recipe we will use <kbd>wafwoof</kbd> to see if there is a web application firewall in our path:</p>
<ol>
<li>Open the terminal screen by clicking on the terminal icon on the top-left corner:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"> <img height="41" width="41" class="alignnone size-full wp-image-366" src="assets/6f28f9f1-68b3-4389-bc1f-874c76808a96.png"/></div>
<ol start="2">
<li>From the main terminal screen, you should be at a Command Prompt of <kbd>root@kali:~#</kbd>.</li>
<li>Let's examine a site without a WAF:</li>
</ol>
<pre style="padding-left: 60px"><strong> wafw00f scanme.nmap.org</strong> </pre>
<ol start="4">
<li>The <kbd>wafw00f</kbd> will provide results showing there was no detection of a WAF protecting <a href="http://scanme.nmap.org/">scanme.nmap.org</a>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="207" width="312" class="alignnone size-full wp-image-648 image-border" src="assets/80506a8b-4684-48b3-95d2-037cb94fef43.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">wafwoof output - no WAF</div>
<ol start="5">
<li>Now, we can examine a site with a WAF using the following command:</li>
</ol>
<pre style="padding-left: 60px"><strong> wafw00f www.example.com</strong></pre>
<ol start="6">
<li>Here, we will see an indication of a WAF protecting the site:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="231" width="470" class="alignnone size-full wp-image-649 image-border" src="assets/8baa20a7-5d9f-4134-aaf7-9c8be8ceb690.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">wafw00f - www.example.com</div>
<ol start="7">
<li>Now, we will examine another site protected by a WAF using the following command:</li>
</ol>
<pre style="padding-left: 60px"><strong> wafw00f example.uk </strong></pre>
<ol start="8">
<li>We will note that a different indication has been triggered:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="207" width="471" class="alignnone size-full wp-image-650 image-border" src="assets/51d39671-23c5-4fcc-9811-5e3e2ba2ebd5.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">wafw00f - example.uk</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using SNMP to gather more information</h1>
                </header>
            
            <article>
                
<p>We can use hosts that we identified through nmap as having open SNMP ports or services running, to try and gather more information.</p>
<p>The <strong>Simple Network Management Protocol</strong> (<strong>SNMP</strong>) is a protocol used to provide status and configuration for various devices including servers, workstations, network appliances, IoT devices, and other hosts. This protocol provides both a read-only and read-write functionality. Quite often, devices have been deployed with read-only available by default. Network administrators will often enable read-write access for management purposes. The default passwords for SNMP on many devices is public for a read-only access and private for a read-write access. There are three types of SNMPs. While version 1 has been mostly deprecated, version 2 is still quite common, and version 3 is gaining in use due to it's better security and authentication system. We will focus on version 2 for this testing</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Let's ensure the following prerequisites:</p>
<ul>
<li>Kali Linux is running and you are logged in as root</li>
<li>Validate internet connectivity</li>
<li>Resolve the IP address of <kbd>demo.snmplabs.com</kbd> (at the time of the writing this book, it was <kbd>104.236.166.95</kbd>)</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<ol>
<li>Open the terminal screen by clicking on the terminal icon on the top-left corner:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"> <img height="41" width="41" class="alignnone size-full wp-image-651" src="assets/73431fd7-0143-486c-aca3-11d22f79f9c9.png"/></div>
<ol start="2">
<li>From the main terminal screen, you should be at a Command Prompt of <kbd>root@kali:~#</kbd>.</li>
</ol>
<ol start="3">
<li>Perform a simple scan of the target device using <kbd>snmp-check</kbd>. By default, many SNMP implementation uses public and private as default SNMP passwords. If we know the password or can guess it, we can substitute it for the default <kbd>public</kbd> in the following command:</li>
</ol>
<pre style="padding-left: 60px"><strong>snmp-check -v2c -c public 104.236.166.95</strong></pre>
<ol start="4">
<li>Looking at the output we see a significant amount of information was displayed about the host. There is network interface information, routing information, services running and TCP/UDP ports open, as well as a variety of system information:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="326" width="396" class="alignnone size-full wp-image-652 image-border" src="assets/2fb90ac2-4080-493e-b512-2ed3ee8d66e9.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">snmp-check - command output</div>
<ol start="5">
<li>In the case where we may not know the credentials used for SNMP, we can attempt to use a dictionary attack against the host to guess the credentials using <kbd>onesixtyone</kbd>:</li>
</ol>
<pre style="padding-left: 60px"><strong> onesixtyone -c /usr/share/doc/onesixtyone/dict.txt 104.236.166.95</strong></pre>
<ol start="6">
<li>You will notice the output from the commands show that both public and private are available for the host. We used the built in dictionary file provided with <kbd>onesixtyone</kbd>. It's important to note that this only has a few potential passwords in it:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="48" width="485" class="alignnone size-full wp-image-653 image-border" src="assets/54029838-39b7-4104-99ec-eb565b818eeb.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">onesixtyone - command output</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>There are a variety of dictionary files that provide more complete password lists that will give you an increased chance of discovering the appropriate passwords for the host in question. Check out <a href="https://github.com/danielmiessler/SecLists/tree/master/Miscellaneous">https://github.com/danielmiessler/SecLists/tree/master/Miscellaneous</a>. </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>


            </article>

            
        </section>
    </body></html>