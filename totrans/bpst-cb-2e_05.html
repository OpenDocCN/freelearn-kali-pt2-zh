<html><head></head><body>
		<div id="_idContainer332">
			<h1 id="_idParaDest-103" class="chapter-number"><a id="_idTextAnchor269"/>5</h1>
			<h1 id="_idParaDest-104"><a id="_idTextAnchor270"/>Assessing Authorization Checks</h1>
			<p>This chapter covers the basics of authorization, including an explanation of how an application uses roles to determine user functions. Web penetration testing involves key assessments to determine how well the application validates functions assigned to a given role or individual user, and we will learn how to use Burp Suite to perform <span class="No-Break">these tests.</span></p>
			<p><a id="_idTextAnchor271"/>In this chapter, we will cover the <span class="No-Break">following recipes:</span></p>
			<ul>
				<li>Testing for <span class="No-Break">directory traversal</span></li>
				<li>Testing for <strong class="bold">Local File </strong><span class="No-Break"><strong class="bold">Inclusion</strong></span><span class="No-Break"> (</span><span class="No-Break"><strong class="bold">LFI</strong></span><span class="No-Break">)</span></li>
				<li>Testing for <strong class="bold">Remote File </strong><span class="No-Break"><strong class="bold">Inclusion</strong></span><span class="No-Break"> (</span><span class="No-Break"><strong class="bold">RFI</strong></span><span class="No-Break">)</span></li>
				<li>Testing for <span class="No-Break">privilege escalation</span></li>
				<li>Testing for <strong class="bold">Insecure Direct Object <a id="_idTextAnchor272"/></strong><span class="No-Break"><strong class="bold">Reference</strong></span><span class="No-Break"> (</span><span class="No-Break"><strong class="bold">IDOR</strong></span><span class="No-Break">)</span></li>
			</ul>
			<h1 id="_idParaDest-105"><a id="_idTextAnchor273"/>Technical requirements</h1>
			<p>To complete the recipes in this chapter, you will need <span class="No-Break">the following:</span></p>
			<ul>
				<li>OWASP <strong class="bold">Broken Web Applications</strong> (<strong class="bold">BWA</strong>) VM: the OWASP <span class="No-Break">Mutillidae application</span></li>
				<li>Burp Suite Proxy Community or <span class="No-Break">Professional (</span><span class="No-Break">https://portswigger.net/burp/</span><span class="No-Break">)</span></li>
				<li>The use of a PortSwigger account to access Web Security <span class="No-Break">Academy (</span><a href="https://portswigger.net/web-security/all-labs"><span class="No-Break">https://portswigger.net/web-security/all-labs</span></a><span class="No-Break">)</span></li>
				<li>A Firefox browser configured to allow Burp Suite to proxy <span class="No-Break">traffic (</span><a href="https://www.mozilla.org/en-US/firefox/new/"><span class="No-Break">https://www.mozilla.org/en-US/firefox/new/</span></a><span class="No-Break">)</span></li>
				<li>The <strong class="source-inline">wfuzz</strong> wordlist repository from <span class="No-Break">GitHub (</span><a href="https://github.com/xmendez/wfuzz"><span class="No-Break">https://github.com/xmendez/wfuzz</span></a><span class="No-Break">)</span></li>
			</ul>
			<h1 id="_idParaDest-106"><a id="_idTextAnchor274"/>Testing for directory traversal</h1>
			<p>Directory traversal<a id="_idIndexMarker363"/> attacks are attempts to discover or force-browse unauthorized web pages usually designed for administrators of the application. If an application does not configure the web document root properly and does not include proper authorization checks on the server side for each page accessed, a directory traversal vulnerability may exist. This type of weakness allows an attack to perform system command injection exploitation or arbitrary <span class="No-Break">code execution<a id="_idTextAnchor275"/>.</span><a id="_idTextAnchor276"/></p>
			<h2 id="_idParaDest-107"><a id="_idTextAnchor277"/>Getting ready</h2>
			<p>Using OWASP Mutillidae II as our target application, let’s determine whether it contains any directory <span class="No-Break">traversal vulnerabilities.</span><a id="_idTextAnchor278"/></p>
			<p>Ensure that Burp Suite and the OWASP BWA VM are running, that Burp Suite is configured in the Firefox browser (or use the Burp Suite browser), and that you are viewing the OWASP <span class="No-Break">BWA applications.</span><a id="_idTextAnchor279"/></p>
			<h2 id="_idParaDest-108"><a id="_idTextAnchor280"/>How to do it...</h2>
			<ol>
				<li>From the OWASP BWA landing page, click the link to the OWASP Mutillidae <span class="No-Break">II application.</span></li>
				<li>Open the login screen of OWASP Mutillidae II in the Firefox browser. From the top menu, <span class="No-Break">click </span><span class="No-Break"><strong class="bold">Login</strong></span><span class="No-Break">.</span></li>
				<li>Find the request you just performed within the <strong class="bold">Proxy</strong> | <strong class="bold">HTTP history</strong> table. Look for the call to the <strong class="source-inline">login.php</strong> page. Highlight the message, move your cursor into the <strong class="bold">Raw</strong> tab of the <strong class="bold">Request</strong> tab, right-click, and click on <strong class="bold">Send </strong><span class="No-Break"><strong class="bold">to Intruder</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer294" class="IMG---Figure">
					<img src="image/B21173_Figure_5.01.jpg" alt="Figure 5.1 – Send to Intruder﻿"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.1 – Send to Intruder</p>
			<ol>
				<li value="4">Switch over <a id="_idIndexMarker364"/>to the <strong class="bold">Intruder</strong> | <strong class="bold">Positions</strong> tab and clear all Burp-defined payload markers by clicking the <strong class="bold">Clear $</strong> button on the <span class="No-Break">right-hand side.</span></li>
				<li>Highlight the value currently stored in the <strong class="source-inline">page</strong> parameter (<strong class="source-inline">login.php</strong>), and place a payload marker around it using the <strong class="bold">Add §</strong> <span class="No-Break">button:</span></li>
			</ol>
			<div>
				<div id="_idContainer295" class="IMG---Figure">
					<img src="image/B21173_Figure_5.02.jpg" alt="Figure 5.2 – Intruder | Positions tab"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.2 – Intruder | Positions tab</p>
			<ol>
				<li value="6">Continue to <a id="_idIndexMarker365"/>the <strong class="bold">Intruder</strong> | <strong class="bold">Payloads</strong> tab and select the following wordlist from the <strong class="source-inline">wfuzz</strong> repository: <strong class="source-inline">admin-panels.txt</strong>. The location of the wordlist from the GitHub repository follows this folder <span class="No-Break">structure: </span><span class="No-Break"><strong class="source-inline">wfuzz/wordlist/general/admin-panels.txt</strong></span><span class="No-Break">.</span></li>
				<li>Click the <strong class="bold">Load</strong> button within the <strong class="bold">Payload Options [Simple list]</strong> section of the <strong class="bold">Intruder</strong> | <strong class="bold">Payloads</strong> tab and a popup will display, prompting for the location of <span class="No-Break">your wordlist.</span></li>
				<li>Browse to the location at which you downloaded the <strong class="source-inline">wfuzz</strong> repository from GitHub. Continue to search through the <strong class="source-inline">wfuzz</strong> folder structure (<strong class="source-inline">wfuzz/wordlist/general/</strong>) until you reach the <strong class="source-inline">admin-panels.txt</strong> file, then select the file, and <span class="No-Break">click </span><span class="No-Break"><strong class="bold">Open</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer296" class="IMG---Figure">
					<img src="image/B21173_Figure_5.03.jpg" alt="Figure 5.3 – Wordlist loading"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.3 – Wordlist loading</p>
			<ol>
				<li value="9">Scroll to the bottom <a id="_idIndexMarker366"/>and uncheck (by default, it is checked) the <strong class="bold">URL-encode these </strong><span class="No-Break"><strong class="bold">characters</strong></span><span class="No-Break"> option:</span></li>
			</ol>
			<div>
				<div id="_idContainer297" class="IMG---Figure">
					<img src="image/B21173_Figure_5.04.jpg" alt="Figure 5.4 – Uncheck the payload encoding box"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.4 – Uncheck the payload encoding box</p>
			<ol>
				<li value="10">You are now ready to begin the attack. Click the <strong class="bold">Start attack</strong> button in the top right-hand corner of the <strong class="bold">Intruder</strong> | <span class="No-Break"><strong class="bold">Positions</strong></span><span class="No-Break"> page.</span></li>
				<li>The attack results table will appear. Allow the attacks to complete. There are 137 payloads in the <strong class="source-inline">admin-panels.txt</strong> wordlist. Sort on the <strong class="bold">Length</strong> column from ascending to descending order to see which of the payloads hit a <span class="No-Break">web page.</span></li>
			</ol>
			<p>Notice the payloads that have larger response lengths. This looks promising! Perhaps we have stumbled upon administration pages that may contain fingerprinting information or <span class="No-Break">unauthorized access:</span></p>
			<div>
				<div id="_idContainer298" class="IMG---Figure">
					<img src="image/B21173_Figure_5.05.jpg" alt="Figure 5.5 – Results table"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.5 – Results table</p>
			<ol>
				<li value="12">Select one of the<a id="_idIndexMarker367"/> pages found in the list with the largest lengths 99,000+, such as <strong class="source-inline">admin.php</strong>. From the attack results table, look at the <strong class="bold">Response</strong> | <strong class="bold">Render</strong> tab, and notice the page displays the PHP version and the <span class="No-Break">system information:</span></li>
			</ol>
			<div>
				<div id="_idContainer299" class="IMG---Figure">
					<img src="image/B21173_Figure_5.06.jpg" alt="Figure 5.6 – One successful result replayed in Repeater"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.6 – One successful result replayed in Repeater</p>
			<h2 id="_idParaDest-109"><a id="_idTextAnchor281"/>H<a id="_idTextAnchor282"/>ow it works...</h2>
			<p>Without even being logged in, we were able to force-browse to an unmapped area of the web application. The term <em class="italic">unmapped</em> means the application itself had no direct link to this secret<a id="_idIndexMarker368"/> configuration page. However, using Burp Suite Intruder and a wordlist containing commonly known administration file names, we were able to discover the page using the directory <span class="No-Break">traversal attack.</span><a id="_idTextAnchor283"/></p>
			<h1 id="_idParaDest-110"><a id="_idTextAnchor284"/>Testing for LFI</h1>
			<p>Web servers control<a id="_idIndexMarker369"/> access to privileged files and resources using configuration settings. Privileged files include files that should only be accessible to system administrators – for example, the <strong class="source-inline">/etc/passwd</strong> file on Unix-like platforms or the <strong class="source-inline">boot.ini</strong> file on <span class="No-Break">Windows systems.</span></p>
			<p>An <strong class="bold">LFI</strong> attack is an <a id="_idIndexMarker370"/>attempt to access privileged files using directory traversal attacks. LFI <a id="_idIndexMarker371"/>attacks<a id="_idIndexMarker372"/> include<a id="_idIndexMarker373"/> different<a id="_idIndexMarker374"/> styles, including <strong class="bold">dot-dot-slash attacks</strong> (<strong class="bold">../</strong>), <strong class="bold">directory brute-forcing</strong>, <strong class="bold">directory climbing</strong>, <span class="No-Break">or </span><span class="No-Break"><strong class="bold">backtra<a id="_idTextAnchor285"/>c<a id="_idTextAnchor286"/>king</strong></span><span class="No-Break">.</span></p>
			<h2 id="_idParaDest-111"><a id="_idTextAnchor287"/>Getting ready</h2>
			<p>Using OWASP Mutillidae II as our target application, let’s determine whether it contains any <span class="No-Break">LFI vulnerabilities.</span></p>
			<p>Ensure Burp Suite and OWASP BWA VM are running and that Burp Suite is configured in the Firefox browser used to view the OWASP <span class="No-Break">BWA applica<a id="_idTextAnchor288"/>t<a id="_idTextAnchor289"/>ions.</span></p>
			<h2 id="_idParaDest-112"><a id="_idTextAnchor290"/>How to do it...</h2>
			<ol>
				<li>From the OWASP BWA Landing page, click the link to the OWASP Mutillidae <span class="No-Break">II application.</span></li>
				<li>Open the login screen of OWASP Mutillidae II in the Firefox browser. From the top menu, <span class="No-Break">click </span><span class="No-Break"><strong class="bold">Login</strong></span><span class="No-Break">.</span></li>
				<li>Find the request you just performed within the <strong class="bold">Proxy</strong> | <strong class="bold">HTTP history</strong> table. Look for the call to the <strong class="source-inline">login.php</strong> page. Highlight the message, move your cursor into the <strong class="bold">Raw</strong> tab of the <strong class="bold">Request</strong> tab, right-click, and select <strong class="bold">Send </strong><span class="No-Break"><strong class="bold">to Intruder</strong></span><span class="No-Break">.</span></li>
				<li>Switch over to the <strong class="bold">Intruder</strong> | <strong class="bold">Positions</strong> tab and clear all Burp-defined payload markers by clicking the <strong class="bold">Clear §</strong> button on the <span class="No-Break">right-hand side.</span></li>
				<li>Highlight the value currently stored in the <strong class="source-inline">page</strong> parameter (<strong class="source-inline">login.php</strong>) and place a payload marker around it using the <strong class="bold">Add §</strong> button on the <span class="No-Break">right-hand side.</span></li>
				<li>Continue to <a id="_idIndexMarker375"/>the <strong class="bold">Intruder</strong> | <strong class="bold">Payloads</strong> tab. Select the following wordlist from the <strong class="source-inline">wfuzz</strong> repository: <strong class="source-inline">Traversal.txt</strong>. The location of the wordlist from the GitHub repository follows this folder <span class="No-Break">structure: </span><span class="No-Break"><strong class="source-inline">wfuzz/wordlist/injections/Traversal.txt</strong></span><span class="No-Break">.</span></li>
				<li>Click the <strong class="bold">Load</strong> button within the <strong class="bold">Payload Options [Simple list]</strong> section of the <strong class="bold">Intruder</strong> | <strong class="bold">Payloads</strong> tab. A popup will display, prompting for the location of <span class="No-Break">your wordlist.</span></li>
				<li>Browse to the location at which you downloaded the <strong class="source-inline">wfuzz</strong> repository from GitHub. Continue to search through the <strong class="source-inline">wfuzz</strong> folder structure until you reach the <strong class="source-inline">Traversal.txt</strong> file. Select the file and <span class="No-Break">click </span><span class="No-Break"><strong class="bold">Open</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer300" class="IMG---Figure">
					<img src="image/B21173_Figure_5.07.jpg" alt="Figure 5.7 – Wordlist loading"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.7 – Wordlist loading</p>
			<ol>
				<li value="9">Scroll to the bottom <a id="_idIndexMarker376"/>and uncheck (by default, it is checked) the <strong class="bold">URL-encode these </strong><span class="No-Break"><strong class="bold">characters</strong></span><span class="No-Break"> option.</span></li>
				<li>You are now ready to begin the attack. Click the <strong class="bold">Start attack</strong> button at the top-right-hand corner of the <strong class="bold">Intruder</strong> | <span class="No-Break"><strong class="bold">Positions</strong></span><span class="No-Break"> page.</span></li>
				<li>The attack results table will appear. Allow the attacks to complete. Sort on the <strong class="bold">Length</strong> column from ascending to descending order to see which of the payloads hit a web page. Notice the payloads with larger lengths; perhaps we gained unauthorized access to the system <span class="No-Break">configuration files!</span></li>
			</ol>
			<div>
				<div id="_idContainer301" class="IMG---Figure">
					<img src="image/B21173_05_008.jpg" alt="Figure 5.8 – Results table snippet"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.8 – Results table snippet</p>
			<ol>
				<li value="12">Select request <strong class="bold">2</strong> in the list. From the attack results table, look at the <strong class="bold">Response</strong> | <strong class="bold">Render</strong> tab and notice the page displays the contents of the host file from the system! Alternatively, you can also send the request to <strong class="bold">Repeater</strong> and replay the attack to <a id="_idIndexMarker377"/>see the <span class="No-Break">same result.</span></li>
			</ol>
			<div>
				<div id="_idContainer302" class="IMG---Figure">
					<img src="image/B21173_05_009.jpg" alt="Figure 5.9 – One successful result replayed in Rep﻿﻿eater"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.9 – One successful result replayed in Rep<a id="_idTextAnchor291"/><a id="_idTextAnchor292"/>eater</p>
			<h2 id="_idParaDest-113"><a id="_idTextAnchor293"/>How it works...</h2>
			<p>Due to poorly protected file permissions and a lack of application authorization checks, attackers can read privileged local files on a system containing sensitive information. The danger behind LFI vulnerabilities is the discovery of secrets, API keys, source code, and configuration files. Revelations <a id="_idIndexMarker378"/>of these kinds have the potential to lead to remote code execution, system account takeovers, or even pivoting to other machines across <span class="No-Break">the ne<a id="_idTextAnchor294"/>t<a id="_idTextAnchor295"/>work.</span></p>
			<h1 id="_idParaDest-114"><a id="_idTextAnchor296"/>Testing for RFI</h1>
			<p><strong class="bold">RFI</strong> is an attack that<a id="_idIndexMarker379"/> attempts to access external URLs and remotely located files. This kind of attack is possible due to parameter manipulation, a lack of server-side checks, and a lack of whitelisting for outbound traffic at the firewall level. These oversights may lead to data exfiltration of user information to external servers controlled by <span class="No-Break">an a<a id="_idTextAnchor297"/>t<a id="_idTextAnchor298"/>tacker.</span></p>
			<h2 id="_idParaDest-115"><a id="_idTextAnchor299"/>Getting ready</h2>
			<p>Using OWASP Mutillidae II as our target application, let’s determine whether it contains any <span class="No-Break">RFI vulnerabi<a id="_idTextAnchor300"/>lities.</span></p>
			<p>Ensure Burp Suite and OWASP BWA VM are running and that Burp Suite is configured in the Firefox browser used to view the OWASP <span class="No-Break">BWA applic<a id="_idTextAnchor301"/>ations.</span></p>
			<h2 id="_idParaDest-116"><a id="_idTextAnchor302"/>How to do it...</h2>
			<ol>
				<li>From the OWASP BWA landing page, click the link to the OWASP Mutillidae <span class="No-Break">II application.</span></li>
				<li>Open the login screen of OWASP Mutillidae II in the Firefox browser. From the top menu, <span class="No-Break">click </span><span class="No-Break"><strong class="bold">Login</strong></span><span class="No-Break">.</span></li>
				<li>Find the request you just performed within the <strong class="bold">Proxy</strong> | <strong class="bold">HTTP history</strong> table. Look for the call to the <span class="No-Break"><strong class="source-inline">login.php</strong></span><span class="No-Break"> page:</span></li>
			</ol>
			<div>
				<div id="_idContainer303" class="IMG---Figure">
					<img src="image/B21173_05_010.jpg" alt="Figure 5.10 – Finding the POST login request"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.10 – Finding the POST login request</p>
			<ol>
				<li value="4">Make a note <a id="_idIndexMarker380"/>of the <strong class="source-inline">page</strong> parameter that determines the page <span class="No-Break">to load:</span></li>
			</ol>
			<div>
				<div id="_idContainer304" class="IMG---Figure">
					<img src="image/B21173_05_011.jpg" alt="Figure 5.11 – Note the page parameter"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.11 – Note the page parameter</p>
			<p>Let’s see whether we can exploit this parameter by providing a URL that is outside the application. For demonstration purposes, we will use a URL that we control in the OWASP BWA VM. However, in the wild, this URL would be <span class="No-Break">attacker-controlled instead.</span></p>
			<ol>
				<li value="5">Switch to the <strong class="bold">Proxy</strong> | <strong class="bold">Intercept</strong> tab, and press the <strong class="bold">Intercept is </strong><span class="No-Break"><strong class="bold">on</strong></span><span class="No-Break"> button.</span></li>
				<li>Return to the Firefox or Burp Suite browse, and reload the login page. The request is paused and contained within the <strong class="bold">Proxy</strong> | <span class="No-Break"><strong class="bold">Intercept</strong></span><span class="No-Break"> tab:</span></li>
			</ol>
			<div>
				<div id="_idContainer305" class="IMG---Figure">
					<img src="image/B21173_05_012.jpg" alt="Figure 5.12 – Proxy | Intercept is on"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.12 – Proxy | Intercept is on</p>
			<ol>
				<li value="7">Now let’s manipulate<a id="_idIndexMarker381"/> the value of the <strong class="source-inline">page</strong> parameter from <strong class="source-inline">login.php</strong> to a URL that is external to the application. Let’s use the login page to<a id="_idIndexMarker382"/> the <strong class="bold">GetBoo</strong> application. Your URL will be specific to your machine’s IP address, so adjust accordingly. The new URL will <span class="No-Break">be </span><span class="No-Break"><strong class="source-inline">http://&lt;your_IP_address&gt;/getboo/</strong></span><span class="No-Break">.</span></li>
				<li>Reload the login page in your browser that is sending traffic to Burp Suite by clicking the <em class="italic">refresh</em> button or pressing <em class="italic">F5</em>. You may also wish to click the <strong class="bold">Login/Register</strong> <span class="No-Break">button again.</span></li>
			</ol>
			<div>
				<div id="_idContainer306" class="IMG---Figure">
					<img src="image/B21173_05_013.jpg" alt="Figure 5.13 – Clicking the Login/Register button"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.13 – Clicking the Login/Register button</p>
			<ol>
				<li value="9">Notice the request is held up in <strong class="bold">Proxy</strong> | <strong class="bold">Intercept</strong>. You may need to click the <strong class="bold">Forward</strong> button until you reach the <strong class="source-inline">GET /multillidae/index.php?page=login.php</strong> request. Now we can manipulate the <a id="_idIndexMarker383"/>values before sending the request to the <span class="No-Break">web server:</span></li>
			</ol>
			<div>
				<div id="_idContainer307" class="IMG---Figure">
					<img src="image/B21173_05_014.jpg" alt="Figure 5.14 – Login request captured in Proxy Intercept"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.14 – Login request captured in Proxy Intercept</p>
			<ol>
				<li value="10">Let’s start manipulating the parameters by replacing the <strong class="source-inline">login.php</strong> value with <strong class="source-inline">http://&lt;your_IP_address&gt;/getboo/</strong> and clicking the <span class="No-Break"><strong class="bold">Forward</strong></span><span class="No-Break"> button:</span></li>
			</ol>
			<div>
				<div id="_idContainer308" class="IMG---Figure">
					<img src="image/B21173_05_015.jpg" alt="Figure 5.15 – Redirecting the user to the GetBoo application"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.15 – Redirecting the user to the GetBoo application</p>
			<ol>
				<li value="11">Now press <strong class="bold">Intercept is on</strong> again<a id="_idIndexMarker384"/> to toggle the intercept button to off<strong class="bold"> </strong>(<strong class="bold">Intercept </strong><span class="No-Break"><strong class="bold">is off</strong></span><span class="No-Break">).</span></li>
				<li>Return to the Firefox browser and notice the page loaded is the <strong class="bold">GetBoo</strong> index page within the context of the <span class="No-Break">Mutillidae application!</span></li>
			</ol>
			<div>
				<div id="_idContainer309" class="IMG---Figure">
					<img src="image/B21173_05_016.jpg" alt="Figure 5.16 – Evidence of a successful re﻿dire﻿ction"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.16 – Evidence of a successful re<a id="_idTextAnchor303"/>dire<a id="_idTextAnchor304"/>ction</p>
			<h2 id="_idParaDest-117"><a id="_idTextAnchor305"/>How it works...</h2>
			<p>The <strong class="source-inline">page</strong> parameter does not include proper data validation to ensure the values provided are whitelisted or contained in a prescribed list of acceptable values. By exploiting this<a id="_idIndexMarker385"/> weakness, we can dictate values to this parameter, redirecting our victim to a page of our choice, or worse, data exfiltration cookie information and scrape sensitive data from our victim’s <span class="No-Break">browser s<a id="_idTextAnchor306"/>e<a id="_idTextAnchor307"/>ssion.</span></p>
			<h1 id="_idParaDest-118"><a id="_idTextAnchor308"/>Testing for privilege escalation</h1>
			<p>Developer code in an<a id="_idIndexMarker386"/> application must include authorization checks on assigned roles to ensure an authorized user is not able to elevate their role to a higher privilege. As an attacker, frequent targets for accessing elevated functionality include parameter tampering, forced browsing, and authentication bypass. These types of privilege escalation attacks may potentially occur by modifying the value of an assigned role or parameter value and replacing that value with another. If the attack is successful, the bad actor gains unauthorized access to resources or functionality normally restricted to administrators or more <span class="No-Break">powerful a<a id="_idTextAnchor309"/>c<a id="_idTextAnchor310"/>counts.</span></p>
			<h2 id="_idParaDest-119"><a id="_idTextAnchor311"/>Getting ready</h2>
			<p>Let’s use the <em class="italic">Privilege escalation via server-side prototype pollution</em> PortSwigger lab, which is located in the <em class="italic">Prototype pollution</em> section of <em class="italic">All labs</em>, as our target application. We will attempt to find a weakness in the Node.js inheritance hierarchy to elevate our privileges within <span class="No-Break">the appli<a id="_idTextAnchor312"/>cation.</span></p>
			<p>Log in to your PortSwigger account and navigate to the following URL: <a href="https://portswigger.net/web-security/prototype-pollution/server-side/lab-privilege-escalation-via-server-side-prototype-pollution">https://portswigger.net/web-security/prototype-pollution/server-side/lab-privilege-escalation-via-server-side-prototype-pollution</a>. Ensure Burp Suite is running and sending traffic through either Firefox or the Burp <span class="No-Break">Suite b<a id="_idTextAnchor313"/>rowser.</span></p>
			<h2 id="_idParaDest-120"><a id="_idTextAnchor314"/>How to do it...</h2>
			<ol>
				<li>From the <em class="italic">Lab: Privilege escalation via server-side prototype pollution</em> landing page, click the link entitled <strong class="bold">Access the lab</strong>. If you do not see the <strong class="bold">Access the lab</strong> button, make sure you are logged in to your <span class="No-Break">PortSwigger account.</span></li>
			</ol>
			<div>
				<div id="_idContainer310" class="IMG---Figure">
					<img src="image/B21173_05_017.jpg" alt="Figure 5.17 – Starting the PortSwigger lab instance"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.17 – Starting the PortSwigger lab instance</p>
			<ol>
				<li value="2">A new tab will <a id="_idIndexMarker387"/>open in your browser and a unique instance of the lab will start up just for you. Your URL will be unique, thus different from the one shown in the <span class="No-Break">following screenshot.</span></li>
			</ol>
			<div>
				<div id="_idContainer311" class="IMG---Figure">
					<img src="image/B21173_05_018.jpg" alt="Figure 5.18 – Instance of the lab running"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.18 – Instance of the lab running</p>
			<ol>
				<li value="3">With traffic running through Burp, log in to the application instance by clicking the <strong class="bold">My account</strong> link on the top right-hand side. You will be presented with a <span class="No-Break">login page.</span></li>
			</ol>
			<div>
				<div id="_idContainer312" class="IMG---Figure">
					<img src="image/B21173_05_019.jpg" alt="Figure 5.19 – Login page"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.19 – Login page</p>
			<ol>
				<li value="4">Credentials are<a id="_idIndexMarker388"/> provided in the lab description and solution, which are username <strong class="source-inline">wiener</strong> and password <strong class="source-inline">peter</strong>. Log in to the application. After logging in, you will be presented with a profile page. Update the address field with a number or additional letter <span class="No-Break">and submit.</span></li>
			</ol>
			<div>
				<div id="_idContainer313" class="IMG---Figure">
					<img src="image/B21173_05_020.jpg" alt="Figure 5.20 – Profile landing page"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.20 – Profile landing page</p>
			<ol>
				<li value="5">Switch to <a id="_idIndexMarker389"/>Burp’s <strong class="bold">Proxy</strong> | <strong class="bold">HTTP history</strong> tab. Find the <strong class="source-inline">POST</strong> request you just made on the profile page to update <span class="No-Break">the address:</span></li>
			</ol>
			<div>
				<div id="_idContainer314" class="IMG---Figure">
					<img src="image/B21173_05_021.jpg" alt="Figure 5.21 – Finding the address change POST request in the Proxy HTTP history table"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.21 – Finding the address change POST request in the Proxy HTTP history table</p>
			<ol>
				<li value="6">Right-click and<a id="_idIndexMarker390"/> select <strong class="bold">Send </strong><span class="No-Break"><strong class="bold">to Repeater</strong></span><span class="No-Break">:</span></li>
			</ol>
			<div>
				<div id="_idContainer315" class="IMG---Figure">
					<img src="image/B21173_05_022.jpg" alt="Figure 5.22 – Send to Repeater"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.22 – Send to Repeater</p>
			<ol>
				<li value="7">In <strong class="bold">Repeater</strong>, add a prototype property of <strong class="source-inline">__proto__</strong> to the JSON <strong class="source-inline">POST</strong> body. Inside the new property, add a fake name/value pair. If you place the following prototype property at the beginning or middle of the existing JSON body, you must add a comma; otherwise, you will receive a JSON <span class="No-Break">parsing error:</span><pre class="source-code">
"__proto__": {
    "foo":"bar"
},</pre></li>			</ol>
			<p>This is shown in the <span class="No-Break">following screenshot:</span></p>
			<div>
				<div id="_idContainer316" class="IMG---Figure">
					<img src="image/B21173_05_023.jpg" alt="Figure 5.23 – Adding a prototype into the JSON body of the POST request"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.23 – Adding a prototype into the JSON body of the POST request</p>
			<ol>
				<li value="8">Send the<a id="_idIndexMarker391"/> request. Note the response is still valid. Also, notice there is a property in the JSON response called <strong class="source-inline">"</strong><span class="No-Break"><strong class="source-inline">isAdmin": false</strong></span><span class="No-Break">.</span></li>
			</ol>
			<div>
				<div id="_idContainer317" class="IMG---Figure">
					<img src="image/B21173_05_024.jpg" alt="Figure 5.24 – Note the isAdmin parameter in the response"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.24 – Note the isAdmin parameter in the response</p>
			<ol>
				<li value="9">Let’s use a prototype<a id="_idIndexMarker392"/> pollution attack to change this value from <strong class="source-inline">false</strong> to <strong class="source-inline">true</strong>. Add the property of <strong class="source-inline">"isAdmin":"true"</strong> to the request where <strong class="source-inline">"foo":"bar"</strong> originally was within the prototype <strong class="source-inline">"</strong><span class="No-Break"><strong class="source-inline">__proto__"</strong></span><span class="No-Break"> object.</span></li>
			</ol>
			<div>
				<div id="_idContainer318" class="IMG---Figure">
					<img src="image/B21173_05_025.jpg" alt="Figure 5.25 – Manipulating the isAdmin parameter in the request"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.25 – Manipulating the isAdmin parameter in the request</p>
			<ol>
				<li value="10">Send the request and<a id="_idIndexMarker393"/> notice the response now reflects the change. We just elevated our privileges to an admin! Return to the browser and refresh the <strong class="source-inline">/my-account</strong> page. Notice you now have an <strong class="bold">Admin panel</strong> <span class="No-Break">link available:</span></li>
			</ol>
			<div>
				<div id="_idContainer319" class="IMG---Figure">
					<img src="image/B21173_05_026.jpg" alt="Figure 5.26 – Access to Admin panel is now available"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.26 – Access to Admin panel is now available</p>
			<ol>
				<li value="11">To solve this lab, click the <strong class="bold">Admin panel</strong> link. On the subsequent page, delete the <span class="No-Break">account </span><span class="No-Break"><strong class="source-inline">carlos</strong></span><span class="No-Break">.</span></li>
			</ol>
			<div>
				<div id="_idContainer320" class="IMG---Figure">
					<img src="image/B21173_05_027.jpg" alt="Figure 5.27 – Delete Carlos’ account"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.27 – Delete Carlos’ account</p>
			<ol>
				<li value="12">You should see<a id="_idIndexMarker394"/> the curtain display confirming you’ve solved <span class="No-Break">the lab.</span></li>
			</ol>
			<div>
				<div id="_idContainer321" class="IMG---Figure">
					<img src="image/B21173_05_028.jpg" alt="Figure 5.28 – Lab is so﻿l﻿ved"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.28 – Lab is so<a id="_idTextAnchor315"/>l<a id="_idTextAnchor316"/>ved</p>
			<h2 id="_idParaDest-121"><a id="_idTextAnchor317"/>How it works...</h2>
			<p>In this recipe, we, as attackers, took advantage of a potential weakness in Node.js objects known as prototype pollution. Each object constructed in Node.js uses a prototype from which objects inherit characteristics and behaviors. If an attack can <em class="italic">pollute</em> the top of the object hierarchy, then all the objects constructed from that polluted prototype can <a id="_idIndexMarker395"/>be manipulated. By adding <strong class="source-inline">"__proto__"</strong> to the <strong class="source-inline">POST</strong> JSON body, we found the presence of this weakness and exploited it to elevate our privileges to <span class="No-Break">an administra<a id="_idTextAnchor318"/>t<a id="_idTextAnchor319"/>or.</span></p>
			<h1 id="_idParaDest-122"><a id="_idTextAnchor320"/>Testing for IDOR</h1>
			<p>Allowing unauthorized <a id="_idIndexMarker396"/>direct access to files or resources on a system based on user-supplied input is known as IDOR. This vulnerability allows us to bypass authorization checks placed on such files or resources. IDOR is a result of unchecked user-supplied input to retrieve an object without performing authorization checks in the <span class="No-Break">application<a id="_idTextAnchor321"/> <a id="_idTextAnchor322"/>code.</span></p>
			<h2 id="_idParaDest-123">Getting <a id="_idTextAnchor323"/>ready</h2>
			<p>Let’s use the <em class="italic">Insecure direct object references</em> PortSwigger lab, which is located in the <em class="italic">Access control</em> section of <em class="italic">All labs</em>, as our target application. We will attempt to find a direct object reference used as a value to a parameter, manipulate it, and access information that should normally not <span class="No-Break">be seen.</span></p>
			<p>Log in to your PortSwigger account and navigate to the following URL: <a href="https://portswigger.net/web-security/access-control/lab-insecure-direct-object-references">https://portswigger.net/web-security/access-control/lab-insecure-direct-object-references</a>. Ensure Burp Suite is running and sending traffic through either Firefox or the Burp <span class="No-Break">Suite bro<a id="_idTextAnchor324"/>wser.</span></p>
			<h2 id="_idParaDest-124"><a id="_idTextAnchor325"/>How to do it...</h2>
			<ol>
				<li>From the <em class="italic">Lab: Insecure direct object references</em> landing page, click the link entitled <strong class="bold">Access the lab</strong>. If you do not see the <strong class="bold">Access the lab</strong> button, make sure you are logged in to your <span class="No-Break">PortSwigger account.</span></li>
			</ol>
			<div>
				<div id="_idContainer322" class="IMG---Figure">
					<img src="image/B21173_05_029.jpg" alt="Figure 5.29 – Starting the lab instance"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.29 – Starting the lab instance</p>
			<ol>
				<li value="2">A new tab will open in your browser and a unique instance of the lab will start up just for you. Your <a id="_idIndexMarker397"/>URL will be unique, thus different from the one shown in the <span class="No-Break">following screenshot.</span></li>
			</ol>
			<div>
				<div id="_idContainer323" class="IMG---Figure">
					<img src="image/B21173_05_030.jpg" alt="Figure 5.30 – Landing page of lab"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.30 – Landing page of lab</p>
			<ol>
				<li value="3">Click the <strong class="bold">Live chat</strong> link in <span class="No-Break">the application.</span></li>
			</ol>
			<div>
				<div id="_idContainer324" class="IMG---Figure">
					<img src="image/B21173_05_031.jpg" alt="Figure 5.31 – The Live chat link"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.31 – The Live chat link</p>
			<ol>
				<li value="4">On the <strong class="bold">Live chat</strong> page, type in a simple message and click <strong class="bold">Send</strong> to send it to the web <span class="No-Break">server backend:</span></li>
			</ol>
			<div>
				<div id="_idContainer325" class="IMG---Figure">
					<img src="image/B21173_05_032.jpg" alt=" Figure 5.32 – Sample message to send"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US"> Figure 5.32 – Sample message to send</p>
			<ol>
				<li value="5">After clicking <a id="_idIndexMarker398"/>the <strong class="bold">Send</strong> button, click the <strong class="bold">View transcript</strong> button. Notice a file is downloaded to your local system containing <span class="No-Break">the conversation.</span></li>
			</ol>
			<div>
				<div id="_idContainer326" class="IMG---Figure">
					<img src="image/B21173_05_033.jpg" alt="Figure 5.33 – Clicking the View transcript button"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.33 – Clicking the View transcript button</p>
			<ol>
				<li value="6">View the downloaded file and see the conversation is captured in the transcript <span class="No-Break">as expected.</span></li>
			</ol>
			<div>
				<div id="_idContainer327" class="IMG---Figure">
					<img src="image/B21173_05_034.jpg" alt="Figure 5.34 – Viewing the downloaded transcript file"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.34 – Viewing the downloaded transcript file</p>
			<ol>
				<li value="7">Switch to Burp’s <strong class="bold">Proxy</strong> | <strong class="bold">HTTP history</strong> tab. Find the <strong class="source-inline">GET</strong> request immediately after the <strong class="source-inline">POST</strong> request to download the file. Notice our filename is a number with the <strong class="source-inline">.txt</strong> extension. What would happen if we changed the value of this number <span class="No-Break">to </span><span class="No-Break"><strong class="source-inline">1</strong></span><span class="No-Break">?</span></li>
			</ol>
			<div>
				<div id="_idContainer328" class="IMG---Figure">
					<img src="image/B21173_05_035.jpg" alt="Figure 5.35 – Seeing the call to retrieve the transcript"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.35 – Seeing the call to retrieve the transcript</p>
			<ol>
				<li value="8">Right-click and <a id="_idIndexMarker399"/>send the request to <strong class="bold">Repeater</strong>. Let’s perform an IDOR attack by manipulating the value assigned to our transcript to the number <strong class="source-inline">1</strong>. Send the request. Notice you can now read the transcript of a different user! Inside the transcript reveals <span class="No-Break">their password!</span></li>
			</ol>
			<div>
				<div id="_idContainer329" class="IMG---Figure">
					<img src="image/B21173_05_036.jpg" alt="Figure 5.36 – Manipulating the filename"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.36 – Manipulating the filename</p>
			<ol>
				<li value="9">Using the password we’ve uncovered, let’s log in using <strong class="source-inline">carlos</strong> as the username and the<a id="_idIndexMarker400"/> password revealed inside the transcript. Click on the <strong class="bold">My account</strong> link to navigate to the login page. Type in the credentials. Note your password may differ from mine since each instance may have <span class="No-Break">different secrets.</span></li>
			</ol>
			<div>
				<div id="_idContainer330" class="IMG---Figure">
					<img src="image/B21173_05_037.jpg" alt="Figure 5.37 – Using the revealed password to log in to Carlos’ account"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.37 – Using the revealed password to log in to Carlos’ account</p>
			<ol>
				<li value="10">After logging in, you should receive the curtain display confirming you’ve solved <span class="No-Break">the lab!</span></li>
			</ol>
			<div>
				<div id="_idContainer331" class="IMG---Figure">
					<img src="image/B21173_05_038.jpg" alt="Figure 5.38 – Lab is solved﻿"/>
				</div>
			</div>
			<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 5.38 – Lab is solved<a id="_idTextAnchor326"/></p>
			<h2 id="_idParaDest-125"><a id="_idTextAnchor327"/>How it works...</h2>
			<p>Due to a lack of<a id="_idIndexMarker401"/> proper authorization checks on the <strong class="source-inline">transcript</strong> filename parameter, we can view the transcript of a completely different user. In this recipe, the transcript contained password information, which we leveraged to perform an account takeover. Mitigation and prevention against this <a id="_idIndexMarker402"/>vulnerability include access controls and checks prior to revealing sensitive files and resources. When these access controls are missing, IDOR vulnerabilities may <span class="No-Break">be present.</span></p>
		</div>
	</body></html>