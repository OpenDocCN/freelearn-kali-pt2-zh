<html><head></head><body>
<div id="sbo-rt-content"><div id="_idContainer025">
<h1 class="chapter-number" id="_idParaDest-14"><a id="_idTextAnchor013"/>1</h1>
<h1 id="_idParaDest-15"><a id="_idTextAnchor014"/>An Introduction to Cybersecurity</h1>
<p>If you’re reading this book, there’s a great chance you’re already familiar with cybersecurity. You might even already have some experience with Linux or even the Kali variant of the Linux <strong class="bold">operating system</strong> (<strong class="bold">OS</strong>). It’s a popular tool used by offensive security<a id="_idIndexMarker000"/> people who are typically referred to as <strong class="bold">red teamers</strong>. <strong class="bold">Offensive security</strong> is when users simulate attacks<a id="_idIndexMarker001"/> to discover potential vulnerabilities within an organization’s technology. However, where there’s offense, there most assuredly is defense. In the world of computers and technology, people working on defensive<a id="_idIndexMarker002"/> security teams are typically referred to as <strong class="bold">blue teamers</strong>. If you’re familiar with the color wheel, then you know that when red is combined with blue, you get purple. Take the utilities of both offense and defense, bundle them as a software application suite added to a popular Linux OS, and there you have it. Welcome to <span class="No-Break">Kali Purple!</span></p>
<p>In this chapter, we’re going to cover the following <span class="No-Break">main topics:</span></p>
<ul>
<li>How we <span class="No-Break">got here</span></li>
<li><span class="No-Break">Offensive security</span></li>
<li><span class="No-Break">Defensive security</span></li>
</ul>
<p>You will get a very brief history of cybersecurity as it relates to the need for such services and how those services relate to Kali Purple. Having this understanding will lay the groundwork for the tool structures and purposes of the utilities commonly found in the Purple distribution. Along the way, you will begin to recognize the revolutionary power of this suite <span class="No-Break">of tools.</span></p>
<p>Those already familiar with the Kali Linux OS will have an idea of some offensive cybersecurity utilities that it contains. For those who don’t, that’s okay! While those with prior Linux experience will more easily recognize some of the concepts that will be talked about, those of us working professionally in the field can attest to several folks who’ve succeeded in the field of cybersecurity with only Windows experience. If that’s you, take comfort in knowing that we will provide a high-level overview in the <em class="italic">Offensive security</em> section, which should provide enough of a foundation for you to easily navigate the rest of this book. How to integrate some of these offensive tools will be discussed much later in <span class="No-Break">this book.</span></p>
<p>Throughout the bulk of the introduction to Kali Purple, the emphasis will be on the blue team tools that have been added to this specific distribution of Linux. As we will with the red team utilities, we will provide a high-level overview up front in this first chapter. You will then see the uniqueness of Kali Purple and be able to visualize how this tool can be used<a id="_idIndexMarker003"/> to set up a fully functioning defensive <strong class="bold">security operations </strong><span class="No-Break"><strong class="bold">center</strong></span><span class="No-Break"> (</span><span class="No-Break"><strong class="bold">SOC</strong></span><span class="No-Break">).</span></p>
<p>By the end of this chapter, you’ll have a well-rounded perspective of how Kali Purple can be used to train analysts within your organization. You will also start to see how this tool can be used for small and at-home businesses or even personal setups to provide a layer of security that otherwise would only be available<a id="_idIndexMarker004"/> as a subscription from a professional <strong class="bold">managed security services </strong><span class="No-Break"><strong class="bold">provider</strong></span><span class="No-Break"> (</span><span class="No-Break"><strong class="bold">MSSP</strong></span><span class="No-Break">).</span></p>
<h1 id="_idParaDest-16"><a id="_idTextAnchor015"/>How we got here</h1>
<p>The need for a technologically<a id="_idIndexMarker005"/> advanced set of computer security tools in the world today is not something that just popped up overnight. There weren’t a couple of college students who decided to hone their coding skills out of boredom between classes. No – the idea of security for computing technology is a concept that evolved in parallel with the <span class="No-Break">technologies themselves.</span></p>
<p>If you wanted to, you could probably find some historical parchment with ancient hieroglyphics or other language painted on it telling stories of the abacus. It might detail how someone, somewhere, managed to trick the ancient Mesopotamians by some art of visual misdirection toward the accountants and then move a bead or two on the abacus. We’ll let the historians determine and tell those stories. We are going to focus on the security of <span class="No-Break">modern computing.</span></p>
<p>During the 1960s and 1970s, computer security was mostly security in the traditional sense of physical protection – that is, security mostly revolved around restricting physical access to mainframe computers. It included access controls such as keypads and locked rooms. Oftentimes, these systems were standalone. They weren’t networked with other systems. When the networking of computer systems began to unfold, it was usually part of a larger project to create the widespread interconnectivity we see in the world today by <a id="_idIndexMarker006"/>an American government agency known as the <strong class="bold">Defense Advanced Research Projects Agency</strong> (<strong class="bold">DARPA</strong>) Sometimes, the D is dropped, and you’ll see<a id="_idIndexMarker007"/> it informally referred to as <strong class="bold">ARPA</strong>. This organization is part of the <strong class="bold">Department of Defense</strong> (<strong class="bold">DOD</strong>) and has earned a reputation<a id="_idIndexMarker008"/> for working on super-secret and interesting projects often dramatized in pop culture. The organization has led research projects leading to cutting-edge advancements in technology. Linking computer systems together is included<a id="_idIndexMarker009"/> in those achievements, with what became known as the <strong class="bold">ARPANET</strong>. The primary purpose of this style of security was to prevent unauthorized individuals from accessing and stealing <span class="No-Break">sensitive information.</span></p>
<p>This began to evolve in the 1980s with the advent<a id="_idIndexMarker010"/> and marketing of personal computers. Though born in the 1970s, Steve Jobs, Steve Wozniak, and Ronald Wayne’s Apple Computer rapidly rose to fame in the early 1980s with the commercial release of their legendary MacIntosh personal computer. It was the first to feature a couple of pieces<a id="_idIndexMarker011"/> of technology that we now know as a <strong class="bold">graphical user interface</strong> (<strong class="bold">GUI</strong>) and a mouse. Also gaining popularity at the time was computer networking and the ability for machines to communicate with each other. During this era, the focus of computer security shifted from physical access restriction toward securing data transmission, establishing secure communication protocols, and data encryption. The first iteration of the <strong class="bold">Data Encryption Standard</strong> (<strong class="bold">DES</strong>) was introduced within this period<a id="_idIndexMarker012"/> to protect data <span class="No-Break">from interception.</span></p>
<p>Apple Computer – now Apple Inc. – was one of the first companies to succeed at the widespread distribution of a personal computer product. However, it was Microsoft Windows’ rise to stardom in the 1990s that dominated the market and made personal computing a household activity. Windows was born in the 1980s, but it was the aptly named Windows 95, released in 1995, that brought forth many of the creature comforts of personal computing we still enjoy today. The exponentially increasing popularity of personal computing during this era gave birth to exponential new challenges and brought forth the roots of cybercrime as we know it today. The term <strong class="bold">hacker</strong>, once a positive term used<a id="_idIndexMarker013"/> to describe the process of making innovative changes to a product, became a negative term associated with miscreants wishing to use technology for their mischief. While there were isolated incidents of mischief and malware in the 1960s and 1970s, not<a id="_idIndexMarker014"/> to mention the infamous <strong class="bold">Morris Worm</strong> of 1988, it was during the 1990s that hackers began to seek out and exploit vulnerabilities within software applications and network architecture on a grander and more mainstream scale. Hackers with coding skills began to use their abilities to create software that caused harm, acted as a nuisance, or did some other dirty deed. While the first antivirus software was created in 1986 by John McAfee, this resulted in the advancement of those earliest versions of antivirus software to become widespread commercially available products. Firewalls were developed to prevent unauthorized<a id="_idIndexMarker015"/> access to endpoints<a id="_idIndexMarker016"/> and the earliest versions of the <strong class="bold">Secure Sockets Layer</strong> (<strong class="bold">SSL</strong>) and <strong class="bold">Transport Layer Security</strong> (<strong class="bold">TLS</strong>) <span class="No-Break">were released.</span></p>
<p>As the world moved into the 21st century, rapidly advancing computer and network technology gave way to e-commerce. This beginning of online shopping and other business transactions created a need for secure payment systems. Afterall, if the bad actors could cause mischief in other areas, anything that might give them access to business or individual’s finances would be ripe for taking! As a result, the major credit card companies<a id="_idIndexMarker017"/> at the time worked to create what is known as the <strong class="bold">Payment Card Industry-Data Security Standard</strong> (<strong class="bold">PCI-DSS</strong>). This standard was meant to create a framework that assisted credit and debit card stakeholders in protecting against fraud. The SSL and TLS from the 1990s became more robust with greater acceptance and more widespread use in the community. Those security principles were designed to encrypt data during communication while covering the confidentiality and integrity<a id="_idIndexMarker018"/> aspects of the Information Security Triad, sometimes called the <strong class="bold">confidentiality, integrity, and availability</strong> (<strong class="bold">CIA</strong>) triad. If you’re not familiar with this foundational framework of cybersecurity, we will talk about it later in this chapter in the <em class="italic">Defensive </em><span class="No-Break"><em class="italic">security</em></span><span class="No-Break"> section.</span></p>
<p>By the mid-2000s, cyberattacks<a id="_idIndexMarker019"/> and data breaches became much more frequent. They were also much more sophisticated. This is where the fun begins. It is the actions of cybercriminals during this era that directly led to the advancement of some of the technologies you will experience in Kali Purple and learn about in this book. There became a greater need to respond to security incidents in real time. Though there were already technologies in place to address this, they were rudimentary at best. Gaining prominence<a id="_idIndexMarker020"/> in the information<a id="_idIndexMarker021"/> security community were concepts such as the <strong class="bold">intrusion detection system</strong> (<strong class="bold">IDS</strong>), <strong class="bold">intrusion prevention system</strong> (<strong class="bold">IPS</strong>), and <strong class="bold">security information and event management</strong> (<strong class="bold">SIEM</strong>) system, among other<a id="_idIndexMarker022"/> things. Each of these concepts is a part of Kali Purple and we will go over them in detail throughout <span class="No-Break">this book.</span></p>
<p>The 2010s improved mobile device and cloud computing technologies by degrees of magnitude. Guess what else grew by degrees of magnitude? You guessed it: new security challenges. Hopefully, you’re beginning to see the trend by now if you haven’t already. There is a parallel between new and emerging technologies and new and emerging threats in the cyber landscape. The security of mobile devices was straightforward, centering around protecting user data, preventing unauthorized access, and securing mobile applications; pretty much the same as it is today. The security of cloud computing was more focused on access<a id="_idIndexMarker023"/> controls, data storage, and protecting <strong class="bold">virtual machines</strong> (<strong class="bold">VMs</strong>). As you navigate the world of Kali Purple, you will see how the tools you’ll learn about are valuable assets for those areas <span class="No-Break">as well.</span></p>
<p>Let’s look at the transition<a id="_idIndexMarker024"/> from physical protection of mainframes to <span class="No-Break">handheld devices:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer010">
<img alt="Figure 1.1 – The evolution of modern cybersecurity" height="324" src="image/B21223_01_1.jpg" width="849"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.1 – The evolution of modern cybersecurity</p>
<p>Up until this point, most of the security in the world of technology was an area of emphasis<a id="_idIndexMarker025"/> that generally fell under the greater <strong class="bold">information technology</strong> (<strong class="bold">IT</strong>) umbrella. Standalone security specialists existed but were much more of a rarity than we see today. It was a series of highly publicized cyberattacks post-2010 that caused the field of cybersecurity to be born as a mainstream career unto itself. Since the entirety of Kali Purple is a suite of tools based upon protecting against cyberattacks, we will briefly look at some of the more prominent attacks so that – as we learn these tools throughout this book – we can refer to this section and mentally paste together the value, need, and –above all – purpose of the utilities<a id="_idIndexMarker026"/> we are about <span class="No-Break">to experience.</span></p>
<h2 id="_idParaDest-17"><a id="_idTextAnchor016"/>Stuxnet</h2>
<p>Before delving into<a id="_idIndexMarker027"/> the post-2010 blitz of cyberattacks, we will briefly discuss one of the most famous attacks of all time and one that is considered in some circles to be the catalyst for cybersecurity to evolve into a self-contained career field. This is an attack that involves an exterior device: a USB drive. While it might seem like this attack could not have been prevented by the tools we’ll be talking about in this book, remain vigilant and open-minded. Not only does Kali Purple have the tools to identify and help stop these types of attacks, but the Kali side of the family also has the tools to create them! The attack we’re talking about here is the famous Stuxnet worm that was discovered <span class="No-Break">in 2010.</span></p>
<p><strong class="bold">Stuxnet</strong> is also one of the first examples of governments utilizing cyber technology for offensive purposes. Some consider it <em class="italic">The Original Sin of Cyberwarfare</em>. While there is no definitive answer as to who was responsible for the attack, the consensus throughout the cybersecurity community is that it was a likely joint effort between the United States and Israel against Iran’s <span class="No-Break">nuclear program.</span></p>
<p>The complex attack occurred<a id="_idIndexMarker028"/> in <span class="No-Break">six stages:</span></p>
<ol>
<li>Reconnaissance and intelligence gathering to discover the code and systems to <span class="No-Break">be compromised.</span></li>
<li>Zero-day and custom exploits were used/created to compromise and manipulate <span class="No-Break">the systems.</span></li>
<li>Code was created to cover all tracks and <span class="No-Break">avoid detection.</span></li>
<li>USB drives were weaponized with a malicious payload and covert delivery/covering <span class="No-Break">of tracks.</span></li>
<li>The payload was delivered via clandestine operators who dropped the weaponized USBs in a <span class="No-Break">parking lot.</span></li>
<li>An unsuspecting employee finds one of the USBs and installs it on the <span class="No-Break">target systems.</span></li>
</ol>
<p>Siemens, a multinational conglomerate company of innovation<a id="_idIndexMarker029"/> and technology, produces what is known as a <strong class="bold">programmable logic controller</strong> (<strong class="bold">PLC</strong>) that is used to manage <strong class="bold">industrial control systems</strong> (<strong class="bold">ICSs</strong>). These are systems that are usually considered<a id="_idIndexMarker030"/> to be critical infrastructure. They can include energy, sewer, and water systems for cities, towns, and major metropolis populations. In this case, the target was Iran’s nuclear program, and the catalyst was to intentionally corrupt the Siemens PLC that was used to manage components of <span class="No-Break">the program.</span></p>
<p>It’s important to note that this attack was highly sophisticated and likely involved a large degree of intelligence gathering by clandestine agents. It involved developing zero-day exploits for both Windows as well as the software used in Siemens PLCs. Then, these zero-day malicious exploits were placed onto several auto-run USB drives. The drives were <em class="italic">accidentally</em> dropped into the parking lot of Iran’s nuclear enrichment facilities – and by <em class="italic">accidentally</em>, we mean <em class="italic">intentionally</em> – with the hope that an unsuspecting employee might pick one up and insert it into their work computer to see what was on it – a classic case of <em class="italic">curiosity killed the cat</em>. It worked. The Stuxnet action involved exploits that were covertly modifying the highly specialized code within the Siemens PLCs that managed the centrifuges within Iran’s nuclear facilities. This code caused the centrifuges to run at improper levels, resulting in physical sabotage of the centrifuges and significant damage to Iran’s nuclear enrichment capabilities while also causing significant delays in Iran’s development of <span class="No-Break">nuclear technology.</span></p>
<p>Part of Stuxnet’s success is the extreme lengths its architects went to so that the attack could remain stealthy and evade detection. So, as Iran’s nuclear capabilities were being sabotaged, so was the fact that sabotage was occurring at all initially and then eventually how the sabotage occurred once it was discovered. Since Stuxnet was presented in the form of a worm on a USB drive, it meant the malicious code contained therein could self-replicate and independently spread itself across network devices. Some might consider this a bit of a backfire if the United States and/or Israel were responsible for the initial release of Stuxnet. The reason is that strongly allied nations such as India and Indonesia ended up with this worm in <span class="No-Break">their environments.</span></p>
<p>Thus began the modern era of government weaponization of computing technology. Stuxnet caused a lot of reflection by security staff worldwide. However, it wasn’t quite personal enough yet for the everyday<a id="_idIndexMarker031"/> average Joe to take notice. To get there, we needed individual citizens to be affected. That happened just 3 <span class="No-Break">years later.</span></p>
<h2 id="_idParaDest-18"><a id="_idTextAnchor017"/>The Target cyberattack of 2013</h2>
<p>Perhaps one of the most individually<a id="_idIndexMarker032"/> impactful cyberattacks of the 21st century is what is known as the <strong class="bold">Target Cyberattack of 2013</strong>. Target is a large and well-known retail chain based in Minneapolis, Minnesota, that operates primarily in the United States, though it does have some international endeavors. The store is famous for its mascot, Bullseye, an all-white bull terrier with a literal bullseye painted around one of its eyes. It is also famous for something else: top-notch security. The retail store, wanting to put an end to shoplifting, spent years and years developing state-of-the-art security systems so potent that they would sometimes lend their forensic experts and teams to local law enforcement to assist in solving complicated criminal cases as a measure of social responsibility. To crack Target’s security would be like a boxer defeating Muhammad Ali. So, when it happened, it was a <span class="No-Break">huge deal.</span></p>
<p>In 2013, Target’s cyber defenses were successfully compromised in what had become one of the largest data breeches in history. Cybercriminals were able to access tens of millions of customer records, including credit and debit card numbers! It is now well-known that the success of this breech was ultimately attributed to lax security with third-party vendors. However, the full picture is often overlooked. There were a great number of errors in this scenario and had any one of them been different, this attack probably wouldn’t have succeeded. Some of the elements of this cyberattack are directly addressed by the tools and training offered by <span class="No-Break">Kali Purple.</span></p>
<p>We’re not going to address every issue associated with this cyberattack or every fix that might have prevented it, such as a lack of proper access controls and network segmentation allowing attackers to easily make lateral movements. While those items may be addressable using a Linux distribution that is used for network and/or user administration and analyzing them would be fun, they are outside the scope of Kali Purple. There are, however, several issues related to the Target attack that directly correlate with <span class="No-Break">Purple’s toolset.</span></p>
<p>One of the most important is basic threat monitoring – what an intrusion detection or prevention system does. It is rumored that the attackers were able<a id="_idIndexMarker033"/> to successfully install trojans within the retail giant’s <strong class="bold">point of sale</strong> (<strong class="bold">POS</strong>) systems. These are the systems that will collect and process debit or credit card information after the customer’s items for purchase have been scanned, taxed, and totaled in price. That would periodically grab the sensitive financial data scanned, even on systems with no internet access, and transfer it to other devices within the company’s network. This type of activity would surely be identified by today’s IDS and SIEM technologies. Of course, that’s only valuable if the analyst believes what they see and acts on it. This brings us to our <span class="No-Break">next scenario.</span></p>
<p class="callout-heading">Note</p>
<p class="callout">Before unpacking this story further, let’s get one very important fact straight. Target’s security was – and still very much is – industry leading. It’s the best any organization could have. The company is very much worthy of respect in the cybersecurity community. One of the unintended consequences of being among the best there is in any area of life means you have a literal target – no pun intended – painted across your back. It’s why Microsoft’s Windows is statistically more likely to fall victim to a virus or other malware and the Mac or Linux systems are sometimes erroneously referred to as being <em class="italic">immune</em> to such things. Anybody who is properly informed knows that Apple and Linux are indeed not immune to malicious activity, including viruses. Those systems simply don’t have the same public hype and market share that Windows does. While that is slowly changing over time, as you learn about the fantastic cybersecurity defenses offered by Kali Purple, it’s critical to understand that nothing is ever truly immune. Anything in life that can be engineered, tangible or virtual, can also be reverse-engineered… anything! Do keep that critical fact in mind throughout your <span class="No-Break">security career.</span></p>
<p>That said, let’s continue<a id="_idIndexMarker034"/> to break down the theories of the Target attack – concerning the company’s superior security – and learn how Kali Purple can act as a useful suite of tools to protect against such attacks in the future. One unconfirmed rumor is that Target was in the process of installing a new IDS/IPS system alongside their existing one and until the new system was fully operational, the old system was allowed to remain active. If true, that’s fantastic! Another version of this story is that the highly reputable security firm FireEye had developed a malware detection tool, and it was that tool that was in place instead of a new IDS/IPS system. It’s unknown what happened. However, even when proposed answers are placed into a hypothetical situation, there are lessons to be learned here regarding <span class="No-Break">Kali Purple.</span></p>
<p>In the first proposed scenario of a new IDS/IPS, it’s been said that the new system did indeed detect malicious activity (or FireEye’s product) and did indeed report on it – supposedly to an annoying level! However, the old system was still operational, and the old system wasn’t reporting on it. That caused the technicians to incorrectly assume the new system was malfunctioning, so they manually closed the alerting process, choosing instead to believe the old technology. Now, even if this isn’t true, anybody who’s ever<a id="_idIndexMarker035"/> worked in a SOC before knows that <strong class="bold">alert fatigue</strong> is a real thing and it’s very easy for a technician or analyst, especially at the end of their shift, to fall victim to taking unnecessary shortcuts. Anytime you or an organization you are working for is conducting an upgrade or improvement to the security defenses, keep in mind that there’s a reason you’re upgrading your technology. If the new technology sounds an alarm, believe it folks! As we work through Kali Purple’s defensive tools, take note of whether something obnoxious alerts you. If it does, believe it! Even if it ends up being incorrect the first hundred times, it only takes the one <span class="No-Break">time, right?</span></p>
<p>Another takeaway from the Target hack<a id="_idIndexMarker036"/> is the level of security training offered to the people working with the systems. It would be a fair assumption to think that proper training might have encouraged those dismissing the alarms to realize they could’ve been legitimate, and the older technology was simply not catching what the new stuff was. One of Kali Purple’s most spectacular benefits is its ability to create live scenarios for testing and proof-of-concept purposes that can then be used to train technicians and analysts firsthand! Training in any technology-based field is critical. When you can add the element of practical application and live examples, that helps the learners visualize and better understand the concepts that need to <span class="No-Break">be conveyed.</span></p>
<p>A couple of additional features of the Target attack to keep in mind are insufficient data encryption and slow incident response. In the case of encryption, we will talk more about that later when we deal with some of the tools that are available<a id="_idIndexMarker037"/> alongside Kali Purple, such as <strong class="bold">CyberChef</strong> – a very robust encryption/decryption tool that is often considered to be a <em class="italic">requirement</em> to survive in the world of cybersecurity. In the case of incident response, there are a few tools<a id="_idIndexMarker038"/> we can<a id="_idIndexMarker039"/> consider, such as <strong class="bold">Synapse</strong> and <strong class="bold">TheHive</strong>. We will devote <a href="B21223_08.xhtml#_idTextAnchor134"><span class="No-Break"><em class="italic">Chapter 8</em></span></a> to security incident response while looking at the utilities offered by <span class="No-Break">Kali Purple.</span></p>
<p>The 21st century continued to bring an influx of widespread <span class="No-Break">high-profile</span><span class="No-Break"><a id="_idIndexMarker040"/></span><span class="No-Break"> cyberattacks:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer011">
<img alt="Figure 1.2 – Snapshot of major cyberattacks since 2010" height="534" src="image/B21223_01_2.jpg" width="835"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.2 – Sna<a id="_idTextAnchor018"/>pshot of major cyberattacks since 2010</p>
<p>Now that we’ve covered a very brief history and the evolution of events that created the state of cybersecurity<a id="_idIndexMarker041"/> as we know it today, let’s examine some of the tools that have been developed and honed because of that evolution. In the next section, you’re going to get a glimpse of some of the most powerful offensive security (red team) tools in use today. They are part of the Kali Linux OS, which means they’re part of <span class="No-Break">Kali Purple.</span></p>
<h1 id="_idParaDest-19"><a id="_idTextAnchor019"/>Offensive security</h1>
<p>The offensive security aspect hails<a id="_idIndexMarker042"/> from the red team side of the Purple family. Because it is the defensive toolset that sets Kali Purple apart from the rest, we will only highlight the offensive portion as it relates to use cases and testing the defensive setup of Purple. You will want to learn or at least have a basic understanding of offensive security to get the most robust rewards from Kali Purple. You will gain an understanding of enough offensive security and red team tools and techniques that you’ll be able to effectively test your defensive setup. That will also allow you to develop live presentations and proof-of-concept activities that you can use to train others or even play with yourself. This, by far, is not an exhaustive instruction or reference point for anyone who is exclusively or primarily interested in offensive security. It has only been included to make your Kali Purple journey proper <span class="No-Break">and complete.</span></p>
<p>It’s expected that most who are reading this book already have a certain level of understanding or at least a foundation for the Kali Linux OS. However, not everyone interested in or working in cybersecurity has taken the time to work with and appreciate the full value of Linux. The Kali Purple hype has created a renewed interest in working with Linux for some who otherwise have limited exposure or experience with the OS. For that reason, we’re going to provide you with enough information throughout this book so that you can successfully understand and use Kali Purple, even if you have no Linux experience. However, let’s be honest – we techies do tend to be rather addicted to our craft, don’t we? You may be tempted to stray from Kali Purple if you have limited Linux experience. While that’s truly not necessary to appreciate Purple, Vijay Kumar Velu has produced a masterpiece that will satisfy your curiosities. You’ll find that golden nugget at the end of this chapter in the <em class="italic">Further reading</em> section; it will help pacify your thirst for those<a id="_idIndexMarker043"/> Kali Linux <span class="No-Break">OS skills.</span></p>
<p class="callout-heading">Note</p>
<p class="callout">As we look at some of the red team tools and methods found within the Kali Linux distribution, it is mission-critical that we understand that these tools and methods are very dangerous. They can do real and significant damage – criminal levels of damage. Therefore, you should never use any of these tools and/or methods without first making absolutely, indisputably, certain that you have permission to do so. Of course, if you’re attacking your own system and later argue that you didn’t give yourself permission, you likely have larger issues to deal with. Joking aside, there are a plethora of publicly available testing sites and applications that were specifically engineered for hands-on practice. However, those resources are not applicable here because we are using these tools to test our very <span class="No-Break">own defenses.</span></p>
<p>Some tools that are available in the Kali Linux distribution that are used by offensive operators, both hackers and security teams alike, include <span class="No-Break">the following:</span></p>
<ul>
<li><span class="No-Break">Nmap</span></li>
<li><span class="No-Break">Metasploit Framework</span></li>
<li><span class="No-Break">Burp Suite</span></li>
<li><span class="No-Break">Wireshark</span></li>
<li><span class="No-Break">Aircrack -ng</span></li>
<li>John <span class="No-Break">the Ripper</span></li>
<li><span class="No-Break">Hydra</span></li>
<li><span class="No-Break">SQLmap</span></li>
<li><span class="No-Break">Maltego</span></li>
<li><strong class="bold">Social Engineering </strong><span class="No-Break"><strong class="bold">Toolkit</strong></span><span class="No-Break"> (</span><span class="No-Break"><strong class="bold">SET</strong></span><span class="No-Break">)</span></li>
</ul>
<p>Let’s look at these <span class="No-Break">in detail.</span></p>
<h2 id="_idParaDest-20"><a id="_idTextAnchor020"/>Nmap</h2>
<p>Short for <strong class="bold">Network Mapper</strong>, <strong class="bold">Nmap</strong> is popularly used by operators<a id="_idIndexMarker044"/> to discover the setup<a id="_idIndexMarker045"/> and layout of any network, allowing users to draw a physical map if they so choose. By mapping a network, the operator can then get a visual with which to analyze the network so that they can examine potential vulnerabilities or points of exploitation. Nmap accomplishes this goal by sending information packets to targets and making assumptions based on whether there is a response and if so, what that response looks like. Here’s an example <span class="No-Break">Nmap scan:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer012">
<img alt="Figure 1.3 – Example Nmap scan" height="162" src="image/B21223_01_3.jpg" width="598"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.3 – Example Nmap scan</p>
<p>Nmap can be used to scan an entire network or a range of IP addresses. When used in this manner, it is usually to identify any actively operating hosts within the network. After sending probing packets, the Nmap operator will be able to deduce that a host is online if there is a response of any kind. That will enable any attacker to create a topology of the network and list potential targets available for further probing <span class="No-Break">and/or exploitation.</span></p>
<p>As individual hosts are selected for further penetration, Nmap can then be used to run a port scan, which is used to determine if any ports are open for connections and communication. Not only does this technique help in identifying potential points of entry for an attacker, but it can also give insight into the functions of the device as specific port numbers might reveal specific types of activities. Ports <strong class="source-inline">80</strong> and <strong class="source-inline">443</strong> being open, for example, could tell the user that website and secure website activity is occurring with such <span class="No-Break">a device.</span></p>
<p>By analyzing responses to probes, Nmap can also assist the offensive operator in determining which OS is active on a host. That would significantly reduce the ambiguity of attack vectors and help them narrow the attack tools and methods most likely to be successful against that device. This<a id="_idIndexMarker046"/> process is known as <span class="No-Break"><strong class="bold">OS fingerprinting</strong></span><span class="No-Break">.</span></p>
<p>As it relates to Kali Purple, Nmap activity can be detected<a id="_idIndexMarker047"/> and analyzed by the <strong class="bold">Elasticsearch, Logstash, and Kibana</strong> (<strong class="bold">ELK</strong>) stack, which we will begin to discuss in <a href="B21223_02.xhtml#_idTextAnchor039"><span class="No-Break"><em class="italic">Chapter 2</em></span></a>. It can<a id="_idIndexMarker048"/> also be detected<a id="_idIndexMarker049"/> by traffic<a id="_idIndexMarker050"/> and log<a id="_idIndexMarker051"/> analysis tools such as <strong class="bold">Arkime</strong> and <strong class="bold">Malcolm</strong> as well as intrusion detection utilities such as <strong class="bold">Suricata</strong> and <strong class="bold">Zeek</strong>, provided those tools<a id="_idIndexMarker052"/> are configured<a id="_idIndexMarker053"/> to do so. All of those tools are part of the Kali <span class="No-Break">Purple distribution.</span></p>
<h2 id="_idParaDest-21"><a id="_idTextAnchor021"/>Metasploit Framework</h2>
<p>The <strong class="bold">Metasploit Framework</strong> is one of the most comprehensive open<a id="_idIndexMarker054"/> source exploit development<a id="_idIndexMarker055"/> platforms available. It is likely to be available by default with any Linux OS that focuses on penetration testing and that includes Kali Linux. Here’s the <span class="No-Break">Metasploit console:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer013">
<img alt="Figure 1.4 – Metasploit’s default console" height="682" src="image/B21223_01_4.jpg" width="555"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.4 – Metasploit’s default console</p>
<p>Originally created by a fellow named <strong class="bold">Harley David</strong> (<strong class="bold">HD</strong>) <strong class="bold">Moore</strong>, Metasploit is now owned<a id="_idIndexMarker056"/> and maintained by a company called <strong class="bold">Rapid7</strong>. The framework includes an exhaustive supply of tools, exploits, and payloads. In addition to the community framework, which is freely available, there is a paid pro edition, so you can rest at ease knowing you have professional support with advanced automation and <span class="No-Break">reporting abilities.</span></p>
<p>At a high level, exploits<a id="_idIndexMarker057"/> are simply pieces of code<a id="_idIndexMarker058"/> that are designed and written to take advantage of vulnerabilities in targeted information system endpoints. Metasploit includes exploits that are designed to gain unauthorized access, escalate privileges, and establish backdoors, as well as deliver and remotely execute <span class="No-Break">malicious payloads.</span></p>
<p>Even better, the Metasploit Framework allows customized payloads to be created and provides access to a library of pre-built payloads. A <strong class="bold">payload</strong> is any application or piece<a id="_idIndexMarker059"/> of code that is delivered to a compromised system. The framework<a id="_idIndexMarker060"/> also includes what are known as <strong class="bold">post-exploitation modules</strong>, which are more like level two exploits or exploits that can only be used after the successful execution of a previous exploit. This can help operators continue to remorselessly explore deeper into a system and network to gain access to sensitive data for exfiltration or other <span class="No-Break">malicious purposes.</span></p>
<p>Metasploit can also be used to launch social-engineering-based attacks and generate reports of actions taken. Just like Nmap, Metasploit activity can be detected by the tools included with the Kali Purple distribution, especially Suricata and Zeek. The ELK stack would require some customizations, but you’ll understand<a id="_idIndexMarker061"/> why that’s a good thing before all is said<a id="_idIndexMarker062"/> <span class="No-Break">and done.</span></p>
<h2 id="_idParaDest-22"><a id="_idTextAnchor022"/>Burp Suite</h2>
<p>Developed by<a id="_idIndexMarker063"/> a company<a id="_idIndexMarker064"/> called PortSwigger, <strong class="bold">Burp Suite</strong> is the leading cybersecurity<a id="_idIndexMarker065"/> utility used for web application security (and attacks). It is highly unlikely you’ll find a professional penetration tester doing web application tests who isn’t using Burp Suite. There<a id="_idIndexMarker066"/> are several unique components – Burp Suite calls them <strong class="bold">modules</strong> – to a Burp Suite installation, each designed to work with the other components if the user wishes. Most of these modules can be found for free within the Community edition of this product. However, some features of Burp Suite are only available in the paid Pro version. Don’t discount this product, however! The free Community edition provides a substantial toolset that’s very useful! Here’s the Burp <span class="No-Break">Suite lobby:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer014">
<img alt="Figure 1.5 – Burp Suite’s default lobby" height="702" src="image/B21223_01_5.jpg" width="813"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.5 – Burp Suite’s default lobby</p>
<p>Burp Suite has a proxy module that serves as a sort of intermediary between a web browser and the target of operations. This<a id="_idIndexMarker067"/> proxy allows for <strong class="bold">man-in-the-middle</strong> style of attacks by providing an avenue for the operators to intercept HTTP/S traffic and modify its requests <span class="No-Break">and responses.</span></p>
<p>There is a scanner module<a id="_idIndexMarker068"/> in the paid Pro version that provides automation for identifying<a id="_idIndexMarker069"/> security vulnerabilities in the targeted web application. Like Nmap for web applications, this scanner operates by sending information to the target. The difference is whereas Nmap sends communication packets, Burp Suite sends attack payloads to target web applications and then analyzes the responses to those payloads to help identify potential vulnerabilities. Some of the vulnerabilities the scanner is looking for include opportunities<a id="_idIndexMarker070"/> for SQL injection, <strong class="bold">cross-site scripting</strong> (<strong class="bold">XSS</strong>), and <strong class="bold">server-side request forgery</strong> (<strong class="bold">SSRF</strong>). It then highlights these<a id="_idIndexMarker071"/> prospective points of attack for <span class="No-Break">further analysis.</span></p>
<p>Ever wanted to run a web crawler or spider? Now you can! One of Burp Suite’s modules is exactly that, a spider. As you might have guessed, the spider module will crawl the target application, where it will then attempt to map the functionality of the application for further investigation. The purpose of the spider is to help identify vulnerable areas that might not be so easily discovered <span class="No-Break">from browsing.</span></p>
<p>Burp Suite allows for attacks called <strong class="bold">brute-force attacks</strong>, which is where the user<a id="_idIndexMarker072"/> tries all possible username and password combinations. As you might imagine, doing this manually could take forever (literally!). Burp Suite automates this process and works at unthinkable speeds to attempt these attacks on your behalf. This action is done in the Intruder module. Within this module, the user can determine the parameters they’d like the brute-force attack <span class="No-Break">to use.</span></p>
<p>You can also<a id="_idIndexMarker073"/> import something called <strong class="bold">rainbow lists</strong> into this module. When a password is created in a computer system, the computer will try to encode that password using a hypothetical one-way mathematical formula. This means the computation – in theory – cannot be reversed. In truth, anything that can be engineered can also be reverse-engineered. However, these mathematical processes’ purpose is to make such an endeavor as close to impractical as possible. The result of these one-way<a id="_idIndexMarker074"/> mathematical processes is called <span class="No-Break">a </span><span class="No-Break"><strong class="bold">hash</strong></span><span class="No-Break">.</span></p>
<p>Over time, hackers and offensive security personnel have gathered the hashes of known and commonly used passwords and stored them in files along with the passwords<a id="_idIndexMarker075"/> they represent. These files are called <strong class="bold">rainbow tables</strong> or rainbow lists. The intruder module will allow you to import such a list so that it can attempt to apply the encoded hashes to <span class="No-Break">break in.</span></p>
<p>The intruder module<a id="_idIndexMarker076"/> can also be used for <strong class="bold">fuzz testing</strong>, which is popular with software test engineers<a id="_idIndexMarker077"/> and parameter manipulation. Also known as <strong class="bold">fuzzing</strong>, it involves injecting random or unexpected data into an application or system. It can be a form of <em class="italic">blind shooting</em> or taking a <em class="italic">stab in the dark</em>. It can also be organized with precomputed groups of data involving random characters or excessively large character inputs. You can use it to test how a web application might handle various inputs. This module makes that easy by allowing the user to define custom lists, payloads, and other attack scenarios. The primary purpose of the intruder module is to help the operator gain access by uncovering weak passwords<a id="_idIndexMarker078"/> or injection flaws or even identifying areas where <strong class="bold">too much information</strong> (<strong class="bold">TMI</strong>) <span class="No-Break">was shared.</span></p>
<p>Sometimes, attackers<a id="_idIndexMarker079"/> accomplish<a id="_idIndexMarker080"/> their objective<a id="_idIndexMarker081"/> by utilizing a method known as a <strong class="bold">replay attack</strong>. Burp Suite offers a module known as the Repeater that exists<a id="_idIndexMarker082"/> to make these sorts of attacks possible. Like all Burp Suite modules, this one allows for customizations and offers great flexibility. It also allows the operator to take existing web application responses and alter them before replaying them to help determine where any application’s thresholds <span class="No-Break">might be.</span></p>
<p>The Sequencer is a module that Burp Suite has for analyzing the randomness and quality of session tokens and what would otherwise be unguessable data. It evaluates the strength of cryptographic algorithms and the level of randomness used within the target application. This module does not necessarily offer an activity that would be directly detected by any of Kali Purple’s included utilities. However, the information an operator gleans from the sequencer can lead to attacks based on the weaknesses it discovers and those attacks most assuredly can be detected by the ELK stack, Suricata, Zeek, and <span class="No-Break">other tools.</span></p>
<p>What is modern technology without having the ability to make it extensible? The final module in Burp Suite is the Extender. It’s an API that allows users to develop and integrate custom plugins into the Burp Suite application. It allows Burp Suite users to custom-tailor the utility to their organization’s needs so that it includes automation. While it’s not directly going to be interacting with any Kali Purple distributions, there’s a large repository that the Burp Suite community has created with user-submitted plugins and any of those items will have the potential to generate activity recognized by the Purple set <span class="No-Break">of tools.</span></p>
<p>The vastness of Burp Suite cannot be overstated. Like all the tools mentioned in this section, it can be used to cause harm or for good by testing for vulnerabilities to rebuff. Burp Suite is based around web application hacking, and you can safely fly to Vegas and <em class="italic">bet the ranch</em> any such activity will be looked<a id="_idIndexMarker083"/> at with Kali Purple’s <span class="No-Break">defensive</span><span class="No-Break"><a id="_idIndexMarker084"/></span><span class="No-Break"> toolset.</span></p>
<h2 id="_idParaDest-23"><a id="_idTextAnchor023"/>Wireshark</h2>
<p>The Kali Purple distribution<a id="_idIndexMarker085"/> adds some tools<a id="_idIndexMarker086"/> for traffic and log analysis, and we will go over those in this book. However, we’d be remiss to ignore the grand-daddy of all protocol analyzers – <strong class="bold">Wireshark</strong>. It was part of the Kali Linux package even before the Purple variety was released. Wireshark is an open source application that’s widely used and often referred to as the gold standard for protocol analyzers. You’ll find it used for network troubleshooting, packet analysis, and security vulnerability testing. It operates by <em class="italic">capturing</em> network traffic packets for operators to review and analyze. Here’s an example of a Wireshark <span class="No-Break">packet capture:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer015">
<img alt="Figure 1.6 – Wireshark example packet capture" height="594" src="image/B21223_01_6.jpg" width="950"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.6 – Wireshark example packet capture</p>
<p>Wireshark works by grabbing network packets as they flow across a network interface. It is typically used to capture and monitor traffic from protocols aligning with Ethernet, TCP/IP, HTTP, DNS, HTTP/S, and others. By grabbing these packets, analysts can look at the headers, payload, and other relevant information data that is being transmitted to help determine if unwanted activity <span class="No-Break">is occurring.</span></p>
<p>Wireshark identifies and examines<a id="_idIndexMarker087"/> the protocols being used and then provides<a id="_idIndexMarker088"/> a very detailed analysis for human eyes to help determine the intended behavior and structure of the various protocols. By examining the messages and interactions this tool identifies, analysts can help uncover anomalous behavior or even simple <span class="No-Break">security misconfigurations.</span></p>
<p>Wireshark can sometimes be used by bad actors for network reconnaissance in a similar fashion to Nmap. In this case, the operator can map the target network by evaluating the information contained in the packets instead of direct responses – or lack thereof – from the devices themselves. Through packet evaluation, the analyst should be able to identify the hosts on the network, detect open ports, and observe communications for any odd or unusual patterns. This will help to visualize the actual infrastructure of the <span class="No-Break">target network.</span></p>
<p>This style of analysis helps operators to investigate sessions for anomalous behavior. That, in turn, should show authentication mechanisms and see if any unusual activity is occurring there. Overall, weaknesses in data exchange or session management should be visible. Using these methods, Wireshark can then look for areas of potential traffic manipulation or opportunities to manipulate traffic via injection methods, payload modification, or network protocol manipulation, which is sometimes utilized by bad actors to bypass network security measures such as flood attacks to cause protective devices to <em class="italic">fail open</em>, <span class="No-Break">for example.</span></p>
<p>Like the previous tools listed, Wireshark<a id="_idIndexMarker089"/> activity can be detected<a id="_idIndexMarker090"/> by Suricata, Zeek, and the ELK stack, among other tools found with the Kali Purple distribution. Due to its popularity with penetration testers and attackers alike, we are going to include it in <span class="No-Break">our process.</span></p>
<h2 id="_idParaDest-24"><a id="_idTextAnchor024"/>Aircrack -ng</h2>
<p><strong class="bold">Aircrack -ng</strong> is a suite of software tools<a id="_idIndexMarker091"/> that are typically used<a id="_idIndexMarker092"/> for network security testing. However, unlike other network testing tools we’ve covered, this suite generally specializes in wireless communications. It is most frequently used to test against the strength of Wi-Fi encryption protocols and passwords. The following screenshot shows some of Aircrack -ng’s <span class="No-Break">Wi-Fi options:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer016">
<img alt="Figure 1.7 – Aircrack -ng Wi-Fi options" height="945" src="image/B21223_01_7.jpg" width="520"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.7 – Aircrack -ng Wi-Fi options</p>
<p><strong class="bold">Airodump -ng</strong> is one of the tools in this package<a id="_idIndexMarker093"/> and its purpose is to capture and analyze Wi-Fi traffic similar to how Wireshark does. One of its unique aspects is that it focuses on collecting information about nearby Wi-Fi networks, any access points associated with them, and any devices connected to them at the time of the scan. It also looks for any encryption protocols that have <span class="No-Break">been used.</span></p>
<p>The primary tool of the suite, the title application, has a feature that captures handshake packets for the nifty purpose of working out password cracking when offline. By default, it will use dictionary-based brute-force methods to accomplish this objective. It also has features that are designed to recover WEP and WPA/WPA2 keys if the network encryption is weak. It does<a id="_idIndexMarker094"/> this using statistical analysis<a id="_idIndexMarker095"/> and rainbow tables – sometimes referred to as <span class="No-Break">pre-computed tables.</span></p>
<p><strong class="bold">Aireplay -ng</strong> is an application in the package<a id="_idIndexMarker096"/> that is utilized to perform what is known as de-authentication attacks. It sends disassociation or de-authentication packets to the targeted devices, forcing them to disconnect from their Wi-Fi networks. This is done to force the reauthentication process so that handshake packets can <span class="No-Break">be captured.</span></p>
<p>A word of caution when using this set of tools: it is very easy for the tools to perform work you didn’t overtly ask them to perform! That can be dangerous due to the illegal nature of performing many of these tasks. So, use Aircrack -ng with extreme caution. Unlike the other red team tools we’ve discussed thus far, the actions brought on by this set are much more difficult to detect and are likely only to be captured if the Kali Purple suite of defensive tools has been configured to look for <span class="No-Break">this activity.</span></p>
<h2 id="_idParaDest-25"><a id="_idTextAnchor025"/>John the Ripper</h2>
<p>Often considered<a id="_idIndexMarker097"/> the <em class="italic">King of Cracking</em> (sometimes seen as <em class="italic">King of Kracking</em>), <strong class="bold">John the Ripper</strong> is as it sounds, an industry-leading, open source<a id="_idIndexMarker098"/> password-cracking system. In penetration testing, it is used to test the various strengths of passwords by attempting to crack encrypted password hashes. The <em class="italic">good guys</em> will use it to assess and gain an overall feel for the security level of their password systems and policies. Here’s an example of John the Ripper cracking <span class="No-Break">a password:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer017">
<img alt="Figure 1.8 – John the Ripper cracks a password called “password”" height="214" src="image/B21223_01_8.jpg" width="748"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.8 – John the Ripper cracks a password called “password”</p>
<p>It is commonplace for attackers<a id="_idIndexMarker099"/> to attempt<a id="_idIndexMarker100"/> to retrieve password hashes – not expecting passwords to be stored <em class="italic">in the clear</em> so much in the modern era, though it does still happen. John the Ripper is a tool that helps expedite the process of finding and grabbing password hashes because it is a feature of this application. As previously discussed, a password hash is the encrypted value of a password that is stored on a system so that it may process and approve or <span class="No-Break">disapprove access.</span></p>
<p>Once obtained, the user will want to try and figure <a id="_idTextAnchor026"/>out the hash type so that it can direct John the Ripper to the correct manner of decryption. The application will first attempt to identify the hash type on its own. It supports various password hash types, such as MD5, SHA1, NTLM, and others. If it cannot ID the hash type<a id="_idIndexMarker101"/> on its own, another popular application called <strong class="bold">CyberChef</strong> might <span class="No-Break">be used.</span></p>
<p class="callout-heading">Note</p>
<p class="callout">CyberChef, a tool included in the Kali Purple suite that we will talk about in the next section and again in <a href="B21223_06.xhtml#_idTextAnchor098"><span class="No-Break"><em class="italic">Chapter 6</em></span></a>, is a tool that is often used to help identify encryption types that include hashes. It can also be accessed online if needed but caution is advised if you’re using this application remotely on a customer-related alert or incident. Any information that’s stolen during data transmission constitutes a data leak and is covered by many different regulatory instructions. Something simple could become a public relations nightmare for you, your employer, and your employer’s customers and potentially cost you <span class="No-Break">your job.</span></p>
<p>Like other cracking tools, John the Ripper has features built into it that support wordlists and customized tables. These are pre-generated lists of potential passwords. They can be from a variety of strategies, including recently leaked database passwords, most used passwords, or any other method. Once these word lists have been prepared and the hashes have been identified, John the Ripper will attempt many different cracking techniques to attempt to match the password hash to its dictionary representative. Once complete, the results are listed as successfully <span class="No-Break">cracked passwords.</span></p>
<p>When used remotely, John the Ripper<a id="_idIndexMarker102"/> activity can easily be detected<a id="_idIndexMarker103"/> by Suricata, the ELK stack, Zeek, and other tools within the Kali <span class="No-Break">Purple distribution.</span></p>
<h2 id="_idParaDest-26"><a id="_idTextAnchor027"/>Hydra</h2>
<p>Another well-known<a id="_idIndexMarker104"/> open source<a id="_idIndexMarker105"/> password-cracking tool is <strong class="bold">Hydra</strong>. Whereas John the Ripper’s focus is on cracking passwords based on stored hashes, Hydra is more for traditional brute force attacks against network services. Here’s an example of <span class="No-Break">Hydra’s use:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer018">
<img alt="Figure 1.9 – Hydra used to recover a local password for an SSH server" height="259" src="image/B21223_01_9.jpg" width="875"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.9 – Hydra used to recover a local password for an SSH server</p>
<p>The first step in using Hydra is to identify the target system or network service. That can usually be accomplished by using some of the tools we’ve already discussed, such as Nmap <span class="No-Break">and Wireshark.</span></p>
<p>Once a target is selected, the operator will identify and specify the authentication method to be tested. With Hydra, the targets could be any one of SSH, FTP, HTTP/S, Telnet, or database services such as MySQL or PostgreSQL, among others. As the information is provided to the application, the operator will also include the IP address or hostname and port number of the target, along with the desired protocol method to be used, such as a password list, dictionary method, and so on. With Hydra, the operator has the option to custom-create the password list they wish to use or use a pre-existing list developed <span class="No-Break">by others.</span></p>
<p>Just like other cracking utilities, once all the information has been input and the proper lists are in place, simply run the program and it will automatically attempt many different password-cracking methods. It will also attempt password spraying if it’s set to do so, as well as user enumeration, both of which are features that are not always available with other cracking utilities. Hydra will provide results the same as other cracking tools for humans to read, verify, and validate. It also is easily<a id="_idIndexMarker106"/> detected by Kali Purple’s suite<a id="_idIndexMarker107"/> of <span class="No-Break">defense tools.</span></p>
<h2 id="_idParaDest-27"><a id="_idTextAnchor028"/>SQLmap</h2>
<p><strong class="bold">SQL</strong> stands for <strong class="bold">Structured Query Language</strong> and it is a common language<a id="_idIndexMarker108"/> that programmers<a id="_idIndexMarker109"/> and software engineers<a id="_idIndexMarker110"/> use to interact with databases. It’s how applications add, delete, and modify information in a database. So, as you might have guessed, <strong class="bold">SQLmap</strong> is an open source tool that’s used to exploit databases. It tries to detect and exploit SQL injection vulnerabilities in web applications that use SQL databases. Its power lies in its ability to automate injection attacks. Here’s <span class="No-Break">its lobby:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer019">
<img alt="Figure 1.10 – SQLmap launch lobby showing available command options" height="164" src="image/B21223_01_10.jpg" width="374"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.10 – SQLmap launch lobby showing available command options</p>
<p>The application starts by scanning a web application to discover potential SQL injection vulnerabilities. It does this in a fashion that should be familiar to you by now. It sends specially crafted requests to the target web application and then… you guessed it… analyzes the response. By doing this, SQLmap can determine various types of SQL injection vulnerabilities, such as Boolean-based (true/false), time-based, and/or <span class="No-Break">error-based injections.</span></p>
<p>Once a potential SQL injection vulnerability is discovered by SQLmap, it can exploit that vulnerability by attempting to extract sensitive information from the database. It will attempt to retrieve database schemas, tables, and columns and then, if possible, dump the entire contents of the database. Making these calculated step-by-step actions helps to identify the full impact of the discovered vulnerability and the scope of any potential data leak. Any level of success with any one database for an organization often serves as an indicator that the same actions can be taken with nearly every other database found for that <span class="No-Break">same organization.</span></p>
<p>There are a couple of awesome features within SQLmap. One is that it allows its users to save the state of a successful injection attack to either resume later or share with others. This might be referred<a id="_idIndexMarker111"/> to as a form of built-in persistence! Another feature is that, like Metasploit, SQLmap offers a manner of post-success level two exploitation. It has several built-in techniques that can be used to continue the attack beyond simply extracting information from the database. It can execute arbitrary SQL queries, access the underlying filesystem (powerful!), and execute OS-level commands. It can even help to establish a reverse shell for remote <span class="No-Break">command execution!</span></p>
<p>Due to the <em class="italic">loud</em> nature of SQLmaps<a id="_idIndexMarker112"/> actions, it would undoubtedly be easily detected<a id="_idIndexMarker113"/> by cyber defense systems, including the ELK stack, Suricata, Zeek, and other tools within the Kali <span class="No-Break">Purple distribution.</span></p>
<h2 id="_idParaDest-28"><a id="_idTextAnchor029"/>Maltego</h2>
<p>Turning the page<a id="_idIndexMarker114"/> from cracking <a id="_idIndexMarker115"/>and vulnerability exploitation, we have <strong class="bold">Maltego</strong>. It is a very powerful intelligence-gathering and data-visualization utility. As implied, its purpose is to gather information, analyze it, and then place it within a GUI to help the operator visualize it. Like most other tools, it looks for vulnerabilities and helps to provide a comprehensive reconnaissance aspect of the attack chain. This is what Maltego <span class="No-Break">looks like:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer020">
<img alt="Figure 1.11 – Maltego example" height="710" src="image/B21223_01_11.jpg" width="496"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.11 – Maltego example</p>
<p>The expected usage of Maltego involves identifying the target network, individual, or domain. We’ve already covered a few tools to help with that if needed. Then, it helps the operator gather information from various sources, such as public databases, DNS records, social media profiles, and online publications, among other things. It reconciles this data – consolidates it – into a visual graph where it physically points out relationships and connections between the different entities of the <span class="No-Break">data created.</span></p>
<p>Entities can be IP <a id="_idIndexMarker116"/>addresses, email<a id="_idIndexMarker117"/> addresses, names, or any unique item concerning the intelligence it was instructed to gather. Maltego will represent these different entities in the form of nodes, showing relationships that appear to exist between them using links or edges within the graph. This helps the operators to carefully evaluate the gathered intelligence and visualizations with the connections between the elements. That, in turn, can help the operators piece together potential attack vectors, vulnerabilities, and entry points for the exploitation phase of <span class="No-Break">a cyberattack.</span></p>
<p>Maltego offers<a id="_idIndexMarker118"/> something called automated data transformation. Through a vast array<a id="_idIndexMarker119"/> of transformation options – called <strong class="bold">transforms</strong> by the application – Maltego automates the process of attempting to retrieve additional information by pivoting from one known entity to another because of the relationships it has identified. Transforms can be used to find additional domain names, DNS records, IP addresses, and social media profiles. These might be associated with what you’ve already collected for example, but they weren’t known until a relationship between the original group of entities was discovered. It can also take this information and compare it to repositories of known vulnerabilities <span class="No-Break">and exploits.</span></p>
<p>Another benefit of this extremely powerful intelligence-gathering tool is the collaboration and reporting features it contains. Maltego can facilitate real-time collaboration between multiple team members by allowing visual representations and graphs to be placed within shared workspaces. It can help process these collaborations by generating detailed reports for the team members to review that document the findings, timeline, relationships, and evidence gathered during the process. That will help the individual members formulate questions for each other in real time and therefore help the entire process move <span class="No-Break">along efficiently.</span></p>
<p>As you can see, Maltego is a wickedly powerful and useful tool. It’s also one of the most effective covert operators on this list of tools. Maltego activity is not likely to be detected by cyber defenses as Maltego and malicious at the same time. What that means is that if the consequences of a Maltego action are picked up by cyber defenses, there would likely be little to no information suggesting such activity was the result of someone using this application. That is not to say it cannot happen; it’s just extremely difficult to detect. However, the actions an actor might take because of the Maltego activity are highly<a id="_idIndexMarker120"/> likely to be detected<a id="_idIndexMarker121"/> if they <span class="No-Break">are malicious.</span></p>
<h2 id="_idParaDest-29"><a id="_idTextAnchor030"/>Social Engineering Toolkit (SET)</h2>
<p>Sounds like something<a id="_idIndexMarker122"/> out of a Psychology 101 college<a id="_idIndexMarker123"/> course, doesn’t it? Believe it or not, the <strong class="bold">Social Engineering Toolkit</strong> (<strong class="bold">SET</strong>) is a real thing; it’s a technology-based toolkit that is included with the Kali Linux distribution. It is an open source and Python scripting language-based framework that was created by a fellow named David Kennedy. It was engineered to facilitate and automate the technological portions of social engineering attacks. Social engineering involves manipulating – engineering – people through deception or psychological manipulation to gain important, sometimes sensitive, information or gain access that would otherwise be unauthorized. While social engineering most assuredly has a strong face-to-face or live interaction component, there are also technological aspects associated with the overall strategy and SET exists to simplify<a id="_idIndexMarker124"/> those aspects for us. This is what SET<a id="_idIndexMarker125"/> <span class="No-Break">looks like:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer021">
<img alt="Figure 1.12 – SET" height="505" src="image/B21223_01_12.jpg" width="544"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.12 – SET</p>
<p>SET allows the operator to arrange<a id="_idIndexMarker126"/> phishing campaigns where the target is tricked into entering their credentials, such as their username and password, into a fake login page. SET helps to accomplish this goal by quickly replicating websites into a new site that appears visually identical to the original site. This is one of the main strategies attackers use to trick users into entering their credentials. A user clicks on a phishing email, and it takes them to the fake site, which looks identical to the original. Then, they try to log in and get an error while the fake site loads the original authentic site, where the user tries a second time and successfully logs in to the proper site. They gave up their credentials to the attack but since they logged in to the correct site the second time, they are none-the-wiser. This<a id="_idIndexMarker127"/> is known as <span class="No-Break"><strong class="bold">website cloning</strong></span><span class="No-Break">.</span></p>
<p>SET can also be used to generate malicious documents that also appear to be legitimate. It can mimic Microsoft Word or PDF files, with hidden code embedded somewhere within the file that will execute the moment someone opens the document. Such code will exploit vulnerabilities in the target system and might do things such as install keyloggers, which will grab every stroke the victim user enters and provide credentials to every single page and/or application they use while on that device after the keylogger is installed. The code can also directly infect the system and grab system information, install a backdoor or reverse shell, and allow the attacker direct access with the potential to laterally pivot to other systems on the network. Files<a id="_idIndexMarker128"/> that allow this action are known as <span class="No-Break"><strong class="bold">infectious media</strong></span><span class="No-Break">.</span></p>
<p>Remember Metasploit and how vast and powerful it is? Guess what. SET integrates with Metasploit so that the exploits available there can be seamlessly embedded into the social engineering campaign once the stage of attack calls <span class="No-Break">for it.</span></p>
<p>SET also can create <strong class="bold">USB-based attacks</strong>. It can set up a USB drive<a id="_idIndexMarker129"/> to automatically execute once inserted into a target system and run preconfigured attack scripts and malicious payloads. Remember Stuxnet? SET can create attacks of that magnitude! While it may require some special configurations to fully detect, Kali Purple’s defensive utilities do have the ability to detect anomalous or suspicious behavior coming from USB drives, such as alerting on <span class="No-Break">auto-run/auto-execute activity.</span></p>
<p>As has been noted<a id="_idIndexMarker130"/> in a few places, these tools can be extremely<a id="_idIndexMarker131"/> dangerous and can land their operators in jail if not used ethically. That means having permission to use them and having a predefined, ideally written scope of where and how to use them and not ever, ever, ever straying outside the boundaries of that scope! While these tools can be found compatible with most Linux distributions or even pre-installed in some cases, what is not common are the defensive tools that you will find with Kali Purple, which includes the blue team side of the family. The selection of red team tools you just briefly covered are all available with Kali Linux, the OS<a id="_idIndexMarker132"/> that supports<a id="_idIndexMarker133"/> Kali Purple. Now that you understand the basics of the red team side of the family, let’s take a gander at the blue <span class="No-Break">team side.</span></p>
<h1 id="_idParaDest-30"><a id="_idTextAnchor031"/>Defensive security</h1>
<p>The uniqueness of Kali Purple<a id="_idIndexMarker134"/> is how it adds defensive tools to the Kali Linux distribution for blue team operators so that they may train junior analysts and/or otherwise do their jobs. Of course, to fully grasp where these tools might fit into an organization’s security posture, it might be helpful to know some of the terms associated with cyber defense. Here, we will go over some of the more commonly used terms and highlight the cyber defense concepts needed to navigate this book. We will talk more directly about what it means to be a blue teamer and gain an understanding of what the information security/CIA triad, SOC, SOAR, SIEM, IDS/IPS, and other concepts are. In the process, we will focus on how these items relate to <span class="No-Break">Kali Purple.</span></p>
<p>If you’ve ever studied for a technology certification or any aspect of cybersecurity, you have likely been introduced to the information<a id="_idIndexMarker135"/> security triad, also known as the CIA triad. The three components – confidentiality, integrity, and availability – are critical factors of a proper security posture. Think of a three-legged stool. If you remove one leg from the stool, it will fall over. Likewise, if you remove one component from the triad, your security will also falter. Collectively, the confidentiality, integrity, and availability of information and resources ensure the proper level of access and security for an organization’s systems <span class="No-Break">and data.</span></p>
<p>So, if one component of the tria<a id="_idTextAnchor032"/>d breaks, the entire foundational framework <span class="No-Break">will topple:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer022">
<img alt="Figure 1.13 – The CIA triad" height="637" src="image/B21223_01_13.jpg" width="1056"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.13 – The CIA triad</p>
<p>Let’s break this down <span class="No-Break">by component.</span></p>
<h2 id="_idParaDest-31"><a id="_idTextAnchor033"/>Confidentiality</h2>
<p>This element of the triad<a id="_idIndexMarker136"/> talks about protecting information from unauthorized access, exposure, or disclosure. This is accomplished by putting safeguards in place to prevent individuals who do not have the proper level of authorization from accessing sensitive data. Some of the measures that can be taken to accomplish this objective might include physical access controls such as keypads, mantraps, or biometrics, encrypting data, or establishing secure <span class="No-Break">communication channels.</span></p>
<h2 id="_idParaDest-32"><a id="_idTextAnchor034"/>Integrity</h2>
<p>This element’s purpose<a id="_idIndexMarker137"/> is to ensure that data remains unaltered from unauthorized sources throughout any portion of the data’s life cycle. It aims to ensure the data remains accurate as presented. The accuracy of the data’s content itself is the responsibility of the authorized creators and handlers of the data. It focuses on preventing unauthorized modifications, corruption, or deletion of data. This is usually accomplished by employing techniques such as digital signatures, hashes, checksums, and digital <span class="No-Break">access controls.</span></p>
<h2 id="_idParaDest-33"><a id="_idTextAnchor035"/>Availability</h2>
<p>This element’s need is based on allowing<a id="_idIndexMarker138"/> proper accessibility and usability of an organization’s resources and information when it is needed. It ensures that only authorized users will have access, that the access will be uninterrupted, and that the access will contain the resources the user needs to perform their tasks. These objectives are usually accomplished by adding layers of redundancy to an information system – both physical and/or virtual, when backing up data, establishing a disaster recovery plan, and implementing fault tolerance. Ideally, the proper data will always be available to the proper users. However, we live in an imperfect world and sometimes even natural disasters can pose a threat to an organization’s security posture. If availability is disrupted, this element of the triad also includes plans to mitigate the impact of any natural disruptions, service outages, <span class="No-Break">or failures.</span></p>
<p>Availability is one of the most misunderstood concepts in all of cybersecurity. That’s because the other elements’ purpose is to deny access and manipulation to the wrong people, whereas this element’s purpose is to ensure access is allowed by the right people! It doesn’t do much good to have the best security in the world if what is being secured is never allowed to be utilized. That defeats the entire purpose of the World Wide Web and computing technology in general, doesn’t it? Because of that abstraction, new technicians and junior analysts sometimes struggle to maintain the proper balance between security and keeping business operations flowing. It’s important to realize that, while you certainly can block all of .com at your firewall, it doesn’t do much good if your organization requires the internet to market or provide support for your product or service. Keep this in mind as you negotiate the tools contained in Kali Purple because these tools are powerful and indeed can severely disrupt the availability of resources <span class="No-Break">if misused.</span></p>
<p>Now that we’ve grasped the core fundamental framework for cybersecurity, let’s examine the environment in which most blue team folks will be employing this framework. The SOC is the environment where most defensive cybersecurity professionals will operate. That is the bread and butter of what Kali Purple is! Sometimes, you’ll see Purple referred to as <em class="italic">SOC-in-a-Box</em> because this suite of tools<a id="_idIndexMarker139"/> contains all the core utilities and functionality needed to establish a <span class="No-Break">miniature SOC.</span></p>
<p>A SOC is a unit within an organization<a id="_idIndexMarker140"/> that is generally centralized and is responsible for monitoring and responding to security incidents. It has evolved to more likely be associated with security incidents that are specifically cyber or computer-related. However, a true SOC would encompass all security situations, including old-school closed-circuit television and other surveillance systems. In today’s world, a SOC is also often used to refer to the team of people who work within the centralized security environment. This can be either the defensive blue team and/or the offensive red team. They are responsible for enhancing and maintaining the security of an organization’s <span class="No-Break">information systems.</span></p>
<p>These teams are usually highly trained and educated cybersecurity professionals. However, some business models have allowed for a <em class="italic">baptism-by-fire</em> style of training cybersecurity professionals if the individuals show a level of passion or desire for the field. Kali Purple is an excellent tool for organizations to provide practical experience for <span class="No-Break">such individuals!</span></p>
<p>The primary goal or expectation of a SOC would be to identify, protect, detect, respond to, and recover from cyber threats and incidents in real time. Those<a id="_idIndexMarker141"/> five terms also happen to be the five pillars of the <strong class="bold">National Institute of Standards and Technology Cybersecurity Framework</strong> (<strong class="bold">NIST CSF</strong>). Aligning with NIST means you’re aligning your skillset with the requirements and operations of many government agencies, including the US Department of Defense and critical infrastructure sectors such as energy, water, healthcare, transportation, and financial services. You’ll also find NIST compliance across numerous small and medium-sized business enterprises. Also, though NIST is an organization within the United States Department of Commerce, you’ll find adherence toward many aspects of its cybersecurity framework within many multinational and globally operating organizations. Since Kali Purple was directly engineered with this specific framework in mind, that makes it the perfect base of operational training for those working in a SOC or desiring a career <span class="No-Break">in cybersecurity.</span></p>
<p>One of the flagship utilities of a SOC is the SIEM system. A SIEM might also be referred to<a id="_idIndexMarker142"/> as a normalization or correlation system. Its purpose is to collect a variety of security event logs and related data from any variety of technological sources – endpoints – within an organization. Then, it interprets that data, matches<a id="_idIndexMarker143"/> it with other relevant data, known as data enrichment, and presents it in a <span class="No-Break">universal format.</span></p>
<p>Related to the SIEM is something called a <strong class="bold">Security Orchestration, Automation, and Response</strong> (<strong class="bold">SOAR</strong>) system. A SOAR<a id="_idIndexMarker144"/> is meant to complement a SIEM system in that it provides capabilities for automating incident response and helps to orchestrate security operations in a well-structured, organized, and <span class="No-Break">coordinated manner.</span></p>
<p>Because the data can come from any number of otherwise incompatible sources, such as a Windows versus a Mac versus a Linux device, the original raw data will likely exist from any one of an infinite number of languages and/or ways to present it. A SIEM takes it all, does the necessary interpretation, and presents it in just one consistent manner, making the analyst’s job much easier and <span class="No-Break">more efficient.</span></p>
<p>By handling this normalization, the analyst can then focus on what’s most important: measuring the data against known and emerging threats as well as evaluating anomalous behavior that might be suggesting potentially unknown and new malicious activity. That, in turn, allows the analyst to quickly narrow the attack surface, communicate recommended changes or even make them if authorized, and efficiently assemble compliance reports for senior security engineers <span class="No-Break">to study.</span></p>
<p>We will introduce<a id="_idIndexMarker145"/> you to one of these systems early on by exploring Kali Purple’s inclusion of Elastic in the next chapter; you will continue to expand upon your SIEM knowledge throughout the rest of this book. It’s important to understand that, by itself, Elastic is not inherently a SIEM. Rather, it is a core component of establishing your SIEM. We will add additional components to create a fully <span class="No-Break">functional SIEM.</span></p>
<p>The Wazuh SIEM is built on top of the <span class="No-Break">ELK stack:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer023">
<img alt="Figure 1.14 – The default Wazuh SIEM dashboard after a fresh installation" height="447" src="image/B21223_01_14.jpg" width="953"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.14 – The default Wazuh SIEM dashboard after a fresh installation</p>
<p>You must understand the following <span class="No-Break">about SIEMs:</span></p>
<ul>
<li><span class="No-Break">Log collection</span></li>
<li><span class="No-Break">Event correlation</span></li>
<li>Alerting <span class="No-Break">and notification</span></li>
<li><span class="No-Break">Incident response</span></li>
<li>Compliance monitoring <span class="No-Break">and reporting</span></li>
<li>Threat <span class="No-Break">intelligence integration</span></li>
</ul>
<p>Let’s look at these <span class="No-Break">in detail.</span></p>
<h3>Log collection</h3>
<p>While SIEMs have many useful functions, log collection<a id="_idIndexMarker146"/> is usually what a cybersecurity professional thinks of when visualizing such a tool. Their most accepted practice of accomplishing this goal is by installing <em class="italic">agents</em> on each endpoint – that is, an individual physical device or software application that the SOC wants the SIEM to monitor. These endpoints might include personal computers or workstations, servers, or even network devices such as routers and switches. They could include individual software<a id="_idIndexMarker147"/> applications such as antivirus systems or <strong class="bold">business-to-business</strong> (<strong class="bold">B2B</strong>) <span class="No-Break">collaboration tools.</span></p>
<p>There is a wide range of complexity in these agents but the gist of it is that they monitor and collect data from the device for which it is installed and then simply report that data to the SIEM. Some agents might report vast amounts of data for the SIEM or analyst to parse on their own while others might deliver a sort of <em class="italic">pre-evaluation</em> of data and only report that which is assumed to be anomalous. It is safest for all the data to be delivered. Then, a person known as a cybersecurity engineer<a id="_idIndexMarker148"/> will assemble code within the SIEM itself to handle any automatic sorting, enriching, or discarding of information based on organizational or customer needs. The information that’s collected by the agents and sent to the SIEM is referred to as logs. Each log<a id="_idIndexMarker149"/> contains very valuable information and might include user activities, system events – what the machine or software is commanding<a id="_idIndexMarker150"/> itself to do – and any overt <span class="No-Break">security incidents.</span></p>
<h3>Event correlation</h3>
<p>Once the SIEM collects<a id="_idIndexMarker151"/> the logs from the agents, it must do something with the information, right? There are many options here, but the most accepted practice is for the data to be analyzed and combined with previously collected or statically entered data. As it was when it was originally collected, the data is considered to be raw. When combined with additional relevant information – additional data tables<a id="_idIndexMarker152"/> that are often<a id="_idIndexMarker153"/> referred to as lookup tables – this is known as <strong class="bold">data enrichment</strong>. An example of this is when a SIEM collects an IP address as part of the log. Here, it has a separate table that explains where certain IP addresses or ranges of addresses are located, takes the IP from the log, matches it with the pre-existing lookup table, and then tells the analyst where the activity in the log is geographically occurring from. Enriching data is like adding additional pieces to a puzzle. It gives a clearer picture of what is happening or has happened from the endpoint. The SIEM platform can then analyze the enriched data for complex patterns and anomalous behavior. That, in turn, allows the SIEM to recognize, flag, and report potential cyberattacks. Individual pieces of raw data can fail to recognize this behavior if not enough information is known <span class="No-Break">or collected.</span></p>
<p>Enriching and then analyzing<a id="_idIndexMarker154"/> the newly enriched data is known as <strong class="bold">event correlation</strong>, a process that increases the odds of detecting malicious behavior exponentially. Event correlation is when the SIEM takes different logs that serve different purposes but have a common denominator and it presents them together to help the analyst see if there’s additional information to serve their investigation. One example might be a log containing authentication failures (that is, someone was unsuccessful at logging in) presented with a log that contains port scanning activity that occurred at or very near the same time as the <span class="No-Break">authentication log.</span></p>
<p>This is not to be confused with data aggregation. <strong class="bold">Data aggregation</strong> is when the SIEM takes multiple logs<a id="_idIndexMarker155"/> that contain the same information, such as all logs containing a specific IP address, and presents them together in a single report. Some SIEM solutions (<strong class="bold">Devo</strong>) will offer the analyst an opportunity<a id="_idIndexMarker156"/> to create and perform data aggregation operations and then output<a id="_idIndexMarker157"/> the results to a file format of choice, such as a <span class="No-Break">CSV spreadsheet.</span></p>
<h3>Alerting and notification</h3>
<p>Would you believe that even<a id="_idIndexMarker158"/> after data enrichment, correlation, and complex analysis, malicious behavior can still sometimes go unnoticed? Yep, sure can! That’s why we have a human element to the layers of security built within a SOC. To access that human element, the SIEM takes the data it has correlated and checks it against criteria established by the cybersecurity engineers who have set up and/or managed the SIEM. If the data matches these criteria or rules, the SIEM then either takes this data and creates a type of report known as an alert<a id="_idIndexMarker159"/> that is meant for human analysis or – if a related alert already exists – adds it as an additional event to that alert. These alerts are meant for human eyes, usually a level one cybersecurity analyst or security triage specialist. The SIEM writes these alerts in a uniform manner and language so that the analysts reviewing the alert only need to learn one style of log analysis. It then typically places the new or newly updated alert in some form of a queue that is actively monitored by <span class="No-Break">cybersecurity analysts.</span></p>
<h3>Incident response</h3>
<p>When level one triaging security analysts<a id="_idIndexMarker160"/> review an alert and determine that an incident has or is about to occur, they will typically escalate that alert to a level two cybersecurity analyst, who is usually incident response. In some organizations, this is level three, but mainstream cybersecurity companies usually reserve level three for threat-hunting specialists. A well-setup SIEM will offer helpful information for incident responders as well. This is done in the form of providing workflows, playbooks, and case or customer management capabilities. This not only provides an excellent point of reference for the analysts, but it is also helpful to train newly hired or promoted analysts. SIEMs can be used in a multitude of business models, some of which may include providing security services to other businesses that might not have a cybersecurity team on-site. In that scenario, there could be hundreds or even thousands of organization-specific playbooks, which would be impractical for any individual incident responder<a id="_idIndexMarker161"/> <span class="No-Break">to memorize.</span></p>
<h3>Compliance monitoring and reporting</h3>
<p>As the demand for cybersecurity<a id="_idIndexMarker162"/> grows, so does oversight such as laws and government regulations, or the development of industry standards such as the PCI-DSS, which we previously discussed. One area where this is very prevalent is in record keeping and reporting. There are many new rules covering how to record and report cybersecurity activity. A well-designed SIEM will provide visibility into security events and will have features that assist in generating reports for compliance purposes. Even without pre-existing laws or regulations in place, it would be a good practice to maintain solid records of adherence to industry standards because it shows that an organization is well-researched, organized, prepared, caring, and determined to be at the forefront of its product or service. Having SIEM-generated reports is a way of showing that these principles are <span class="No-Break">in place.</span></p>
<h3>Threat intelligence integration</h3>
<p>The most updated and advanced<a id="_idIndexMarker163"/> SIEM technologies<a id="_idIndexMarker164"/> will have the ability to integrate with external data sources<a id="_idIndexMarker165"/> such as threat<a id="_idIndexMarker166"/> intelligence feeds. Examples include AT&amp;T’s AlienVault <strong class="bold">Open Threat eXchange</strong> (<strong class="bold">OTX</strong>), the <strong class="bold">Structured Threat Information eXpression</strong> (<strong class="bold">STIX</strong>), and <strong class="bold">Trusted Automated eXchange of Indicator Information</strong> (<strong class="bold">TAXII</strong>). There are also databases and other non-live<a id="_idIndexMarker167"/> sources of intelligence that might prove useful for a SIEM to access. This can help with the data enrichment and correlation processes. When the external integrations involve access to developing or up-to-date threat intelligence, then the SIEM will more readily be able to identify known malicious actors as well as emerging threat actors, malicious IP addresses, or domains, along with other indicators <span class="No-Break">of compromise.</span></p>
<p>Besides the threat intelligence<a id="_idIndexMarker168"/> feeds, there’s also the <strong class="bold">Any.Run</strong> and <strong class="bold">Cuckoo</strong> automated sandbox analysis<a id="_idIndexMarker169"/> utilities, which technically aren’t a part of Kali Purple but you can integrate with Purple’s tools for a more robust SOC experience. This is what Any.Run <span class="No-Break">looks like:</span></p>
<div>
<div class="IMG---Figure" id="_idContainer024">
<img alt="Figure 1.15 – Any.Run malware analysis home page" height="824" src="image/B21223_01_15.jpg" width="1650"/>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US">Figure 1.15 – Any.Run malware analysis home page</p>
<p>While Kali Purple offers many tools for defensive security, the SIEM is what seems to have attracted most people to the platform initially because now users have a single system where offensive security actions (Kali Linux) and defensive security can proactively monitor and manage real security events, detect real threats, and begin the process of incident response – and they can get it free <span class="No-Break">of charge.</span></p>
<p>Sometimes, you will find a SIEM<a id="_idIndexMarker170"/> combined with an IDS<a id="_idIndexMarker171"/> or IPS. To effectively navigate the entire cybersecurity defense process, we are not going to do that here. We’ve spoken about the Elastic stack and how with some additions, such as agents, we can convert it into a fully functioning SIEM – and indeed we are going to do that. Now, let’s look at a couple of IDS that are part of the Kali Purple package. Later, we will take some concepts from the <em class="italic">Offensive security</em> section and apply those against Suricata and/or Zeek to give you a hands-on use case approach<a id="_idIndexMarker172"/> to what cyber defenses<a id="_idIndexMarker173"/> look like. Let’s <span class="No-Break">discuss Suricata.</span></p>
<h4>Suricata</h4>
<p>Suricata is an open source<a id="_idIndexMarker174"/> product that can function<a id="_idIndexMarker175"/> as either an IDS or IPS. What’s the difference? Glad you asked. It’s explained in the terms themselves. An IDS does just that – it detects anomalous or potentially malicious behavior. That’s all it does. It doesn’t act against this behavior. It simply detects it and lets you know. There’s a reason for that and we will discuss it in a bit. An IPS will also detect anomalous or potentially malicious behavior, but it will take the additional step of proactively blocking or taking some other action against <span class="No-Break">that behavior.</span></p>
<p>A question you might ask is, “<em class="italic">Why wouldn’t we just want the system to prevent the behavior for us instead of allowing extra work to be created?</em>” The answer is simple. Not all behavior that presents as anomalous or malicious is malicious! These types of alerts are called false positives, and they are commonplace<a id="_idIndexMarker176"/> in the field of cybersecurity. They are so common that there’s another term to describe having to deal with them – alert fatigue. A properly set up IPS will reduce alert fatigue. However, it might also prevent or block authentic benign activity and that’s not good either. Remember the CIA triad? Remember that we discussed how the <em class="italic">A</em> is the most misunderstood? Blocking otherwise valid activity can be just as damaging or even more so to organizations’ bottom lines than failing to block malicious activity. Within some organizations, this is a non-issue, and accidentally blocking benign activity would have little to no effect on them. For this reason, both IDS and IPS technologies exist. You need to choose the one that is right for your situation. Suricata <span class="No-Break">offers both.</span></p>
<p>It is a very robust and highly scalable tool that analyzes network traffic for suspicious or malicious attributes. It operates with a multi-threaded performance approach. This allows for parallel processing instructions, giving it the ability to work with high-speed network traffic efficiently. Suricata, like Wireshark, captures network packets in real time. Unlike Wireshark, it automatically analyzes these packets to include the headers and payload and makes alerting determinations based on this analysis. By default, it’s designed to alert users to network intrusions fitting criteria that match exploitation, malware, policy violations, and anomalous, or suspicious, behavior. Of course, Suricata can also perform the regular protocol analysis functions of Wireshark to include HTTP, DNS, FTP, SMTP, and more, which it uses to detect attacks that might be specifically targeting a <span class="No-Break">particular protocol.</span></p>
<p>It uses two primary manners of detection: signature and anomaly-based. With signature detection, Suricata matches network traffic<a id="_idIndexMarker177"/> against predefined rules or patterns, known as signatures, to assist in identifying known threats. With anomaly detection, Suricata first establishes a baseline of normal network behavior. It then alerts whenever there are any deviations from this <span class="No-Break">established baseline.</span></p>
<p>Suricata can integrate with threat intelligence sources, which is an unwritten requirement for any worthy IDS/IPS solution. These can be external public feeds or an internally maintained threat feed. These feeds greatly assist the system in identifying emerging threats, thus creating<a id="_idIndexMarker178"/> an enhanced detection<a id="_idIndexMarker179"/> <span class="No-Break">capability overall.</span></p>
<h4>Zeek</h4>
<p>Zeek (formerly known as Bro) is not<a id="_idIndexMarker180"/> a full-fledged IDS<a id="_idIndexMarker181"/> product. However, it contains<a id="_idIndexMarker182"/> features and capabilities allowing it to function as one. By default, Zeek is a network analysis framework that’s used for monitoring and analyzing network traffic. Like a few other tools already shared in both the <em class="italic">Offensive security</em> and <em class="italic">Defensive security</em> sections of this chapter, Zeek captures and analyzes network packets in real time, where it attempts to extract useful information about protocols, active connections, and overall behavior. In addition to the protocol analysis that other tools also offer, Zeek focuses on connection details and file transfer information. It might be described as a hybrid of Wireshark and Suricata in terms <span class="No-Break">of functionality.</span></p>
<p>It allows users to work with its scripting language, giving them the ability to create custom rules and policies to alert on in the manner of an IDS. However, it is more work-intensive than many <em class="italic">pre-packaged</em> IDS solutions available today. Nevertheless, that could provide value to a cybersecurity analyst who might wish to develop or hone skills in preparation for advancement into the cybersecurity engineering direction. Another IDS personality of Zeek is its event-driven model. Events are generated based on network activity, which provides a flexible and customizable framework to be used for monitoring <span class="No-Break">and analysis.</span></p>
<p>While these detection, prevention, logging, and alerting products are core tools of a solidly designed SOC, sometimes analysts need to manually inspect the traffic in a particular scenario to determine whether the alerting is a true or false positive. This can help the team fine-tune the detection and logging rules to help reduce unnecessary alerting, and therefore alert fatigue, in the future. Kali Purple<a id="_idIndexMarker183"/> offers such tools<a id="_idIndexMarker184"/> with <span class="No-Break">its distribution.</span></p>
<h4>Arkime</h4>
<p>Arkime – formerly known as Moloch – is one<a id="_idIndexMarker185"/> such tool. It<a id="_idIndexMarker186"/> is an end-to-end<a id="_idIndexMarker187"/> traffic analysis application that was designed to capture large volumes of network packet information and index it for manual exploration by an analyst. It offers real-time searching/queries, customizable dashboards, and a variety of advanced data analyses. Like most traffic analysis utilities, Arkime is most used for network security monitoring, incident response, and data analysis. Its specialty is in processing massive amounts of <span class="No-Break">network information.</span></p>
<p>This application supports a variety of packet capture methods, including<a id="_idIndexMarker188"/> passive listening, <strong class="bold">packet capture</strong> (<strong class="bold">PCAP</strong>) file import, and even direct capture with network <strong class="bold">test access points</strong> (<strong class="bold">TAPs</strong>). A PCAP file is a standardized file format that is widely<a id="_idIndexMarker189"/> accepted with packet capture utilities such as Wireshark. A TAP is typically – but not always – a hardware device that provides a way for analysts to monitor network traffic by creating a copy of the data that is passing through the network link. Software versions<a id="_idIndexMarker190"/> of this function are known as <strong class="bold">Virtual TAPs</strong> or <strong class="bold">vTAPs</strong>. These allow the original traffic to flow without interference. A TAP is usually placed between network devices such as switches and routers. While Arkime itself does not provide a vTAP, it is set up for integration with such <span class="No-Break">software applications.</span></p>
<p>Arkime also offers advanced searching capabilities. This includes searching across all indexed fields, packet payloads, and metadata with support for regular expressions, range searches, and <span class="No-Break">contextual queries.</span></p>
<p>Whenever an application offers advanced query abilities, it’s always good to also offer ways for the user to present this information in ways that best suit them. That will help the user bond with the application and create a natural comfort using it. Arkime accomplishes that goal by allowing customizable dashboards so that the operator can personalize how the network data is displayed to them by focusing on the data that is most valuable to the user at <span class="No-Break">the time.</span></p>
<p>Arkime also supports plugins with its architecture so that its operators can extend its functionality. As with most large-scale software applications offering this feature – such as Burp Suite – there is a community of Arkime users who have already developed various plugins to support additional analytics, integrations with external tools, and customizations and are offering these prebuilt plugins for use by other Arkime operators. We will explore this application<a id="_idIndexMarker191"/> in greater detail<a id="_idIndexMarker192"/> at the beginning of <a href="B21223_06.xhtml#_idTextAnchor098"><span class="No-Break"><em class="italic">Chapter 6</em></span></a><span class="No-Break">.</span></p>
<h4>Malcolm</h4>
<p>Malcom is a similar<a id="_idIndexMarker193"/> traffic analysis tool<a id="_idIndexMarker194"/> that has a particular focus on visualizing network traffic. Along with the same network monitoring that Arkime offers, Malcom is also popularly used for threat hunting, file extraction, and metadata extraction, giving it a unique area of emphasis over other network analysis tools. Though known for its simplicity, Malcolm’s claim to fame is its ability to extract and analyze files from the network traffic. In Malcom’s case, this is an <span class="No-Break">automated feature.</span></p>
<p>It also provides support as a collaboration tool by allowing multiple users to work together on the same investigation, providing functionality for sharing and commenting on the data that is captured. This feature is uncommon with traffic analysis tools and makes a convincing case for SOC teams to select Malcolm over other traffic analysis tools because it supports real-time collaboration with incident response <span class="No-Break">and analysis.</span></p>
<p>As you have seen, Kali Purple offers a robust array of defensive security tools. They are largely built around the ELK stack, which we will detail in <a href="B21223_02.xhtml#_idTextAnchor039"><span class="No-Break"><em class="italic">Chapter 2</em></span></a>. When integrating the IDS tools we’ve discussed, such as Suricata or Zeek, the full toolset starts to form the SOC required for our security posture. That’s the entire purpose of Kali Purple. That’s the reason Kali Purple <span class="No-Break">was created!</span></p>
<h1 id="_idParaDest-34"><a id="_idTextAnchor036"/>Summary</h1>
<p>In this chapter, we discovered a solid base of actions and knowledge that led to the cybersecurity stage as we see it today. We were able to follow a brief history of security developments and events that created the protective needs businesses have today. In doing so, we examined Stuxnet, one of the world’s first uses of modern computing technology for weaponization and cyberwarfare. From there, we looked at a cyberattack that affected individuals in the masses with the Target attack of 2013. We saw how these two attacks led to much of the technology we are about to work with throughout the rest of <span class="No-Break">this book.</span></p>
<p>As we navigated both the red and blue team tools included in the Kali Purple distribution or made available to add to it, we started to piece together the full picture of a well-rounded cybersecurity system. We were able to begin seeing the greater potential of Kali Purple and watch it slowly emerge as a comprehensive <em class="italic">one-stop-shop</em> capable of providing a great level of universality in business security solutions, training for analysts, and proof <span class="No-Break">of concept.</span></p>
<p>Now equipped with a solid base of understanding, we will begin to unpack this <em class="italic">SOC-in-a-Box</em> in the next chapter by drilling down slightly on Kali Linux and sharply on what is arguably the most highly anticipated and popular feature of Kali Purple – <span class="No-Break">the SIEM.</span></p>
<h1 id="_idParaDest-35"><a id="_idTextAnchor037"/>Questions</h1>
<p>Answer the following questions to test your knowledge of <span class="No-Break">this chapter:</span></p>
<ol>
<li>What is <span class="No-Break">a SOC?</span><ol><li class="Alphabets">Special <span class="No-Break">operations command</span></li><li class="Alphabets">Standard of <span class="No-Break">operational conduct</span></li><li class="Alphabets">Security <span class="No-Break">operations center</span></li><li class="Alphabets">A piece of fabric someone wears on <span class="No-Break">their foot</span></li></ol></li>
<li>What is the primary difference between Hydra and John <span class="No-Break">the Ripper?</span><ol><li class="Alphabets">Hydra’s focus is on password cracking from a hash list and John the Ripper’s is on brute-forcing with <span class="No-Break">network applications</span></li><li class="Alphabets">John the Ripper’s focus is on password cracking from a hash list and Hydra’s is on brute-forcing with <span class="No-Break">network applications</span></li><li class="Alphabets">Hydra has many heads whereas John the Ripper only <span class="No-Break">has one</span></li><li class="Alphabets">All <span class="No-Break">the above</span></li><li class="Alphabets">None of <span class="No-Break">the above</span></li></ol></li>
<li>What is the downside of being known for having <span class="No-Break">top-tier security?</span><ol><li class="Alphabets">You become a target for adversaries looking to prove <span class="No-Break">their mettle</span></li><li class="Alphabets">Your security budget <span class="No-Break">is outrageous</span></li><li class="Alphabets">You’re so protected that your own mother cannot <span class="No-Break">contact you</span></li><li class="Alphabets">Everybody expects you to share <span class="No-Break">your secrets</span></li></ol></li>
<li>Which pocket-sized tool was used to deliver sabotage against Iran’s nuclear <span class="No-Break">enrichment program?</span><ol><li class="Alphabets"> A Swiss <span class="No-Break">Army knife</span></li><li class="Alphabets">A <span class="No-Break">butane lighter</span></li><li class="Alphabets"><span class="No-Break">A paperclip</span></li><li class="Alphabets">A USB <span class="No-Break">thumb drive</span></li></ol></li>
<li>When a SIEM combines freshly acquired data with pre-existing data sources, this is known <span class="No-Break">as what?</span><ol><li class="Alphabets"><span class="No-Break">Data corruption</span></li><li class="Alphabets"><span class="No-Break">Data enrichment</span></li><li class="Alphabets"><span class="No-Break">Data pollution</span></li><li class="Alphabets">A <span class="No-Break">chaotic mess</span></li></ol></li>
<li>The CIA triad stands for confidentiality, integrity, <span class="No-Break">and _______________.</span><ol><li class="Alphabets"><span class="No-Break">Availability</span></li><li class="Alphabets"><span class="No-Break">Accessibility</span></li><li class="Alphabets"><span class="No-Break">Accountability</span></li><li class="Alphabets"><span class="No-Break">Assumability</span></li></ol></li>
<li>Which OS was the first successful mass-market OS distributed with a desktop <span class="No-Break">personal computer?</span><ol><li class="Alphabets">Linus <span class="No-Break">Torvald’s Linux</span></li><li class="Alphabets"><span class="No-Break">Microsoft’s Windows</span></li><li class="Alphabets">Thompson and <span class="No-Break">Ritchie’s Unix</span></li><li class="Alphabets"><span class="No-Break">Apple’s MacIntosh</span></li></ol></li>
<li>Which application feature in Elastic, Arkime, and other tools allows the user to customize how information is presented <span class="No-Break">to them?</span><ol><li class="Alphabets"><span class="No-Break">GUI</span></li><li class="Alphabets"><span class="No-Break">Dynamic ruleset</span></li><li class="Alphabets"><span class="No-Break">Dashboards</span></li><li class="Alphabets"><span class="No-Break">Whiteboard</span></li></ol></li>
</ol>
<h1 id="_idParaDest-36"><a id="_idTextAnchor038"/>Further reading</h1>
<p>To learn more about the topics that were covered in this chapter, take a look at the <span class="No-Break">following resources:</span></p>
<ul>
<li><strong class="bold">Kali Linux and Kali Purple release </strong><span class="No-Break"><strong class="bold">page</strong></span><span class="No-Break">: </span><a href="https://www.kali.org/blog/kali-linux-2023-1-release/"><span class="No-Break">https://www.kali.org/blog/kali-linux-2023-1-release/</span></a></li>
<li><strong class="bold">NIST Cybersecurity </strong><span class="No-Break"><strong class="bold">Framework</strong></span><span class="No-Break">: </span><a href="https://www.nist.gov/cyberframework"><span class="No-Break">https://www.nist.gov/cyberframework</span></a></li>
<li><strong class="bold">Metasploit Framework home </strong><span class="No-Break"><strong class="bold">page</strong></span><span class="No-Break">: </span><a href="https://www.metasploit.com/"><span class="No-Break">https://www.metasploit.com/</span></a></li>
<li><em class="italic">Mastering Kali Linux for Advanced Penetration Testing: Become a cybersecurity ethical hacking expert using Metasploit, Nmap, Wireshark, and Burp Suite, 4th Edition</em>, by Vijay Kumar <span class="No-Break">Velu: </span><a href="https://www.amazon.com/Mastering-Linux-Advanced-Penetration-Testing/dp/1801819777/ref=nav_custrec_signin?crid=2OKNCSTWE085&amp;keywords=kali+purple&amp;qid=1694494113&amp;s=books&amp;sprefix=kali+purple%2Cstripbooks%2C134&amp;sr=1-1&amp;"><span class="No-Break">https://www.amazon.com/Mastering-Linux-Advanced-Penetration-Testing/dp/1801819777/ref=nav_custrec_signin?crid=2OKNCSTWE085&amp;keywords=kali+purple&amp;qid=1694494113</span>
&amp;<span class="No-Break">s=books&amp;sprefix=kali+purple%2Cstripbooks%2C134&amp;sr=1-1&amp;</span></a></li>
</ul>
</div>
</div></body></html>