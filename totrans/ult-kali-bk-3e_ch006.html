<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xml:lang="en" lang="en">
<head>
<title>The Ultimate Kali Linux Book - Third Edition</title>
<link rel="stylesheet" type="text/css" href="../styles/stylesheet1.css"/>
<link rel="stylesheet" type="text/css" href="../styles/stylesheet2.css"/>
</head>
<body>
<div id="book-content">
<div id="sbo-rt-content"><section id="exploring-open-source-intelligence" class="level1 pkt" data-number="6">
<h1 data-number="6">5 Exploring Open Source Intelligence</h1>
<section id="join-our-book-community-on-discord-4" class="level2" data-number="6.1">
<h2 data-number="6.1">Join our book community on Discord</h2>
<p><a href="https://packt.link/SecNet">https://packt.link/SecNet</a><img src="../media/file136.png" alt="Qr code Description automatically generated" width="150" height="150"/>Just a couple of decades ago, the internet was not readily available to many people and organizations around the world due to many constraints. However, as technologies continue to evolve and Internet Service Providers (ISPs) work continuously to expand their network infrastructure to ensure everyone is able to connect and access the internet, there are more users on the internet today than ever and the numbers are continuing to increase as many people and organizations are using the internet for their personal gain and business, such as education, marketing, digitally connecting with others, e-commerce and the list can go on and on. This means, people are continuously creating and uploading data in various founds on many platforms on the internet, hence information is easily available to anyone on the internet. Sometimes, people and even employees of an organization share too much sensitive information on the internet without realizing how adversaries can collect and analyze the data to create intelligence which can be used to plan a cyber-attack on an organization.In this chapter, you will explore how ethical hackers and penetration testers collect and analyze <strong>Open Source Intelligence</strong> (<strong>OSINT</strong>) found on online data sources to create a profile and better understand their targets before proceeding to develop or acquire an exploit to compromise targeted systems and networks. You will learn how to use Google hacking techniques to filter search results to identify any unintentionally exposed assets, systems and resources of a targeted organization. In addition, you will gain the hands-on skills used by threat actors to perform passive reconnaissance on a targeted domain and identify sub-domains of an organization. Furthermore, you will explore various internet search engines which are commonly used by penetration testers to identify the technical infrastructure of a company and how hackers are able to collect employees’ data to plan and improve their operations.In this chapter, we will cover the following topics:</p>
<ul>
<li>Google hacking techniques</li>
<li>Domain reconnaissance</li>
<li>Sub-domain harvesting</li>
<li>Identifying organizational infrastructure</li>
<li>Harvesting employees’ data</li>
<li>Social media reconnaissance</li>
</ul>
<p>Let’s dive in!</p>
</section>
<section id="technical-requirements-3" class="level2" data-number="6.2">
<h2 data-number="6.2">Technical Requirements</h2>
<p>To follow along with the exercises in this chapter, please ensure that you have met the following hardware and software requirements:</p>
<ul>
<li>Kali Linux - <a href="https://www.kali.org/get-kali/">https://www.kali.org/get-kali/</a></li>
<li>DNSmap - <a href="https://github.com/resurrecting-open-source-projects/dnsmap">https://github.com/resurrecting-open-source-projects/dnsmap</a></li>
<li>Sublist3r - <a href="https://github.com/aboul3la/Sublist3r">https://github.com/aboul3la/Sublist3r</a></li>
<li>Sherlock - <a href="https://github.com/sherlock-project/Sherlock">https://github.com/sherlock-project/Sherlock</a></li>
</ul>
</section>
<section id="google-hacking-techniques" class="level2" data-number="6.3">
<h2 data-number="6.3">Google hacking techniques</h2>
<p>The concept of Google hacking, sometimes referred to as <em>Google dorking</em>, is not the process of hacking into Google's network infrastructure or systems, but rather leveraging the advanced search parameters within the Google search engine to filter specific results. Many organizations don't always pay close attention to which systems and resources they are exposing on the internet. Google Search is a very powerful search platform that crawls/indexes everything on the internet and filters most malicious websites. Since Google indexes everything, the search engine can automatically discover hidden online directories, resources, and login portals of many organizations.</p>
<blockquote>
<p>Using Google hacking techniques is not illegal but there's a very fine line that you shouldn't cross; otherwise, you'll be in legal trouble. We can use Google hacking techniques to discover hidden and sensitive directories and web portals on the internet, but if you use such information with malicious intentions to perform a cyber-attack, then you can face legal actions.</p>
</blockquote>
<p>To get started with learning about Google hacking, let's take a look at the following scenarios:</p>
<ul>
<li>Imagine you are required to use passive reconnaissance techniques to identify domains and sub-domains of a targeted organization. A common technique is to use Google Search to discover public-facing assets of the target.</li>
</ul>
<p>To do this, use the <code>site:domain-name</code> syntax, to filter all results for the specified domain as shown here:</p>
<img src="../media/file137.png" width="727" height="564"/>
<p>As shown in the preceding screenshot, Google Search returned only the results that contained the targeted domain name only.</p>
<ul>
<li>If you want to filter the search results based on a specific keyword for a targeted domain name, use the <code>keyword site:domain-name</code> syntax, as shown below:</li>
</ul>
<img src="../media/file138.png" width="737" height="527"/>
<p>As shown in the preceding screenshot, the <code>eternalblue site:microsoft.com</code> syntax enables us to filter the search results to display all Microsoft’s domains and URLs which contains the ‘<code>eternalblue</code>’ keyword. This is useful when performing research for security vulnerabilities and exploits on a targeted system based on the application, operating system and vendor of the device.</p>
<ul>
<li>If you want to find all the domains of a targeted organization and filter the results based on 2 keywords, use the <code>keyword1 AND keyword2 site: domain-name</code> syntax, as shown below:</li>
</ul>
<img src="../media/file139.png" width="737" height="561"/>
<p>As shown in the preceding screenshot, using the <code>AND</code> operator with carefully chosen keywords helps us to find login portals of a targeted domain.</p>
<blockquote>
<p>You can use the <code>OR</code> syntax to specify keywords compared to using AND to include both keywords.</p>
</blockquote>
<ul>
<li>If you’re interested in search for specific file types on a targeted domain, use the <code>site:domain-name filetype:file type</code> syntax, as shown below:</li>
</ul>
<img src="../media/file140.png" width="731" height="599"/>
<p>As shown in the preceding screenshot, including the <code>filetype:</code> syntax helps us to filter the search results to display any files that are either intentionally or unintentionally leaked by the targeted organization.</p>
<ul>
<li>To discover specific directories that contains sensitive keywords on their title pages, use the <code>site:domain-name intitle:keyword</code> syntax, as shown below:</li>
</ul>
<img src="../media/file141.png" width="731" height="588"/>
<p>As shown in the preceding screenshot, using the <code>login</code> keyword as the <code>intitle:</code> parameter is useful for displaying login portals of the targeted domain.</p>
<ul>
<li>To find sub-domains of a targeted organization, use the <code>site:domain-name -www</code> syntax to exclude the <code>www</code> parameter, as shown below:</li>
</ul>
<img src="../media/file142.png" width="727" height="420"/>
<p>Using this technique is a good way to remove specific sub-domains and URLs from your search results.</p>
<blockquote>
<p>In additional, you can use the <code>site:*.domain.com -site:www.domain.com</code> syntax to find sub-domains of the targeted organization.</p>
</blockquote>
<p>Furthermore, if you're not too sure how to use the advanced search operators on the Google search engine, you can simply head on over to the Google home page and click on <strong>Settings</strong> &gt; <strong>Advanced search</strong> to open the <strong>Advanced search menu</strong>, as shown below:</p>
<img src="../media/file143.png" width="754" height="657"/>
<p>Google provides a very easy and simple method to enable users to perform advanced searching and filtering, without having to know the advanced search operators, as shown below:</p>
<img src="../media/file144.png" width="1018" height="783"/>
<p>Once you've filled in the necessary details and clicked on the <strong>Advanced Search</strong> button, Google will automatically insert the appropriate search operations needed to perform advanced searches.While there are so many possibilities when using advanced Google search operators, it can be a bit overwhelming. <strong>Google Hacking Database</strong> (<strong>GHDB</strong>) is maintained by the creators of Kali Linux, <strong>Offensive Security</strong> (<a href="https://www.offsec.com/">https://www.offsec.com/</a>), and can be found at <a href="https://www.exploit-db.com/google-hacking-database">https://www.exploit-db.com/google-hacking-database</a>. GHDB is a website that contains a list of various Google dorks (advanced search operators), which are used to find very sensitive information and resources on the internet using Google Search:</p>
<img src="../media/file145.png" width="1152" height="679"/>
<p>As shown in the preceding screenshot, GHDB is regularly updated with new search syntax to help users discover vulnerable services and sensitive directories. A word of caution, though – please be very mindful and careful when lurking around using Google hacking techniques. Do not use the information you find for malicious purposes or to cause harm to a system or network.Having completed this section, you have learned how ethical hackers and penetration testers can leverage the power of Google Search to discover hidden directories and resources. In the next section, you will learn how to discover exposed assets owned by organizations.</p>
</section>
<section id="domain-reconnaissance" class="level2" data-number="6.4">
<h2 data-number="6.4">Domain reconnaissance</h2>
<p>Collecting information about a target-owned domain helps cyber criminals, ethical hackers and penetration testers to identify whether the targeted organization has any exposed systems and network infrastructure which can be leveraged when planning a future attack. In addition, domain reconnaissance helps ethical hackers and penetration testers to determine the external attack surface of an organization, which is, identifying all the internet-facing systems, their operating systems, open ports and running services with the intention of discovering security vulnerabilities which can be exploited by real attackers. This helps ethical hackers to determine whether their targets are unintentionally exposing vulnerable systems, services and applications on the internet, and how a threat actor can leverage the information to perform a cyber-attack.</p>
<section id="collecting-whois-data" class="level3" data-number="6.4.1">
<h3 data-number="6.4.1">Collecting WHOIS data</h3>
<p>What if you can access a database which contains the records of registered domains on the internet? Many domain registrars allow the general public to view publicly available information about registered domains. This information can be found on various WHOIS databases on the internet.The following is a list of various types of information which can be collected from WHOIS databases:</p>
<ul>
<li>Registrant contact information</li>
<li>Administrative contact information</li>
<li>Technical contact information</li>
<li>Name servers</li>
<li>Important dates, such as registration, update, and expiration dates</li>
<li>Registry domain ID</li>
<li>Registrar information</li>
</ul>
<p>Accessing a WHOIS database is quite simple: you can use your favorite internet search engine to find various WHOIS databases, such as the following:</p>
<ul>
<li><a href="https://who.is/">https://who.is/</a></li>
<li><a href="https://www.whois.com/">https://www.whois.com/</a></li>
<li><a href="https://lookup.icann.org/">https://lookup.icann.org/</a></li>
<li><a href="https://whois.domaintools.com/">https://whois.domaintools.com/</a></li>
</ul>
<p>Within Kali Linux, you will being a pre-installed WHOIS tool which enables penetration testers to perform a WHOIS lookup directly on the Terminal. To perform a WHOIS lookup on a targeted domain, open the Terminal on Kali Linux and execute the <code>whois &lt;domain-name&gt;</code> commands to begin a search, as shown here:</p>
<img src="../media/file146.png" width="1381" height="819"/>
<p>As shown in the preceding screenshot, the WHOIS tool was able to retrieve publicly available information about the targeted domain by simply asking a trusted online source. Keep in mind that, as the need for online privacy increases around the world, domain owners are paying a premium fee to ensure their contact and personal information is not revealed by WHOIS databases to the general public. This means that you will not commonly find personal contact information for domains that are no longer being revealed on WHOIS databases if the domain owner pays the premium for additional privacy features.However, do not pass this tool aside as there are still many organizations around the world which does not always value online privacy. Due to the lack of security awareness and negligence of many people and organizations, threat actors and penetration testers can exploit this vulnerability to collect OSINT on their targets.</p>
</section>
<section id="performing-dns-enumeration" class="level3" data-number="6.4.2">
<h3 data-number="6.4.2">Performing DNS enumeration</h3>
<p><strong>Domain Name System</strong> (<strong>DNS</strong>) is an application-layer protocol that enables a system such as a computer to resolve a hostname to an IP address. While there are so many devices on a network, especially on the internet, remembering the IP addresses of web servers can be quite challenging. Using DNS, a system administrator can configure each device with both an IP address and a hostname. Using a hostname is a lot easier to remember, such as <code>www.packtpub.com</code> or <code>www.google.com</code>. However, do you know the IP addresses of the servers that are hosting these websites for Packt and Google? You probably don't, and that's okay because on the internet, there is a hierarchy of DNS servers that contain the records of public hostnames and their IP addresses. These are known as root DNS servers.A DNS server is like a traditional telephone directory, with a list of people and their telephone numbers. On a DNS server, you can find records of the hostnames of servers and devices, as well as their associated IP addresses. Many popular internet companies, such as Cisco, Google, Cloudflare, and others, have set up many public DNS servers around the internet which contains the records of almost every public domain name on the internet.To get a better understanding on how a client device such as a computer uses DNS to resolve a domain name, let’s take a look at the following scenario:</p>
<ol>
<li>Imagine you want to view the webpage on <code>www.example.com</code> on your computer, so you decide to open the web browser and enter <code>www.example.com</code> within the address bar and hit enter to connect to the web server.</li>
<li>Your computer will check the local DNS cache to determine whether the IP address of <code>www.example.com</code> is known already due to a previous connection. If the IP address of <code>www.example.com</code> is found within the local cache, the computer will establish a connection to the destination server.</li>
<li>If the IP address is not found within the local DNS cache of the client, the client sends a <strong>DNS Query</strong> message to the DNS server, requesting the IP address of the hostname (<code>www.example.com</code>), as shown below:</li>
</ol>
<img src="../media/file147.png" width="1071" height="596"/>
<ol>
<li>The DNS server will check its records and respond to the client with a non-authoritative <strong>DNS Reply</strong> message, providing the client with the IP address of the hostname, as shown below:</li>
</ol>
<img src="../media/file148.png" width="1071" height="596"/>
<blockquote>
<p>If the DNS server does not have the requested records for the hostname, it performs a recursive DNS lookup to retrieve the DNS records either from other DNS servers on the internet or the root DNS server. When the client receives the IP address from the DNS Reply from the DNS server, the client stores the IP address to hostname mapping within the local DNS cache for future reference.</p>
</blockquote>
<ol>
<li>The client uses the IP address from <strong>DNS Reply</strong> to connect to <code>www.example.com</code> on the internet, as shown below:</li>
</ol>
<img src="../media/file149.png" width="1071" height="596"/>
<p>There are many public DNS servers on the internet; some are created by threat actors with malicious intentions, such as redirecting unaware users to malicious websites for social engineering purposes. As a result, I recommend using a trusted DNS providers on all of your networking devices, security appliances, servers and computers to improve your organization’s online safety. The following are some popular DNS servers on the internet:</p>
<ul>
<li>Cloudflare: <a href="https://1.1.1.1/">https://1.1.1.1/</a></li>
<li>Quad 9: <a href="https://www.quad9.net/">https://www.quad9.net/</a></li>
<li>Cisco OpenDNS: <a href="https://www.opendns.com/">https://www.opendns.com/</a></li>
<li>Google Public DNS: <a href="https://developers.google.com/speed/public-dns">https://developers.google.com/speed/public-dns</a></li>
</ul>
<p>Additionally, DNS servers not only resolve a hostname to IP address – they also contain various types of records with information about a domain, such as the following:</p>
<ul>
<li><code>A</code>: This record maps a hostname to an IPv4 address.</li>
<li><code>AAAA</code> – Used to map a hostname to an IPv6 address.</li>
<li><code>NS</code> – Used for specifying the name servers for a domain.</li>
<li><code>MX</code> – Specifies the mail exchange or email servers for the domain.</li>
<li><code>PTR</code> – This record maps a hostname to an IPv4 or IPv6 address.</li>
<li><code>CNAME</code> – Used to specify an alias for another record.</li>
<li><code>RP</code> – This report contains the responsible person for the domain.</li>
<li><code>SOA</code> – This record specifies the authority for the domain.</li>
<li><code>SRV</code> – This record contains the service records such as port numbers for specific services on the domain.</li>
<li><code>TXT</code> – This record allows the domain owner to specify a text record. Commonly used for verification of ownership for a domain.</li>
</ul>
<p>You're probably wondering, what does learning about DNS have to do with passive reconnaissance and OSINT as a penetration tester? As an aspiring penetration tester, DNS enumeration is the technique of probing specific DNS records for a targeted domain to retrieve information about an organization’s internet-facing assets and identify any security vulnerabilities that can assist in planning a cyber-attack. Performing DNS enumeration is simply requesting the DNS records of a targeted domain from a public DNS server on the internet. Then, analyzing the collected information to create intelligence and better understand how an adversary can leverage the intelligence to compromise the targeted organization.Within Kali Linux, you will find many DNS analysis tools to help ethical hackers and penetration testers to efficiently collect and analyze DNS records of a targeted domain. While the preference of using such type of tool is usually depend upon the personal choice of the penetration tester, I strongly urge you to try all the available tools to better understanding on which ones work best for you. To get started with using <strong>DNSrecon</strong> for DNS enumeration, please use the following instructions:</p>
<ol>
<li>Power-on the <strong>Kali Linux</strong> virtual machine and log-in.</li>
<li>Next, open the <strong>Terminal</strong> and use the following commands to retrieve the DNS records for a targeted domain:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ dnsrecon -d microsoft.com -n 1.1.1.1</code></pre>
</div>
<p>The following screenshot shows DNSrecon was able to retrieve the public DNS records for the Microsoft.com domain from Cloudflare’s public DNS server:</p>
<img src="../media/file150.png" width="976" height="536"/>
<blockquote>
<p>Using the <code>-d</code> syntax enables you to specify the targeted domain, the <code>-n</code> syntax enables you to specify a name server to query,</p>
</blockquote>
<p>As shown in the preceding screenshot, DNSrecon was able to retrieve various DNS records for the targeted domain, such as the A, NS, MX and SOA records. An ethical hacker and penetration tester can leverage the information collected to identity the public IP address of additional assets owned by the target.</p>
<ol>
<li>In addition, DNSrecon was able to enumerate the SRV records of the targeted domain, as shown below:</li>
</ol>
<img src="../media/file151.png" width="1321" height="201"/>
<p>As shown in the preceding screenshot, the end of each line indicates the open port number for each service. Identifying open ports helps penetration testers to determine running services and points of entry into a targeted system.</p>
<blockquote>
<p>To learn more about DNSrecon and its additional features, use the <code>dnsrecon -h</code> and <code>man dnsrecon</code> commands on Kali Linux.</p>
</blockquote>
<p>Having completed this exercise, you have learnt how to enumerate DNS records from public DNS servers for a targeted domain. Next, you will learn how to exploit a vulnerable DNS server to extract sensitive DNS records.</p>
</section>
<section id="exploiting-dns-zone-transfer" class="level3" data-number="6.4.3">
<h3 data-number="6.4.3">Exploiting DNS zone transfer</h3>
<p>DNS zone transfer allows the zone records from one DNS server to be copied from a master DNS server onto another DNS server over a network For instance, from a primary DNS server to a secondary DNS server for redundancy. Sometimes, an IT professional may forget to secure their DNS server and implement security controls to prevent the zone records from being copied to unauthorized DNS servers. If a threat actor were to successfully perform a DNS zone transfer on a targeted organization, the adversary will be able to retrieve both public and private DNS records which helps the attacker to identify critical systems on the internal network of the target.In another scenario, the targeted organization may not separate their internal and external namespaces from each other on their DNS servers for the company. This type of misconfiguration on DNS servers can lead to a future DNS zone transfer attack. While nowadays, it’s less likely to discover a target’s DNS server with this security vulnerability, it’s still important for both ethical hackers and penetration testers understand how adversaries are able to discover and exploit this security flaw.However, as security training is applied to almost every field within IT courses and certifications, the upcoming generation of IT professionals are usually made aware of this security flaw to ensure their systems and networks are always secure. Hence, the possibility of a poorly configured DNS server may be almost non-existent since, as an aspiring penetration tester, you should leave no stone unturned and always test for everything within your scope of a penetration test on your target.</p>
<blockquote>
<p>The awesome folks at <strong>Digi Ninja</strong> (<a href="https://digi.ninja/">https://digi.ninja/</a>) setup an amazing environment to better understand how to test for DNS zone transfer vulnerabilities. In addition, they have made their online platform free to the public so anyone can learn more about this security vulnerabilities of misconfigured DNS servers.</p>
</blockquote>
<p>To get started with this exercise, please use the following instructions:</p>
<ol>
<li>Power-on your <strong>Kali Linux</strong> virtual machine and login.</li>
<li>Open the <strong>Terminal</strong> and use the <code>host</code> command to retrieve the DNS records of <code>zonetransfer.me</code>, as shown below:</li>
</ol>
<img src="../media/file152.png" width="976" height="315"/>
<p>As shown in the preceding screenshot, various DNS records were retrieved, such as the <code>A</code> and <code>MX</code> records.</p>
<ol>
<li>Next, let’s attempt to retrieve the <code>NS</code> records for the targeted domain, use the <code>host -t ns zonetransfer.me</code> commands, as shown below:</li>
</ol>
<img src="../media/file153.png" width="747" height="138"/>
<p>As shown in the preceding screenshot, the targeted domain has 2 name servers, these are: <code>nsztm1.digi.ninja</code> and <code>nsztm2.digi.ninja</code>. We can proceed to check each of these name servers to determine whether they are misconfigured for unauthorized zone transfer.</p>
<ol>
<li>Next, let’s query the <code>nsztm1.digi.ninja</code> Name Server to identify whether it’s vulnerable to DNS zone transfer and retrieve the zone records, use the following command:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ host -l zonetransfer.me nsztm1.digi.ninja</code></pre>
</div>
<p>The following screenshots all the DNS records that were obtained from the <code>nsztm1.digi.ninja</code> Name Server for the targeted domain:</p>
<img src="../media/file154.png" width="1262" height="823"/>
<p>As shown in the preceding screenshot, there are many interesting hostnames, and their corresponding IP addresses were retrieved. These hostnames may not be intentionally exposed to the internet by the targeted organization but as a result of poorly configured DNS server settings, they were.</p>
<blockquote>
<p>Be sure to query all the Name Servers for a given domain – sometimes, one server may be misconfigured even though the others are secured.</p>
</blockquote>
<ol>
<li>Next, to automate the DNS analysis and perform DNS zone transfer on a targeted domain, use the <strong>DNSenum</strong> tool with the following commands:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ dnsenum zonetransfer.me</code></pre>
</div>
<p>The DNSenum tool will attempt to retrieve all DNS records for the targeted domain and will attempt to perform DNS zone transfer using all the Name Servers that are found. In the following screenshot shows DNSenum was able to retrieve the zone records for the targeted domain:</p>
<img src="../media/file155.png" width="1350" height="734"/>
<p>DNSEnum was able to retrieve additional zone records, as shown here:</p>
<img src="../media/file156.png" width="1303" height="388"/>
<p>As you can imagine, the collected information can be leverage by both adversaries and ethical hackers to discover additional assets that are owned by the targeted organization, identify their hostnames and IP addresses.Having completed this exercise, you have learnt how to perform DNS enumeration and zone transfer as an ethical hacker and penetration tester. Next, you will learn how to automate the collection of OSINT using Spiderfoot.</p>
</section>
<section id="automation-using-spiderfoot" class="level3" data-number="6.4.4">
<h3 data-number="6.4.4">Automation using Spiderfoot</h3>
<p><strong>Spiderfoot</strong> is a very popular OSINT tool that helps ethical hackers, penetration testers and cybersecurity researchers to automate their processes and workloads when gathering intelligence about their targets. This tool provides excellent visualization of the all data it has gathered in the form of graphs and tables, which helps you easily read and interpret the data that's been collected.To get started with Spiderfoot, please use the following instructions:</p>
<ol>
<li>Power-on the <strong>Kali Linux</strong> virtual machine and ensure it has an active internet connection.</li>
<li>Next, open the <strong>Terminal</strong> and use the following commands to launch the Spiderfoot web interface:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ spiderfoot -l 0.0.0.0:1234</code></pre>
</div>
<p>The following screenshot shows the execution of the preceding commands:</p>
<img src="../media/file157.png" width="1163" height="480"/>
<p>As shown in the preceding screenshot, the <code>-l</code> syntax specifies the IP address and port number for the Spiderfoot web interface. Where, <code>0.0.0.0</code> specifies all interfaces and <code>1234</code> is the open port for incoming connections to Spiderfoot web interface.</p>
<ol>
<li>Next, open the web browser within Kali Linux and go to <code>http://127.0.0.1:1234/</code> to access the Spiderfoot web interface, as shown below:</li>
</ol>
<img src="../media/file158.png" width="915" height="462"/>
<ol>
<li>Next, to automate the OSINT data collection and analysis, click on <strong>New Scan</strong> &gt; set a <strong>Scan Name</strong> with a <strong>Scan Target</strong> and use the <strong>Passive</strong> option, then click on <strong>Run Scan Now</strong> as shown below:</li>
</ol>
<img src="../media/file159.png" width="917" height="937"/>
<ol>
<li>Spiderfoot begins to collect and analyze data from multiple data sources on the internet about the targeted organization or domain, as shown below:</li>
</ol>
<img src="../media/file160.png" width="848" height="744"/>
<ol>
<li>Select the <strong>Graph</strong> tab to view how each data point is interconnected to the target domain, as shown below:</li>
</ol>
<img src="../media/file161.png" width="695" height="749"/>
<p>Clicking a data point shown in the preceding screenshot reveals with a domain name, sub-domain, hostname, email address or URL that’s associated to the target.</p>
<ol>
<li>Next, to view the data that was collected based on categories, click on <strong>Browse</strong>, as shown in the following screenshot:</li>
</ol>
<img src="../media/file162.png" width="757" height="591"/>
<ol>
<li>Next, click within the <strong>Internet Name</strong> category to see the data that was collected, as shown below:</li>
</ol>
<img src="../media/file163.png" width="768" height="666"/>
<p>As you can imagine, Spiderfoot can dig deeper until it gathers all the data about a targeted domain, inclusive of DNS information, and format the data into information and convert it into intelligence that can be leverage by ethical hackers and penetration testers.Having completed this section, you have gained the hands-on experience and skills to perform domain and DNS reconnaissance. In the next section, you will learn how to discover sub-domains using OSINT techniques.</p>
</section>
</section>
<section id="sub-domain-harvesting" class="level2" data-number="6.5">
<h2 data-number="6.5">Sub-domain harvesting</h2>
<p>Every day, search engines such as Bing, Google, and Yahoo frequently learn and index new and existing websites to improve their search results. If a person searches for a company's website, you’re likely to discover the primary domain, such as <code>example.com</code>. A lot of organizations create sub-domains for various reasons, but as an aspiring ethical hacker and penetration tester, discovering all the possible sub-domains of a targeted organization can lead to finding sensitive locations and resources, such as login portals and unintentionally exposed corporate directories, which may contain confidential files and resources.</p>
<section id="enumeration-with-dnsmap" class="level3" data-number="6.5.1">
<h3 data-number="6.5.1">Enumeration with DNSmap</h3>
<p><strong>DNSmap</strong> works a bit differently from the tools we looked at in the previous sections. DNSmap attempts to enumerate the sub-domains of a targeted parent domain by querying a built-in wordlist within Kali Linux. Once a sub-domain is found, DNSmap will also attempt to resolve the IP address automatically.To get started using DNSmap, please use the following instructions:</p>
<ol>
<li>Power-on the <strong>Kali Linux</strong> virtual machine and ensure it has internet connectivity.</li>
<li>Next, open the <strong>Terminal</strong> and use the following commands to install the latest version of DNSmap on Kali Linux:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ sudo apt update
kali@kali:~$ sudo apt install dnsmap</code></pre>
</div>
<ol>
<li>Next, use the following commands to automate the discovery of sub-domains for a target using DNSmap:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ dnsmap microsoft.com</code></pre>
</div>
<p>The following screenshot shows DNSmap is identifying the sub-domains of a targeted organization and is resolving each hostname/sub-domain to an IP address:</p>
<img src="../media/file164.png" width="1073" height="487"/>
<p>As a penetration tester, discovering the sub-domains of your target can lead to finding vulnerable web applications and even systems. Furthermore, such information can be used to build a better profile of your target. Next, you will learn how to use another popular tool that leverages OSINT to gather the sub-domains of a targeted organization.</p>
</section>
<section id="sub-domain-discovery-with-sublist3r" class="level3" data-number="6.5.2">
<h3 data-number="6.5.2">Sub-domain discovery with Sublist3r</h3>
<p>You can leverage the power of search engines for discovering sub-domains by using the <strong>Sublist3r</strong> tool. Sublist3r is a Python-based tool that is used to enumerate (extract/obtain) the sub-domains of a targeted public domain using OSINT techniques and data sources, such as search engines and other internet indexing platforms.To get started using Sublist3r, please use the following instructions:</p>
<ol>
<li>Firstly, power-on the <strong>Kali Linux</strong> virtual machine and ensure it has internet connectivity.</li>
<li>Next, open the <strong>Terminal</strong> and use the following commands to download the <strong>Sublist3r</strong> setup files from a working branch of the application:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ sudo apt update
kali@kali:~$ git clone https://github.com/huntergregal/Sublist3r.git</code></pre>
</div>
<blockquote>
<p>The packages from the official GitHub repository for Sublist3r is no longer working at the time of writing, therefore we’ll use a known working branch from <a href="https://github.com/aboul3la/Sublist3r">https://github.com/aboul3la/Sublist3r</a>.</p>
</blockquote>
<ol>
<li>Next, use the following commands to change the present working directory to the Sublist3r folder and install the requirements for the tool:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ cd Sublist3r
kali@kali:~/Sublist3r$ sudo pip install -r requirements.txt</code></pre>
</div>
<ol>
<li>Next, use the following commands to perform sub-domain discovery on a targeted domain:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~/Sublist3r$ python ./sublist3r.py –d microsoft.com</code></pre>
</div>
<p>The following screenshot shows the sub-domain discovery process with Sublist3r:</p>
<img src="../media/file165.png" width="646" height="480"/>
<blockquote>
<p>The <code>-o</code> syntax enables Sublist3r to create an output file with the results and store it in a custom location. For instance, appending the <code>-o /home/kali/Desktop/subdomains.txt</code> command at the end will create the output on the Desktop of Kali Linux.</p>
</blockquote>
<p>Using the information that was found regarding sub-domains, penetration testers will need to check these sub-domains to determine where they lead, such as to a vulnerable web application or even a login portal for employees or customers.Having completed this section, you have learned how to efficiently discover the sub-domains of a targeted organization. In the next section, you will learn how to use OSINT to identify the technical infrastructure of an organization.</p>
</section>
</section>
<section id="identifying-organizational-infrastructure" class="level2" data-number="6.6">
<h2 data-number="6.6">Identifying organizational infrastructure</h2>
<p>While many organizations think their network infrastructure is hidden behind their public IP address and that threat actors are unable to determine their internal infrastructure, threat actors uses various OSINT techniques and tools to identify the systems and applications that are running within a targeted organization.Over the next sub-sections, you will learn how organizations are leaking technical details about their internal network and how it can be leveraged by threat actors to improve their cyber-attack.</p>
<section id="data-leakage-on-job-websites" class="level3" data-number="6.6.1">
<h3 data-number="6.6.1">Data leakage on job websites</h3>
<p>Over the years, I’ve noticed many organizations leak a lot of data about their internal infrastructure and systems which can help adversaries to improve their plan of attack and identify security vulnerabilities within an organization by simply analyzing public information. For instance, a recruiter usually post a vacancy on a job board or on their careers section of their company’s website for job seekers. Quite often, the recruiter or job poster provides specific technical details about the organization’s internal systems to help the job seeker to determine whether the position is a good fit for their career development.The following are the advantages of companies posting their technologies on recruitment websites:</p>
<ul>
<li>The potential candidate will have an idea of the environment and technologies they will be working with if they are successful during the interviewing process.</li>
<li>The potential candidate can determine whether they have the skillset required for the job beforehand.</li>
</ul>
<p>However, a threat actor can leverage the technical details found a job post to determine the type of operating systems, applications and versions, networking and security solutions are running within the company. In addition, such information is usually public information and OSINT which can be leveraged by adversaries to determine the attack surface and security vulnerabilities of the company.The following are the disadvantages of companies posting their technologies on recruitment websites:</p>
<ul>
<li>The company is leaking details about its technologies to the general public, and this information can be leveraged by a threat actor.</li>
<li>A hacker can determine the infrastructure, and select exploits and tools to perform a cyber-attack on the targeted organization.</li>
</ul>
<p>As a penetration tester, when recruiters reveal such information, we can easily create a portfolio of the targeted organization's internal infrastructure by identifying the operating systems of clients and servers, the vendor of networking devices, and the vendor of security appliances and technologies within the company's network.To get a better understanding of developing a hacker mindset as a penetration tester, let's take a look at the following screenshot:</p>
<img src="../media/file166.png" width="573" height="444"/>
<p>As shown in the preceding screenshot, the recruiter listed the main qualifications of the ideal candidate. Let's analyze the information provided by taking a closer look at the desired experience. The job poster is looking for someone who’s experienced in Microsoft Windows Server 2012, 2016, and 2019. The following can be derived from this information:</p>
<ul>
<li>The hiring organization has a Microsoft Windows environment with some older versions of Windows Server, specifically 2012 and 2016.</li>
<li>There's the possibility that either the older systems or all Windows servers within the organization are not fully patched and contains security vulnerabilities.</li>
<li>The organization may not have rolled out Windows Server 2019 within their network yet or is planning to roll out the newer version of Windows Server soon.</li>
<li>The hiring company specified the vendors for their existing networking devices and security solutions, which are Cisco routers and switches and Fortinet firewalls. This gives the attacker a clear idea of the threat prevention systems that are in place.</li>
<li>The organization is also using Microsoft cloud computing services such as Azure. There is a likelihood that their cloud-based servers and applications are not secure.</li>
</ul>
<p>As an aspiring penetration tester, using your favorite search engine, you can search for known security vulnerabilities and learn how to exploit each of these technologies. As you have seen, the recruiter leaked too much data about the organization which can also be used against that same organization by threat actors for malicious purposes, as well as by ethical hackers and penetration testers who have been hired to simulate a real-world cyber-attack, help the organization identify how they are leaking data and the potential impact if the information is leveraged by a real attacker.Next, you will learn how to use a special internet search engine to find exposed systems from many organizations around the world.</p>
</section>
<section id="finding-vulnerable-systems-using-shodan" class="level3" data-number="6.6.2">
<h3 data-number="6.6.2">Finding vulnerable systems using Shodan</h3>
<p><strong>Shodan</strong> is a search engine for <strong>Internet of Things</strong> (<strong>IoT</strong>), systems, and networks that are directly connected to the internet. Ethical hackers, penetration testers, and even threat actors use Shodan to identify their organization's or target's assets, and they check whether they have been publicly exposed on the internet. This online tool helps cybersecurity professionals quickly determine whether their organization's assets have been exposed on the internet.To provide some additional insight, imagine that you want to determine whether your organization has any systems, such as servers that are accessible over the internet. These servers may include open service ports, vulnerable running applications, and services. Imagine that your organization has a legacy system running an older operating system that isn't patched with the latest security updates from the vendor and is directly connected to the internet. A penetration tester or threat actor can use an online tool, such as Shodan, to discover such systems without even sending a probe of any kind directly from the penetration tester's system to the target server, simply because Shodan detects it automatically.To get started using Shodan, please use the following instructions:</p>
<ol>
<li>Using your web browser, go to <a href="https://www.shodan.io/">https://www.shodan.io/</a> and register for an account. You can perform searches on Shodan without an account but the results will be very limited.</li>
<li>After creating your account, login and use the Shodan search field to enter some keywords such as <code>windows server 2008</code>, as shown in the following screenshot:</li>
</ol>
<img src="../media/file167.png" width="1261" height="642"/>
<p>As shown in the preceding screenshot, there are over 200,000 devices around the world which are still running the Microsoft Windows Server 2008 operating system that are identified using Shodan, and these systems are directly connected to the internet. As an ethical hacker and penetration tester, you can use Shodan to find exposed assets that are owned by the targeted organization to determine the attack surface of the company. Furthermore, once you’re able to identify the operating system(s) of the target, you can research known security vulnerabilities for these systems.</p>
<ol>
<li>Clicking on any of these system will provide additional information about the system, such as open ports, running services, banner and locale details. The following screenshot shows the local information of a system:</li>
</ol>
<img src="../media/file168.png" width="659" height="564"/>
<p>As shown in the preceding screenshot, Shodan was able to retrieve the hostname, domain name, <strong>Internet Service Provider</strong> (<strong>ISP</strong>) details and its <strong>Autonomous System Number</strong> (<strong>ASN</strong>), and locale information. Such information helps cyber criminals and ethical hackers to determine the locality of the targeted organization during their reconnaissance phase.</p>
<ol>
<li>Additionally, Shodan provides details on the open ports and their associated services that are running on the targeted system, as shown below:</li>
</ol>
<img src="../media/file169.png" width="952" height="740"/>
<p>As shown in the preceding screenshot, Shodan was able to identify exposed services and ports on this system. Whether these ports were intentionally exposed by the organization, cyber criminals and ethical hackers can use this information to determine which services are running on the targeted system and determine whether there are any security vulnerabilities.</p>
<blockquote>
<p>To learn more about service names and port numbers, please see: <a href="https://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xhtml">https://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.xhtml</a>.</p>
</blockquote>
<p>For instance, the system is running <strong>Server Message Block</strong> (<strong>SMB</strong>) version 1, which is known to contain security flaws that enables an attacker to perform <strong>Remote Code Execution</strong> (<strong>RCE</strong>) on the targeted system. Furthermore, Shodan was able to enumerate a valid username for the <strong>Remote Desktop Protocol</strong> (<strong>RDP</strong>) service that’s running on the device. Such details helps the ethical hacker and penetration tester to improve their attack and future operations for gaining access on the target.</p>
<blockquote>
<p>As an aspiring ethical hacker and penetration tester, ports are open on a system to allow ingress and egress traffic. Identifying open ports helps you to determine the entry-points on a targeted system.</p>
</blockquote>
<ol>
<li>Additionally, if Shodan detects any known security vulnerabilities on the system it will provide the details as shown below:</li>
</ol>
<img src="../media/file170.png" width="943" height="526"/>
<p>As shown in the preceding screenshot, Shodan provides a list of known security vulnerabilities with a brief description and their associated <strong>Common Vulnerabilities and Exposure</strong> (<strong>CVE</strong>) numbers.</p>
<blockquote>
<p>The CVE database allows cybersecurity professionals and researchers to report and track security vulnerabilities at <a href="https://cve.mitre.org/">https://cve.mitre.org/</a>. Furthermore, cybersecurity professionals use the CVE details to create <strong>Cyber Threat Intelligence</strong> (<strong>CTI</strong>) to improve their cyber defenses and mitigate new and emerging threats.</p>
</blockquote>
<p>As shown in the preceding steps, ethical hackers and penetration testers can leverage the search algorithm of Shodan to passively collect information to identify the attack surface of their targets. Shodan can help you gather OSINT data without having to directly engage a target. In the next section, you will discover how to use another well-known tool within the industry to gather in-depth intelligence on systems on the internet.</p>
</section>
<section id="discovering-exposed-systems-with-censys" class="level3" data-number="6.6.3">
<h3 data-number="6.6.3">Discovering exposed systems with Censys</h3>
<p><strong>Censys</strong> is another internet search engine which helps cybersecurity professionals and researchers to collect and analyze information about internet-facing systems and identity their attack surface to better understand how a cyber-criminal leverages public information about such as the domain names, IP addresses and digital certificates that as associated to a targeted organization.To get started working with Censys, please use the following instructions:</p>
<ol>
<li>Firstly, go to <a href="https://search.censys.io/">https://search.censys.io/</a> and register for a free user account on the platform:</li>
</ol>
<img src="../media/file171.png" width="805" height="400"/>
<ol>
<li>After registering for an account, login and use the <strong>Search</strong> field to enter the name, IP address or domain name of your targeted organization and click on <strong>Search</strong> to perform a lookup, as shown below:</li>
</ol>
<img src="../media/file172.png" width="1200" height="873"/>
<p>As shown in the preceding screenshot, a lookup was performed on Cloudflare’s <strong>Domain Name Server</strong> (<strong>DNS</strong>) address. The results shows information about the network and IP addressing, running services and open ports on the server, and the geo-location of the server. Such information is useful when trying to find the geo-location or locale data for a targeted organization.</p>
<ol>
<li>Next, the <strong>Explore</strong> tab provides additional such as association to domain names, IPv4 and IPv6 addresses, and other assets owned by the organization, as shown below:</li>
</ol>
<img src="../media/file173.png" width="759" height="571"/>
<ol>
<li>The <strong>History</strong> tab allows you to view the change which occurred on the targeted system. Understand what has changed helps ethical hackers and penetration tester to determine if there’s a vulnerability within an application or configuration. For instance, installing a new plugin on a web application can introduce new security vulnerabilities which can be exploited by a threat actor.</li>
<li>The <strong>WHOIS</strong> table provides the domain registration details and contact information about the owner of the domain. Sometimes, a domain owner does not pay an additional fee during the domain registration process to conceal their personal information. It’s common for threat actors and ethical hackers to identify the domain registration details to determine the owner’s contact detail and geo-location of the organization.</li>
</ol>
<p>Using the information gathered from Censys, ethical hackers and penetration testers can create a profile of systems that are publicly available through the internet and their open ports. Such information can be leveraged to research security vulnerabilities and techniques to compromise those systems. In the next section, you will learn how to automate passive reconnaissance techniques and acquiring OSINT data.</p>
</section>
<section id="mapping-external-systems-using-maltego" class="level3" data-number="6.6.4">
<h3 data-number="6.6.4">Mapping external systems using Maltego</h3>
<p><strong>Maltego</strong> is a graphical open source intelligence tool that was created maintained by Maltego Technologies. This tool helps ethical hackers and penetration testers collect intelligence on a targeted organization's infrastructure by using a graphical interactive data mining application. This application provides the ability to query and gather information from multiple data sources on the internet and present data in easy-to-understand graphs. These graphs provide visualizations of the relationships between each entity and the target, therefore helps penetration testers to identify the external attack surface or a targeted system, network and organization.To get started with using Maltego for data harvesting, please use the following instructions:</p>
<ol>
<li>Go to <a href="https://www.maltego.com/ce-registration/">https://www.maltego.com/ce-registration/</a> to register for a free Community Edition (CE) user account for the Maltego application.</li>
<li>Next, power-on the <strong>Kali Linux</strong> virtual machine and log-in.</li>
<li>On the <strong>Kali Linux</strong> desktop, open the <strong>Terminal</strong> and use the following commands to update the local package repository list and install Maltego:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ sudo apt update
kali@kali:~$ sudo apt install maltego</code></pre>
</div>
<ol>
<li>Next, click the Kali Linux icon (top-left corner) to expand the applications menu, select <strong>01 – Information Gathering</strong> &gt; <strong>OSINT Analysis</strong> &gt; <strong>maltego</strong>, as shown below:</li>
</ol>
<img src="../media/file174.png" width="623" height="439"/>
<ol>
<li>Next, the Maltego <strong>Product Selection</strong> window will appear, select <strong>Maltego CE</strong> (<strong>Free</strong>) &gt; <strong>Run</strong> to launch the community edition, as shown below:</li>
</ol>
<img src="../media/file175.png" width="865" height="705"/>
<ol>
<li>Next, the <strong>Configure Maltego – License</strong> Agreement windows will appear, accept the license agreement and click on <strong>Next</strong>.</li>
<li>Next, the <strong>Configure Maltego – Login</strong> window appears, ensure your user credentials that were created during step 1, and click on <strong>Next</strong> to continue.</li>
<li>Click <strong>Next</strong> on the <strong>Login Results</strong>, <strong>Install Transforms</strong>, <strong>Help Improve Maltego</strong>, <strong>Web Browser Options</strong>, <strong>Privacy Mode Options</strong> and <strong>Ready</strong> windows.</li>
<li>To start gathering information on a targeted organization, open a new graph. To do this, click on the <strong>Maltego icon</strong> (top-left corner), and then click on <strong>New</strong>:</li>
</ol>
<img src="../media/file176.png" width="1376" height="853"/>
<p>As shown in the preceding screenshot, once a new graph is created, you'll see various types of entities on the left pane, while on the right side, you'll see <strong>Overview</strong>, <strong>Detail View</strong>, and <strong>Property View</strong> panes.</p>
<ol>
<li>Next, to start collecting infrastructure information about a targeted organization, from the <strong>Entity Palette</strong> section, drag and drop the <strong>Domain</strong> entity onto the middle of the graph pane, as shown below:</li>
</ol>
<img src="../media/file177.png" width="763" height="466"/>
<ol>
<li>Next, double-click on the <strong>Domain</strong> entity on the graph pane to open the <strong>Details</strong> window, enter an organization’s domain name within the <strong>Domain Name</strong> field and click on <strong>OK</strong> as shown below:</li>
</ol>
<img src="../media/file178.png" width="834" height="557"/>
<ol>
<li>To retrieve the target’s public DNS records, right-click on the <strong>Domain</strong> entity on the graph pane and select <strong>All Transforms</strong> &gt; <strong>To DNS Name – NS</strong> (<strong>name server</strong>), as shown below:</li>
</ol>
<img src="../media/file179.png" width="454" height="402"/>
<p>Once the transform executes and retrieved data, Maltego populates the graph pane to show the Name Servers of the target. as shown below:</p>
<img src="../media/file180.png" width="503" height="409"/>
<ol>
<li>To retrieve the <strong>Mail Exchange</strong> (<strong>MX</strong>) records to identify a target’s email servers, right-click on the <strong>Domain</strong> entity | select <strong>All Transforms</strong> | <strong>To DNS Name – MX</strong> (<strong>mail server</strong>), as shown below:</li>
</ol>
<img src="../media/file181.png" width="454" height="402"/>
<p>Once Maltego retrieves the MX records from public DNS servers, the graph pane is updated to show the email server(s) of the targeted organization:</p>
<img src="../media/file182.png" width="632" height="402"/>
<ol>
<li>To retrieve the public IP address of the name servers or email servers, right-click on one of the entities on the graph pane | select <strong>All Transforms</strong> | <strong>To IP Address</strong> [<strong>DNS</strong>], as shown below:</li>
</ol>
<img src="../media/file183.png" width="451" height="474"/>
<ol>
<li>Next, to discover if there’s a website that’s associated to the targeted domain, right-click on the <strong>Domain</strong> entity | select <strong>All Transforms</strong> | <strong>To Website</strong> [<strong>Quick lookup</strong>].</li>
<li>To retrieve the public IP address(es) that are associated to the website address, right-click on the <strong>Website</strong> entity | select <strong>All Transforms</strong> | <strong>To IP Address</strong> [<strong>DNS</strong>], as shown below:</li>
</ol>
<img src="../media/file184.png" width="731" height="520"/>
<ol>
<li>To retrieve a list of publicly known email addresses which as associated to the targeted domain, right-click on the <strong>Domain</strong> entity | select <strong>All Transforms</strong> | <strong>To Email addresses</strong> [<strong>PGP</strong>], as shown below:</li>
</ol>
<img src="../media/file185.png" width="722" height="343"/>
<p>Lastly, you can save the information collected by Maltego by clicking on the Maltego icon on the left-corner and selecting the <strong>Save</strong> option.The relation-mapping feature on Maltego helps you analyze information and understand how one component is connected to another. Using the information that's been collected from Maltego, you can determine publicly available servers, IP addresses, employees' email addresses, linked URLs on web pages, and more. As you have seen, using a tool such as Maltego can help automate the process of gathering various types of OSINT data from multiple data sources on the internet, this helps ethical hackers and penetration tester to reducing spent during the reconnaissance phase. Next, you will learn how to use Netcraft to identify the external attack surface, assets and technologies of a targeted organization.</p>
</section>
<section id="identifying-infrastructure-with-netcraft" class="level3" data-number="6.6.5">
<h3 data-number="6.6.5">Identifying infrastructure with Netcraft</h3>
<p>Netcraft enables ethical hackers and penetration testers to collected OSINT on a targeted organization to better understand the technologies, operating systems, applications and locations of their internet-facing devices. Netcraft provides the following data types:</p>
<ul>
<li>Network and IP information</li>
<li>IP geolocation information</li>
<li>Website technologies and applications</li>
</ul>
<p>To get started using Netcraft to profile a targeted organization/domain, please use the following instructions:</p>
<ol>
<li>Using a standard web browser, go to <a href="https://sitereport.netcraft.com/">https://sitereport.netcraft.com/</a>, then enter a targeted domain name within the domain field and click on <strong>Look UP</strong>, as shown below:</li>
</ol>
<img src="../media/file186.png" width="890" height="386"/>
<ol>
<li>After a few seconds, Netcraft will automatically display all information it knows about the targeted domain and its technologies, as shown below:</li>
</ol>
<img src="../media/file187.png" width="1145" height="606"/>
<p>As shown in the preceding screenshot, ethical hackers and penetration testers to use the information to determine the owner of the domain name, the name servers, hosting company and public addresses of the target.</p>
<ol>
<li>Next, to determine the geolocation of the targeted organization, scroll-down to the <strong>SSL</strong>/<strong>TLS</strong> section, as shown below:</li>
</ol>
<img src="../media/file188.png" width="569" height="550"/>
<p>As shown in the preceding screenshot, Netcraft was able to collect and analyzed the information found within the digital certificate for the targeted domain, and provides the organization, state and country. Such information is useful for ethical hackers when planning a physical penetration test. In addition, the <strong>Subject Alternative Name</strong> field provide additional sub-domains which are permitted to use this digital certificate, this data helps penetration testers to identify additional assets that are owned by the target.</p>
<ol>
<li>Next, the <strong>Site Technology</strong> section provides valuable information such as identifying the server-side and client-side technologies, this information is useful when planning a web application penetration test, as shown below:</li>
</ol>
<img src="../media/file189.png" width="934" height="543"/>
<p>Having completed this exercise, you have gained the skills on how ethical hackers are able to leverage Netcraft to identify the public infrastructure of a targeted organization. Next, you will learn how to use Recon-ng to automate data collection and analysis as an ethical hacker.</p>
</section>
<section id="using-recon-ng-for-data-harvesting" class="level3" data-number="6.6.6">
<h3 data-number="6.6.6">Using Recon-ng for data harvesting</h3>
<p><strong>Recon-ng</strong> is an OSINT reconnaissance framework written in Python. The tool itself contains a lot of modules for additional capabilities, a database for storing OSINT, interactive help, and a menu system, similar to Metasploit. Recon-ng can perform web-based, information-gathering techniques to collect OSINT from multiple online data sources, and it's one of the must-have tools for any aspiring ethical hacker or penetration tester to have within their arsenal.To get started using recon-ng for data harvesting, please use the following instructions:</p>
<ol>
<li>Power-on the <strong>Kali Linux</strong> virtual machine and execute the following command within the <strong>Terminal</strong> to start Recon-ng:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ recon-ng</code></pre>
</div>
<ol>
<li>Recon-ng uses various modules which are designed to collect and analyze data from multiple data sources. By default, there are no modules pre-installed on Recon-ng, therefore use the following commands to install all modules from the Recon-ng marketplace:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>[recon-ng][default] &gt; marketplace install all</code></pre>
</div>
<p>The following screenshot shows Recon-ng is downloading and setting up the modules:</p>
<img src="../media/file190.png" width="1076" height="336"/>
<p>After the modules are installed, Recon-ng will automatically reload the newly installed modules and there will be a lot of warning messages that are written in red, as shown below:</p>
<img src="../media/file191.png" width="1584" height="233"/>
<p>The preceding screenshot shows there are various Recon-ng modules which requires an <strong>Application Programming Interface</strong> (<strong>API</strong>) key to allow Recon-ng to retrieve OSINT from the data source.</p>
<blockquote>
<p>The <code>modules search</code> command is used to display all current modules with Recon-ng and their categories, such as Discovery, Exploitation, Import, Recon and Reporting.</p>
</blockquote>
<ol>
<li>Next, to view a list of supported API keys on Recon-ng, use the following commands:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>[recon-ng][default] &gt; keys list</code></pre>
</div>
<p>As shown in the following screenshot, the key list commands allows us to view which API keys are supported and whether there’s already an API in-use:</p>
<img src="../media/file192.png" width="582" height="527"/>
<ol>
<li>Next, to get a supported API key, simply go to the data source such as <strong>BuiltWith</strong> at <a href="https://builtwith.com/">https://builtwith.com/</a> and create a free user account. Once account is created, login and go to <strong>Tools</strong> &gt; <strong>API Access</strong> to find the API key. Feel free to acquire as many API keys for each supported modules from the list of supported APIs.</li>
</ol>
<p>Consider getting an API key from the following data sources:</p>
<ul>
<li>Hunter - <a href="https://hunter.io">https://hunter.io</a></li>
<li>Censys - <a href="https://search.censys.io">https://search.censys.io</a></li>
<li>VirusTotal - <a href="https://www.virustotal.com">https://www.virustotal.com</a></li>
<li>Shodan - <a href="https://www.shodan.io/">https://www.shodan.io/</a></li>
</ul>
<ol>
<li>Once you’ve acquired your API keys, the next step it to add each API to their API-supported modules. Use the <code>keys add &lt;API-module-name&gt; &lt;API key value&gt;</code> command. For instance, the following commands are used to add an API key for the <code>builtwith_api</code>, as shown below:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>[recon-ng][default] &gt; keys add builtwith_api 12345</code></pre>
</div>
<ol>
<li>After adding your API keys, use the <code>keys list</code> command to verify whether the keys were added successfully, as shown below:</li>
</ol>
<img src="../media/file193.png" width="1232" height="815"/>
<ol>
<li>As an ethical hacker and penetration tester, you may be working on multiple projects at a time, Recon-ng enables you to create multiple, virtual workspaces to help you better manage the collection and analysis of data. To create a new workspace, use the following commands:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>[recon-ng][default] &gt; workspaces create myfirstproject</code></pre>
</div>
<blockquote>
<p>Once a new workspace is created, Recon-ng will automatically move your working environment from <code>default</code> to your new workspace. To view a list of available workspaces within Recon-ng, use the <code>workspaces list</code> command. Additionally, the <code>workspaces load &lt;workspace-name&gt;</code> command allows you to select and work within a specific workspace, while the <code>workspaces remove &lt;workspace-name&gt;</code> command removes a workspace from Recon-ng.</p>
</blockquote>
<ol>
<li>Next, the <code>modules search &lt;keyword&gt;</code> commands enables you to search for specific modules based on a keyword. For instance, use the <code>modules search whois</code> command to view all Recon-ng modules which contains the <code>whois</code> keyword, as shown below:</li>
</ol>
<img src="../media/file194.png" width="698" height="309"/>
<ol>
<li>Next, to use a specific module within Recon-ng, use the <code>modules load &lt;module-name&gt;</code> command. For instance, to gather a list of <strong>point-of-contacts</strong> (<strong>POCS</strong>) for a targeted domain on the internet, use the following commands:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>[recon-ng][myfirstproject] &gt; modules load recon/domains-contacts/whois_pocs
[recon-ng][myfirstproject][whois_pocs] &gt; info</code></pre>
</div>
<p>As shown in the following screenshot, the info command prints the description and required options for the selected module:</p>
<img src="../media/file195.png" width="1311" height="605"/>
<ol>
<li>To set the required options for the module, use the following commands to set <code>microsoft.com</code> as the <strong>SOURCE</strong> for our targeted domain:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>[recon-ng][myfirstproject][whois_pocs] &gt; options set SOURCE microsoft.com</code></pre>
</div>
<blockquote>
<p>To unset a value within a module, use the <code>options unset &lt;parameter/value&gt;</code> command. Ensure that you execute the <code>info</code> command afterwards to verify the value is unset/removed.</p>
</blockquote>
<ol>
<li>Next, use the <code>run</code> command to execute the module, as shown below:</li>
</ol>
<img src="../media/file196.png" width="859" height="708"/>
<ol>
<li>Next, use the <code>back</code> command to exit a module and <code>modules search bing</code> command to for modules that can leverage the Bing search engine, as shown below:</li>
</ol>
<img src="../media/file197.png" width="727" height="336"/>
<ol>
<li>Next, use the following command to load the <code>bing_domain_web</code> module, display its information, set the targeted domain and execute the module:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>[recon-ng][myfirstproject] &gt; modules load recon/domains-hosts/google_site_web
[recon-ng][myfirstproject][google_site_web] &gt; info
[recon-ng][myfirstproject][google_site_web] &gt; options set SOURCE microsoft.com
[recon-ng][myfirstproject][google_site_web] &gt; run</code></pre>
</div>
<ol>
<li>Use the <code>show hosts</code> command to view a list of sub-domains and hostnames that were collected about the target, as shown below:</li>
</ol>
<img src="../media/file198.png" width="1310" height="315"/>
<ol>
<li>Next, use the <code>show contacts</code> command to view a list of contact information that was collected, as shown below:</li>
</ol>
<img src="../media/file199.png" width="1566" height="439"/>
<blockquote>
<p>The show command can be used with show [<code>companies</code>] [<code>credentials</code>] [<code>hosts</code>] [<code>locations</code>] [<code>ports</code>] [<code>pushpins</code>] [<code>vulnerabilities</code>] [<code>contacts</code>] [<code>domains</code>] [<code>leaks</code>] [<code>netblocks</code>] [<code>profiles</code>] [<code>repositories</code>] to view specific information that was obtained by Recon-ng. Additionally, the <code>dashboard</code> command provides a summary of all activites in Recon-ng such as showing the number of times a module was executed and how much data was collected.</p>
</blockquote>
<ol>
<li>To view a summary of your activities within the <code>myfirstproject</code> workspace, use the <code>dashboard</code> command, as shown below:</li>
</ol>
<img src="../media/file200.png" width="772" height="425"/>
<ol>
<li>Next, collecting all the data can overwhelming to process and analyzed, however Recon-ng has various reporting modules to help us. Use the <code>modules search report</code> command to view a list of all reporting modules, as shown below:</li>
</ol>
<img src="../media/file201.png" width="798" height="441"/>
<ol>
<li>To generate an HTML-format report, use the following commands to set the required parameters and specify the output location for the final report:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>[recon-ng][myfirstproject] &gt; modules load reporting/html
[recon-ng][myfirstproject][html] &gt; info
[recon-ng][myfirstproject][html] &gt; options set CREATOR GLEN
[recon-ng][myfirstproject][html] &gt; options set CUSTOMER ACME_Enterprises
[recon-ng][myfirstproject][html] &gt; options set FILENAME /home/kali/Desktop/myfirstproject_report.html
[recon-ng][myfirstproject][html] &gt; run</code></pre>
</div>
<p>The following screenshot shows the how to preceding commands were applied on the module:</p>
<img src="../media/file202.png" width="1725" height="800"/>
<ol>
<li>To view the report, simply go to the output directory such as <code>/home/kali/Desktop</code> and open the report HTML file using the web browser, as shown below:</li>
</ol>
<img src="../media/file203.png" width="905" height="503"/>
<p>This report provides a very easy-to-understand summary of all the data that was collected using Recon-ng. The reporting module plays an excellent role in helping ethical hackers to correlate data about their target during the reconnaissance phase.</p>
<ol>
<li>Next, to access the web interface of Recon-ng, use the following command on a new Terminal:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ recon-web</code></pre>
</div>
<ol>
<li>Once the workspace has been initialized, open the web browser within Kali Linux and go to <code>http://127.0.0.1:5000/</code>, as shown below:</li>
</ol>
<img src="../media/file204.png" width="914" height="647"/>
<ol>
<li>As shown in the preceding screenshot, ethical hackers and penetration testers can improve their data collection and analysis using the web interface of Recon-ng.</li>
</ol>
<blockquote>
<p>To learn more about Recon-ng and its features, please visit the official GitHub repository at: <a href="https://github.com/lanmaster53/recon-ng">https://github.com/lanmaster53/recon-ng</a>.</p>
</blockquote>
<p>Having completed this exercise, you’ve learnt how to leverage Recon-ng to efficiently collect and analysis OSINT from multiple data sources. Next, you will learn how to use theHarvester for data harvesting.</p>
</section>
<section id="data-collection-with-theharvester" class="level3" data-number="6.6.7">
<h3 data-number="6.6.7">Data collection with theHarvester</h3>
<p>Using a tool such as <strong>theHarvester</strong> enables to you efficiently collect OSINT to identify sub-domains and additional exposed assets of a targeted organization. To get started using theHarvester for data collection, please use the following instructions:</p>
<ol>
<li>Firstly, power-on the <strong>Kali Linux</strong> virtual machine and ensure it has internet connectivity.</li>
<li>Next, open the <strong>Terminal</strong> and use the following command to display the menu for theHarvester:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ theHarvester -h</code></pre>
</div>
<p>The preceding command displays the help menu and provides a list of various syntax and how they can be used to retrieve OSINT from online sources. In addition, the help menu provides a list of various data sources using the <code>-b</code> command.</p>
<ol>
<li>Next, to retrieve a list of sub-domains of a targeted domain, use the following commands:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ theHarvester -d microsoft.com -b duckduckgo
kali@kali:~$ theHarvester -d microsoft.com -b dnsdumpster
kali@kali:~$ theHarvester -d microsoft.com -b bing
kali@kali:~$ theHarvester -d microsoft.com -b yahoo
kali@kali:~$ theHarvester -d microsoft.com -b crtsh</code></pre>
</div>
<p>The following screenshot shows theHarvester was able to collect multiple sub-domains for the targeted domain:</p>
<img src="../media/file205.png" width="638" height="389"/>
<blockquote>
<p>To learn more about the features of theHarvester, please visit the official GitHub repository at: <a href="https://github.com/laramies/theHarvester">https://github.com/laramies/theHarvester</a>. Some sources require an API key to retrieve data from the online database, to learn more how to add an API key to theHarvester, please see: <a href="https://github.com/laramies/theHarvester/wiki/Installation#api-keys">https://github.com/laramies/theHarvester/wiki/Installation#api-keys</a>.</p>
</blockquote>
<p>Having completed this section, you have gained the skills needed to collect OSINT information on targeted organizations to identify how they are leaking data such as their internal infrastructure to anyone on the internet. In the next section, you will learn how to gather employee OSINT.</p>
</section>
</section>
<section id="harvesting-employees-data" class="level2" data-number="6.7">
<h2 data-number="6.7">Harvesting employees’ data</h2>
<p>Around the world, employees of many organizations commonly leak and share too much information about themselves and their organization without realizing how a threat actor or adversary can collect and analyze such information to plan a cyber-attack or improve a threat towards their organizations and themselves. Quite often, you’ll notice that many employees of the leadership team for an organization commonly share their contact details on professional social networking platforms, such as the following types of the information:</p>
<ul>
<li>Full name and job title</li>
<li>Company’s email address</li>
<li>Telephone number</li>
<li>Roles and responsibilities</li>
<li>Recent projects with technical details</li>
<li>Pictures of their employee badges</li>
</ul>
<p>As a penetration tester, it's quite simple to create an account that will function as a sock puppet on a site such as LinkedIn, populate some false information on the account, such as information stating you're an employee who is working at another branch office, and then add some low-level employees from the targeted organization as connections. Therefore, other employees of the targeted organization will notice your sock puppet profile has mutual connections and may reduce suspicions.There’s a possibility the employees will automatically accept the connection/friend request because they will see that you're a fellow employee at their company. This will provide some leverage for you to connect with the high-profile employees of the targeted organization and enabling you collect contact details to plan various social engineering attacks and identify your targets.</p>
<section id="working-with-hunter" class="level3" data-number="6.7.1">
<h3 data-number="6.7.1">Working with Hunter</h3>
<p>Hunter is an online data source that harvests both employee and organizational data from public sources on the internet. As an ethical hacker and penetration tester, this is a must-have resource for gathering employees' names, telephone numbers, email addresses, and even their job titles when planning a social engineering attack.To get started using this tool, please use the following instructions:</p>
<ol>
<li>Firstly, you’ll need to register for a free account at <a href="https://hunter.io/">https://hunter.io/</a> and complete the registration process.</li>
<li>Once the registration process is completed, log-in to online platform using your user credentials.</li>
<li>Next, you’ll be presented with the <strong>Domain Search</strong> field, simply enter a targeted domain, as shown below:</li>
</ol>
<img src="../media/file206.png" width="682" height="171"/>
<ol>
<li>While entering a domain within the <strong>Domain Search</strong> field, Hunter will provide suggestions for your search, I’ve used <code>microsoft.com</code> as an example, as shown below:</li>
</ol>
<img src="../media/file207.png" width="750" height="617"/>
<p>As shown in the preceding screenshot, Hunter can provide a list of employees' information, such as their names, email addresses, telephone numbers, and other sources of information. In addition, collecting email addresses for a targeted organizations helps you to determine the format of employees’ email addresses. Therefore, if an adversary or ethical hacker knows the names of employees, then it’s a bit easy to guess the email addresses of various employees, this information is useful when planning social engineering, password spraying and credential stuffing attacks.</p>
<blockquote>
<p>To learn more about password spraying and credential stuffing attacks, please see <a href="https://attack.mitre.org/techniques/T1110/003/">https://attack.mitre.org/techniques/T1110/003/</a> and <a href="https://attack.mitre.org/techniques/T1110/004/">https://attack.mitre.org/techniques/T1110/004/</a>.</p>
</blockquote>
<p>The following screenshot shows all the sources that Hunter used to collect the data for a specific person:</p>
<img src="../media/file208.png" width="609" height="216"/>
<p>While employees will provide their contact details on various online platforms, including their company's website, such information can be leveraged by a threat actor and a penetration tester to perform social engineering attacks against the organization.</p>
</section>
</section>
<section id="social-media-reconnaissance" class="level2" data-number="6.8">
<h2 data-number="6.8">Social media reconnaissance</h2>
<p>Employees of an organization often leak too much information about themselves and their company. While many employees are very happy to be working in their organizations, sometimes, they share information that can be leveraged by threat actors to improve their attack on a target. As an aspiring ethical hacker and penetration tester, collecting and analyzing information from social media platforms can be useful in finding unsecure employee profiles with weak privacy and collecting any sensitive data from their profiles.The following is some information that's commonly leaked:</p>
<ul>
<li>Employee contact information, such as telephone numbers and email addresses, which can be used during social engineering and account takeover attacks.</li>
<li>Sharing photos with their employee badges, which can be used by a threat actor to create a fake ID for impersonation for physical penetration testing.</li>
<li>Pictures of an employee's computing systems and desktop, which can inform a threat actor about the available device vendors and operating systems.</li>
<li>Projects that have been completed by the employee may contain specific technical details, which can allow a threat actor to profile the internal network infrastructure.</li>
</ul>
<p>These are just some of the many types of information that are commonly posted on social media platforms such as LinkedIn. As a penetration tester, you can create a sock puppet, impersonate someone on social media, and trick the employees of the targeted organization into performing an action or revealing sensitive information (social engineering). Furthermore, imagine performing a physical penetration test, where you can print a fake employee ID badge and dress like a typical employee by using the information found on the targeted organization's social media page. Over the next few sub-sections, you will learn how to perform social media reconnaissance.</p>
<section id="automating-with-sherlock" class="level3" data-number="6.8.1">
<h3 data-number="6.8.1">Automating with Sherlock</h3>
<p><strong>Sherlock</strong> is an OSINT tool that helps penetration testers quickly determine whether their target has any social media accounts and which platforms the accounts may exist on. This tool supports over 200 social media websites, automates the process of checking each site, and generates a report of the results.To get started using Sherlock for social media reconnaissance, please use the following instructions:</p>
<ol>
<li>Power-on the <strong>Kali Linux</strong> virtual machine, open the <strong>Terminal</strong> and use the following commands to download <strong>Sherlock</strong> from its official GitHub repository:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ sudo apt update
kali@kali:~$ git clone https://github.com/sherlock-project/Sherlock</code></pre>
</div>
<ol>
<li>Next, use the following commands to install the requirements for Sherlock:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~$ cd sherlock
kali@kali:~/sherlock$ python3 -m pip install -r requirements.txt</code></pre>
</div>
<ol>
<li>Next, to search for a targeted organization social media presence on the internet, use the <code>python3 sherlock &lt;username&gt;</code> command, as shown below:</li>
</ol>
<div class="C1-ConsolePACKT">
<pre><code>kali@kali:~/sherlock$ python3 sherlock microsoft --timeout 5</code></pre>
</div>
<p>Notice the <code>--timeout</code> command was used to instruct Sherlock to not spend more than 5 seconds on any of the social media sites, as shown here:</p>
<img src="../media/file209.png" width="1148" height="721"/>
<p>When Sherlock completes the task, the results will be stored into a text file within the present working directory, as shown below:</p>
<img src="../media/file210.png" width="984" height="388"/>
<p>Be sure to check each site within the output file to ensure it is valid and provides meaningful information about your target. A penetration tester can use the information that's been collected to easily identify the social media accounts owned by a targeted organization or user. Such information can be also used to gather further intelligence of the target.Having completed this section, you have learnt how to automate the data collection process of finding user accounts for a targeted organization or person using Sherlock.</p>
</section>
</section>
<section id="summary-4" class="level2" data-number="6.9">
<h2 data-number="6.9">Summary</h2>
<p>During this chapter, you have learnt how to apply various Google hacking techniques to perform advanced search and filtering to identify sensitive directories and exposed resources on the internet. In addition, you have gained the hands-on skills needed to perform domain reconnaissance to collect and analyze DNS records, perform zone transfer and identify sub-domains of a target. Furthermore, you have learned how to leverage specialized internet search engines to identify exposed assets of companies around the world, and gained a better understanding on how OSINT helps ethical hackers and penetration testers to develop a profile about their targets.I trust that the knowledge presented in this chapter has provided you with valuable insights, supporting your path towards becoming an ethical hacker and penetration tester in the dynamic field of cybersecurity. May this newfound understanding empower you in your journey, allowing you to navigate the industry with confidence and make a significant impact. In the next chapter, <em>Exploring Active Reconnaissance</em>, you will learn how to perform active reconnaissance techniques to identify live systems, open ports and running services.</p>
</section>
<section id="further-reading-4" class="level2" data-number="6.10">
<h2 data-number="6.10">Further Reading</h2>
<ul>
<li>Open source intelligence - <a href="https://www.imperva.com/learn/application-security/open-source-intelligence-osint/">https://www.imperva.com/learn/application-security/open-source-intelligence-osint/</a></li>
<li>Top OSINT tools - <a href="https://www.csoonline.com/article/567859/what-is-osint-top-open-source-intelligence-tools.html">https://www.csoonline.com/article/567859/what-is-osint-top-open-source-intelligence-tools.html</a></li>
<li>What is Whois - <a href="https://www.domaintools.com/support/what-is-whois-information-and-why-is-it-valuable/">https://www.domaintools.com/support/what-is-whois-information-and-why-is-it-valuable/</a></li>
</ul>
</section>
</section>
</div>
</div>
</body>
</html>