- en: Chapter 1. Wireless Lab Setup
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '|   | *"If I had eight hours to chop down a tree, I''d spend six hours sharpening
    my axe."* |   |'
  prefs: []
  type: TYPE_TB
- en: '|   | --*Abraham Lincoln, 16th US President* |'
  prefs: []
  type: TYPE_TB
- en: '*Behind every successful execution is hours or days of preparation, and wireless
    penetration testing is no exception. In this chapter, we will create a wireless
    lab that we will use for our experiments in this book. Consider this lab as your
    preparation arena before you dive into real-world penetration testing!*'
  prefs: []
  type: TYPE_NORMAL
- en: '*Wireless penetration testing is a practical subject, and it is important to
    first set up a lab, where we can try out all the different experiments in this
    book in a safe and controlled environment. It is important that you set up this
    lab first before moving on in this book.*'
  prefs: []
  type: TYPE_NORMAL
- en: 'In this chapter, we will take a look at the following:'
  prefs: []
  type: TYPE_NORMAL
- en: Hardware and software requirements
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Installing Kali
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Setting up an access point and configuring it
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Installing the wireless card
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Testing connectivity between the laptop and the access point
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: So let the games begin!
  prefs: []
  type: TYPE_NORMAL
- en: Hardware requirements
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'We will need the following hardware to set up the wireless lab:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Two laptops with internal Wi-Fi cards**: We will use one of the laptops as
    the victim in our lab and the other as the penetration tester''s laptop. Though
    almost any laptop would fit this profile, laptops with at least 3 GB RAM are desirable.
    This is because we may be running a lot of memory-intensive software in our experiments.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**One wireless adapter (optional)**: Depending on the wireless card of your
    laptop, we may need a USB Wi-Fi card that can support packet injection and packet
    sniffing, which is supported by Kali. The best choice seems to be the Alfa AWUS036H
    card from Alfa Networks, as Kali supports this out of the box. This is available
    on [www.amazon.com](http://www.amazon.com) for a retail price of £18 at the time
    of writing. An alternative option is the Edimax EW-7711UAN, which is smaller and,
    marginally, cheaper.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**One access point**: Any access8 point that supports WEP/WPA/WPA2 encryption
    standards would fit the bill. I will be using a TP-LINK TL-WR841N Wireless router
    for the purpose of illustration in this book. You can purchase it from [www.amazon.com](http://www.amazon.com)
    for a retail price of around £20 at the time of writing.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**An internet connection**: This will come in handy for performing research,
    downloading software, and for some of our experiments.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Software requirements
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'We will need the following software to set up the wireless lab:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Kali**: This software can be downloaded from the official website located
    at [http://www.kali.org](http://www.kali.org). The software is open source, and
    you should be able to download it directly from the website.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Windows XP/Vista/7/10**: You will need any one of Windows XP, Windows Vista,
    Windows 7, or Windows 10 installed on one of the laptops. This laptop will be
    used as the victim machine for the rest of the book.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Note
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Important to note is that even though we are using a Windows-based OS for our
    tests, the techniques learnt can be applied to any Wi-Fi-capable devices, such
    as smartphones and tablets, among others.
  prefs: []
  type: TYPE_NORMAL
- en: Installing Kali
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Let's now quickly take a look at how to get up and running with Kali.
  prefs: []
  type: TYPE_NORMAL
- en: Kali will be installed on the laptop that will serve as the penetration tester's
    machine for the rest of the book.
  prefs: []
  type: TYPE_NORMAL
- en: Time for action – installing Kali
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Kali is relatively simple to install. We will run Kali by booting it as a live
    DVD, and then install it on the hard drive.
  prefs: []
  type: TYPE_NORMAL
- en: 'Perform the following instructions step by step:'
  prefs: []
  type: TYPE_NORMAL
- en: Burn the Kali ISO (we are using the Kali 32-bit ISO) you downloaded, onto a
    bootable DVD.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Boot the laptop with this DVD and select the option **Install** from **Boot
    menu**:![Time for action – installing Kali](graphics/B09903_01_01.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: If booting was successful, then you should see an awesome retro screen as shown
    in the following screenshot:![Time for action – installing Kali](graphics/B09903_01_02.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: This installer is similar to the GUI-based installers of most Linux systems
    and should be simple to follow. Select the appropriate options on every screen
    and start the installation process. Once the installation is done, restart the
    machine as prompted and remove the DVD.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Once the machine restarts, a login screen will be displayed. Log in as `root`
    and the password is whatever you set it to during the installation process. You
    should now be logged into your installed version of Kali. Congratulations!
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: I will change the desktop theme and some settings for this book. Feel free to
    use your own themes and color settings!
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '*What just happened?*'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We have successfully installed Kali on the laptop! We will use this laptop as
    the penetration tester's laptop for all other experiments in this book.
  prefs: []
  type: TYPE_NORMAL
- en: Have a go hero – installing Kali on VirtualBox
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We can also install Kali within virtualization software such as VirtualBox.
    If you don't want to dedicate a full laptop to Kali, this is the best option.
    Kali's installation process in VirtualBox is exactly the same. The only difference
    is the pre-setup, which you will have to create in VirtualBox. Have a go at it!
    You can download VirtualBox from [http://www.virtualbox.org](http://www.virtualbox.org).
  prefs: []
  type: TYPE_NORMAL
- en: One of the other ways in which we can install and use Kali is via USB drives.
    This is particularly useful if you do not want to install on the hard drive, but
    still want to store persistent data, such as scripts and new tools, on your Kali
    instance. We encourage you to try this out as well!
  prefs: []
  type: TYPE_NORMAL
- en: Setting up the access point
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Now we will set up the access point. As mentioned earlier, we will be using
    the TP-LINK TL-WR841N Wireless router for all the experiments in this book. However,
    feel free to use any other access point. The basic principles of operation and
    usage remain the same.
  prefs: []
  type: TYPE_NORMAL
- en: Time for action – configuring the access point
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Let's begin! We will set the access point up to use **Open Authentication**
    (**OAuth**) with an SSID of `Wireless Lab`.
  prefs: []
  type: TYPE_NORMAL
- en: 'Follow these instructions step by step:'
  prefs: []
  type: TYPE_NORMAL
- en: Power on the access point, and use an Ethernet cable to connect your laptop
    to one of the access point's Ethernet ports.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Enter the IP address of the access point configuration terminal in your browser.
    For TP-Link, it is by default `192.168.1.1`. You should consult your access point's
    setup guide to find its IP address. If you do not have the manuals for the access
    point, you can also find the IP address by running the `route –n` command. The
    gateway IP address is typically the access point's IP. Once you are connected,
    you should see a configuration portal that looks like the following **TP-LINK
    Wireless N Router WR841N** emblazoned screenshot:![Time for action – configuring
    the access point](graphics/B09903_01_03.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Explore the various settings in the portal after logging in, and find the settings
    related to configuring a new SSID.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Change the SSID to `Wireless Lab`. Depending on the access point, you may have
    to reboot it for the settings to change.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Similarly, find the settings related to **Wireless Security** and change the
    setting to **Disable Security**. **Disable Security** indicates that it is using
    the Open Authentication mode.![Time for action – configuring the access point](graphics/B09903_01_04.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Save the changes to the access point and reboot it, if required. Now your access
    point should be up-and-running with an SSID, `Wireless Lab`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'An easy way to verify this is to use the wireless configuration utility in
    Windows and observe the available networks using the Windows laptop. You should
    find `Wireless Lab` as one of the networks in the listing:'
  prefs: []
  type: TYPE_NORMAL
- en: '![Time for action – configuring the access point](graphics/B09903_01_05.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '*What just happened?*'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We have successfully set up our access point with an SSID, `Wireless Lab`. It
    is broadcasting its presence, and this is being picked up by our Windows laptop
    and others within the **Radio Frequency** (**RF**) range of the access point.
  prefs: []
  type: TYPE_NORMAL
- en: Important to note is that we configured our access point in the **Open** mode,
    which is the least secure. It is advisable not to connect this access point to
    the internet for the time being, as anyone within the RF range will be able to
    use it to access the internet.
  prefs: []
  type: TYPE_NORMAL
- en: Have a go hero – configuring the access point to use WEP and WPA
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Play around with the configuration options of your access point. Try to get
    it up-and-running using encryption schemes such as WEP and WPA/WPA2\. We will
    use these modes in later chapters to illustrate attacks against them.
  prefs: []
  type: TYPE_NORMAL
- en: Setting up the wireless card
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Setting up our wireless adapter is much easier than the access point. The advantage
    is that Kali supports this card out of the box and ships with all requisite device
    drivers to enable packet injection and packet sniffing.
  prefs: []
  type: TYPE_NORMAL
- en: Time for action – configuring your wireless card
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: We will be using the wireless adapter with the penetration tester's laptop.
  prefs: []
  type: TYPE_NORMAL
- en: 'Follow these instructions step by step to set up your card:'
  prefs: []
  type: TYPE_NORMAL
- en: Plug in the card to one of the Kali laptop's USB ports and boot it. Once you
    log in, open a console terminal and type in `iwconfig`. Your screen should look
    as follows:![Time for action – configuring your wireless card](graphics/B09903_01_06.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: As you can see, `wlan0` is the wireless interface created for the wireless adapter.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: 'Type in `ifconfig wlan0 up` to bring the interface up. Then, type in `ifconfig
    wlan0` to see the current state of the interface:'
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: '![Time for action – configuring your wireless card](graphics/B09903_01_07.jpg)'
  prefs:
  - PREF_IND
  type: TYPE_IMG
- en: The MAC address `00:c0:ca:3e:bd:93` should look like the MAC address written
    under your Alfa card. I am using the Edimax that gives me the preceding MAC address
    `80:1f:02:8f:34:d5`. This is a quick check to ensure that you have enabled the
    correct interface.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '*What just happened?*'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Kali ships with all the required drivers for the Alfa and Edimax adapters out
    of the box. As soon as the machine booted, the adapter was recognized and was
    assigned the network interface `wlan0`. Now our wireless adapter is up and functional!
  prefs: []
  type: TYPE_NORMAL
- en: Connecting to the access point
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Now we will take a look at how to connect to the access point using the wireless
    adapter. Our access point has an SSID, `Wireless Lab` and does not use any authentication.
  prefs: []
  type: TYPE_NORMAL
- en: Time for action – configuring your wireless card
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Here we go! Follow these steps to connect your wireless card to the access
    point:'
  prefs: []
  type: TYPE_NORMAL
- en: Let's first see what wireless networks our adapter is currently detecting. Issue
    the `iwlist wlan0 scanning` command, and you will find a list of networks in your
    vicinity:![Time for action – configuring your wireless card](graphics/B09903_01_08.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Keep scrolling down and you should find the `Wireless Lab` network in this list.
    In my setup, it is detected as `Cell 05`; it may be different in yours. The `ESSID`
    field contains the network name.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: As multiple access points can have the same SSID, verify that the MAC address
    mentioned in the preceding `Address` field matches your access point's MAC. A
    fast and easy way to get the MAC address is underneath the access point or using
    web-based GUI settings.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now, issue the `iwconfig wlan0 essid "Wireless Lab"` command and then `iwconfig
    wlan0` to check the status. If you have successfully connected to the access point,
    you should see the MAC address of the access point in the `Access Point` field
    in the output of `iwconfig`.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: We know that the access point has a management interface IP address `192.168.0.1`
    from its manual. Alternately, this is the same as the default router IP address
    when we run the `route –n` command. Let's set our IP address in the same subnet
    by issuing the `ifconfig wlan0 192.168.0.2 netmask 255.255.255.0 up` command.
    Verify that the command succeeded by typing `ifconfig wlan0` and checking the
    output.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Now let's ping the access point by issuing the `ping 192.168.0.1` command. If
    the network connection has been set up properly, then you should see the responses
    from the access point. You can additionally issue an `arp –a` command to verify
    that the response is coming from the access point. You should see that the MAC
    address of the IP `192.168.0.1` is the access point's MAC address we noted earlier.
    It is important to note that some of the more recent access points might have
    responses to the **Internet Control Message Protocol** (**ICMP**) echo request
    packets disabled. This is typically done to make the access point secure out of
    the box with only minimal configuration settings available. In such a case, you
    can try to launch a browser and access the web interface to verify that the connection
    is up-and-running:![Time for action – configuring your wireless card](graphics/B09903_01_09.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: On the access point, we can verify connectivity by looking at the connection
    logs. As you can see in the following log, the MAC address of the wireless card
    `4C:0F:6E:70:BD:CB` has been logged making DHCP requests from the router:![Time
    for action – configuring your wireless card](graphics/B09903_01_10.jpg)
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '*What just happened?*'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We just connected to our access point successfully from Kali using our wireless
    adapter as the wireless device. We also learned how to verify that a connection
    has been established at both the wireless client and the access point side.
  prefs: []
  type: TYPE_NORMAL
- en: Have a go hero – establishing a connection in a WEP configuration
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Here is a challenging exercise for you: set up the access point in a WEP configuration.
    For each of these, try establishing a connection with the access point using the
    wireless adapter. Hint: check the manual for the `iwconfig` command by typing
    `man iwconfig` to see how to configure the card to connect to WEP.'
  prefs: []
  type: TYPE_NORMAL
- en: Pop quiz – understanding the basics
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Q1\. After issuing the `ifconfig wlan0` command, how do you verify that the
    wireless card is up and functional?
  prefs: []
  type: TYPE_NORMAL
- en: Q2\. Can we run all our experiments using the Kali live CD alone? Can we not
    install the CD to the hard drive?
  prefs: []
  type: TYPE_NORMAL
- en: Q3\. What does the `arp –a` command show?
  prefs: []
  type: TYPE_NORMAL
- en: Q4\. Which tool should we use in Kali to connect to WPA/WPA2 networks?
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'This chapter provided you with detailed instructions on how to set up your
    own wireless lab. Also, in the process, you learned the basic steps do the following:'
  prefs: []
  type: TYPE_NORMAL
- en: Installing Kali on your hard drive and exploring other options such as virtual
    machines and USBs
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Configuring your access point over the web interface
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Understanding and using several commands to configure and use your wireless
    card
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Verifying the connection state between the wireless client and the access point
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Gaining confidence in configuring the system is important for you. If you aren't
    confident, it is advisable that you repeat the preceding examples a couple of
    times. In later chapters, we will design more complicated scenarios.
  prefs: []
  type: TYPE_NORMAL
- en: In the next chapter, you will learn about inherent design-based insecurities
    in the WLANs design. We will use the network analyzer tool, Wireshark, to understand
    these concepts in a practical way.
  prefs: []
  type: TYPE_NORMAL
