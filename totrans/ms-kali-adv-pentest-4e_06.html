<html><head></head><body>
  <div id="_idContainer247" class="Basic-Text-Frame">
    <h1 class="chapterNumber">6</h1>
    <h1 id="_idParaDest-164" class="chapterTitle">Wireless and Bluetooth Attacks</h1>
    <p class="normal">The dominance of mobile devices has led the majority of companies to adopt <strong class="keyWord">Bring Your Own Devices</strong> (<strong class="keyWord">BYOD</strong>) and the need to provide instant network connectivity, with wireless networks becoming the ubiquitous access point to the internet. Unfortunately, the convenience of wireless access is accompanied by an increase in effective attacks that result in the theft of data and unauthorized access, as well as the denial of service of network resources. Kali provides several tools to configure and launch these wireless attacks, allowing organizations to improve security.</p>
    <p class="normal">In this chapter, we will examine several housekeeping tasks and wireless attacks, including the following topics:</p>
    <ul>
      <li class="bulletList">Configuring Kali for wireless and Bluetooth attacks</li>
      <li class="bulletList">Wireless and Bluetooth reconnaissance</li>
      <li class="bulletList">Bypassing a hidden <strong class="keyWord">Service Set Identifier</strong> (<strong class="keyWord">SSID</strong>)</li>
      <li class="bulletList">Bypassing MAC address authentication and open authentication</li>
      <li class="bulletList">Compromising WPA/WPA2 encryption and performing <strong class="keyWord">Man-in-The-Middle</strong> (<strong class="keyWord">MiTM</strong>) attacks</li>
      <li class="bulletList">Attacking wireless routers with Reaver</li>
      <li class="bulletList"><strong class="keyWord">Denial-of-Service</strong> (<strong class="keyWord">DoS</strong>) attacks against wireless and Bluetooth communication</li>
    </ul>
    <h1 id="_idParaDest-165" class="heading-1">Introduction to wireless and Bluetooth technologies</h1>
    <p class="normal">Wireless <a id="_idIndexMarker646"/>technology <a id="_idIndexMarker647"/>provides the ability to communicate between two or more entities over distances without the use of wires or cables of any sort. This <a id="_idIndexMarker648"/>utilizes <strong class="keyWord">radio frequency</strong> (<strong class="keyWord">RF</strong>) as <a id="_idIndexMarker649"/>well as <strong class="keyWord">infrared</strong> (<strong class="keyWord">IR</strong>) waves. </p>
    <p class="normal"><em class="italic">Table 6.1</em> outlines the different wireless technologies with the IEEE standards they support, the radio frequency that they operate on, data bit rates, and network ranges and size:</p>
    <table id="table001-3" class="table-container">
      <tbody>
        <tr>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Name</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Bluetooth Classic</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Bluetooth 4.0 Low Energy (BLE)</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">ZigBee</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Wi-Fi</strong></p>
          </td>
          <td class="table-cell">
            <p class="normal"><strong class="keyWord">Wi-Fi 5/6</strong></p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">IEEE Standard</p>
          </td>
          <td class="table-cell">
            <p class="normal">802.15.1</p>
          </td>
          <td class="table-cell">
            <p class="normal">802.15.1</p>
          </td>
          <td class="table-cell">
            <p class="normal">802.15.4</p>
          </td>
          <td class="table-cell">
            <p class="normal">802.11 (a, b, g, n)</p>
          </td>
          <td class="table-cell">
            <p class="normal">802.11 (ac, ax)</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">Frequency (GHz)</p>
          </td>
          <td class="table-cell">
            <p class="normal">2.4</p>
          </td>
          <td class="table-cell">
            <p class="normal">2.4</p>
          </td>
          <td class="table-cell">
            <p class="normal">0.868, 0.915, 2.4</p>
          </td>
          <td class="table-cell">
            <p class="normal">2.4 and 5</p>
          </td>
          <td class="table-cell">
            <p class="normal">ac= 5, ax=2.4 and 5</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">Maximum raw bit rate (Mbps)</p>
          </td>
          <td class="table-cell">
            <p class="normal">1-3</p>
          </td>
          <td class="table-cell">
            <p class="normal">1</p>
          </td>
          <td class="table-cell">
            <p class="normal">0.250</p>
          </td>
          <td class="table-cell">
            <p class="normal">11 (b), 54 (g), 600 (n)</p>
          </td>
          <td class="table-cell">
            <p class="normal">433(ac)600.4 (ax)</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">Typical data throughput (Mbps)</p>
          </td>
          <td class="table-cell">
            <p class="normal">0.7-2.1</p>
          </td>
          <td class="table-cell">
            <p class="normal">0.27</p>
          </td>
          <td class="table-cell">
            <p class="normal">0.2</p>
          </td>
          <td class="table-cell">
            <p class="normal">7 (b), 25 (g), 150 (n)</p>
          </td>
          <td class="table-cell">
            <p class="normal">6933 (ac)9607.8(ax)</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">Maximum (Outdoor) Range (Meters)</p>
          </td>
          <td class="table-cell">
            <p class="normal">10 (class 2), 100 (class 1)</p>
          </td>
          <td class="table-cell">
            <p class="normal">50</p>
          </td>
          <td class="table-cell">
            <p class="normal">10-100</p>
          </td>
          <td class="table-cell">
            <p class="normal">100-250</p>
          </td>
          <td class="table-cell">
            <p class="normal">ac=35-110 ax=70-240</p>
          </td>
        </tr>
        <tr>
          <td class="table-cell">
            <p class="normal">Network Size</p>
          </td>
          <td class="table-cell">
            <p class="normal">7</p>
          </td>
          <td class="table-cell">
            <p class="normal">Undefined</p>
          </td>
          <td class="table-cell">
            <p class="normal">64,000+</p>
          </td>
          <td class="table-cell">
            <p class="normal">255</p>
          </td>
          <td class="table-cell">
            <p class="normal">8</p>
          </td>
        </tr>
      </tbody>
    </table>
    <p class="packt_figref">Table 6.1: A comparison of different types of wireless technologies</p>
    <p class="normal">In this chapter, we will focus on two main wireless technologies, Bluetooth and Wi-Fi. The main difference is Wi-Fi can provide long-range and high-speed internet and Bluetooth <a id="_idIndexMarker650"/>is<a id="_idIndexMarker651"/> designed for short-range devices for sharing information.</p>
    <h1 id="_idParaDest-166" class="heading-1">Configuring Kali for wireless attacks</h1>
    <p class="normal">Kali Linux<a id="_idIndexMarker652"/> is<a id="_idIndexMarker653"/> pre-equipped with several tools to facilitate the testing of wireless networks; however, these attacks require extensive configuration to be fully effective. In addition, testers should acquire a strong background in wireless networking before they implement attacks or audit a wireless network.</p>
    <p class="normal">The most important tool in wireless security testing is the wireless adapter, which connects to the<a id="_idIndexMarker654"/> wireless <strong class="keyWord">Access Point</strong> (<strong class="keyWord">AP</strong>). It must support the tools that are used, especially the <code class="inlineCode">aircrack-ng</code> suite of tools; in particular, the card’s chipset, and drivers must possess the ability to inject wireless packets into a communication stream. </p>
    <p class="normal">This is a requirement for attacks that require specific packet types to be injected into the traffic stream between the target and the victim. The injected packets can cause a DoS, allowing an attacker to capture handshake data that’s needed to crack encryption keys or support other wireless attacks.</p>
    <p class="normal">The most reliable adapters that you can use with Kali are the Alfa Network cards, especially the AWUS036NH or Wi-Fi Pineapple adapters or TP-Link N150 TL-WN722N version 1, which support wireless 802.11 b, g, and n protocols. Similarly, to perform the Bluetooth attacks, it is recommended you use an external dongle such as the TP-Link USB Bluetooth Adapter or WAVLINK Wireless Bluetooth CSR 4.0 Dongle. These cards generally cost less than $10 and are readily available online and will support all the tests and attacks that are delivered using Kali.</p>
    <h1 id="_idParaDest-167" class="heading-1">Wireless reconnaissance</h1>
    <p class="normal">The first step in<a id="_idIndexMarker655"/> conducting a wireless attack is to conduct reconnaissance—this identifies the exact target AP and highlights the other wireless networks that could impact testing.</p>
    <p class="normal">If you are using a USB-connected wireless card to connect to a Kali virtual machine, make sure that the USB connection has been disconnected from the host operating system and attached to the virtual machine. If you are using VirtualBox, select the Kali Linux virtual machine, then click on <strong class="screenText">Settings.</strong> Select the <strong class="screenText">USB </strong>category, then click on the USB icon with the <strong class="screenText">+</strong> symbol, then select the USB wireless or Bluetooth adapter. This should disconnect the USB from the host operating system and attach it to your VirtualBox. Similarly, for VMware, click on the <strong class="screenText">VM </strong>from the main menu, click <strong class="screenText">Removable devices</strong>, and select your wireless or Bluetooth device. </p>
    <p class="normal">Next, determine which wireless interfaces are available by running <code class="inlineCode">iwconfig</code> from the command line, as shown in <em class="italic">Figure 6.1</em>:</p>
    <figure class="mediaobject"><img src="../Images/B17765_06_01.png" alt=""/></figure>
    <p class="packt_figref">Figure 6.1: Wireless adapter list</p>
    <p class="normal">For certain attacks, you may wish to increase the power output of the adapter. This is especially useful if you are collocated with a legitimate wireless AP, and you want the targets to connect to a false AP under your control rather than the legitimate AP. These false, or <strong class="keyWord">rogue</strong>, APs allow an attacker to intercept data and view or alter it as needed to support an attack. Attackers will frequently copy or clone a legitimate wireless network and then increase its transmission power compared to the legitimate site as a means of attracting victims. To increase power, the following command is used:</p>
    <pre class="programlisting con"><code class="hljs-con">sudo iwconfig wlan0 txpower 30
</code></pre>
    <p class="normal">Many attacks will be conducted using <code class="inlineCode">aircrack-ng</code> and its related tools. To start, we need to intercept or monitor wireless transmissions; therefore, we need to set the Kali communication interface with wireless capabilities to monitor mode using the <code class="inlineCode">airmon-ng</code> command:</p>
    <pre class="programlisting con"><code class="hljs-con">sudo airmon-ng start wlan0
</code></pre>
    <p class="normal">The execution of<a id="_idIndexMarker656"/> the previous command is shown in <em class="italic">Figure 6.2</em>:</p>
    <figure class="mediaobject"><img src="../Images/B17765_06_02.png" alt=""/></figure>
    <p class="packt_figref">Figure 6.2: Starting the monitoring mode using airmon-ng</p>
    <p class="normal">Note that the description that is returned indicates that there are some processes that could cause trouble. The most effective way to deal with these processes is to use a comprehensive <code class="inlineCode">kill</code> command, as follows:</p>
    <pre class="programlisting con"><code class="hljs-con">sudo airmon-ng check kill
</code></pre>
    <p class="normal">To view the local wireless environment, use the following command:</p>
    <pre class="programlisting con"><code class="hljs-con">sudo airodump-ng wlan0mon
</code></pre>
    <p class="normal">The previous <a id="_idIndexMarker657"/>command lists all the identified networks that can be found within the range of the wireless adapter at that particular point in time. It <a id="_idIndexMarker658"/>provides the <strong class="keyWord">Basic Service Set Identifier</strong> (<strong class="keyWord">BSSID</strong>) of the wireless nodes on the network, as identified by the MAC addresses. </p>
    <div class="note">
      <p class="normal">A <strong class="keyWord">Media Access Control </strong>(<strong class="keyWord">MAC</strong>) address<a id="_idIndexMarker659"/> uniquely identifies each node in a network. It takes the form of six pairs of hexadecimal digits (0 to 9 and the letters A to F) that are separated by colons or dashes, and usually appears in this format: <code class="inlineCode">00:50:56:C0:00:01.</code></p>
    </div>
    <p class="normal">It also shows you an indication of the relative output power, information on data packets that have been sent, bandwidth information including the channel used and data, information on<a id="_idIndexMarker660"/> the encryption used, and the <strong class="keyWord">Extended Service Set Identifier</strong> (<strong class="keyWord">ESSID</strong>) that provides the name of the wireless network. This information is shown in <em class="italic">Figure 6.3</em>; non-essential ESSIDs have been blurred out:</p>
    <figure class="mediaobject"><img src="../Images/B17765_06_03.png" alt=""/></figure>
    <p class="packt_figref">Figure 6.3: airodump-ng actively identifying different wireless APs</p>
    <p class="normal">The <code class="inlineCode">airodump</code> command<a id="_idIndexMarker661"/> cycles through the available wireless channels 1-13 by default on 2.4 GHz and identifies the following:</p>
    <ul>
      <li class="bulletList">The <code class="inlineCode">BSSID</code>, which is the unique MAC address that identifies a wireless AP or router.</li>
      <li class="bulletList">The <code class="inlineCode">PWR</code>, or power, of each network. Although <code class="inlineCode">airodump-ng</code> incorrectly shows the power as being negative, this is a reporting artifact. To obtain the proper positive values, access a terminal and run <code class="inlineCode">airdriver-ng unload 36</code>, and then run <code class="inlineCode">airdriver-ng load 35</code>.</li>
      <li class="bulletList"><code class="inlineCode">CH</code> shows the channel that is being used to broadcast.</li>
      <li class="bulletList"><code class="inlineCode">ENC</code> shows the encryption in use—it is <code class="inlineCode">OPN</code>, or open, for no encryption being used, or <code class="inlineCode">WEP</code> or <code class="inlineCode">WPA</code>/<code class="inlineCode">WPA2</code> if encryption is being used. <code class="inlineCode">CIPHER</code> and <code class="inlineCode">AUTH</code> provide additional encryption information.</li>
      <li class="bulletList">The <code class="inlineCode">ESSID</code> is the common name of the wireless network and is made up of the APs that share the same SSID or name.</li>
    </ul>
    <p class="normal">In the lower section of the terminal window, you will see the stations attempting to connect, or that are connected to the wireless network.</p>
    <p class="normal">Before we can interact with any of these (potential) target networks, we have to confirm that our wireless adapter is capable of packet injection. To do this, run the following command from a terminal shell prompt:</p>
    <pre class="programlisting con"><code class="hljs-con">sudo aireplay-ng -9 wlan0mon
</code></pre>
    <p class="normal">Here, <code class="inlineCode">-9</code> indicates <a id="_idIndexMarker662"/>an injection test. That will provide the ability to inject the packets into the target Wi-Fi network. </p>
    <h1 id="_idParaDest-168" class="heading-1">Bypassing a hidden SSID</h1>
    <p class="normal">ESSID is the <a id="_idIndexMarker663"/>sequence of characters that uniquely identify a wireless local area network. Hiding the ESSID is a poor method of attempting to achieve security through obscurity; unfortunately, the ESSID can be obtained by doing either of the following:</p>
    <ul>
      <li class="bulletList">Sniffing the wireless environment and waiting for a client to associate to a network and then capturing that association</li>
      <li class="bulletList">Actively deauthenticating a client to force the client to associate and then capturing that association</li>
    </ul>
    <p class="normal">The <code class="inlineCode">aircrack</code> tools are particularly well suited to capture the data that’s needed to unhide a hidden ESSID, as shown in the following steps:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">At the command prompt, confirm that wireless is enabled on the attacking system by entering the following command:
        <pre class="programlisting con"><code class="hljs-con">sudo airmon-ng
</code></pre>
      </li>
      <li class="numberedList">Next, use the following <code class="inlineCode">ifconfig</code> command to review the available interfaces and to determine the exact name that’s used by your wireless system:
        <pre class="programlisting con"><code class="hljs-con">ifconfig
</code></pre>
      </li>
      <li class="numberedList">Enable your wireless interface by entering the following (you may need to replace <code class="inlineCode">wlan0</code> with an available wireless interface that was identified in the previous step):
        <pre class="programlisting con"><code class="hljs-con">sudo airmon-ng start wlan0
</code></pre>
      </li>
      <li class="numberedList">If you reconfirm with <code class="inlineCode">ifconfig</code>, you will see that there is now a monitoring or <code class="inlineCode">wlan0mon</code> address in use. Now use <code class="inlineCode">airodump</code> to confirm the available wireless networks by entering the following command, and attackers should be able to <a id="_idIndexMarker664"/>see the screen in <em class="italic">Figure 6.4</em>:
        <pre class="programlisting con"><code class="hljs-con">sudo airodump-ng wlan0mon
</code></pre>
        <figure class="mediaobject"><img src="../Images/B17765_06_04.png" alt=""/></figure>
        <p class="packt_figref">Figure 6.4: airodump displaying all the available wireless networks in range</p>
        <p class="normal">As you can see in <em class="italic">Figure 6.4</em>, the last network’s <code class="inlineCode">ESSID</code> is identified only as <code class="inlineCode">&lt;length: 0&gt;</code>. No other name or designation is used. The length of the hidden <code class="inlineCode">ESSID</code> is identified as being composed of nine characters; however, this value may not be correct because the <code class="inlineCode">ESSID</code> is hidden. The true <code class="inlineCode">ESSID</code> length may actually be shorter or longer than nine characters.</p>
        <p class="normal">What is important is that there may be clients attached to this particular network. If clients are present, we will deauthenticate the client, forcing them to send the <code class="inlineCode">ESSID</code> when they reconnect to the AP.</p>
      </li>
      <li class="numberedList">Rerun <code class="inlineCode">airodump</code> and filter out everything but the target AP. In this particular case, we will focus on collecting data from the hidden network on channel 11 using the following command:
        <pre class="programlisting con"><code class="hljs-con">sudo airodump-ng -c 11 wlan0mon
</code></pre>
        <p class="normal">Executing this command removes the output from the multiple wireless sources, and<a id="_idIndexMarker665"/> allows the attacker to focus on the target <code class="inlineCode">ESSID</code>, as shown in <em class="italic">Figure 6.5</em>:</p>
        <figure class="mediaobject"><img src="../Images/B17765_06_05.png" alt=""/></figure>
        <p class="packt_figref">Figure 6.5: airodump running on channel 11</p>
        <p class="normal">The data that we get when the <code class="inlineCode">airodump</code> command is executed indicates that there is one station (<code class="inlineCode">82:A4:64:7F:6D:88</code>) that is connected to the <code class="inlineCode">BSSID</code> (<code class="inlineCode">C0:05:C2:02:85:67</code>), which is, in turn, associated with the hidden <code class="inlineCode">ESSID</code>.</p>
      </li>
      <li class="numberedList">To capture the <code class="inlineCode">ESSID</code> as it is being transmitted, we need to create a condition where we know it will be sent—during the initial stage of the connection between a client and the AP.<p class="normal">Therefore, we will launch a deauthentication attack against both the client and the AP by sending a stream of packets that breaks the connection between them and forces the client to re-associate with the AP.</p>
        <p class="normal">To launch the attack, open a new command shell and enter the command that’s shown in the following screenshot (<code class="inlineCode">0</code> indicates that we are launching a deauthentication attack, <code class="inlineCode">10</code> indicates that we will send <code class="inlineCode">10</code> deauthentication packets, <code class="inlineCode">-a</code> is the target AP, and <code class="inlineCode">c</code> is the client’s MAC address):</p>
        <figure class="mediaobject"><img src="../Images/B17765_06_06.png" alt=""/></figure>
        <p class="packt_figref">Figure 6.6: Sending deauthentication packets to the connected station </p>
      </li>
      <li class="numberedList">After all the <a id="_idIndexMarker666"/>deauthentication packets have been sent, return to the original window that monitors the network connection on channel 11, as shown in <em class="italic">Figure 6.7</em>:<figure class="mediaobject"><img src="../Images/B17765_06_07.png" alt=""/></figure>
        <p class="packt_figref">Figure 6.7: Hidden ESSID is now visible in the airodump on channel 11</p>
      </li>
    </ol>
    <p class="normal">You will now see the <code class="inlineCode">ESSID</code> in the clear.</p>
    <p class="normal">Knowing the <code class="inlineCode">ESSID</code> helps an attacker to confirm that they are focused on the correct network (because <a id="_idIndexMarker667"/>most ESSIDs are based on the corporate identity) and facilitates the logon process.</p>
    <h1 id="_idParaDest-169" class="heading-1">Bypassing MAC address authentication and open authentication</h1>
    <p class="normal">A MAC address<a id="_idIndexMarker668"/> is usually <a id="_idIndexMarker669"/>associated with a network adapter or a device with networking capability; for this reason, it’s frequently called the physical address.</p>
    <p class="normal">The first three pairs of digits in the MAC address are called the Organizational Unique Identifier, and they serve to identify the company that manufactured or sold the device. The last three pairs of digits are specific to the device and can be considered to be a serial number.</p>
    <p class="normal">Because a MAC address is unique, it can be used to associate a user to a particular network, especially a wireless network. This has two significant implications—it can be used to identify a hacker or a legitimate network tester who has tried to access a network, and it can be used as a means of authenticating individuals and granting them access to a network.</p>
    <p class="normal">During penetration testing, the tester may prefer to appear anonymous to a network. One way to support this anonymous profile is to change the MAC address of the attacking system.</p>
    <p class="normal">This can be done manually using the <code class="inlineCode">ifconfig</code> command. To determine the existing MAC address, run the following from a command shell:</p>
    <pre class="programlisting con"><code class="hljs-con">sudo ifconfig wlan0 down
sudo ifconfig wlan0 | grep HW
</code></pre>
    <p class="normal">To manually change the IP address, use the following commands:</p>
    <pre class="programlisting con"><code class="hljs-con">sudo ifconfig wlan0 hw ether 38:33:15:xx:xx:xx
sudo ifconfig wlan0 up
</code></pre>
    <p class="normal">Substitute different hexadecimal pairs for the <code class="inlineCode">xx</code> expressions. This command will allow us to change the attacking system’s MAC address to one that is used and accepted by the victim network. The attacker must ensure that the MAC address is not already in use on the network, or the repeated MAC address may trigger an alarm if the network is being monitored.</p>
    <div class="note">
      <p class="normal">The wireless interface must be brought down before changing the MAC address.</p>
    </div>
    <p class="normal">Kali also <a id="_idIndexMarker670"/>permits <a id="_idIndexMarker671"/>the use of an automated tool, <code class="inlineCode">macchanger</code>. To change the attacker’s MAC address to a MAC address of a product produced by the same vendor, use the following <code class="inlineCode">macchanger</code> command from a terminal window:</p>
    <pre class="programlisting con"><code class="hljs-con">sudo macchanger wlan0 -e
</code></pre>
    <p class="normal">To change the existing MAC address to a completely random MAC address, use the following command :</p>
    <pre class="programlisting con"><code class="hljs-con">sudo macchanger wlan0 -r
</code></pre>
    <p class="normal">You should be able to see the <code class="inlineCode">macchanger</code> tool. <em class="italic">Figure 6.8 </em>provides the new MAC address assigned for our wireless adapter:</p>
    <figure class="mediaobject"><img src="../Images/B17765_06_08.png" alt=""/></figure>
    <p class="packt_figref">Figure 6.8: Changing the MAC address of the wireless adapter</p>
    <p class="normal">Some attackers <a id="_idIndexMarker672"/>use <a id="_idIndexMarker673"/>automated scripts to change their MAC addresses on a frequent basis during testing to anonymize their activities.</p>
    <p class="normal">Many organizations, particularly large academic groups, such as colleges and universities, use MAC address filtering to control who can access their wireless network resources. </p>
    <p class="normal">MAC address filtering uses the unique MAC address on the network card to control access to network resources; in a typical configuration, the organization maintains a whitelist of the MAC addresses that are permitted to access the network. If an incoming MAC address is not on the approved access list, it is restricted from connecting to the network.</p>
    <p class="normal">Unfortunately, MAC address information is transmitted in the clear text. An attacker can use <code class="inlineCode">airodump</code> to collect a list of accepted MAC addresses and then manually change their MAC address to one of the addresses that is accepted by the target network. Therefore, this type of filtering provides almost no real protection to a wireless network.</p>
    <p class="normal">The next level of wireless network protection is provided using encryption.</p>
    <h1 id="_idParaDest-170" class="heading-1">Attacking WPA and WPA2</h1>
    <p class="normal"><strong class="keyWord">Wi-Fi Protected Access</strong> (<strong class="keyWord">WPA</strong>) and <strong class="keyWord">Wi-Fi Protected Access 2</strong> (<strong class="keyWord">WPA2</strong>) are wireless security protocols<a id="_idIndexMarker674"/> that<a id="_idIndexMarker675"/> were intended to address the security shortcomings of WEP. Because the WPA protocols dynamically generate a new key for each packet, they prevent the statistical analysis that caused WEP to fail. Nevertheless, they are vulnerable to some attack techniques as well.</p>
    <p class="normal">WPA and WPA2 are frequently deployed with a <strong class="keyWord">pre-shared key</strong> (<strong class="keyWord">PSK</strong>) to secure communications between the AP and the wireless clients. The PSK should be a random passphrase of at least 13 characters in length; if not, it is possible to determine the PSK using a brute-force attack by comparing the PSK to a known dictionary. This is the most common attack.</p>
    <div class="note">
      <p class="normal">Note that if configured in the Enterprise mode, which provides authentication using a RADIUS authentication server, it might require a more powerful machine to crack the key or perform different types of MiTM attacks.</p>
    </div>
    <h2 id="_idParaDest-171" class="heading-2">Brute-force attacks</h2>
    <p class="normal">Unlike WEP, which <a id="_idIndexMarker676"/>can be broken using a statistical analysis of a large number of packets, WPA decryption requires the attacker to create specific packet types that reveal details, such as the handshake between the AP and the client.</p>
    <p class="normal">To attack a WPA transmission, the following steps should be performed:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Start the wireless adapter and use the <code class="inlineCode">ifconfig</code> command to ensure that the monitor interface has been created.</li>
      <li class="numberedList">Use <code class="inlineCode">sudo airodump-ng wlan0mon</code> to identify the target network.</li>
      <li class="numberedList">Start capturing traffic between the target AP and the client using the following command:
        <pre class="programlisting con"><code class="hljs-con">sudo airodump-ng --bssid F0:7D:68:44:61:EA -c 11 --showack --output-format pcap --write &lt;OUTPUT LOCATION&gt; wlan0mon
</code></pre>
      </li>
      <li class="numberedList">Set <code class="inlineCode">-c</code> to monitor a specific channel, <code class="inlineCode">--write</code> to write the output to a file for a dictionary attack later, and the <code class="inlineCode">--showack</code> flag to ensure that the client computer acknowledges your request to deauthenticate it from the wireless AP. A typical output from the above command is shown in <em class="italic">Figure 6.9</em>:<figure class="mediaobject"><img src="../Images/B17765_06_09.png" alt=""/></figure>
        <p class="packt_figref">Figure 6.9: airodump on specific BSSID on channel 11</p>
      </li>
      <li class="numberedList">Leave this <a id="_idIndexMarker677"/>terminal window open and open a second terminal window to launch a deauthentication attack; this will force the user to reauthenticate to the target AP and re-exchange the WPA key. The deauthentication attack command is shown as follows:
        <pre class="programlisting con"><code class="hljs-con">sudo aireplay-ng -0 10 -a &lt;BSSID&gt; -c &lt;STATION ID&gt; wlan0mon
</code></pre>
        <p class="normal"><em class="italic">Figure 6.10</em> shows <code class="inlineCode">aireplay-ng</code> in action for deauthenticating a station connected to a particular BSSID:</p>
        <figure class="mediaobject"><img src="../Images/B17765_06_10.png" alt=""/></figure>
        <p class="packt_figref">Figure 6.10: Deauthentication of the station from the BSSID</p>
      </li>
      <li class="numberedList">A successful deauthentication attack will show <code class="inlineCode">ACKs</code>, which indicates that the client who was connected to the target AP has acknowledged the deauthentication command that was just sent.</li>
      <li class="numberedList">Review the original command shell that was kept open to monitor the wireless transmission, and ensure that you capture the four-way handshake. A successful WPA handshake will be identified in the top-right corner of the console. In the<a id="_idIndexMarker678"/> following example, the data indicates a WPA handshake value of <code class="inlineCode">C2:B3:7B:17:00:B7</code>:<figure class="mediaobject"><img src="../Images/B17765_06_11.png" alt=""/></figure>
        <p class="packt_figref">Figure 6.11: Successful capture of a wireless handshake for a specific BSSID</p>
      </li>
      <li class="numberedList">Use <code class="inlineCode">aircrack</code> to crack the WPA key using a defined wordlist. The filename that was defined by the attacker for collecting handshake data will be located in the root directory, and the <code class="inlineCode">.cap</code> extension will be appended to it.</li>
    </ol>
    <p class="normal">In Kali, wordlists are located in the <code class="inlineCode">/usr/share/wordlists</code> directory. Although several wordlists are available, it is recommended that you download lists that will be more effective in breaking common passwords.</p>
    <p class="normal">In the previous example, the key was preplaced in the password list. Undertaking a dictionary attack<a id="_idIndexMarker679"/> for a long, complex password can take several hours, depending on the system configuration. The following command uses <code class="inlineCode">passwordlist</code> as the source wordlist (attackers can also utilize the password list located in the <code class="inlineCode">/usr/share/wordlists/</code><strong class="keyWord"> </strong>folder within Kali):</p>
    <pre class="programlisting con"><code class="hljs-con">sudo aircrack-ng -w passwordlist -b BSSID &lt;OUTPUT LOCATION&gt;Output.cap
</code></pre>
    <p class="normal"><em class="italic">Figure 6.12</em> shows the results from successfully cracking the WPA key; the key to the network named “Hidden” was found to be <code class="inlineCode">Letmein87</code> after testing six well-known keys:</p>
    <figure class="mediaobject"><img src="../Images/B17765_06_12.png" alt=""/></figure>
    <p class="packt_figref">Figure 6.12: Wireless adapter list</p>
    <p class="normal">If you don’t have a<a id="_idIndexMarker680"/> custom password list to hand or wish to rapidly generate a list, you can use the crunch application in Kali. The following command instructs crunch to create a wordlist of words with a minimum length of <code class="inlineCode">5</code> characters and a maximum length of <code class="inlineCode">25</code> characters using the given character set:</p>
    <pre class="programlisting con"><code class="hljs-con">sudo crunch 5 25 abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 | aircrack-ng --bssid (MAC address) -w nameofthewifi.cap
</code></pre>
    <p class="normal">As an additional option, you can also improve the effectiveness of the brute-force attack using GPU-based password cracking tools (oclHashcat for AMD/ATI graphics cards and cudaHashcat for NVIDIA graphics cards).</p>
    <p class="normal">To implement this attack, first convert the WPA handshake capture file, <code class="inlineCode">output.cap</code>, to a <code class="inlineCode">hashcat</code> file using the following command:</p>
    <pre class="programlisting con"><code class="hljs-con">sudo aircrack-ng nameofthewifi.cap -j &lt;output file&gt;
</code></pre>
    <p class="normal">When the conversion is completed, you should have a <code class="inlineCode">.hccapx</code> file in the same folder where the command was run. Now the attacker can execute the <code class="inlineCode">hashcat</code> against the new capture file (choose the version of <code class="inlineCode">hashcat</code> that matches your CPU architecture and your graphics card) using<a id="_idIndexMarker681"/> the following command :</p>
    <pre class="programlisting con"><code class="hljs-con">sudo hashcat -m 2500 &lt;filename&gt;.hccapx &lt;wordlist&gt;
</code></pre>
    <figure class="mediaobject"><img src="../Images/B17765_06_13.png" alt="Text  Description automatically generated"/></figure>
    <p class="packt_figref">Figure 6.13: Running hashcat on your VirtualBox using a host GPU</p>
    <div class="note">
      <p class="normal">One of the common issues noted while running hashcat in virtual containers such as VirtualBox or VMware is that users might not be able to run hashcat as expected, as 3.x version of hashcat requires GPUs. However, an alternative is to run the following command in the terminal: <code class="inlineCode">sudo apt-get install libhwloc-dev ocl-icd-dev ocl-icd-opencl-dev</code>. This will allow the testers to utilize the CPU power to run hashcat within the container.</p>
    </div>
    <p class="normal">If you have multiple GPUs, testers can utilize tools such as John the Ripper and <code class="inlineCode">cowpatty</code> to crack the password from the captured wireless traffic by using the following command in a terminal:</p>
    <pre class="programlisting con"><code class="hljs-con">sudo john –w=&lt;dictionaryfile&gt; --stdout | sudo cowpatty -r yourhandshake.cap -d - -s WIFIESSIDS
</code></pre>
    <p class="normal">Basically, John the Ripper will create a dictionary incrementally for all the characters, special characters, and numbers. Later, the output will be passed through to Pyrit to crack the <a id="_idIndexMarker682"/>password using the <code class="inlineCode">passthrough</code> keyword, and additionally, <code class="inlineCode">cowpatty</code> will crack the password for a particular <code class="inlineCode">WIFIESSID</code>.</p>
    <h2 id="_idParaDest-172" class="heading-2">Attacking wireless routers with Reaver</h2>
    <p class="normal">WPA and<a id="_idIndexMarker683"/> WPA2 are<a id="_idIndexMarker684"/> also vulnerable to attacks <a id="_idIndexMarker685"/>against an AP’s <strong class="keyWord">Wi-Fi Protected Setup</strong> (<strong class="keyWord">WPS</strong>) and PIN.</p>
    <p class="normal">Most APs support the WPS protocol, which emerged as a standard in 2006 to allow users to easily set up and configure APs and add new devices to an existing network without having to re-enter large and complex passphrases.</p>
    <p class="normal">Unfortunately, the PIN is an eight-digit number (100,000,000 possible guesses), but the last number is a checksum value. Because the WPS authentication protocol cuts the pin in half and validates each half separately, this means that there are 10<sup class="superscript">4</sup> (10,000) values for the first half of the pin, and 10<sup class="superscript">3</sup> (1,000) possible values for the second half—the attacker only has to make a maximum of 11,000 guesses to compromise the AP!</p>
    <p class="normal">Reaver is a tool that’s designed to maximize the guessing process (although Wifite also conducts WPS guesses).</p>
    <p class="normal">To start a Reaver attack, use the <code class="inlineCode">wash</code> companion tool to identify any vulnerable networks first, ensure the device is in monitoring mode by running <code class="inlineCode">sudo airmon-ng start wlan0</code>, and then run the following command:</p>
    <pre class="programlisting con"><code class="hljs-con">sudo wash -i wlan0mon --ignore-fcs
</code></pre>
    <p class="normal">If there are<a id="_idIndexMarker686"/> any <a id="_idIndexMarker687"/>vulnerable networks, launch an attack against them using the following command:</p>
    <pre class="programlisting con"><code class="hljs-con">sudo reaver -i wlan0mon -b (BSSID) -vv
</code></pre>
    <p class="normal">Attackers should be able to see the following screenshot when running the Reaver tool from the terminal:</p>
    <figure class="mediaobject"><img src="../Images/B17765_06_14.png" alt=""/></figure>
    <p class="packt_figref">Figure 6.14: reaver running on a specific BSSID</p>
    <p class="normal">Testing this attack in Kali has demonstrated that the attack is slow and prone to failure; however, it can be used as a background attack or can supplement other routes of attack <a id="_idIndexMarker688"/>to <a id="_idIndexMarker689"/>compromise the WPA network.</p>
    <h1 id="_idParaDest-173" class="heading-1">Denial of Service (DoS) attacks against wireless communications</h1>
    <p class="normal">The final<a id="_idIndexMarker690"/> attack against<a id="_idIndexMarker691"/> wireless networks that we’ll evaluate is DoS attacks, where an attacker deprives a legitimate user of access to a wireless network or makes the network unavailable by causing it to crash. Wireless networks are extremely susceptible to DoS attacks, and it is difficult to localize the attacker on a distributed wireless network. Examples of DoS attacks include the following:</p>
    <ul>
      <li class="bulletList">Injecting crafted network commands, such as reconfiguration commands, into a wireless network can cause the failure of routers, switches, and other network devices.</li>
      <li class="bulletList">Some devices and applications can recognize that an attack is taking place and will automatically respond by disabling the network. A malicious attacker can launch an obvious attack and then let the target create the DoS itself!</li>
      <li class="bulletList">Bombarding the wireless network with a flood of data packets can make it unavailable for use; for example, an HTTP flood attack making thousands of page requests to a web server can exhaust its processing ability. In the same way, flooding the network with authentication and association packets blocks users from connecting to the APs.</li>
      <li class="bulletList">Attackers can craft specific deauthentication and disassociation commands, which are used in wireless networks to close an authorized connection and flood the network, thereby stopping legitimate users from maintaining their connection to a wireless AP.</li>
    </ul>
    <p class="normal">To demonstrate this last point, we will create a DoS attack by flooding a network with deauthentication packets. Because the wireless 802.11 protocol is built to support deauthentication upon the receipt of a defined packet (so that a user can break a connection when it is no longer required), this can be a devastating attack—it complies with the standard, and there is no way to stop it from happening.</p>
    <p class="normal">The easiest way to bump a legitimate user off a network is to target them with a stream of deauthentication packets. This can be done with the help of the <code class="inlineCode">aircrack-ng</code> tool suite:</p>
    <pre class="programlisting con"><code class="hljs-con">sudo airmon-ng start wlan0
sudo aireplay-ng -0 0 -a (bssid) -c (station ID) wlan0mon
</code></pre>
    <p class="normal">This <a id="_idIndexMarker692"/>command <a id="_idIndexMarker693"/>identifies the attack type as <code class="inlineCode">-0</code>, indicating that it is for a deauthentication attack. The second <code class="inlineCode">0</code> (zero) launches a continuous stream of deauthentication packets, making the network unavailable to its users.</p>
    <p class="normal">The WebSploit framework is an open source tool that’s used to scan and analyze remote systems. It contains several tools, including tools that are specific to wireless attacks. It can be installed by running <code class="inlineCode">sudo apt install websploit</code> in the terminal. To launch it, open a command shell and simply type <code class="inlineCode">websploit</code>. </p>
    <p class="normal">The WebSploit interface is similar to that of <code class="inlineCode">recon-ng</code> and the Metasploit framework, and it presents the user with a modular interface.</p>
    <p class="normal">Once launched, use the <code class="inlineCode">show modules</code> command to see the attack modules that are present in the existing version. Select the <code class="inlineCode">Wi-Fi deauth</code> (a stream of deauthentication packets) using the <code class="inlineCode">use wifi_deauth</code> command. As shown in <em class="italic">Figure 6.15</em>, the attacker just has to use the <code class="inlineCode">set</code> commands to set the various options and then run <code class="inlineCode">execute</code> to launch the attack:</p>
    <figure class="mediaobject"><img src="../Images/B17765_06_15.png" alt=""/></figure>
    <p class="packt_figref">Figure 6.15: Using WebSploit to perform a deauthentication attack</p>
    <h1 id="_idParaDest-174" class="heading-1">Compromising enterprise implementations of WPA2</h1>
    <p class="normal">WPA-Enterprise<a id="_idIndexMarker694"/> is a technology<a id="_idIndexMarker695"/> that’s widely utilized in corporations. It does not use a single WPA-PSK, which most users use to connect to wireless networks. To maintain the governance and the flexibility of the domain accounts, corporations utilize WPA-Enterprise.</p>
    <p class="normal">A typical approach to compromising a WPA-Enterprise network would first be to enumerate the wireless devices and finally attack the connected clients to find out the authentication details. This consists of spoofing a target network and also providing a good signal to the client. Then, the original valid AP later leads into a MiTM attack between the AP and the clients connecting to the AP. To simulate a WPA-Enterprise attack, attackers must be physically near to the target when they have a range of APs. Attackers can also sniff the traffic using Wireshark to identify the wireless network traffic handshake.</p>
    <p class="normal">In this section, we will explore different tools that attackers would typically utilize to perform different types of attacks on WPA-/WPA2-Enterprise networks.</p>
    <p class="normal">Wifite is an automatic wireless attack tool that’s preinstalled in Kali Linux, and is written in Python. The latest<a id="_idIndexMarker696"/> version of Wifite<a id="_idIndexMarker697"/> is V2.5.8, which has previously known <code class="inlineCode">aircrack-ng</code> bugs.</p>
    <p class="normal">This tool utilizes the following attacks to extract the password of a wireless AP:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">WPS</strong>: The Offline <a id="_idIndexMarker698"/>Pixie Dust attack and the Online Brute-Force PIN attack</li>
      <li class="bulletList"><strong class="keyWord">WPA</strong>: The WPA Handshake Capture and offline crack, and the PMKID Hash Capture and offline crack</li>
      <li class="bulletList"><strong class="keyWord">WEP</strong>: All of the aforementioned attacks, including chop-chop, fragmentation, and aireplay injection</li>
    </ul>
    <p class="normal">Now we are all set to start Wifite so that we can perform a WPA four-way handshake capture and then perform an automatic password cracking attack. This tool can be directly launched from the terminal by typing <code class="inlineCode">sudo wifite</code>. The attacker will be presented with the interactive mode so that they can select an interface, as shown in <em class="italic">Figure 6.16</em>:</p>
    <figure class="mediaobject"><img src="../Images/B17765_06_16.png" alt=""/></figure>
    <p class="packt_figref">Figure 6.16: Wireless adapter list in wifite</p>
    <p class="normal">Once the interface has been selected, it should automatically enable the adapter in monitor mode and start to list all the Wi-Fi ESSIDs, channels, encryption, and power, regardless of <a id="_idIndexMarker699"/>whether <a id="_idIndexMarker700"/>or not they are WPS, as well as the number of clients connected to a particular ESSID. Once the target ESSID is selected, the attacker presses <em class="keystroke">Ctrl</em> + <em class="keystroke">C</em> on the keyboard, which will launch the attack.</p>
    <p class="normal">By default, four attack types are launched automatically. These are WPS Pixie Dust, WPS PIN, PMKID, and WPA Handshake. Attackers can choose to ignore the first three attacks if they aren’t relevant by pressing <em class="keystroke">Ctrl</em> + <em class="keystroke">C</em>. While the handshake is being captured, attackers can see which clients have been discovered that are connected to the station. Once the handshake has been captured, by default, a copy of the handshake will be stored in the current folder as <code class="inlineCode">hs/handshake_ESSID_MAC.cap</code>.</p>
    <p class="normal">Once the handshake has been successfully captured, it will be analyzed using <code class="inlineCode">tshark</code>, <code class="inlineCode">cowpatty</code> (this tool is not preinstalled in Kali Linux, so to install it, run <code class="inlineCode">sudo apt install cowpatty</code> in the terminal), and <code class="inlineCode">aircrack-ng</code>, which will validate the handshake for ESSID and BSSID.</p>
    <p class="normal">Wifite is programmed to automatically use a wordlist to run with <code class="inlineCode">aircrack-ng</code>. The custom wordlist can also be passed directly while launching Wifite by typing <code class="inlineCode">wifite --wpa --dict /path/customwordlist</code>. A successful handshake cracking would typically return the password for the wireless AP (router), as shown in <em class="italic">Figure 6.17</em>:</p>
    <figure class="mediaobject"><img src="../Images/B17765_06_17.png" alt=""/></figure>
    <p class="packt_figref">Figure 6.17: Wireless adapter list</p>
    <p class="normal">All the passwords will<a id="_idIndexMarker701"/> be <a id="_idIndexMarker702"/>saved in the <code class="inlineCode">cracked.txt</code> file in the current folder from where Wifite was run from. The tool has an anonymous feature that can change the MAC to a random address before attacking, and then change it back when the attacks are complete.</p>
    <h1 id="_idParaDest-175" class="heading-1">Working with bettercap</h1>
    <p class="normal">bettercap is one<a id="_idIndexMarker703"/> of the tools that attackers could utilize to better perform a Wi-Fi handshake capture attack within a few minutes. The tool is prepacked with the Wi-Fi hacking modules that can be very handy during a red team exercise or pentest. The following steps are involved to successfully capture a WPA2 handshake:</p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Ensure the wireless device is on the monitoring mode by running <code class="inlineCode">sudo airmon-ng start wlan0</code>.</li>
      <li class="numberedList">Run bettercap with the relevant interface from the terminal by entering <code class="inlineCode">sudo bettercap --iface wlan0mon</code>.</li>
      <li class="numberedList">Type <code class="inlineCode">wifi.recon on</code> in the bettercap terminal as shown in <em class="italic">Figure 6.18</em>:<figure class="mediaobject"><img src="../Images/B17765_06_18.png" alt=""/></figure>
        <p class="packt_figref">Figure 6.18: bettercap performing wireless network reconnaissance</p>
        <div class="note">
          <p class="normal">If you get error messages reading <code class="inlineCode">error while setting interface wlan0mon</code> when running <code class="inlineCode">wifi.recon on</code> in bettercap, ensure you have the older version of libpcap installed. You can download it using <code class="inlineCode">wget http://old.kali.org/kali/pool/main/libp/libpcap/libpcap0.8_1.9.1-4_amd64.deb </code>and then install it using <code class="inlineCode">dpkg -i libpcap0.8_1.9.1-4_amd64.deb</code>.</p>
        </div>
      </li>
      <li class="numberedList">To list all the Wi-Fi networks that are visible, enter <code class="inlineCode">wifi.show</code> in the bettercap terminal. </li>
      <li class="numberedList">Perform a deauthentication attack by running <code class="inlineCode">wifi.deauth &lt;BSSID&gt;</code>.</li>
      <li class="numberedList">After the deauthentication is succesful, when the station reconnects to the Wi-Fi network, the handshake must be captured by bettercap and stored in the <code class="inlineCode">/root/</code> folder as shown in <em class="italic">Figure 6.19</em> for BSSID <code class="inlineCode">c2:b3:7b:17:00:b7</code>:<figure class="mediaobject"><img src="../Images/B17765_06_19.png" alt=""/></figure>
        <p class="packt_figref">Figure 6.19: bettercap capturing the handshake of the wireless network</p>
      </li>
      <li class="numberedList">Finally, the <a id="_idIndexMarker704"/>same <code class="inlineCode">.pcap</code> file can be passed to <code class="inlineCode">aircrack-ng</code> or <code class="inlineCode">hashcat </code>to crack the password.</li>
    </ol>
    <h1 id="_idParaDest-176" class="heading-1">Evil Twin attack using Wifiphisher</h1>
    <p class="normal">One of the <a id="_idIndexMarker705"/>main<a id="_idIndexMarker706"/> issues that a majority of companies face is rogue APs within the range of their offices with the same name as their Wi-Fi network. In this section, we explore Wifiphisher, a rogue AP framework to conduct red team engagements or Wi-Fi penetration testing. Typically, we use this tool to perform effective MiTM attacks against clients that are associated with a Wi-Fi network.  </p>
    <p class="normal">This tool is not installed by default in Kali, hence attackers should install this tool by running <code class="inlineCode">sudo apt install wifiphisher</code> in the terminal. </p>
    <p class="normal">The following steps are involved in successfully performing an Evil Twin attack using Wifiphisher: </p>
    <ol class="numberedList" style="list-style-type: decimal;">
      <li class="numberedList" value="1">Once Wifiphisher is installed, launch the tool by running <code class="inlineCode">sudo wifiphisher</code> in the terminal, which should bring up the following screen with the list of available wireless networks: <figure class="mediaobject"><img src="../Images/B17765_06_20.png" alt=""/></figure>
        <p class="packt_figref">Figure 6.20: Wifiphisher identifying the list of wireless networks </p>
      </li>
      <li class="numberedList">Select<a id="_idIndexMarker707"/> the <a id="_idIndexMarker708"/>right ESSID/BSSID of the wireless target and hit <em class="keystroke">Enter</em>. This will enable our wireless adapter to copy and clone the AP. This should bring us to a screen to select the available phishing scenarios as shown in <em class="italic">Figure 6.21</em>:<figure class="mediaobject"><img src="../Images/B17765_06_21.png" alt=""/></figure>
        <p class="packt_figref">Figure 6.21: Wifiphisher’s predefined phishing templates</p>
      </li>
      <li class="numberedList">There are three built-in scenarios as shown in the preceding screenshot: a firmware upgrade page, network manager connect, and browser plugin update. We can select any of these options. In this example, we have selected option 2 to imitate a network manager window with a specific page and ask for a password. In the next step, the ESSID is copied with the same name and channel. Additionally, web and DHCP server is set, and all the connected stations will be disconnected using the deauthentication method. Internally, an AP is set up with another interface to capture the details<a id="_idIndexMarker709"/> entered <a id="_idIndexMarker710"/>by the victim as shown in <em class="italic">Figure 6.22</em>:<figure class="mediaobject"><img src="../Images/B17765_06_22.png" alt=""/></figure>
        <p class="packt_figref">Figure 6.22: Wifiphisher’s dashboard of active client connections to the fake AP</p>
      </li>
      <li class="numberedList">The wireless end clients are disconnected by the deauthentication attack and will not be able to connect to their Wi-Fi, since this tool also performs Wi-Fi jamming. (If attackers do not want to jam the network, it is recommended to use <code class="inlineCode">sudo wifiphisher –nojamming</code>.)</li>
      <li class="numberedList">Victims will now be able to see the Wi-Fi network as an open network, as seen in <em class="italic">Figure 6.23</em>: <figure class="mediaobject"><img src="../Images/B17765_06_23.png" alt=""/></figure>
        <p class="packt_figref">Figure 6.23: Insecure clone of our target wireless network</p>
      </li>
      <li class="numberedList">Once the<a id="_idIndexMarker711"/> user is <a id="_idIndexMarker712"/>connected to the free Wi-Fi, it will open the captive portal requesting the user to enter the password, as shown in <em class="italic">Figure 6.24</em>: <figure class="mediaobject"><img src="../Images/B17765_06_24.png" alt=""/></figure>
        <p class="packt_figref">Figure 6.24: Fake captive portal on the victim device</p>
      </li>
      <li class="numberedList">And that is it – whatever<a id="_idIndexMarker713"/> password the <a id="_idIndexMarker714"/>victim entered to connect to the attacker’s network is captured in Wifiphisher, and these entries can be used to create a password list dictionary to crack the handshake captured in the previous sections. Attackers should see the following screen when they close the Wifiphisher tool with <em class="keystroke">Ctrl</em> + <em class="keystroke">C</em>:<figure class="mediaobject"><img src="../Images/B17765_06_25.png" alt=""/></figure>
        <p class="packt_figref">Figure 6.25: List of passwords captured by the fake AP using Wifiphisher</p>
      </li>
    </ol>
    <h1 id="_idParaDest-177" class="heading-1">WPA3</h1>
    <p class="normal">Although the <a id="_idIndexMarker715"/>adoption of the third generation of WPA (WPA3) was introduced in January 2018 as a replacement for WPA2 to remedy the weaknesses of WPA2, it is not widely used. This standard utilizes 192-bit cryptographic strength and WPA3-Enterprise works with AES-256 in GCM mode with <strong class="keyWord">SHA-384</strong> (<strong class="keyWord">Secure Hashing Algorithm</strong>) as <strong class="keyWord">Hash-Based Message Authentication Code </strong>(<strong class="keyWord">HMAC</strong>) and still enforces the use of <strong class="keyWord">CCMP-128</strong> (<strong class="keyWord">Counter Mode </strong><strong class="keyWord"><a id="_idIndexMarker716"/></strong><strong class="keyWord">Cipher Block Chaining Message Protocol</strong>), which is <strong class="keyWord">AES-128</strong> (<strong class="keyWord">American Encryption Standard</strong>) in CCM mode and this is used as the minimum encryption algorithm in WPA3-Personal. </p>
    <p class="normal">Unlike <a id="_idIndexMarker717"/>WPA2’s <strong class="keyWord">Pre-Shared Key</strong> (<strong class="keyWord">PSK</strong>), WPA3<a id="_idIndexMarker718"/> utilizes <strong class="keyWord">Simultaneous Authentication of Equals</strong> (<strong class="keyWord">SAE</strong>), also known as Dragonfly. One <a id="_idIndexMarker719"/>quite interesting paper written by Mathy Vanhoef (<a href="https://papers.mathyvanhoef.com/usenix2021.pdf"><span class="url">https://papers.mathyvanhoef.com/usenix2021.pdf</span></a>) outlines the design flaws in the IEEE Standard 802.11 relating to frame fragmentation, aggregation, and Forge attacks. </p>
    <p class="normal">Although there are no readily available exploits, there are issues related to WPA3-Personal<a id="_idIndexMarker720"/> and the SAE authentication protocol it uses. </p>
    <h1 id="_idParaDest-178" class="heading-1">Bluetooth attacks</h1>
    <p class="normal">A casino was once <a id="_idIndexMarker721"/>hacked through a fish tank thermometer in the past, which shows the importance of securing devices that are part<a id="_idIndexMarker722"/> of the <strong class="keyWord">Internet of Things</strong> (<strong class="keyWord">IoT</strong>). Bluetooth is not an <a id="_idIndexMarker723"/>exception and <strong class="keyWord">Bluetooth Low Energy</strong> (<strong class="keyWord">BLE</strong>) devices are used extensively by consumers and corporations, hence it is important for attackers to understand how to probe and attack them. </p>
    <p class="normal">Important parts of the Bluetooth<a id="_idIndexMarker724"/> protocol layers are the following:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">Logical Link Control and Adaptation Protocol</strong> (<strong class="keyWord">L2CAP</strong>): This provides the data<a id="_idIndexMarker725"/> interface between the high layer data protocols and the applications. </li>
      <li class="bulletList"><strong class="keyWord">Radio Frequency Communications Protocol</strong> (<strong class="keyWord">RFCOMM</strong>): This emulates the functionalities<a id="_idIndexMarker726"/> required for serial communication interfaces such as EIA-RS-232 on a computer. RFCOMM can be accessed by AT commands and also the <strong class="keyWord">Wireless Application Protocol</strong> (<strong class="keyWord">WAP</strong>) through<a id="_idIndexMarker727"/> the <strong class="keyWord">Transmission Control Protocol/Internet Protocol</strong> (<strong class="keyWord">TCP/IP</strong>) stack<a id="_idIndexMarker728"/> and <strong class="keyWord">Object Exchange</strong> (<strong class="keyWord">OBEX</strong>) protocol. By default, data files, business <a id="_idIndexMarker729"/>cards, and calendar information can be shared without vendor dependencies.</li>
    </ul>
    <p class="normal">Bluetooth has three security modes:</p>
    <ul>
      <li class="bulletList"><strong class="keyWord">Security mode 1</strong> – This is <a id="_idIndexMarker730"/>an insecure mode, observed in old models of phones/devices.</li>
      <li class="bulletList"><strong class="keyWord">Security mode 2</strong> – In this mode, service-level security is enforced; for example, some access requires authorization and authentication to connect and use the service. </li>
      <li class="bulletList"><strong class="keyWord">Security mode 3</strong> – In this mode, link-level security is enforced, while Bluetooth itself uses trusted and untrusted devices.</li>
    </ul>
    <p class="normal">Kali Linux is pre-installed with device drivers (BlueZ, which is a set of tools to manage Bluetooth devices) to support Bluetooth devices. Similar to using <code class="inlineCode">iwconfig</code> to identify wireless adapters, we <a id="_idIndexMarker731"/>use <code class="inlineCode">sudo hciconfig -a</code> in the terminal to verify that our Bluetooth devices are connected and active. </p>
    <p class="normal">When running this command, you should see configuration information for the <code class="inlineCode">hci0</code> or <code class="inlineCode">hci1</code> adapter or both, as shown in <em class="italic">Figure 6.26</em>:</p>
    <figure class="mediaobject"><img src="../Images/B17765_06_26.png" alt=""/></figure>
    <p class="packt_figref">Figure 6.26: Bluetooth USB devices list</p>
    <p class="normal">The next step is to perform reconnaissance for any available Bluetooth devices within range by running <code class="inlineCode">sudo hcitool scan</code> in the terminal. This should bring us a list of devices that our adapter is able to reach and get responses from as shown in <em class="italic">Figure 6.27</em>:</p>
    <figure class="mediaobject"><img src="../Images/B17765_06_27.png" alt=""/></figure>
    <p class="packt_figref">Figure 6.27: Bluetooth reconnaissance using hcitool</p>
    <p class="normal">Similar to Wireshark, attackers <a id="_idIndexMarker732"/>can also leverage the hcidump tool to further debug the packets sent and received by the devices. </p>
    <p class="normal">Now that we have our target devices, the next step is to identify what type of services the devices support. This can be achieved by utilizing sdptool, preinstalled with Kali. The following command provides us with a list of services that the target device supports, as shown in <em class="italic">Figure 6.28</em>: </p>
    <pre class="programlisting con"><code class="hljs-con">sudo sdptool browse &lt;MAC address of the target&gt;
</code></pre>
    <figure class="mediaobject"><img src="../Images/B17765_06_28.png" alt=""/></figure>
    <p class="packt_figref">Figure 6.28: Running sdptool to browse on the target MAC</p>
    <p class="normal">Once these details are obtained, attackers can perform more advanced attacks such as bluesnarf (compromising the device to access its contact list, SMS, emails, or even private photos) or bluejacking (sending anonymous messages to other available Bluetooth devices). As these attacks are dependent on specific mobile device models, we will not be exploring them in this book. Attackers can choose to perform a DoS attack using the <code class="inlineCode">l2ping</code> utility. This is done simply by running <code class="inlineCode">sudo l2ping –s 100 &lt;MAC address&gt;</code> on the device, and<a id="_idIndexMarker733"/> once the target is down, you can use one of the social engineering tactics to pretend to be IT personnel.</p>
    <h1 id="_idParaDest-179" class="heading-1">Summary</h1>
    <p class="normal">In this chapter, we examined different tasks that are required to perform a successful attack against any wireless network and also how to configure the wireless modem and reconnaissance of APs using tools such as <code class="inlineCode">aircrack-ng</code>. In this chapter, we also learned the basics of Bluetooth and also about the complete suite of <code class="inlineCode">aircrack-ng</code> tools that are used to identify hidden networks, bypass MAC authentication, and compromise WPA, WPA2, and WPA-Enterprise. We also saw how we can utilize the automated tool Wifite to perform a quick capture of a handshake and crack passwords offline or with a good dictionary with the use of multiple options. Then, we took a deep dive into setting up a fake AP using Wifiphisher, and learned how to perform DoS attacks against wireless networks and Bluetooth devices.</p>
    <p class="normal">In the next chapter, we will focus on how to assess a website using a methodology that’s specific to this type of access, thereby conducting the reconnaissance and scanning that’s necessary to identify vulnerabilities that may be exploitable. We’ll see how attackers take advantage of these vulnerabilities with automated tools, such as exploit frameworks and online password cracking. Finally, we’ll be able to conduct the most important attacks against a web application and then leverage this access with a web shell to fully compromise the web services. We will also look into specific services and why and how they are vulnerable to DoS attacks.</p>
  </div>
</body></html>