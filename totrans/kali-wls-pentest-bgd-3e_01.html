<html><head></head><body><div class="chapter" title="Chapter&#xA0;1.&#xA0;Wireless Lab Setup"><div class="titlepage"><div><div><h1 class="title"><a id="ch01"/>Chapter 1. Wireless Lab Setup</h1></div></div></div><div class="blockquote"><table border="0" cellpadding="0" cellspacing="0" class="blockquote" summary="Block quote" width="100%"><tr><td valign="top"> </td><td valign="top"><p><span class="emphasis"><em>"If I had eight hours to chop down a tree, I'd spend six hours sharpening my axe."</em></span></p></td><td valign="top"> </td></tr><tr><td valign="top"> </td><td align="right" colspan="2" style="text-align: center" valign="top">--<span class="attribution"><span class="emphasis"><em>Abraham Lincoln, 16th US President</em></span></span></td></tr></table></div><p>
<span class="emphasis"><em>Behind every successful execution is hours or days of preparation, and wireless penetration testing is no exception. In this chapter, we will create a wireless lab that we will use for our experiments in this book. Consider this lab as your preparation arena before you dive into real-world penetration testing!</em></span>
</p><p>
<span class="emphasis"><em>Wireless penetration testing is a practical subject, and it is important to first set up a lab, where we can try out all the different experiments in this book in a safe and controlled environment. It is important that you set up this lab first before moving on in this book.</em></span>
</p><p>In this chapter, we will take a look at the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Hardware and software requirements</li><li class="listitem" style="list-style-type: disc">Installing Kali</li><li class="listitem" style="list-style-type: disc">Setting up an access point and configuring it</li><li class="listitem" style="list-style-type: disc">Installing the wireless card</li><li class="listitem" style="list-style-type: disc">Testing connectivity between the laptop and the access point</li></ul></div><p>So let the games begin!</p><div class="section" title="Hardware requirements"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec10"/>Hardware requirements</h1></div></div></div><p>We will need the following <a class="indexterm" id="id0"/>hardware to set up the wireless lab:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Two laptops with internal Wi-Fi cards</strong></span>: We will use one of the laptops as the victim in our lab and the other as the penetration<a class="indexterm" id="id1"/> tester's laptop. Though almost any laptop would fit this profile, laptops with at least 3 GB RAM are desirable. This is because we may be running a lot of memory-intensive software in our experiments.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>One wireless adapter (optional)</strong></span>: Depending on the wireless card of your laptop, we may need a USB Wi-Fi card that can support packet injection and packet sniffing, which is<a class="indexterm" id="id2"/> supported by Kali. The best choice seems to be the Alfa AWUS036H card from Alfa Networks, as Kali supports this out of the box. This is available on <a class="ulink" href="http://www.amazon.com">www.amazon.com</a> for a retail price of £18 at the time of writing. An alternative option is the Edimax EW-7711UAN, which is smaller and, marginally, cheaper.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>One access point</strong></span>: Any access<a class="indexterm" id="id3"/>8 point that supports WEP/WPA/WPA2 encryption standards would fit the bill. I will be using a TP-LINK TL-WR841N Wireless router for the purpose of illustration in this book. You can purchase it from <a class="ulink" href="http://www.amazon.com">www.amazon.com</a> for a retail price of around £20 at the time of writing.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>An internet connection</strong></span>: This will come in handy for performing research, downloading software, and for<a class="indexterm" id="id4"/> some of our experiments.</li></ul></div></div></div>
<div class="section" title="Software requirements"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec11"/>Software requirements</h1></div></div></div><p>We will need the following<a class="indexterm" id="id5"/> software to set up the wireless lab:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Kali</strong></span>: This software can be downloaded <a class="indexterm" id="id6"/>from the official website located at <a class="ulink" href="http://www.kali.org">http://www.kali.org</a>. The<a class="indexterm" id="id7"/> software is open source, and you should be able to download it directly from the website.</li><li class="listitem" style="list-style-type: disc"><span class="strong"><strong>Windows XP/Vista/7/10</strong></span>: You will need any one of Windows XP, Windows Vista, Windows 7, or Windows 10 installed<a class="indexterm" id="id8"/> on one of the laptops. This laptop will be used as the victim machine for the rest of the book.</li></ul></div><div class="note" style="" title="Note"><div class="inner"><h3 class="title"><a id="note02"/>Note</h3><p>Important to note is that even though we are using a Windows-based OS for our tests, the techniques learnt can be applied to any Wi-Fi-capable devices, such as smartphones and tablets, among others.</p></div></div></div>
<div class="section" title="Installing Kali"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec12"/>Installing Kali</h1></div></div></div><p>Let's now quickly take<a class="indexterm" id="id9"/> a look at how to get up and running with Kali.</p><p>Kali will be installed on the laptop that will serve as the penetration tester's machine for the rest of the book.</p></div>
<div class="section" title="Time for action &#x2013; installing Kali"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec13"/>Time for action – installing Kali</h1></div></div></div><p>Kali is relatively simple to install. We will run Kali by booting it as a live DVD, and then install it on the hard drive.</p><p>Perform the following instructions step by step:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Burn the Kali ISO (we are using the Kali 32-bit ISO) you downloaded, onto a bootable DVD.</li><li class="listitem">Boot the laptop with this DVD and select the option <span class="strong"><strong>Install</strong></span> from <span class="strong"><strong>Boot menu</strong></span>:<div class="mediaobject"><img alt="Time for action – installing Kali" src="graphics/B09903_01_01.jpg"/></div></li><li class="listitem">If booting was successful, then you should see an awesome retro screen as shown in the following screenshot:<div class="mediaobject"><img alt="Time for action – installing Kali" src="graphics/B09903_01_02.jpg"/></div></li><li class="listitem">This installer is<a class="indexterm" id="id10"/> similar to the GUI-based installers of most Linux systems and should be simple to follow. Select the appropriate options on every screen and start the installation process. Once the installation is done, restart the machine as prompted and remove the DVD.</li><li class="listitem">Once the machine restarts, a login screen will be displayed. Log in as <code class="literal">root</code> and the password is whatever you set it to during the installation process. You should now be logged into your installed version of Kali. Congratulations!</li><li class="listitem">I will change the desktop theme and some settings for this book. Feel free to use your own themes and color settings!</li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec10"/>
<span class="emphasis"><em>What just happened?</em></span>
</h2></div></div></div><p>We have successfully installed Kali on the laptop! We will use this laptop as the penetration tester's laptop for all other experiments in this book.</p></div><div class="section" title="Have a go hero – installing Kali on VirtualBox"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec11"/>Have a go hero – installing Kali on VirtualBox</h2></div></div></div><p>We can also install Kali<a class="indexterm" id="id11"/> within virtualization software such as VirtualBox. If you don't want to dedicate a full laptop to Kali, this is the best option. Kali's installation process in VirtualBox is exactly the same. The only difference is the pre-setup, which you will have to create in VirtualBox. Have a go at it! You can download <a class="indexterm" id="id12"/>VirtualBox from <a class="ulink" href="http://www.virtualbox.org">http://www.virtualbox.org</a>.</p><p>One of the other ways in which we can install and use Kali is via USB drives. This is particularly useful if you do not want to install on the hard drive, but still want to store persistent data, such as scripts and new tools, on your Kali instance. We encourage you to try this out as well!</p></div></div>
<div class="section" title="Setting up the access point"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec14"/>Setting up the access point</h1></div></div></div><p>Now we will set up the<a class="indexterm" id="id13"/> access point. As mentioned earlier, we will be using the TP-LINK TL-WR841N Wireless router for all the experiments in this book. However, feel free to use any other access point. The basic principles of operation and usage remain the same.</p></div>
<div class="section" title="Time for action &#x2013; configuring the access point"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec15"/>Time for action – configuring the access point</h1></div></div></div><p>Let's begin! We will set the access point up to use <span class="strong"><strong>Open Authentication</strong></span> (<span class="strong"><strong>OAuth</strong></span>) with an SSID of <code class="literal">Wireless Lab</code>.</p><p>Follow these<a class="indexterm" id="id14"/> instructions step by step:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Power on the access point, and use an Ethernet cable to connect your laptop to one of the access point's Ethernet ports.</li><li class="listitem">Enter the IP address of the access point configuration terminal in your browser. For TP-Link, it is by default <code class="literal">192.168.1.1</code>. You should consult your access point's setup guide to find its IP address. If you do not have the manuals for the access point, you can also find the IP address by running the <code class="literal">route –n</code> command. The gateway IP address is typically the access point's IP. Once you are connected, you should see a configuration portal that looks like the following <span class="strong"><strong>TP-LINK Wireless N Router WR841N</strong></span> emblazoned screenshot:<div class="mediaobject"><img alt="Time for action – configuring the access point" src="graphics/B09903_01_03.jpg"/></div></li><li class="listitem">Explore the<a class="indexterm" id="id15"/> various settings in the portal after logging in, and find the settings related to configuring a new SSID.</li><li class="listitem">Change the SSID to <code class="literal">Wireless Lab</code>. Depending on the access point, you may have to reboot it for the settings to change.</li><li class="listitem">Similarly, find the settings related to <span class="strong"><strong>Wireless Security</strong></span> and change the setting to <span class="strong"><strong>Disable Security</strong></span>. <span class="strong"><strong>Disable Security</strong></span> indicates that it is using the Open Authentication mode.<div class="mediaobject"><img alt="Time for action – configuring the access point" src="graphics/B09903_01_04.jpg"/></div></li><li class="listitem">Save the changes to<a class="indexterm" id="id16"/> the access point and reboot it, if required. Now your access point should be up-and-running with an SSID, <code class="literal">Wireless Lab</code>.</li></ol></div><p>An easy way to verify this is to use the wireless configuration utility in Windows and observe the available networks using the Windows laptop. You should find <code class="literal">Wireless Lab</code> as one of the networks in the listing:</p><div class="mediaobject"><img alt="Time for action – configuring the access point" src="graphics/B09903_01_05.jpg"/></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec12"/>
<span class="emphasis"><em>What just happened?</em></span>
</h2></div></div></div><p>We have <a class="indexterm" id="id17"/>successfully set up our access point with an SSID, <code class="literal">Wireless Lab</code>. It is broadcasting its presence, and this is being picked up by our Windows laptop and others<a class="indexterm" id="id18"/> within the <span class="strong"><strong>Radio Frequency</strong></span> (<span class="strong"><strong>RF</strong></span>) range of the access point.</p><p>Important to note is that we configured our access point in the <span class="strong"><strong>Open</strong></span> mode, which is the least secure. It is advisable not to connect this access point to the internet for the time being, as anyone within the RF range will be able to use it to access the internet.</p></div><div class="section" title="Have a go hero – configuring the access point to use WEP and WPA"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec13"/>Have a go hero – configuring the access point to use WEP and WPA</h2></div></div></div><p>Play around with the<a class="indexterm" id="id19"/> configuration options of your access point. Try to get it up-and-running using encryption schemes such as WEP and WPA/WPA2. We will use these modes in later chapters to illustrate attacks against them.</p></div></div>
<div class="section" title="Setting up the wireless card"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec16"/>Setting up the wireless card</h1></div></div></div><p>Setting up our wireless<a class="indexterm" id="id20"/> adapter is much easier than the access point. The advantage is that Kali supports this card out of the box and ships with all requisite device drivers to enable packet injection and packet sniffing.</p></div>
<div class="section" title="Time for action &#x2013; configuring your wireless card"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec17"/>Time for action – configuring your wireless card</h1></div></div></div><p>We will be using the<a class="indexterm" id="id21"/> wireless adapter with the penetration tester's laptop.</p><p>Follow these instructions step by step to set up your card:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Plug in the card to one of the Kali laptop's USB ports and boot it. Once you log in, open a console terminal and type in <code class="literal">iwconfig</code>. Your screen should look as follows:<div class="mediaobject"><img alt="Time for action – configuring your wireless card" src="graphics/B09903_01_06.jpg"/></div><p>As you can see, <code class="literal">wlan0</code> is the wireless interface created for the wireless adapter.</p><p>Type in <code class="literal">ifconfig wlan0 up</code> to bring the interface up. Then, type in <code class="literal">ifconfig wlan0</code> to see the current state of the interface:</p><div class="mediaobject"><img alt="Time for action – configuring your wireless card" src="graphics/B09903_01_07.jpg"/></div></li><li class="listitem">The MAC address <code class="literal">00:c0:ca:3e:bd:93</code> should look like the MAC address written under <a class="indexterm" id="id22"/>your Alfa card. I am using the Edimax that gives me the preceding MAC address <code class="literal">80:1f:02:8f:34:d5</code>. This is a quick check to ensure that you have enabled the correct interface.</li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec14"/>
<span class="emphasis"><em>What just happened?</em></span>
</h2></div></div></div><p>Kali ships with all the required drivers for the Alfa and Edimax adapters out of the box. As soon as the machine booted, the adapter was recognized and was assigned the network interface <code class="literal">wlan0</code>. Now our wireless adapter is up and functional!</p></div></div>
<div class="section" title="Connecting to the access point"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec18"/>Connecting to the access point</h1></div></div></div><p>Now we will take a look at<a class="indexterm" id="id23"/> how to connect to the access point using the wireless adapter. Our access point has an SSID, <code class="literal">Wireless Lab</code> and does not use any authentication.</p></div>
<div class="section" title="Time for action &#x2013; configuring your wireless card"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec19"/>Time for action – configuring your wireless card</h1></div></div></div><p>Here we go! Follow these steps to connect your wireless card to the access point:</p><div class="orderedlist"><ol class="orderedlist arabic"><li class="listitem">Let's first see <a class="indexterm" id="id24"/>what wireless networks our adapter is currently detecting. Issue the <code class="literal">iwlist wlan0 scanning</code> command, and you will find a list of networks in your vicinity:<div class="mediaobject"><img alt="Time for action – configuring your wireless card" src="graphics/B09903_01_08.jpg"/></div><p>Keep scrolling down and you should find the <code class="literal">Wireless Lab</code> network in this list. In my setup, it is detected as <code class="literal">Cell 05</code>; it may be different in yours. The <code class="literal">ESSID</code> field contains the network name.</p></li><li class="listitem">As multiple<a class="indexterm" id="id25"/> access points can have the same SSID, verify that the MAC address mentioned in the preceding <code class="literal">Address</code> field matches your access point's MAC. A fast and easy way to get the MAC address is underneath the access point or using web-based GUI settings.</li><li class="listitem">Now, issue the <code class="literal">iwconfig wlan0 essid "Wireless Lab"</code> command and then <code class="literal">iwconfig wlan0</code> to check the status. If you have successfully connected to the access point, you should see the MAC address of the access point in the <code class="literal">Access Point</code> field in the output of <code class="literal">iwconfig</code>.</li><li class="listitem">We know that the access point has a management interface IP address <code class="literal">192.168.0.1</code> from its manual. Alternately, this is the same as the default router IP address when we run the <code class="literal">route –n</code> command. Let's set our IP address in the same subnet by issuing the <code class="literal">ifconfig wlan0 192.168.0.2 netmask 255.255.255.0 up</code> command. Verify that the command succeeded by typing <code class="literal">ifconfig wlan0</code> and checking the output.</li><li class="listitem">Now let's ping the access point by issuing the <code class="literal">ping 192.168.0.1</code> command. If the network connection has been set up properly, then you should see the responses from the access point. You can additionally issue an <code class="literal">arp –a</code> command to verify that the response is coming from the access point. You should see that the MAC address of the IP <code class="literal">192.168.0.1</code> is the access point's MAC address we noted earlier. It is important to note that some of the more recent access points might have responses to the <span class="strong"><strong>Internet Control Message Protocol</strong></span> (<span class="strong"><strong>ICMP</strong></span>) echo request <a class="indexterm" id="id26"/>packets disabled. This is typically done to make the access point secure out of the box with only minimal configuration settings available. In such a case, you can try to launch a browser and access the web interface to verify that the connection is up-and-running:<div class="mediaobject"><img alt="Time for action – configuring your wireless card" src="graphics/B09903_01_09.jpg"/></div></li><li class="listitem">On the access <a class="indexterm" id="id27"/>point, we can verify connectivity by looking at the connection logs. As you can see in the following log, the MAC address of the wireless card <code class="literal">4C:0F:6E:70:BD:CB</code> has been logged making DHCP requests from the router:<div class="mediaobject"><img alt="Time for action – configuring your wireless card" src="graphics/B09903_01_10.jpg"/></div></li></ol></div><div class="section" title="What just happened?"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec15"/>
<span class="emphasis"><em>What just happened?</em></span>
</h2></div></div></div><p>We just connected to our access point successfully from Kali using our wireless adapter as the wireless device. We <a class="indexterm" id="id28"/>also learned how to verify that a connection has been established at both the wireless client and the access point side.</p></div><div class="section" title="Have a go hero – establishing a connection in a WEP configuration"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec16"/>Have a go hero – establishing a connection in a WEP configuration</h2></div></div></div><p>Here is a challenging exercise for you: set up the access point in a WEP configuration. For each of these, try establishing a connection with the access point using the wireless adapter. Hint: check the manual <a class="indexterm" id="id29"/>for the <code class="literal">iwconfig</code> command by typing <code class="literal">man iwconfig</code> to see how to configure the card to connect to WEP.</p></div><div class="section" title="Pop quiz – understanding the basics"><div class="titlepage"><div><div><h2 class="title"><a id="ch01lvl2sec17"/>Pop quiz – understanding the basics</h2></div></div></div><p>Q1. After issuing the <code class="literal">ifconfig wlan0</code> command, how do you verify that the wireless card is up and functional?</p><p>Q2. Can we run all our experiments using the Kali live CD alone? Can we not install the CD to the hard drive?</p><p>Q3. What does the <code class="literal">arp –a</code> command show?</p><p>Q4. Which tool should we use in Kali to connect to WPA/WPA2 networks?</p></div></div>
<div class="section" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="ch01lvl1sec20"/>Summary</h1></div></div></div><p>This chapter provided you with detailed instructions on how to set up your own wireless lab. Also, in the process, you learned the basic steps do the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Installing Kali on your hard drive and exploring other options such as virtual machines and USBs</li><li class="listitem" style="list-style-type: disc">Configuring your access point over the web interface</li><li class="listitem" style="list-style-type: disc">Understanding and using several commands to configure and use your wireless card</li><li class="listitem" style="list-style-type: disc">Verifying the connection state between the wireless client and the access point</li></ul></div><p>Gaining confidence in configuring the system is important for you. If you aren't confident, it is advisable that you repeat the preceding examples a couple of times. In later chapters, we will design more complicated scenarios.</p><p>In the next chapter, you will learn about inherent design-based insecurities in the WLANs design. We will use the network analyzer tool, Wireshark, to understand these concepts in a practical way.</p></div></body></html>